import{c,_ as H}from"./index-BwQ9Rjin.js";import{r as b,b as x,f as W,g as d,k as u,l as V,W as J,n as B,u as y,j as D,t as h,T as j,m as U,F as N,z as O,D as L,s as Z,i as _,Z as q}from"./vendor-Bfvy7Eak.js";const pe={async getFeed(e){return c.get("/posts/feed",e)},async getWallPosts(e,s){return c.get(`/walls/${e}/posts`,s)},async getPost(e){return c.get(`/posts/${e}`)},async createPost(e){const s=new FormData;return s.append("wall_id",e.wall_id.toString()),s.append("content",e.content),e.post_type&&s.append("post_type",e.post_type),e.visibility&&s.append("visibility",e.visibility),e.ai_application_id&&s.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((f,v)=>{s.append(`media_files[${v}]`,f)}),c.upload("/posts",s)},async updatePost(e,s){return c.patch(`/posts/${e}`,s)},async deletePost(e){return c.delete(`/posts/${e}`)},async reactToPost(e,s){return c.post(`/posts/${e}/reactions`,{reaction_type:s})},async removeReaction(e){return c.delete(`/posts/${e}/reactions`)},async sharePost(e,s,f){return c.post(`/posts/${e}/share`,{wall_id:s,content:f})},async incrementViewCount(e){return c.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return c.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return c.post(`/posts/${e}/open`)}};function G(e,s){const f=()=>({like:0,love:0,haha:0,wow:0,sad:0,angry:0}),v=b([]),o=b({total:0,by_type:f()}),l=b(null),C=b(!1),w=b(null),R=()=>typeof e=="string"?e:e.value,$=()=>typeof s=="number"?s:s.value,m={like:"ðŸ‘",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},k={like:"#3b82f6",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},g=()=>{const a=localStorage.getItem("user");if(a)try{return JSON.parse(a).user_id||0}catch(r){return console.error("Error parsing user from localStorage:",r),0}return 0},p=async()=>{var a,r;try{C.value=!0,w.value=null;const t=await c.get(`/reactions/${R()}/${$()}`);if(t&&typeof t=="object"&&"reactions"in t){v.value=Array.isArray(t.reactions)?t.reactions:[];const n={like:0,love:0,haha:0,wow:0,sad:0,angry:0},i=((a=t.stats)==null?void 0:a.by_type)||{},F={...n};Object.keys(n).forEach(S=>{S in i&&(F[S]=Number(i[S])||0)}),o.value={total:((r=t.stats)==null?void 0:r.total)||0,by_type:F};const z=g(),E=v.value.find(S=>S.user_id===z);l.value=E?E.reaction_type:null}else Array.isArray(t)?(v.value=t,o.value={total:t.length,by_type:f()}):(v.value=[],o.value={total:0,by_type:f()})}catch(t){w.value=t.message||"Failed to load reactions",console.error("Error loading reactions:",t)}finally{C.value=!1}},P=async a=>{const r=l.value,t=o.value.total,n={...o.value.by_type};try{l.value=a,o.value.total++,o.value.by_type[a]=(o.value.by_type[a]??0)+1,await c.post("/reactions",{reactable_type:R(),reactable_id:$(),reaction_type:a}),await p()}catch(i){throw l.value=r,o.value.total=t,o.value.by_type=n,w.value=i.message||"Failed to add reaction",i}},I=async()=>{const a=l.value,r=o.value.total,t={...o.value.by_type};if(a)try{l.value=null,o.value.total--,o.value.by_type[a]!==void 0&&(o.value.by_type[a]=Math.max(0,o.value.by_type[a]-1)),await c.delete(`/reactions/${R()}/${$()}`),await p()}catch(n){throw l.value=a,o.value.total=r,o.value.by_type=t,w.value=n.message||"Failed to remove reaction",n}},T=async a=>{l.value===a?await I():l.value?(await I(),await P(a)):await P(a)},M=x(()=>l.value?m[l.value]:"ðŸ¤"),A=x(()=>l.value?k[l.value]:"#94a3b8");return{reactions:v,stats:o,currentUserReaction:l,loading:C,error:w,reactionIcons:m,reactionColors:k,displayIcon:M,displayColor:A,loadReactions:p,addReaction:P,removeReaction:I,toggleReaction:T}}const K={class:"reaction-picker-container"},Q={class:"reaction-icon"},X={key:0,class:"reaction-count"},Y=["onClick","title"],ee={class:"modal-header"},te={class:"modal-body"},ae={class:"reaction-tabs"},se=["onClick"],oe={class:"reaction-users-list"},ne=["src","alt"],le={class:"username"},re={class:"reaction-emoji"},ie={key:0,class:"empty-state"},ce=W({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const s=e,{reactions:f,stats:v,currentUserReaction:o,reactionIcons:l,displayIcon:C,displayColor:w,loadReactions:R,toggleReaction:$}=G(b(s.reactableType),b(s.reactableId)),m=b(!1),k=b(!1),g=b("all");let p=null;const P=r=>{r.stopPropagation(),m.value=!m.value},I=()=>{p=setTimeout(()=>{m.value=!0},300)},T=()=>{p&&(clearTimeout(p),p=null),setTimeout(()=>{m.value&&(m.value=!1)},300)},M=()=>{p&&(clearTimeout(p),p=null)},A=async r=>{m.value=!1;try{await $(r)}catch(t){console.error("Failed to toggle reaction:",t)}},a=x(()=>g.value==="all"?f.value:f.value.filter(r=>r.reaction_type===g.value));return R(),(r,t)=>(_(),d("div",K,[u("button",{onClick:P,onMouseenter:I,onMouseleave:T,class:B(["reaction-button",{active:y(o)}]),style:J({color:y(w)})},[u("span",Q,h(y(C)),1),y(v).total>0?(_(),d("span",X,h(y(v).total),1)):D("",!0)],38),V(j,{name:"picker-fade"},{default:U(()=>[m.value?(_(),d("div",{key:0,class:"reaction-picker",onMouseenter:M,onMouseleave:T},[(_(!0),d(N,null,O(y(l),(n,i)=>(_(),d("button",{key:i,onClick:F=>A(i),class:B(["reaction-option",{selected:y(o)===i}]),title:i},h(n),11,Y))),128))],32)):D("",!0)]),_:1}),V(j,{name:"modal-fade"},{default:U(()=>[k.value?(_(),d("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=n=>k.value=!1)},[u("div",{class:"modal-content",onClick:t[2]||(t[2]=L(()=>{},["stop"]))},[u("div",ee,[t[4]||(t[4]=u("h3",null,"Reactions",-1)),u("button",{onClick:t[0]||(t[0]=n=>k.value=!1),class:"btn-close"},"Ã—")]),u("div",te,[u("div",ae,[u("button",{onClick:t[1]||(t[1]=n=>g.value="all"),class:B(["tab-button",{active:g.value==="all"}])}," All "+h(y(v).total),3),(_(!0),d(N,null,O(y(v).by_type,(n,i)=>Z((_(),d("button",{key:i,onClick:F=>g.value=i,class:B(["tab-button",{active:g.value===i}])},h(y(l)[i])+" "+h(n),11,se)),[[q,n>0]])),128))]),u("div",oe,[(_(!0),d(N,null,O(a.value,n=>(_(),d("div",{key:n.reaction_id,class:"reaction-user-item"},[u("img",{src:n.avatar_url||"/assets/images/default-avatar.svg",alt:n.username,class:"user-avatar"},null,8,ne),u("span",le,h(n.username),1),u("span",re,h(y(l)[n.reaction_type]),1)]))),128)),a.value.length===0?(_(),d("div",ie," No reactions yet ")):D("",!0)])])])])):D("",!0)]),_:1})]))}}),de=H(ce,[["__scopeId","data-v-7f6eb01c"]]);export{de as R,pe as p};
//# sourceMappingURL=ReactionPicker-C42v5s3c.js.map
