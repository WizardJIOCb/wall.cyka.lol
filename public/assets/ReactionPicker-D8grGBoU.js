import{c,_ as H}from"./index-BB417rzM.js";import{r as m,b as j,f as W,w as J,g as d,k as p,l as E,W as L,n as F,u as y,j as B,t as h,T as V,m as z,F as A,z as O,D as Z,s as q,i as _,Z as G}from"./vendor-Bfvy7Eak.js";const de={async getFeed(e){return c.get("/posts/feed",e)},async getWallPosts(e,a){return c.get(`/walls/${e}/posts`,a)},async getPost(e){return c.get(`/posts/${e}`)},async createPost(e){const a=new FormData;return a.append("wall_id",e.wall_id.toString()),a.append("content",e.content),e.post_type&&a.append("post_type",e.post_type),e.visibility&&a.append("visibility",e.visibility),e.ai_application_id&&a.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((f,v)=>{a.append(`media_files[${v}]`,f)}),c.upload("/posts",a)},async updatePost(e,a){return c.patch(`/posts/${e}`,a)},async deletePost(e){return c.delete(`/posts/${e}`)},async reactToPost(e,a){return c.post(`/posts/${e}/reactions`,{reaction_type:a})},async removeReaction(e){return c.delete(`/posts/${e}/reactions`)},async sharePost(e,a,f){return c.post(`/posts/${e}/share`,{wall_id:a,content:f})},async incrementViewCount(e){return c.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return c.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return c.post(`/posts/${e}/open`)}};function K(e,a){const f=()=>({like:0,love:0,haha:0,wow:0,sad:0,angry:0}),v=m([]),s=m({total:0,by_type:f()}),l=m(null),R=m(!1),w=m(null),k=()=>typeof e=="string"?e:e.value,$=()=>typeof a=="number"?a:a.value,g={like:"ðŸ‘",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},C={like:"#3b82f6",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},b=()=>{const o=localStorage.getItem("user");if(console.log("User string from localStorage:",o),o)try{const r=JSON.parse(o);console.log("Parsed user object:",r);const t=r.user_id||0;return console.log("User ID:",t),t}catch(r){return console.error("Error parsing user from localStorage:",r),0}return console.log("No user found in localStorage"),0},u=async()=>{var o,r;try{R.value=!0,w.value=null;const t=await c.get(`/reactions/${k()}/${$()}`);if(t&&typeof t=="object"&&"reactions"in t){v.value=Array.isArray(t.reactions)?t.reactions:[];const n={like:0,love:0,haha:0,wow:0,sad:0,angry:0},i=((o=t.stats)==null?void 0:o.by_type)||{},D={...n};Object.keys(n).forEach(S=>{S in i&&(D[S]=Number(i[S])||0)}),s.value={total:((r=t.stats)==null?void 0:r.total)||0,by_type:D};const x=b();console.log("Current user ID:",x),console.log("Reactions array:",v.value);const U=v.value.find(S=>S.user_id===x);console.log("User reaction found:",U),l.value=U?U.reaction_type:null,console.log("Current user reaction set to:",l.value)}else Array.isArray(t)?(v.value=t,s.value={total:t.length,by_type:f()}):(v.value=[],s.value={total:0,by_type:f()})}catch(t){w.value=t.message||"Failed to load reactions",console.error("Error loading reactions:",t)}finally{R.value=!1}},P=async o=>{const r=l.value,t=s.value.total,n={...s.value.by_type};try{l.value=o,s.value.total++,s.value.by_type[o]=(s.value.by_type[o]??0)+1,await c.post("/reactions",{reactable_type:k(),reactable_id:$(),reaction_type:o}),await u()}catch(i){throw l.value=r,s.value.total=t,s.value.by_type=n,w.value=i.message||"Failed to add reaction",i}},I=async()=>{const o=l.value,r=s.value.total,t={...s.value.by_type};if(o)try{l.value=null,s.value.total--,s.value.by_type[o]!==void 0&&(s.value.by_type[o]=Math.max(0,s.value.by_type[o]-1)),await c.delete(`/reactions/${k()}/${$()}`),await u()}catch(n){throw l.value=o,s.value.total=r,s.value.by_type=t,w.value=n.message||"Failed to remove reaction",n}},T=async o=>{l.value===o?await I():l.value?(await I(),await P(o)):await P(o)},M=j(()=>l.value?g[l.value]:"ðŸ¤"),N=j(()=>l.value?C[l.value]:"#94a3b8");return{reactions:v,stats:s,currentUserReaction:l,loading:R,error:w,reactionIcons:g,reactionColors:C,displayIcon:M,displayColor:N,loadReactions:u,addReaction:P,removeReaction:I,toggleReaction:T}}const Q={class:"reaction-picker-container"},X={class:"reaction-icon"},Y={key:0,class:"reaction-count"},ee=["onClick","title"],te={class:"modal-header"},ae={class:"modal-body"},oe={class:"reaction-tabs"},se=["onClick"],ne={class:"reaction-users-list"},le=["src","alt"],re={class:"username"},ie={class:"reaction-emoji"},ce={key:0,class:"empty-state"},ue=W({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const a=e,{reactions:f,stats:v,currentUserReaction:s,reactionIcons:l,displayIcon:R,displayColor:w,loadReactions:k,toggleReaction:$}=K(m(a.reactableType),m(a.reactableId));J(()=>[a.reactableType,a.reactableId],()=>{k()});const g=m(!1),C=m(!1),b=m("all");let u=null;const P=r=>{r.stopPropagation(),g.value=!g.value},I=()=>{u&&clearTimeout(u),u=setTimeout(()=>{g.value=!0},150)},T=()=>{u&&(clearTimeout(u),u=null),u=setTimeout(()=>{g.value=!1},300)},M=()=>{u&&(clearTimeout(u),u=null)},N=async r=>{g.value=!1;try{await $(r)}catch(t){console.error("Failed to toggle reaction:",t)}},o=j(()=>b.value==="all"?f.value:f.value.filter(r=>r.reaction_type===b.value));return k(),(r,t)=>(_(),d("div",Q,[p("button",{onClick:P,onMouseenter:I,onMouseleave:T,class:F(["reaction-button",{active:y(s)}]),style:L({color:y(w)})},[p("span",X,h(y(R)),1),y(v).total>0?(_(),d("span",Y,h(y(v).total),1)):B("",!0)],38),E(V,{name:"picker-fade"},{default:z(()=>[g.value?(_(),d("div",{key:0,class:"reaction-picker",onMouseenter:M,onMouseleave:T},[(_(!0),d(A,null,O(y(l),(n,i)=>(_(),d("button",{key:i,onClick:D=>N(i),class:F(["reaction-option",{selected:y(s)===i}]),title:i},h(n),11,ee))),128))],32)):B("",!0)]),_:1}),E(V,{name:"modal-fade"},{default:z(()=>[C.value?(_(),d("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=n=>C.value=!1)},[p("div",{class:"modal-content",onClick:t[2]||(t[2]=Z(()=>{},["stop"]))},[p("div",te,[t[4]||(t[4]=p("h3",null,"Reactions",-1)),p("button",{onClick:t[0]||(t[0]=n=>C.value=!1),class:"btn-close"},"Ã—")]),p("div",ae,[p("div",oe,[p("button",{onClick:t[1]||(t[1]=n=>b.value="all"),class:F(["tab-button",{active:b.value==="all"}])}," All "+h(y(v).total),3),(_(!0),d(A,null,O(y(v).by_type,(n,i)=>q((_(),d("button",{key:i,onClick:D=>b.value=i,class:F(["tab-button",{active:b.value===i}])},h(y(l)[i])+" "+h(n),11,se)),[[G,n>0]])),128))]),p("div",ne,[(_(!0),d(A,null,O(o.value,n=>(_(),d("div",{key:n.reaction_id,class:"reaction-user-item"},[p("img",{src:n.avatar_url||"/assets/images/default-avatar.svg",alt:n.username,class:"user-avatar"},null,8,le),p("span",re,h(n.username),1),p("span",ie,h(y(l)[n.reaction_type]),1)]))),128)),o.value.length===0?(_(),d("div",ce," No reactions yet ")):B("",!0)])])])])):B("",!0)]),_:1})]))}}),ye=H(ue,[["__scopeId","data-v-79b47ca8"]]);export{ye as R,de as p};
//# sourceMappingURL=ReactionPicker-D8grGBoU.js.map
