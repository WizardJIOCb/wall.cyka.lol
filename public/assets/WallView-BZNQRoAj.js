import{f as tt,r as m,b as E,e as st,o as et,g as o,k as s,j as _,t as u,U,F as $,x as j,R as at,v as ot,n as nt,y as lt,u as it,i as n}from"./vendor-B5QdKGWw.js";import{u as rt,b as g,_ as ct}from"./index-PzoI_kRW.js";import"./utils-i9HKr1_Q.js";const dt={class:"wall-view"},ut={key:0,class:"loading-container"},pt={key:1,class:"error-container"},_t={key:2,class:"wall-content"},vt={class:"wall-header"},mt={class:"wall-info"},ht={class:"wall-avatar"},ft=["src","alt"],wt={class:"wall-details"},yt={class:"wall-title"},gt={key:0,class:"wall-owner"},bt={key:1,class:"wall-description"},kt={class:"wall-stats"},Ct={class:"stat"},It={class:"stat-value"},At={class:"stat"},Mt={class:"stat-value"},Pt={class:"posts-section"},$t={key:0,class:"loading-posts"},Tt={key:1,class:"empty-state"},Lt={key:2,class:"posts-grid"},St={key:0,class:"ai-generation-status"},Ft={class:"progress-bar"},xt={class:"status-text"},Dt={class:"post-header"},Et=["src","alt"],Ut={class:"post-meta"},jt={class:"post-author"},Gt={class:"post-time"},Ot={class:"post-content"},Rt=["innerHTML"],Ht={key:1},Wt={key:1,class:"ai-content-preview"},Nt={class:"ai-preview-prompt"},qt={key:0,class:"ai-preview-code"},Vt=["onClick"],Bt={key:2,class:"post-media"},zt=["src","alt"],Jt={class:"post-actions"},Yt={class:"action-btn"},Kt={class:"action-btn"},Qt={class:"action-btn"},Xt={key:3,class:"load-more"},Zt={class:"modal-content ai-modal"},ts={key:0,class:"modal-body"},ss={class:"ai-modal-section"},es={class:"ai-prompt-full"},as={key:0,class:"ai-modal-section"},os={class:"section-header"},ns={class:"code-block"},ls={key:1,class:"ai-modal-section"},is={class:"section-header"},rs={class:"code-block"},cs={key:2,class:"ai-modal-section"},ds={class:"section-header"},us={class:"code-block"},T=20,ps=tt({__name:"WallView",props:{wallId:{}},setup(G){const O=G;it();const R=ot(),L=rt(),b=m(!0),y=m(!1),f=m(null),c=m(null),v=m([]),k=m(1),S=m(!0);let w=null;const H=E(()=>c.value&&L.user&&c.value.user_id===L.user.id),W=E(()=>{var e;return(e=c.value)!=null&&e.theme?{backgroundColor:c.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),N=e=>{const t=new Date(e),i=new Date().getTime()-t.getTime(),l=Math.floor(i/6e4),r=Math.floor(i/36e5),a=Math.floor(i/864e5);return l<1?"just now":l<60?`${l}m ago`:r<24?`${r}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()},q=async()=>{var e,t,d,i;try{b.value=!0,f.value=null;let l=O.wallId||R.params.wallId;if(!l)throw new Error("No wall identifier provided");let r;if(l==="me"?r=await g.get("/walls/me"):r=await g.get(`/walls/${l}`),r!=null&&r.success&&((e=r==null?void 0:r.data)!=null&&e.wall))c.value=r.data.wall,await C();else throw new Error((r==null?void 0:r.message)||"Wall not found")}catch(l){console.error("Error loading wall:",l),((t=l.response)==null?void 0:t.status)===404?f.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":f.value=((i=(d=l.response)==null?void 0:d.data)==null?void 0:i.message)||l.message||"Failed to load wall"}finally{b.value=!1}},C=async(e=!1)=>{var t;if(c.value)try{e||(y.value=!0);const d=(k.value-1)*T,i=await g.get(`/walls/${c.value.wall_id}/posts?limit=${T}&offset=${d}`);if(i!=null&&i.success&&((t=i==null?void 0:i.data)!=null&&t.posts)){const l=i.data.posts;k.value===1?e?V(l):v.value=l:v.value=[...v.value,...l],S.value=l.length===T,B()}}catch(d){console.error("Error loading posts:",d)}finally{e||(y.value=!1)}},V=e=>{const t=new Map(e.map(d=>[d.post_id,d]));v.value.forEach((d,i)=>{const l=t.get(d.post_id);l&&(d.ai_status!==l.ai_status&&(v.value[i]={...d,...l}),t.delete(d.post_id))}),t.size>0&&(v.value=[...Array.from(t.values()),...v.value])},B=()=>{v.value.some(t=>t.post_type==="ai_app"&&(t.ai_status==="queued"||t.ai_status==="processing"))?z():F()},z=()=>{w||(w=setInterval(async()=>{await C(!0)},3e3))},F=()=>{w&&(clearInterval(w),w=null)},J=()=>{k.value++,C()},Y=()=>{console.log("Create post functionality coming soon")},K=e=>({queued:10,processing:60,completed:100,failed:0})[e]||0,Q=e=>({queued:"Waiting in queue...",processing:"Generating your application...",completed:"Generation complete!",failed:"Generation failed"})[e]||"Processing...",x=(e,t)=>e?e.length<=t?e:e.substring(0,t)+"...":"",p=m(null),I=m(!1),X=async e=>{try{console.log("Opening AI modal for post:",e),console.log("AI app ID:",e.ai_app_id);const t=await g.get(`/ai/apps/${e.ai_app_id}`);console.log("API Response:",t),t&&t.data&&t.data.app?(p.value={...e,ai_content:t.data.app},console.log("Selected AI Post:",p.value),I.value=!0,console.log("Modal should be visible now")):(console.error("Unexpected response structure:",t),alert("Failed to load AI content: Invalid response structure"))}catch(t){console.error("Error loading AI content:",t),alert("Failed to load AI content: "+(t.message||"Unknown error"))}},A=()=>{I.value=!1,p.value=null},M=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{alert(`${t} copied to clipboard!`)})},Z=()=>{var D;if(!((D=p.value)!=null&&D.ai_content))return;const e=p.value.ai_content,r=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Generated App</title>
  <style>
${e.css_content||""}
  </style>
</head>
<body>
${e.html_content||""}
  <script>
${e.js_content||""}
  <\/script>
</body>
</html>`,a=new Blob([r],{type:"text/html"}),h=URL.createObjectURL(a),P=document.createElement("a");P.href=h,P.download=`ai-app-${p.value.post_id}.html`,P.click(),URL.revokeObjectURL(h)};return st(()=>{q()}),et(()=>{F()}),(e,t)=>{var d,i,l,r;return n(),o($,null,[s("div",dt,[b.value?(n(),o("div",ut,[...t[4]||(t[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):f.value?(n(),o("div",pt,[t[5]||(t[5]=s("h2",null,"Error Loading Wall",-1)),s("p",null,u(f.value),1),s("button",{onClick:t[0]||(t[0]=a=>e.$router.push("/")),class:"btn-primary"},"Go Home")])):c.value?(n(),o("div",_t,[s("div",vt,[s("div",{class:"wall-banner",style:U(W.value)},null,4),s("div",mt,[s("div",ht,[s("img",{src:c.value.owner_avatar||c.value.avatar_url||"/assets/images/default-avatar.svg",alt:c.value.owner_username||c.value.display_name},null,8,ft)]),s("div",wt,[s("h1",yt,u(c.value.display_name),1),c.value.owner_username?(n(),o("p",gt,"by @"+u(c.value.owner_username),1)):_("",!0),c.value.description?(n(),o("p",bt,u(c.value.description),1)):_("",!0)]),s("div",kt,[s("div",Ct,[s("span",It,u(c.value.posts_count||0),1),t[6]||(t[6]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",At,[s("span",Mt,u(c.value.subscribers_count||0),1),t[7]||(t[7]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",Pt,[t[17]||(t[17]=s("h2",{class:"section-title"},"Posts",-1)),y.value?(n(),o("div",$t,[...t[8]||(t[8]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):v.value.length===0?(n(),o("div",Tt,[t[9]||(t[9]=s("p",null,"No posts yet on this wall.",-1)),H.value?(n(),o("button",{key:0,onClick:Y,class:"btn-primary"},"Create First Post")):_("",!0)])):(n(),o("div",Lt,[(n(!0),o($,null,j(v.value,a=>(n(),o("div",{key:a.post_id,class:nt(["post-card",{"ai-post":a.post_type==="ai_app"}])},[a.post_type==="ai_app"&&a.ai_status!=="completed"?(n(),o("div",St,[t[10]||(t[10]=s("div",{class:"status-header"},[s("span",{class:"status-icon"},"🤖"),s("h3",null,"AI Application Generating...")],-1)),s("div",Ft,[s("div",{class:"progress-fill",style:U({width:K(a.ai_status)+"%"})},null,4)]),s("p",xt,u(Q(a.ai_status)),1)])):_("",!0),s("div",Dt,[s("img",{src:a.author_avatar||"/assets/images/default-avatar.svg",alt:a.author_username,class:"post-avatar"},null,8,Et),s("div",Ut,[s("span",jt,"@"+u(a.author_username),1),s("span",Gt,u(N(a.created_at)),1)])]),s("div",Ot,[a.content_html?(n(),o("div",{key:0,innerHTML:a.content_html},null,8,Rt)):(n(),o("p",Ht,u(a.content_text),1))]),a.post_type==="ai_app"&&a.ai_status==="completed"&&a.ai_content?(n(),o("div",Wt,[t[13]||(t[13]=s("div",{class:"ai-preview-header"},[s("span",{class:"preview-icon"},"✨"),s("h4",null,"Generated Application")],-1)),s("div",Nt,[t[11]||(t[11]=s("strong",null,"Prompt:",-1)),lt(" "+u(x(a.ai_content.user_prompt,150)),1)]),a.ai_content.html_content?(n(),o("div",qt,[s("pre",null,u(x(a.ai_content.html_content,200)),1)])):_("",!0),s("button",{onClick:h=>X(a),class:"btn-open-ai"},[...t[12]||(t[12]=[s("span",{class:"icon"},"👁️",-1),s("span",null,"Open Full Content",-1)])],8,Vt)])):_("",!0),a.media_attachments&&a.media_attachments.length>0?(n(),o("div",Bt,[(n(!0),o($,null,j(a.media_attachments,h=>(n(),o("img",{key:h.attachment_id,src:h.file_url,alt:h.file_name},null,8,zt))),128))])):_("",!0),s("div",Jt,[s("button",Yt,[t[14]||(t[14]=s("span",{class:"icon"},"👍",-1)),s("span",null,u(a.reaction_count||0),1)]),s("button",Kt,[t[15]||(t[15]=s("span",{class:"icon"},"💬",-1)),s("span",null,u(a.comment_count||0),1)]),s("button",Qt,[t[16]||(t[16]=s("span",{class:"icon"},"👁",-1)),s("span",null,u(a.view_count||0),1)])])],2))),128))])),S.value&&!y.value?(n(),o("div",Xt,[s("button",{onClick:J,class:"btn-secondary"},"Load More")])):_("",!0)])])):_("",!0)]),I.value?(n(),o("div",{key:0,class:"modal-overlay",onClick:at(A,["self"])},[s("div",Zt,[s("div",{class:"modal-header"},[t[18]||(t[18]=s("h2",null,"✨ AI Generated Application",-1)),s("button",{onClick:A,class:"btn-close"},"×")]),p.value?(n(),o("div",ts,[s("div",ss,[t[19]||(t[19]=s("h3",null,"📝 Prompt",-1)),s("div",es,u(((d=p.value.ai_content)==null?void 0:d.user_prompt)||"No prompt available"),1)]),(i=p.value.ai_content)!=null&&i.html_content?(n(),o("div",as,[s("div",os,[t[20]||(t[20]=s("h3",null,"🌐 HTML",-1)),s("button",{onClick:t[1]||(t[1]=a=>M(p.value.ai_content.html_content,"HTML")),class:"btn-copy-small"},"📋 Copy")]),s("pre",ns,u(p.value.ai_content.html_content),1)])):_("",!0),(l=p.value.ai_content)!=null&&l.css_content?(n(),o("div",ls,[s("div",is,[t[21]||(t[21]=s("h3",null,"🎨 CSS",-1)),s("button",{onClick:t[2]||(t[2]=a=>M(p.value.ai_content.css_content,"CSS")),class:"btn-copy-small"},"📋 Copy")]),s("pre",rs,u(p.value.ai_content.css_content),1)])):_("",!0),(r=p.value.ai_content)!=null&&r.js_content?(n(),o("div",cs,[s("div",ds,[t[22]||(t[22]=s("h3",null,"⚡ JavaScript",-1)),s("button",{onClick:t[3]||(t[3]=a=>M(p.value.ai_content.js_content,"JavaScript")),class:"btn-copy-small"},"📋 Copy")]),s("pre",us,u(p.value.ai_content.js_content),1)])):_("",!0)])):_("",!0),s("div",{class:"modal-footer"},[s("button",{onClick:Z,class:"btn-primary"},[...t[23]||(t[23]=[s("span",null,"📥",-1),s("span",null,"Download Full App",-1)])]),s("button",{onClick:A,class:"btn-secondary"},"Close")])])])):_("",!0)],64)}}}),hs=ct(ps,[["__scopeId","data-v-f3e3c241"]]);export{hs as default};
//# sourceMappingURL=WallView-BZNQRoAj.js.map
