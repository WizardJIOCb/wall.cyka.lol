import{e as L,r as c,b as S,i as U,f as o,k as a,h as _,t as n,F as M,s as N,n as x,v as A,Q as Y,V as j,o as i}from"./vendor-Cy2yCxOA.js";import{b as p,_ as z}from"./index-CKQhb95x.js";import"./utils-i9HKr1_Q.js";const H={class:"notifications-view"},Q={class:"notifications-header"},q=["disabled"],G={class:"filter-tabs"},J=["onClick"],K={key:0,class:"badge"},O={class:"notifications-container"},P={key:0,class:"loading-container"},W={key:1,class:"empty-state"},X={key:2,class:"notifications-list"},Z=["onClick"],tt={class:"notification-avatar"},et=["src","alt"],at={class:"notification-type-icon"},st={class:"notification-content"},ot={class:"notification-text"},nt={key:0,class:"notification-preview"},it={class:"notification-time"},rt={class:"notification-actions"},lt=["onClick"],ct={key:3,class:"load-more"},dt=L({__name:"NotificationsView",setup(ut){const f=j(),v=c(!0),m=c(!1),r=c([]),l=c(0),d=c("all"),y=c(1),h=c(!0),E=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"mentions",label:"Mentions"},{id:"reactions",label:"Reactions"},{id:"comments",label:"Comments"},{id:"follows",label:"Follows"}],k=S(()=>d.value==="all"?r.value:d.value==="unread"?r.value.filter(t=>!t.is_read):r.value.filter(t=>t.notification_type===d.value.slice(0,-1))),V=t=>({follow:"👥",reaction:"❤️",comment:"💬",reply:"💬",mention:"@",bricks:"🧱",ai_complete:"🤖"})[t]||"🔔",D=t=>{var e;return{follow:"started following you",reaction:`reacted to your ${t.target_type}`,comment:"commented on your post",reply:"replied to your comment",mention:`mentioned you in a ${t.target_type}`,bricks:`sent you ${((e=t.content)==null?void 0:e.amount)||0} bricks`,ai_complete:"Your AI application is ready"}[t.notification_type]||"sent you a notification"},R=t=>{const s=new Date(t),u=new Date().getTime()-s.getTime(),g=Math.floor(u/6e4),$=Math.floor(u/36e5),C=Math.floor(u/864e5);return g<1?"just now":g<60?`${g}m ago`:$<24?`${$}h ago`:C<7?`${C}d ago`:s.toLocaleDateString()},b=async()=>{try{v.value=!0;const t=20,s=(y.value-1)*t,e=await p.get(`/notifications?limit=${t}&offset=${s}`);e.data.success&&e.data.data.notifications&&(y.value===1?r.value=e.data.data.notifications:r.value=[...r.value,...e.data.data.notifications],h.value=e.data.data.notifications.length===t)}catch(t){console.error("Error loading notifications:",t)}finally{v.value=!1}},T=async()=>{try{const t=await p.get("/notifications/unread-count");t.data.success&&(l.value=t.data.data.unread_count||0)}catch(t){console.error("Error loading unread count:",t)}},w=async t=>{try{await p.patch(`/notifications/${t}/read`);const s=r.value.find(e=>e.notification_id===t);s&&(s.is_read=!0,l.value=Math.max(0,l.value-1))}catch(s){console.error("Error marking notification as read:",s)}},F=async()=>{try{m.value=!0,await p.post("/notifications/mark-all-read"),r.value.forEach(t=>{t.is_read=!0}),l.value=0}catch(t){console.error("Error marking all as read:",t)}finally{m.value=!1}},B=async t=>{t.is_read||await w(t.notification_id),t.target_type==="post"&&t.target_id?f.push(`/post/${t.target_id}`):t.target_type==="wall"&&t.target_id?f.push(`/wall/${t.target_id}`):t.target_type==="user"&&t.actor_id?f.push(`/profile/${t.actor_username}`):t.target_type==="ai_app"&&t.target_id&&f.push(`/ai/${t.target_id}`)},I=()=>{y.value++,b()};return U(()=>{b(),T()}),(t,s)=>(i(),o("div",H,[a("div",Q,[a("h1",null,n(t.$t("navigation.notifications")),1),l.value>0?(i(),o("button",{key:0,onClick:F,class:"btn-secondary",disabled:m.value},n(m.value?"Marking...":"Mark all as read"),9,q)):_("",!0)]),a("div",G,[(i(),o(M,null,N(E,e=>a("button",{key:e.id,class:x(["filter-tab",{active:d.value===e.id}]),onClick:u=>d.value=e.id},[A(n(e.label)+" ",1),e.id==="unread"&&l.value>0?(i(),o("span",K,n(l.value),1)):_("",!0)],10,J)),64))]),a("div",O,[v.value?(i(),o("div",P,[s[0]||(s[0]=a("div",{class:"spinner"},null,-1)),a("p",null,n(t.$t("common.labels.loading")),1)])):k.value.length===0?(i(),o("div",W,[s[1]||(s[1]=a("span",{class:"empty-icon"},"🔔",-1)),s[2]||(s[2]=a("h2",null,"No notifications",-1)),a("p",null,n(d.value==="unread"?"You're all caught up!":"No notifications to show"),1)])):(i(),o("div",X,[(i(!0),o(M,null,N(k.value,e=>(i(),o("div",{key:e.notification_id,class:x(["notification-item",{unread:!e.is_read}]),onClick:u=>B(e)},[a("div",tt,[a("img",{src:e.actor_avatar||"/assets/images/default-avatar.svg",alt:e.actor_username},null,8,et),a("span",at,n(V(e.notification_type)),1)]),a("div",st,[a("div",ot,[a("strong",null,n(e.actor_username),1),A(" "+n(D(e)),1)]),e.target_preview?(i(),o("div",nt,n(e.target_preview),1)):_("",!0),a("div",it,n(R(e.created_at)),1)]),a("div",rt,[e.is_read?_("",!0):(i(),o("button",{key:0,onClick:Y(u=>w(e.notification_id),["stop"]),class:"mark-read-btn",title:"Mark as read"}," ✓ ",8,lt))])],10,Z))),128))])),h.value&&!v.value?(i(),o("div",ct,[a("button",{onClick:I,class:"btn-secondary"},n(t.$t("common.buttons.loadMore")),1)])):_("",!0)])]))}}),mt=z(dt,[["__scopeId","data-v-e27ac00a"]]);export{mt as default};
//# sourceMappingURL=NotificationsView-hJJrD-G0.js.map
