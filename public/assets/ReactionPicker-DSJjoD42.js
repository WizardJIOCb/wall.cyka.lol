import{c as i,_ as L}from"./index-CW9PQZPk.js";import{r as u,b as V,f as Z,w as q,g as m,k as p,B as G,l as z,u as d,W as H,n as M,j as O,t as $,C as K,T as X,m as W,F as j,z as E,D as Q,s as ee,Y,i as f,Z as te}from"./vendor-Bfvy7Eak.js";const ge={async getFeed(e){return i.get("/posts/feed",e)},async getWallPosts(e,t){return i.get(`/walls/${e}/posts`,t)},async getPost(e){return i.get(`/posts/${e}`)},async createPost(e){const t=new FormData;return t.append("wall_id",e.wall_id.toString()),t.append("content",e.content),e.post_type&&t.append("post_type",e.post_type),e.visibility&&t.append("visibility",e.visibility),e.ai_application_id&&t.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((_,c)=>{t.append(`media_files[${c}]`,_)}),i.upload("/posts",t)},async updatePost(e,t){return i.patch(`/posts/${e}`,t)},async deletePost(e){return i.delete(`/posts/${e}`)},async reactToPost(e,t){return i.post(`/posts/${e}/reactions`,{reaction_type:t})},async removeReaction(e){return i.delete(`/posts/${e}/reactions`)},async sharePost(e,t,_){return i.post(`/posts/${e}/share`,{wall_id:t,content:_})},async incrementViewCount(e){return i.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return i.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return i.post(`/posts/${e}/open`)}};function ae(e,t){const _=()=>({like:0,dislike:0,love:0,haha:0,wow:0,sad:0,angry:0}),c=u([]),o=u({total:0,by_type:_()}),l=u(null),P=u(!1),I=u(null),B=()=>typeof e=="string"?e:e.value,S=()=>typeof t=="number"?t:t.value,N={like:"ðŸ‘",dislike:"ðŸ‘Ž",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},g={like:"#3b82f6",dislike:"#94a3b8",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},D=()=>{const s=localStorage.getItem("wall_user");if(console.log("User string from localStorage:",s),s)try{const r=JSON.parse(s);console.log("Parsed user object:",r);const n=r.id||r.user_id||0;return console.log("User ID:",n),n}catch(r){return console.error("Error parsing user from localStorage:",r),0}return console.log("No user found in localStorage"),0},h=async()=>{var s,r;try{P.value=!0,I.value=null;const n=await i.get(`/reactions/${B()}/${S()}`);if(n&&typeof n=="object"&&"reactions"in n){c.value=Array.isArray(n.reactions)?n.reactions:[];const k={like:0,dislike:0,love:0,haha:0,wow:0,sad:0,angry:0},T=((s=n.stats)==null?void 0:s.by_type)||{},U={...k};Object.keys(k).forEach(a=>{a in T&&(U[a]=Number(T[a])||0)}),o.value={total:((r=n.stats)==null?void 0:r.total)||0,by_type:U};const A=D();console.log("Current user ID:",A),console.log("Reactions array:",c.value);const b=c.value.find(a=>a.user_id===A);console.log("User reaction found:",b),l.value=b?b.reaction_type:null,console.log("Current user reaction set to:",l.value)}else Array.isArray(n)?(c.value=n,o.value={total:n.length,by_type:_()}):(c.value=[],o.value={total:0,by_type:_()})}catch(n){I.value=n.message||"Failed to load reactions",console.error("Error loading reactions:",n),c.value=[],o.value={total:0,by_type:_()}}finally{P.value=!1}},R=async s=>{const r=l.value,n=o.value.total,k={...o.value.by_type};try{l.value=s,o.value.total++,o.value.by_type[s]=(o.value.by_type[s]??0)+1,await i.post("/reactions",{reactable_type:B(),reactable_id:S(),reaction_type:s})}catch(T){throw l.value=r,o.value.total=n,o.value.by_type=k,I.value=T.message||"Failed to add reaction",T}},x=async()=>{const s=l.value,r=o.value.total,n={...o.value.by_type};if(s)try{l.value=null,o.value.total--,o.value.by_type[s]!==void 0&&(o.value.by_type[s]=Math.max(0,o.value.by_type[s]-1)),await i.delete(`/reactions/${B()}/${S()}`)}catch(k){throw l.value=s,o.value.total=r,o.value.by_type=n,I.value=k.message||"Failed to remove reaction",k}},F=async s=>{l.value===s?await x():l.value?(await x(),await R(s)):await R(s),await h()},C=V(()=>l.value?N[l.value]:"ðŸ¤"),y=V(()=>l.value?g[l.value]:"#94a3b8");return{reactions:c,stats:o,currentUserReaction:l,loading:P,error:I,reactionIcons:N,reactionColors:g,displayIcon:C,displayColor:y,loadReactions:h,addReaction:R,removeReaction:x,toggleReaction:F}}const oe=["disabled"],se={class:"reaction-icon"},ne={key:0,class:"reaction-count"},le=["onClick","title","disabled"],re={class:"modal-header"},ie={class:"modal-body"},ce={class:"reaction-tabs"},ue=["onClick"],ve={class:"reaction-users-list"},pe=["src","alt"],de={class:"username"},ye={class:"reaction-emoji"},fe={key:0,class:"empty-state"},_e=Z({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const t=e,{reactions:_,stats:c,currentUserReaction:o,loading:l,reactionIcons:P,displayIcon:I,displayColor:B,loadReactions:S,toggleReaction:N}=ae(u(t.reactableType),u(t.reactableId));q(()=>[t.reactableType,t.reactableId],()=>{S()});const g=u(!1),D=u(!1),h=u("all"),R=u(!1),x=u(null),F=u(null),C=u({position:"fixed",top:"0px",left:"0px",transform:"translateX(-50%)",zIndex:"9999"});let y=null;const s=b=>{b.stopPropagation(),g.value=!g.value,g.value&&Y(()=>{r()})},r=()=>{if(!F.value||!x.value)return;const a=F.value.getBoundingClientRect();a.bottom+200>window.innerHeight?(R.value=!0,C.value.top=`${a.top-4}px`):(R.value=!1,C.value.top=`${a.bottom+4}px`),C.value.left=`${a.left+a.width/2}px`,R.value?C.value.transform="translateX(-50%) translateY(-100%)":C.value.transform="translateX(-50%)"},n=()=>{y&&clearTimeout(y),y=setTimeout(()=>{g.value=!0,Y(()=>{r()})},150)},k=()=>{y&&(clearTimeout(y),y=null),y=setTimeout(()=>{g.value=!1},300)},T=()=>{y&&(clearTimeout(y),y=null)},U=async b=>{g.value=!1;try{await N(b)}catch(a){console.error("Failed to toggle reaction:",a)}},A=V(()=>h.value==="all"?_.value:_.value.filter(b=>b.reaction_type===h.value));return S(),(b,a)=>(f(),m("div",{class:"reaction-picker-container",ref_key:"containerRef",ref:F},[p("button",{onClick:s,onMouseenter:n,onMouseleave:k,class:M(["reaction-button",{active:d(o)}]),style:H({color:d(B)}),disabled:d(l)},[p("span",se,$(d(I)),1),d(c).total>0?(f(),m("span",ne,$(d(c).total),1)):O("",!0)],46,oe),(f(),G(K,{to:"body"},[z(X,{name:"picker-fade"},{default:W(()=>[g.value?(f(),m("div",{key:0,ref_key:"pickerRef",ref:x,class:M(["reaction-picker",{"position-above":R.value}]),style:H(C.value),onMouseenter:T,onMouseleave:k},[(f(!0),m(j,null,E(d(P),(v,w)=>(f(),m("button",{key:w,onClick:J=>U(w),class:M(["reaction-option",{selected:d(o)===w}]),title:w,disabled:d(l)},$(v),11,le))),128))],38)):O("",!0)]),_:1})])),z(X,{name:"modal-fade"},{default:W(()=>[D.value?(f(),m("div",{key:0,class:"modal-overlay",onClick:a[3]||(a[3]=v=>D.value=!1)},[p("div",{class:"modal-content",onClick:a[2]||(a[2]=Q(()=>{},["stop"]))},[p("div",re,[a[4]||(a[4]=p("h3",null,"Reactions",-1)),p("button",{onClick:a[0]||(a[0]=v=>D.value=!1),class:"btn-close"},"Ã—")]),p("div",ie,[p("div",ce,[p("button",{onClick:a[1]||(a[1]=v=>h.value="all"),class:M(["tab-button",{active:h.value==="all"}])}," All "+$(d(c).total),3),(f(!0),m(j,null,E(d(c).by_type,(v,w)=>ee((f(),m("button",{key:w,onClick:J=>h.value=w,class:M(["tab-button",{active:h.value===w}])},$(d(P)[w])+" "+$(v),11,ue)),[[te,v>0]])),128))]),p("div",ve,[(f(!0),m(j,null,E(A.value,v=>(f(),m("div",{key:v.reaction_id,class:"reaction-user-item"},[p("img",{src:v.avatar_url||"/assets/images/default-avatar.svg",alt:v.username,class:"user-avatar"},null,8,pe),p("span",de,$(v.username),1),p("span",ye,$(d(P)[v.reaction_type]),1)]))),128)),A.value.length===0?(f(),m("div",fe," No reactions yet ")):O("",!0)])])])])):O("",!0)]),_:1})],512))}}),ke=L(_e,[["__scopeId","data-v-4e892f29"]]);export{ke as R,ge as p};
//# sourceMappingURL=ReactionPicker-DSJjoD42.js.map
