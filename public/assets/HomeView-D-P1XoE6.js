import{d as G,r as g,b as D,e as I,p as J,f as y,o as p,k as r,h as w,l as C,x,m as V,v as R,t as S,F as W,s as O,i as N,j,z as K,T as Q,g as U,I as q,n as X,E as Y,L as Z,D as H}from"./vendor-DTOKxEoQ.js";import{b as $,u as ee,c as te,f as oe,d as se,_ as L,A as z}from"./index-BTUNdkEp.js";import"./utils-i9HKr1_Q.js";const F={async getFeed(e){return $.get("/posts/feed",e)},async getWallPosts(e,t){return $.get(`/walls/${e}/posts`,t)},async getPost(e){return $.get(`/posts/${e}`)},async createPost(e){const t=new FormData;return t.append("wall_id",e.wall_id.toString()),t.append("content",e.content),e.post_type&&t.append("post_type",e.post_type),e.visibility&&t.append("visibility",e.visibility),e.ai_application_id&&t.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((s,v)=>{t.append(`media_files[${v}]`,s)}),$.upload("/posts",t)},async updatePost(e,t){return $.patch(`/posts/${e}`,t)},async deletePost(e){return $.delete(`/posts/${e}`)},async reactToPost(e,t){return $.post(`/posts/${e}/reactions`,{reaction_type:t})},async removeReaction(e){return $.delete(`/posts/${e}/reactions`)},async sharePost(e,t,s){return $.post(`/posts/${e}/share`,{wall_id:t,content:s})}},ae=G("posts",()=>{const e=g([]),t=g([]),s=g(1),v=g(1),h=g(!0),a=g(!1),d=g({content_type:"all",time_range:"all",sort_by:"recent"}),_=D(()=>m=>e.value.find(n=>n.id===m)),l=async(m=1,n=!1)=>{if(!a.value){a.value=!0;try{const i=await F.getFeed({page:m,per_page:20,content_type:d.value.content_type!=="all"?d.value.content_type:void 0,time_range:d.value.time_range!=="all"?d.value.time_range:void 0,sort_by:d.value.sort_by});n?t.value=i.data:t.value.push(...i.data),s.value=i.pagination.current_page,v.value=i.pagination.total_pages,h.value=i.pagination.has_more,i.data.forEach(k=>{const M=e.value.findIndex(T=>T.id===k.id);M>=0?e.value[M]=k:e.value.push(k)})}catch(i){throw console.error("Failed to fetch feed:",i),i}finally{a.value=!1}}},c=async()=>{h.value&&!a.value&&await l(s.value+1,!1)},o=async()=>{s.value=1,await l(1,!0)};return{posts:e,feedPosts:t,currentPage:s,totalPages:v,hasMore:h,loading:a,filters:d,getPostById:_,fetchFeed:l,loadMore:c,refreshFeed:o,createPost:async m=>{try{const n=await F.createPost(m);return t.value.unshift(n),e.value.unshift(n),n}catch(n){throw console.error("Failed to create post:",n),n}},updatePost:async(m,n)=>{try{const i=await F.updatePost(m,n),k=t.value.findIndex(T=>T.id===m);k>=0&&(t.value[k]=i);const M=e.value.findIndex(T=>T.id===m);return M>=0&&(e.value[M]=i),i}catch(i){throw console.error("Failed to update post:",i),i}},deletePost:async m=>{try{await F.deletePost(m),t.value=t.value.filter(n=>n.id!==m),e.value=e.value.filter(n=>n.id!==m)}catch(n){throw console.error("Failed to delete post:",n),n}},reactToPost:async(m,n)=>{try{await F.reactToPost(m,n);const i=e.value.find(k=>k.id===m);i&&(i.reactions_count=(i.reactions_count||0)+1)}catch(i){throw console.error("Failed to react to post:",i),i}},removeReaction:async m=>{try{await F.removeReaction(m);const n=e.value.find(i=>i.id===m);n&&n.reactions_count>0&&n.reactions_count--}catch(n){throw console.error("Failed to remove reaction:",n),n}},setFilters:m=>{d.value={...d.value,...m},o()},clearFilters:()=>{d.value={content_type:"all",time_range:"all",sort_by:"recent"},o()}}}),ne={class:"post-card"},le={class:"post-header"},ie={class:"post-author"},re={class:"post-time"},de=["innerHTML"],ce={key:0,class:"post-media"},ue=["src"],me={class:"post-actions"},pe={key:0},ve={key:0},fe={key:0},he=I({__name:"PostCard",props:{post:{}},emits:["edit","delete","comment","share","react"],setup(e,{emit:t}){const s=e,v=t,h=ee(),a=D(()=>!1),d=D(()=>{var c;return((c=h.user)==null?void 0:c.id)===s.post.user_id}),_=c=>oe(c),l=()=>v("react","like");return(c,o)=>{var f,b,E,A;const u=J("router-link");return p(),y("article",ne,[r("div",le,[C(te,{src:(f=e.post.user)==null?void 0:f.avatar_url,name:((b=e.post.user)==null?void 0:b.display_name)||((E=e.post.user)==null?void 0:E.username),size:"md"},null,8,["src","name"]),r("div",ie,[C(u,{to:`/profile/${(A=e.post.user)==null?void 0:A.username}`,class:"author-name"},{default:V(()=>{var P,B;return[R(S(((P=e.post.user)==null?void 0:P.display_name)||((B=e.post.user)==null?void 0:B.username)),1)]}),_:1},8,["to"]),r("span",re,S(_(e.post.created_at)),1)]),d.value?(p(),x(se,{key:0,position:"bottom-right"},{trigger:V(()=>[...o[4]||(o[4]=[r("button",{class:"btn-icon"},"â‹®",-1)])]),default:V(()=>[r("button",{class:"dropdown-item",onClick:o[0]||(o[0]=P=>c.$emit("edit"))},"Edit"),r("button",{class:"dropdown-item danger",onClick:o[1]||(o[1]=P=>c.$emit("delete"))},"Delete")]),_:1})):w("",!0)]),r("div",{class:"post-content",innerHTML:e.post.content_html||e.post.content},null,8,de),e.post.media&&e.post.media.length?(p(),y("div",ce,[(p(!0),y(W,null,O(e.post.media,P=>(p(),y("img",{key:P.id,src:P.file_path,alt:"Media"},null,8,ue))),128))])):w("",!0),r("div",me,[r("button",{class:"action-btn",onClick:l},[r("span",null,S(a.value?"â¤ï¸":"ðŸ¤"),1),e.post.reactions_count?(p(),y("span",pe,S(e.post.reactions_count),1)):w("",!0)]),r("button",{class:"action-btn",onClick:o[2]||(o[2]=P=>c.$emit("comment"))},[o[5]||(o[5]=r("span",null,"ðŸ’¬",-1)),e.post.comments_count?(p(),y("span",ve,S(e.post.comments_count),1)):w("",!0)]),r("button",{class:"action-btn",onClick:o[3]||(o[3]=P=>c.$emit("share"))},[o[6]||(o[6]=r("span",null,"ðŸ”„",-1)),e.post.shares_count?(p(),y("span",fe,S(e.post.shares_count),1)):w("",!0)])])])}}}),ye=L(he,[["__scopeId","data-v-c143b1f9"]]),ge={class:"post-list"},_e={key:0,class:"loading"},we={key:1,class:"end-message"},Pe=I({__name:"PostList",props:{posts:{},loading:{type:Boolean},hasMore:{type:Boolean}},emits:["react","comment","share","edit","delete"],setup(e,{emit:t}){const s=t,v=(l,c)=>s("react",l,c),h=l=>s("comment",l),a=l=>s("share",l),d=l=>s("edit",l),_=l=>s("delete",l);return(l,c)=>(p(),y("div",ge,[(p(!0),y(W,null,O(e.posts,o=>(p(),x(ye,{key:o.id,post:o,onReact:u=>v(o.id,u),onComment:u=>h(o.id),onShare:u=>a(o.id),onEdit:u=>d(o.id),onDelete:u=>_(o.id)},null,8,["post","onReact","onComment","onShare","onEdit","onDelete"]))),128)),e.loading?(p(),y("div",_e,[...c[0]||(c[0]=[r("div",{class:"spinner"},null,-1),r("p",null,"Loading posts...",-1)])])):w("",!0),!e.loading&&!e.hasMore?(p(),y("div",we,"No more posts")):w("",!0)]))}}),$e=L(Pe,[["__scopeId","data-v-220026a9"]]),be={key:0,class:"modal-header"},ke={key:0,class:"modal-title"},Ce={class:"modal-body"},Ve={key:1,class:"modal-footer"},Se=I({__name:"AppModal",props:{modelValue:{type:Boolean},title:{},size:{default:"md"},closeable:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const s=e,v=t,h=D(()=>["modal",`modal-${s.size}`]),a=()=>{s.closeable&&v("update:modelValue",!1)},d=()=>{a()},_=l=>{l.key==="Escape"&&s.modelValue&&a()};return N(()=>{document.addEventListener("keydown",_)}),j(()=>{document.removeEventListener("keydown",_)}),(l,c)=>(p(),x(K,{to:"body"},[C(Q,{name:"modal"},{default:V(()=>[e.modelValue?(p(),y("div",{key:0,class:"modal-overlay",onClick:d},[r("div",{class:X(h.value),role:"dialog","aria-modal":"true",onClick:c[0]||(c[0]=q(()=>{},["stop"]))},[e.title||e.closeable?(p(),y("div",be,[e.title?(p(),y("h3",ke,S(e.title),1)):w("",!0),e.closeable?(p(),y("button",{key:1,class:"modal-close","aria-label":"Close modal",onClick:a}," âœ• ")):w("",!0)])):w("",!0),r("div",Ce,[U(l.$slots,"default",{},void 0,!0)]),l.$slots.footer?(p(),y("div",Ve,[U(l.$slots,"footer",{},void 0,!0)])):w("",!0)],2)])):w("",!0)]),_:3})]))}}),Ee=L(Se,[["__scopeId","data-v-3ba69d9b"]]),Fe={class:"form-actions"},Me=I({__name:"PostCreator",props:{modelValue:{type:Boolean},wallId:{}},emits:["update:modelValue","submit"],setup(e,{emit:t}){const s=e,v=t,h=g(s.modelValue),a=g(""),d=g([]),_=g(),l=g(!1),c=u=>{const f=u.target;f.files&&(d.value=Array.from(f.files))},o=()=>{a.value.trim()&&(v("submit",{wall_id:s.wallId,content:a.value,media_files:d.value}),a.value="",d.value=[],v("update:modelValue",!1))};return(u,f)=>(p(),x(Ee,{modelValue:h.value,"onUpdate:modelValue":f[2]||(f[2]=b=>h.value=b),title:"Create Post",size:"md"},{default:V(()=>[r("form",{onSubmit:q(o,["prevent"])},[Y(r("textarea",{"onUpdate:modelValue":f[0]||(f[0]=b=>a.value=b),placeholder:"What's on your mind?",rows:"6",class:"post-input"},null,512),[[Z,a.value]]),r("div",Fe,[r("input",{type:"file",ref_key:"fileInput",ref:_,onChange:c,accept:"image/*,video/*",multiple:"",hidden:""},null,544),C(z,{type:"button",variant:"ghost",onClick:f[1]||(f[1]=b=>{var E;return(E=_.value)==null?void 0:E.click()})},{default:V(()=>[...f[3]||(f[3]=[R("ðŸ“Ž Add Media",-1)])]),_:1}),C(z,{type:"submit",variant:"primary",loading:l.value},{default:V(()=>[...f[4]||(f[4]=[R("Post",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["modelValue"]))}}),Te=L(Me,[["__scopeId","data-v-3d8180a6"]]),Ie=(e,t={threshold:.8})=>{const s=g(),v=g(!1),h=()=>{if(!s.value||v.value)return;const{scrollTop:a,scrollHeight:d,clientHeight:_}=s.value;(a+_)/d>=t.threshold&&(v.value=!0,e(),setTimeout(()=>{v.value=!1},1e3))};return N(()=>{var a;(a=s.value)==null||a.addEventListener("scroll",h),window.addEventListener("scroll",h)}),j(()=>{var a;(a=s.value)==null||a.removeEventListener("scroll",h),window.removeEventListener("scroll",h)}),{targetRef:s,isLoading:v}},Le={class:"home-view"},De={class:"feed-header"},Re=I({__name:"HomeView",setup(e){const t=ae(),s=g(!1),v=g(1);N(()=>{t.fetchFeed()}),Ie(()=>{t.hasMore&&!t.loading&&t.loadMore()});const h=async o=>{await t.createPost(o)},a=(o,u)=>{t.reactToPost(o,u)},d=o=>{console.log("Comment on post",o)},_=o=>{console.log("Share post",o)},l=o=>{console.log("Edit post",o)},c=async o=>{confirm("Delete this post?")&&await t.deletePost(o)};return(o,u)=>(p(),y("div",Le,[r("div",De,[u[3]||(u[3]=r("h1",null,"Home Feed",-1)),C(z,{variant:"primary",onClick:u[0]||(u[0]=f=>s.value=!0)},{default:V(()=>[...u[2]||(u[2]=[R("+ Create Post",-1)])]),_:1})]),C($e,{posts:H(t).feedPosts,loading:H(t).loading,"has-more":H(t).hasMore,onReact:a,onComment:d,onShare:_,onEdit:l,onDelete:c},null,8,["posts","loading","has-more"]),C(Te,{modelValue:s.value,"onUpdate:modelValue":u[1]||(u[1]=f=>s.value=f),"wall-id":v.value,onSubmit:h},null,8,["modelValue","wall-id"])]))}}),He=L(Re,[["__scopeId","data-v-b469c97f"]]);export{He as default};
//# sourceMappingURL=HomeView-D-P1XoE6.js.map
