import{f as I,r as c,b as j,e as z,g as o,k as s,j as v,t as n,F as M,z as N,n as x,A,D as L,p as S,i}from"./vendor-Bfvy7Eak.js";import{c as g,_ as Y}from"./index-TLTI1gNp.js";import"./utils-Cb2jxgch.js";const H={class:"notifications-view"},q={class:"notifications-header"},G=["disabled"],J={class:"filter-tabs"},K=["onClick"],O={key:0,class:"badge"},P={class:"notifications-container"},Q={key:0,class:"loading-container"},W={key:1,class:"empty-state"},X={key:2,class:"notifications-list"},Z=["onClick"],ee={class:"notification-avatar"},te=["src","alt"],ae={class:"notification-type-icon"},se={class:"notification-content"},oe={class:"notification-text"},ne={key:0,class:"notification-preview"},ie={class:"notification-time"},re={class:"notification-actions"},le=["onClick"],ce={key:3,class:"load-more"},de=I({__name:"NotificationsView",setup(ue){const f=S(),p=c(!0),m=c(!1),r=c([]),l=c(0),d=c("all"),y=c(1),_=c(!0),D=[{id:"all",label:"All"},{id:"unread",label:"Unread"},{id:"mentions",label:"Mentions"},{id:"reactions",label:"Reactions"},{id:"comments",label:"Comments"},{id:"follows",label:"Follows"}],k=j(()=>d.value==="all"?r.value:d.value==="unread"?r.value.filter(e=>!e.is_read):r.value.filter(e=>e.notification_type===d.value.slice(0,-1))),E=e=>({follow:"ðŸ‘¥",reaction:"â¤ï¸",comment:"ðŸ’¬",reply:"ðŸ’¬",mention:"@",bricks:"ðŸ§±",ai_complete:"ðŸ¤–"})[e]||"ðŸ””",R=e=>{var t;return{follow:"started following you",reaction:`reacted to your ${e.target_type}`,comment:"commented on your post",reply:"replied to your comment",mention:`mentioned you in a ${e.target_type}`,bricks:`sent you ${((t=e.content)==null?void 0:t.amount)||0} bricks`,ai_complete:"Your AI application is ready"}[e.notification_type]||"sent you a notification"},T=e=>{const a=new Date(e),u=new Date().getTime()-a.getTime(),h=Math.floor(u/6e4),$=Math.floor(u/36e5),C=Math.floor(u/864e5);return h<1?"just now":h<60?`${h}m ago`:$<24?`${$}h ago`:C<7?`${C}d ago`:a.toLocaleDateString()},w=async()=>{try{p.value=!0;const e=20,a=(y.value-1)*e,t=await g.get(`/notifications?limit=${e}&offset=${a}`);t&&t.data?t.data.success&&t.data.data&&t.data.data.notifications?(y.value===1?r.value=t.data.data.notifications:r.value=[...r.value,...t.data.data.notifications],_.value=t.data.data.notifications.length===e):(console.warn("Unexpected response structure:",t.data),r.value=[],_.value=!1):(console.error("Invalid response:",t),r.value=[],_.value=!1)}catch(e){console.error("Error loading notifications:",e),r.value=[],_.value=!1}finally{p.value=!1}},V=async()=>{var e;try{const a=await g.get("/notifications/unread-count");a&&a.data&&a.data.success?l.value=((e=a.data.data)==null?void 0:e.unread_count)||0:(console.warn("Unexpected response structure for unread count:",a==null?void 0:a.data),l.value=0)}catch(a){console.error("Error loading unread count:",a),l.value=0}},b=async e=>{try{await g.patch(`/notifications/${e}/read`);const a=r.value.find(t=>t.notification_id===e);a&&(a.is_read=!0,l.value=Math.max(0,l.value-1))}catch(a){console.error("Error marking notification as read:",a)}},F=async()=>{try{m.value=!0,await g.post("/notifications/mark-all-read"),r.value.forEach(e=>{e.is_read=!0}),l.value=0}catch(e){console.error("Error marking all as read:",e)}finally{m.value=!1}},U=async e=>{e.is_read||await b(e.notification_id),e.target_type==="post"&&e.target_id?f.push(`/post/${e.target_id}`):e.target_type==="wall"&&e.target_id?f.push(`/wall/${e.target_id}`):e.target_type==="user"&&e.actor_id?f.push(`/profile/${e.actor_username}`):e.target_type==="ai_app"&&e.target_id&&f.push(`/ai/${e.target_id}`)},B=()=>{y.value++,w()};return z(()=>{w(),V()}),(e,a)=>(i(),o("div",H,[s("div",q,[s("h1",null,n(e.$t("navigation.notifications")),1),l.value>0?(i(),o("button",{key:0,onClick:F,class:"btn-secondary",disabled:m.value},n(m.value?"Marking...":"Mark all as read"),9,G)):v("",!0)]),s("div",J,[(i(),o(M,null,N(D,t=>s("button",{key:t.id,class:x(["filter-tab",{active:d.value===t.id}]),onClick:u=>d.value=t.id},[A(n(t.label)+" ",1),t.id==="unread"&&l.value>0?(i(),o("span",O,n(l.value),1)):v("",!0)],10,K)),64))]),s("div",P,[p.value?(i(),o("div",Q,[a[0]||(a[0]=s("div",{class:"spinner"},null,-1)),s("p",null,n(e.$t("common.labels.loading")),1)])):k.value.length===0?(i(),o("div",W,[a[1]||(a[1]=s("span",{class:"empty-icon"},"ðŸ””",-1)),a[2]||(a[2]=s("h2",null,"No notifications",-1)),s("p",null,n(d.value==="unread"?"You're all caught up!":"No notifications to show"),1)])):(i(),o("div",X,[(i(!0),o(M,null,N(k.value,t=>(i(),o("div",{key:t.notification_id,class:x(["notification-item",{unread:!t.is_read}]),onClick:u=>U(t)},[s("div",ee,[s("img",{src:t.actor_avatar||"/assets/images/default-avatar.svg",alt:t.actor_username},null,8,te),s("span",ae,n(E(t.notification_type)),1)]),s("div",se,[s("div",oe,[s("strong",null,n(t.actor_username),1),A(" "+n(R(t)),1)]),t.target_preview?(i(),o("div",ne,n(t.target_preview),1)):v("",!0),s("div",ie,n(T(t.created_at)),1)]),s("div",re,[t.is_read?v("",!0):(i(),o("button",{key:0,onClick:L(u=>b(t.notification_id),["stop"]),class:"mark-read-btn",title:"Mark as read"}," âœ“ ",8,le))])],10,Z))),128))])),_.value&&!p.value?(i(),o("div",ce,[s("button",{onClick:B,class:"btn-secondary"},n(e.$t("common.buttons.loadMore")),1)])):v("",!0)])]))}}),pe=Y(de,[["__scopeId","data-v-d4a95fb0"]]);export{pe as default};
//# sourceMappingURL=NotificationsView-BJvCOfiG.js.map
