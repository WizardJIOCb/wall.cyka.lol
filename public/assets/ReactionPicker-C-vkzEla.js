import{c as i,_ as z}from"./index-MGQYcoty.js";import{r as m,b as j,f as L,w as W,g as v,k as p,l as E,W as J,n as F,u as y,j as B,t as h,T as V,m as H,F as A,z as O,D as K,s as Z,i as _,Z as q}from"./vendor-Bfvy7Eak.js";const ve={async getFeed(e){return i.get("/posts/feed",e)},async getWallPosts(e,o){return i.get(`/walls/${e}/posts`,o)},async getPost(e){return i.get(`/posts/${e}`)},async createPost(e){const o=new FormData;return o.append("wall_id",e.wall_id.toString()),o.append("content",e.content),e.post_type&&o.append("post_type",e.post_type),e.visibility&&o.append("visibility",e.visibility),e.ai_application_id&&o.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((g,u)=>{o.append(`media_files[${u}]`,g)}),i.upload("/posts",o)},async updatePost(e,o){return i.patch(`/posts/${e}`,o)},async deletePost(e){return i.delete(`/posts/${e}`)},async reactToPost(e,o){return i.post(`/posts/${e}/reactions`,{reaction_type:o})},async removeReaction(e){return i.delete(`/posts/${e}/reactions`)},async sharePost(e,o,g){return i.post(`/posts/${e}/share`,{wall_id:o,content:g})},async incrementViewCount(e){return i.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return i.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return i.post(`/posts/${e}/open`)}};function G(e,o){const g=()=>({like:0,love:0,haha:0,wow:0,sad:0,angry:0}),u=m([]),s=m({total:0,by_type:g()}),l=m(null),C=m(!1),k=m(null),w=()=>typeof e=="string"?e:e.value,P=()=>typeof o=="number"?o:o.value,f={like:"ðŸ‘",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},R={like:"#3b82f6",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},b=()=>{const a=localStorage.getItem("user");if(console.log("User string from localStorage:",a),a)try{const r=JSON.parse(a);console.log("Parsed user object:",r);const t=r.user_id||0;return console.log("User ID:",t),t}catch(r){return console.error("Error parsing user from localStorage:",r),0}return console.log("No user found in localStorage"),0},d=async()=>{var a,r;try{C.value=!0,k.value=null;const t=await i.get(`/reactions/${w()}/${P()}`);if(t&&typeof t=="object"&&"reactions"in t){u.value=Array.isArray(t.reactions)?t.reactions:[];const n={like:0,love:0,haha:0,wow:0,sad:0,angry:0},c=((a=t.stats)==null?void 0:a.by_type)||{},D={...n};Object.keys(n).forEach(T=>{T in c&&(D[T]=Number(c[T])||0)}),s.value={total:((r=t.stats)==null?void 0:r.total)||0,by_type:D};const x=b();console.log("Current user ID:",x),console.log("Reactions array:",u.value);const U=u.value.find(T=>T.user_id===x);console.log("User reaction found:",U),l.value=U?U.reaction_type:null,console.log("Current user reaction set to:",l.value)}else Array.isArray(t)?(u.value=t,s.value={total:t.length,by_type:g()}):(u.value=[],s.value={total:0,by_type:g()})}catch(t){k.value=t.message||"Failed to load reactions",console.error("Error loading reactions:",t)}finally{C.value=!1}},$=async a=>{const r=l.value,t=s.value.total,n={...s.value.by_type};try{l.value=a,s.value.total++,s.value.by_type[a]=(s.value.by_type[a]??0)+1,await i.post("/reactions",{reactable_type:w(),reactable_id:P(),reaction_type:a}),await d()}catch(c){throw l.value=r,s.value.total=t,s.value.by_type=n,k.value=c.message||"Failed to add reaction",c}},I=async()=>{const a=l.value,r=s.value.total,t={...s.value.by_type};if(a)try{l.value=null,s.value.total--,s.value.by_type[a]!==void 0&&(s.value.by_type[a]=Math.max(0,s.value.by_type[a]-1)),await i.delete(`/reactions/${w()}/${P()}`),await d()}catch(n){throw l.value=a,s.value.total=r,s.value.by_type=t,k.value=n.message||"Failed to remove reaction",n}},S=async a=>{l.value===a?await I():l.value?(await I(),await $(a)):await $(a)},M=j(()=>l.value?f[l.value]:"ðŸ¤"),N=j(()=>l.value?R[l.value]:"#94a3b8");return{reactions:u,stats:s,currentUserReaction:l,loading:C,error:k,reactionIcons:f,reactionColors:R,displayIcon:M,displayColor:N,loadReactions:d,addReaction:$,removeReaction:I,toggleReaction:S}}const Q={class:"reaction-picker-container"},X={class:"reaction-icon"},Y={key:0,class:"reaction-count"},ee=["onClick","title"],te={class:"modal-header"},oe={class:"modal-body"},ae={class:"reaction-tabs"},se=["onClick"],ne={class:"reaction-users-list"},le=["src","alt"],re={class:"username"},ce={class:"reaction-emoji"},ie={key:0,class:"empty-state"},ue=L({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const o=e;console.log("ReactionPicker created with:",o.reactableType,o.reactableId);const{reactions:g,stats:u,currentUserReaction:s,reactionIcons:l,displayIcon:C,displayColor:k,loadReactions:w,toggleReaction:P}=G(m(o.reactableType),m(o.reactableId));W(()=>[o.reactableType,o.reactableId],()=>{console.log("ReactionPicker props changed, reloading reactions:",o.reactableType,o.reactableId),w()});const f=m(!1),R=m(!1),b=m("all");let d=null;const $=r=>{r.stopPropagation(),console.log("Toggle picker clicked"),f.value=!f.value},I=()=>{console.log("Show picker on hover"),d=setTimeout(()=>{f.value=!0},300)},S=()=>{console.log("Hide picker on hover"),d&&(clearTimeout(d),d=null),setTimeout(()=>{f.value&&(f.value=!1)},300)},M=()=>{console.log("Keep picker open"),d&&(clearTimeout(d),d=null)},N=async r=>{console.log("Handle reaction click:",r),f.value=!1;try{await P(r),console.log("Reaction toggled successfully")}catch(t){console.error("Failed to toggle reaction:",t)}},a=j(()=>b.value==="all"?g.value:g.value.filter(r=>r.reaction_type===b.value));return console.log("Loading reactions on mount"),w(),(r,t)=>(_(),v("div",Q,[p("button",{onClick:$,onMouseenter:I,onMouseleave:S,class:F(["reaction-button",{active:y(s)}]),style:J({color:y(k)})},[p("span",X,h(y(C)),1),y(u).total>0?(_(),v("span",Y,h(y(u).total),1)):B("",!0)],38),E(V,{name:"picker-fade"},{default:H(()=>[f.value?(_(),v("div",{key:0,class:"reaction-picker",onMouseenter:M,onMouseleave:S},[(_(!0),v(A,null,O(y(l),(n,c)=>(_(),v("button",{key:c,onClick:D=>N(c),class:F(["reaction-option",{selected:y(s)===c}]),title:c},h(n),11,ee))),128))],32)):B("",!0)]),_:1}),E(V,{name:"modal-fade"},{default:H(()=>[R.value?(_(),v("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=n=>R.value=!1)},[p("div",{class:"modal-content",onClick:t[2]||(t[2]=K(()=>{},["stop"]))},[p("div",te,[t[4]||(t[4]=p("h3",null,"Reactions",-1)),p("button",{onClick:t[0]||(t[0]=n=>R.value=!1),class:"btn-close"},"Ã—")]),p("div",oe,[p("div",ae,[p("button",{onClick:t[1]||(t[1]=n=>b.value="all"),class:F(["tab-button",{active:b.value==="all"}])}," All "+h(y(u).total),3),(_(!0),v(A,null,O(y(u).by_type,(n,c)=>Z((_(),v("button",{key:c,onClick:D=>b.value=c,class:F(["tab-button",{active:b.value===c}])},h(y(l)[c])+" "+h(n),11,se)),[[q,n>0]])),128))]),p("div",ne,[(_(!0),v(A,null,O(a.value,n=>(_(),v("div",{key:n.reaction_id,class:"reaction-user-item"},[p("img",{src:n.avatar_url||"/assets/images/default-avatar.svg",alt:n.username,class:"user-avatar"},null,8,le),p("span",re,h(n.username),1),p("span",ce,h(y(l)[n.reaction_type]),1)]))),128)),a.value.length===0?(_(),v("div",ie," No reactions yet ")):B("",!0)])])])])):B("",!0)]),_:1})]))}}),ye=z(ue,[["__scopeId","data-v-dddd9e97"]]);export{ye as R,ve as p};
//# sourceMappingURL=ReactionPicker-C-vkzEla.js.map
