import{d as ce,r as C,b as V,f as U,w as re,e as J,g as p,i,D as q,k as a,j as $,s as te,v as ae,x as se,u as I,n as G,t as b,q as Y,W as me,l as E,m as A,A as W,B as H,F as O,z as X,o as le,X as de}from"./vendor-Bfvy7Eak.js";import{p as z,R as ue}from"./ReactionPicker-qPdyD_3b.js";import{b as oe,c as B,_ as N,u as ie,d as ve,f as pe,e as fe,g as he,h as ye,A as Z}from"./index-DN_oDYf5.js";import"./utils-Cb2jxgch.js";const ge=ce("posts",()=>{const e=C([]),d=C([]),t=C(1),l=C(1),s=C(!0),n=C(!1),v=C({content_type:"all",time_range:"all",sort_by:"recent"}),f=V(()=>_=>e.value.find(h=>h.id===_)),m=async(_=1,h=!1)=>{var o,g,P;n.value=!0;try{const D=await z.getFeed({page:_,per_page:20,content_type:v.value.content_type!=="all"?v.value.content_type:void 0,time_range:v.value.time_range!=="all"?v.value.time_range:void 0,sort_by:v.value.sort_by}),K=Array.isArray(D.data)?D.data:[];h?d.value=K:d.value.push(...K),t.value=((o=D.pagination)==null?void 0:o.current_page)||_,l.value=((g=D.pagination)==null?void 0:g.total_pages)||1,s.value=((P=D.pagination)==null?void 0:P.has_more)||!1,K.forEach(w=>{const y=e.value.findIndex(j=>j.id===w.id);y>=0?e.value[y]=w:e.value.push(w)})}catch(D){throw console.error("Failed to fetch feed:",D),h&&(d.value=[]),D}finally{n.value=!1}},k=async()=>{s.value&&!n.value&&await m(t.value+1,!1)},c=async()=>{t.value=1,await m(1,!0)};return{posts:e,feedPosts:d,currentPage:t,totalPages:l,hasMore:s,loading:n,filters:v,getPostById:f,fetchFeed:m,loadMore:k,refreshFeed:c,createPost:async _=>{try{const h=await z.createPost(_);return d.value.unshift(h),e.value.unshift(h),h}catch(h){throw console.error("Failed to create post:",h),h}},updatePost:async(_,h)=>{try{const o=await z.updatePost(_,h),g=d.value.findIndex(D=>D.id===_);g>=0&&(d.value[g]=o);const P=e.value.findIndex(D=>D.id===_);return P>=0&&(e.value[P]=o),o}catch(o){throw console.error("Failed to update post:",o),o}},deletePost:async _=>{try{await z.deletePost(_),d.value=d.value.filter(h=>h.id!==_),e.value=e.value.filter(h=>h.id!==_)}catch(h){throw console.error("Failed to delete post:",h),h}},reactToPost:async(_,h)=>{try{await z.reactToPost(_,h);const o=e.value.find(g=>g.id===_);o&&(o.reactions_count=(o.reactions_count||0)+1)}catch(o){throw console.error("Failed to react to post:",o),o}},removeReaction:async _=>{try{await z.removeReaction(_);const h=e.value.find(o=>o.id===_);h&&h.reactions_count>0&&h.reactions_count--}catch(h){throw console.error("Failed to remove reaction:",h),h}},setFilters:_=>{v.value={...v.value,..._},c()},clearFilters:()=>{v.value={content_type:"all",time_range:"all",sort_by:"recent"},c()}}}),_e={class:"form-group"},we=["placeholder","rows","onKeydown"],Ce={class:"form-footer"},be={class:"form-actions"},ke=["disabled"],$e=["disabled"],Pe={key:0,class:"error-message"},Ie=U({__name:"CommentForm",props:{postId:{},parentCommentId:{},commentId:{},initialContent:{},placeholder:{},rows:{default:3},showCancel:{type:Boolean,default:!0}},emits:["comment-created","comment-updated","cancel"],setup(e,{emit:d}){const t=e,l=d,{t:s}=oe(),n=C(t.initialContent||""),v=C(!1),f=C(null),m=C(null),k=V(()=>n.value.length),c=V(()=>{const F=n.value.trim();return F.length>0&&F.length<=2e3&&!v.value}),u=V(()=>t.commentId?s("comments.updateComment"):t.parentCommentId?s("comments.reply"):s("comments.comment")),r=F=>{const x=m.value;x&&(x.style.height="auto",x.style.height=x.scrollHeight+"px")},S=async()=>{var F,x;if(c.value){v.value=!0,f.value=null;try{let R;t.commentId?(R=await B.patch(`/comments/${t.commentId}`,{content:n.value.trim()}),l("comment-updated",R.data.data)):t.parentCommentId?(R=await B.post(`/comments/${t.parentCommentId}/replies`,{content:n.value.trim()}),l("comment-created",R.data.data)):t.postId&&(R=await B.post(`/posts/${t.postId}/comments`,{content:n.value.trim()}),l("comment-created",R.data.data)),n.value="",m.value&&(m.value.style.height="auto")}catch(R){f.value=((x=(F=R.response)==null?void 0:F.data)==null?void 0:x.message)||s("comments.errorPosting")}finally{v.value=!1}}},T=()=>{n.value=t.initialContent||"",f.value=null,l("cancel")};return re(()=>t.initialContent,F=>{n.value=F||""}),J(()=>{r()}),(F,x)=>(i(),p("form",{onSubmit:q(S,["prevent"]),class:"comment-form"},[a("div",_e,[te(a("textarea",{ref_key:"textareaRef",ref:m,"onUpdate:modelValue":x[0]||(x[0]=R=>n.value=R),placeholder:e.placeholder||I(s)("comments.write"),maxlength:2e3,rows:e.rows,onInput:r,onKeydown:[se(q(S,["meta"]),["enter"]),se(q(S,["ctrl"]),["enter"])],class:"comment-textarea"},null,40,we),[[ae,n.value]]),a("div",Ce,[a("span",{class:G(["char-count",{warning:k.value>1800,error:k.value>2e3}])},b(k.value)+" / 2000 ",3),a("div",be,[e.showCancel?(i(),p("button",{key:0,type:"button",onClick:T,class:"btn btn-secondary",disabled:v.value},b(I(s)("comments.cancel")),9,ke)):$("",!0),a("button",{type:"submit",disabled:!c.value||v.value,class:"btn btn-primary"},b(v.value?I(s)("comments.posting"):u.value),9,$e)])])]),f.value?(i(),p("div",Pe,b(f.value),1)):$("",!0)],32))}}),ee=N(Ie,[["__scopeId","data-v-f4bc005c"]]),xe={class:"comment-header"},Re=["src","alt"],Fe={class:"comment-meta"},Me={class:"timestamp"},Se={key:0,class:"edited-badge"},De={key:0,class:"comment-actions"},Te=["disabled","title"],Ee=["title"],Le={class:"comment-content"},Ve=["innerHTML"],Ae={class:"comment-footer"},je={key:0,class:"user-reaction"},Be={key:1},He={key:2,class:"count"},Ue={key:0,class:"count"},Ne=["onClick","title"],ze={key:1,class:"reply-form"},We={key:2,class:"replies"},Ke=U({__name:"CommentItem",props:{comment:{},postId:{},depth:{default:0},maxDepth:{default:4}},emits:["reply-created","comment-updated","comment-deleted"],setup(e,{emit:d}){const t=e,l=d,{t:s}=oe(),n=ie();t.comment||console.warn("CommentItem: comment prop is required");const v=C(!1),f=C(!1),m=C(!1),k=C(!0),c=[{type:"like",emoji:"ðŸ‘",label:"Like"},{type:"dislike",emoji:"ðŸ‘Ž",label:"Dislike"},{type:"heart",emoji:"â¤ï¸",label:"Love"},{type:"laugh",emoji:"ðŸ˜‚",label:"Laugh"},{type:"wow",emoji:"ðŸ˜®",label:"Wow"},{type:"sad",emoji:"ðŸ˜¢",label:"Sad"},{type:"angry",emoji:"ðŸ˜ ",label:"Angry"}],u=V(()=>{var w;return t.comment&&((w=n.user)==null?void 0:w.user_id)===t.comment.author_id}),r=V(()=>{if(!t.comment)return!1;const w=new Date(t.comment.created_at).getTime();return(Date.now()-w)/1e3/60<15}),S=V(()=>{if(!t.comment||t.depth===0)return"0";const w=window.innerWidth>768?24:12;return`${t.depth*w}px`}),T=w=>{const y=new Date(w),Q=new Date().getTime()-y.getTime(),M=Math.floor(Q/6e4);if(M<1)return s("comments.justNow");if(M<60)return s("comments.minutesAgo",{count:M});const L=Math.floor(M/60);if(L<24)return s("comments.hoursAgo",{count:L});const ne=Math.floor(L/24);return ne<7?s("comments.daysAgo",{count:ne}):y.toLocaleDateString()},F=w=>w>=1e6?(w/1e6).toFixed(1)+"M":w>=1e3?(w/1e3).toFixed(1)+"K":w.toString(),x=w=>{const y=c.find(j=>j.type===w);return(y==null?void 0:y.emoji)||"ðŸ‘"},R=()=>{r.value&&(v.value=!0)},_=async()=>{if(!(!t.comment||!confirm(s("comments.deleteConfirm"))))try{await B.delete(`/comments/${t.comment.comment_id}`),l("comment-deleted",t.comment.comment_id)}catch(w){console.error("Failed to delete comment:",w)}},h=()=>{f.value=!f.value,f.value&&(m.value=!1)},o=()=>{k.value=!k.value},g=()=>{m.value=!m.value,m.value&&(f.value=!1)},P=async w=>{if(t.comment)try{const y=await B.post(`/comments/${t.comment.comment_id}/reactions`,{reaction_type:w});t.comment.reaction_count=y.data.data.reaction_count,t.comment.like_count=y.data.data.like_count,t.comment.dislike_count=y.data.data.dislike_count,y.data.data.action==="removed"?t.comment.user_reaction=null:t.comment.user_reaction=w,m.value=!1}catch(y){console.error("Failed to react:",y)}},D=w=>{v.value=!1,l("comment-updated",w)},K=w=>{f.value=!1,t.comment&&(t.comment.replies||(t.comment.replies=[]),t.comment.replies.push(w),t.comment.reply_count++,l("reply-created",w))};return(w,y)=>{const j=Y("router-link"),Q=Y("CommentItem",!0);return e.comment&&e.comment.comment_id?(i(),p("div",{key:0,class:G(["comment-item",`depth-${e.depth}`]),style:me({marginLeft:S.value})},[a("div",xe,[a("img",{src:e.comment.author_avatar||"/default-avatar.png",alt:e.comment.author_name,class:"avatar"},null,8,Re),a("div",Fe,[E(j,{to:`/users/${e.comment.author_id}`,class:"author-name"},{default:A(()=>[W(b(e.comment.author_name),1)]),_:1},8,["to"]),a("span",Me,b(T(e.comment.created_at)),1),e.comment.is_edited?(i(),p("span",Se,b(I(s)("comments.edited")),1)):$("",!0)]),u.value?(i(),p("div",De,[a("button",{onClick:R,disabled:!r.value,title:r.value?I(s)("comments.edit"):I(s)("comments.editExpired"),class:"action-btn"},[...y[7]||(y[7]=[a("span",null,"âœï¸",-1)])],8,Te),a("button",{onClick:_,title:I(s)("comments.delete"),class:"action-btn"},[...y[8]||(y[8]=[a("span",null,"ðŸ—‘ï¸",-1)])],8,Ee)])):$("",!0)]),a("div",Le,[v.value?(i(),H(ee,{key:1,"comment-id":e.comment.comment_id,"initial-content":e.comment.content_text,"show-cancel":!0,rows:2,onCommentUpdated:D,onCancel:y[0]||(y[0]=M=>v.value=!1)},null,8,["comment-id","initial-content"])):(i(),p("p",{key:0,innerHTML:e.comment.content_html},null,8,Ve))]),a("div",Ae,[a("button",{class:G(["reaction-btn",{active:e.comment.user_reaction}]),onClick:g},[e.comment.user_reaction?(i(),p("span",je,b(x(e.comment.user_reaction)),1)):(i(),p("span",Be,"ðŸ‘")),e.comment.reaction_count>0?(i(),p("span",He,b(F(e.comment.reaction_count)),1)):$("",!0)],2),e.depth<e.maxDepth?(i(),p("button",{key:0,onClick:h,class:"reply-btn"},[W(b(I(s)("comments.reply"))+" ",1),e.comment.reply_count>0?(i(),p("span",Ue," ("+b(e.comment.reply_count)+") ",1)):$("",!0)])):$("",!0),e.comment.reply_count>0&&e.comment.replies?(i(),p("button",{key:1,onClick:o,class:"collapse-btn"},b(k.value?I(s)("comments.hideReplies"):I(s)("comments.showReplies")),1)):$("",!0)]),m.value?(i(),p("div",{key:0,class:"reaction-picker",onClick:y[2]||(y[2]=q(()=>{},["stop"]))},[(i(),p(O,null,X(c,M=>a("button",{key:M.type,onClick:L=>P(M.type),class:G(["reaction-option",{selected:e.comment.user_reaction===M.type}]),title:M.label},b(M.emoji),11,Ne)),64)),a("button",{onClick:y[1]||(y[1]=M=>m.value=!1),class:"close-picker"}," âœ• ")])):$("",!0),f.value?(i(),p("div",ze,[E(ee,{"post-id":e.postId,"parent-comment-id":e.comment.comment_id,placeholder:I(s)("comments.writeReply"),rows:2,onCommentCreated:K,onCancel:y[3]||(y[3]=M=>f.value=!1)},null,8,["post-id","parent-comment-id","placeholder"])])):$("",!0),k.value&&e.comment.replies&&e.comment.replies.length>0?(i(),p("div",We,[(i(!0),p(O,null,X(e.comment.replies,M=>(i(),H(Q,{key:M.comment_id,comment:M,"post-id":e.postId,depth:e.depth+1,"max-depth":e.maxDepth,onReplyCreated:y[4]||(y[4]=L=>w.$emit("reply-created",L)),onCommentUpdated:y[5]||(y[5]=L=>w.$emit("comment-updated",L)),onCommentDeleted:y[6]||(y[6]=L=>w.$emit("comment-deleted",L))},null,8,["comment","post-id","depth","max-depth"]))),128))])):$("",!0)],6)):$("",!0)}}}),qe=N(Ke,[["__scopeId","data-v-f75f85ba"]]),Oe={class:"comment-section"},Xe={class:"comment-section-header"},Ge={class:"section-title"},Je={class:"comment-controls"},Qe={value:"created_asc"},Ye={value:"created_desc"},Ze={value:"reactions"},et={key:0,class:"comment-form-container"},tt={key:1,class:"loading-state"},ot={key:2,class:"empty-state"},nt={key:3,class:"comments-list"},st={key:5,class:"loading-more"},at=U({__name:"CommentSection",props:{postId:{},initialComments:{default:()=>[]},allowComments:{type:Boolean,default:!0}},setup(e){const d=e,{t}=oe(),l=C(d.initialComments),s=C(!1),n=C(!1),v=C("created_asc"),f=C(0),m=C(null),k=V(()=>l.value.filter(o=>o&&o.comment_id&&!o.parent_comment_id)),c=o=>{if(o==null||typeof o!="object"||typeof o.comment_id!="number"||o.comment_id<=0)return!1;const g=["post_id","author_id","content_text","content_html","created_at"];for(const P of g)if(!(P in o))return!1;return!0},u=async()=>{s.value=!0;try{const o=await B.get(`/posts/${d.postId}/comments`,{params:{sort:v.value,limit:50}});o&&o.comments&&Array.isArray(o.comments)?(l.value=o.comments.filter(c),n.value=o.has_more||!1,f.value=o.count||0):(l.value=[],n.value=!1,f.value=0),r()}catch(o){console.error("Failed to fetch comments:",o),l.value=[],n.value=!1,f.value=0}finally{s.value=!1}},r=()=>{const o=new Map;l.value.forEach(g=>{c(g)&&(g.replies=[],o.set(g.comment_id,g))}),l.value.forEach(g=>{if(c(g)&&g.parent_comment_id){const P=o.get(g.parent_comment_id);P&&P.replies&&P.replies.push(g)}})},S=async()=>{console.log("Load more comments")},T=o=>{c(o)&&(l.value.unshift(o),f.value++,r())},F=o=>{c(o)&&f.value++},x=o=>{if(c(o)){const g=l.value.findIndex(P=>c(P)&&P.comment_id===o.comment_id);g!==-1&&(l.value[g]={...l.value[g],...o},r())}},R=o=>{l.value=l.value.filter(g=>c(g)&&g.comment_id!==o),f.value--,r()},_=()=>{m.value=window.setInterval(()=>{s.value||u()},1e4)},h=()=>{m.value&&(clearInterval(m.value),m.value=null)};return J(()=>{l.value.length===0?u():(r(),f.value=l.value.length),_()}),le(()=>{h()}),(o,g)=>(i(),p("div",Oe,[a("div",Xe,[a("h3",Ge,b(I(t)("comments.title"))+" ("+b(f.value)+") ",1),a("div",Je,[te(a("select",{"onUpdate:modelValue":g[0]||(g[0]=P=>v.value=P),class:"sort-select",onChange:u},[a("option",Qe,b(I(t)("comments.sortOldest")),1),a("option",Ye,b(I(t)("comments.sortNewest")),1),a("option",Ze,b(I(t)("comments.sortReactions")),1)],544),[[de,v.value]])])]),e.allowComments?(i(),p("div",et,[E(ee,{"post-id":e.postId,"show-cancel":!1,onCommentCreated:T},null,8,["post-id"])])):$("",!0),s.value&&l.value.length===0?(i(),p("div",tt,[g[1]||(g[1]=a("div",{class:"spinner"},null,-1)),a("p",null,b(I(t)("comments.loading")),1)])):l.value.length===0?(i(),p("div",ot,[a("p",null,b(I(t)("comments.noComments")),1)])):(i(),p("div",nt,[(i(!0),p(O,null,X(k.value,P=>(i(),H(qe,{key:P.comment_id,comment:P,"post-id":e.postId,depth:0,"max-depth":4,onReplyCreated:F,onCommentUpdated:x,onCommentDeleted:R},null,8,["comment","post-id"]))),128))])),n.value&&!s.value?(i(),p("button",{key:4,onClick:S,class:"load-more-btn"},b(I(t)("comments.loadMore")),1)):$("",!0),s.value&&l.value.length>0?(i(),p("div",st,[...g[2]||(g[2]=[a("div",{class:"spinner-small"},null,-1)])])):$("",!0)]))}}),lt=N(at,[["__scopeId","data-v-c8a3ef3d"]]);function it(){const e=C(!1),d=C(null);return{loading:e,error:d,repostPost:async(l,s)=>{try{e.value=!0,d.value=null;const n=await B.post(`/posts/${l}/repost`,s||{});if(n&&typeof n=="object"){if("post"in n)return n.post;if("message"in n)throw new Error(n.message);return n}else return n}catch(n){throw d.value=n.message||"Failed to repost post",n}finally{e.value=!1}}}}const ct={class:"post-card"},rt={class:"post-header"},mt={class:"post-author"},dt={class:"post-time"},ut=["innerHTML"],vt={key:0,class:"post-media"},pt=["src"],ft={class:"post-actions"},ht={key:0},yt={key:0},gt=U({__name:"PostCard",props:{post:{}},emits:["edit","delete","comment","share","react"],setup(e,{emit:d}){const t=e,l=ie(),s=C(!1),n=V(()=>{var u;return((u=l.user)==null?void 0:u.id)===t.post.user_id}),{repostPost:v}=it(),{showToast:f}=he(),m=u=>pe(u),k=()=>{s.value=!s.value},c=async()=>{try{await v(t.post.post_id),f("Post reposted successfully","success")}catch(u){f("Failed to repost post","error"),console.error("Repost failed:",u)}};return(u,r)=>{var T,F,x,R;const S=Y("router-link");return i(),p("article",ct,[a("div",rt,[E(ve,{src:(T=e.post.user)==null?void 0:T.avatar_url,name:((F=e.post.user)==null?void 0:F.display_name)||((x=e.post.user)==null?void 0:x.username),size:"md"},null,8,["src","name"]),a("div",mt,[E(S,{to:`/profile/${(R=e.post.user)==null?void 0:R.username}`,class:"author-name"},{default:A(()=>{var _,h;return[W(b(((_=e.post.user)==null?void 0:_.display_name)||((h=e.post.user)==null?void 0:h.username)),1)]}),_:1},8,["to"]),a("span",dt,b(m(e.post.created_at)),1)]),n.value?(i(),H(fe,{key:0,position:"bottom-right"},{trigger:A(()=>[...r[2]||(r[2]=[a("button",{class:"btn-icon"},"â‹®",-1)])]),default:A(()=>[a("button",{class:"dropdown-item",onClick:r[0]||(r[0]=_=>u.$emit("edit"))},"Edit"),a("button",{class:"dropdown-item danger",onClick:r[1]||(r[1]=_=>u.$emit("delete"))},"Delete")]),_:1})):$("",!0)]),a("div",{class:"post-content",innerHTML:e.post.content_html||e.post.content},null,8,ut),e.post.media&&e.post.media.length?(i(),p("div",vt,[(i(!0),p(O,null,X(e.post.media,_=>(i(),p("img",{key:_.id,src:_.file_path,alt:"Media"},null,8,pt))),128))])):$("",!0),a("div",ft,[E(ue,{"reactable-type":"post","reactable-id":e.post.post_id},null,8,["reactable-id"]),a("button",{class:"action-btn",onClick:k},[r[3]||(r[3]=a("span",null,"ðŸ’¬",-1)),e.post.comments_count?(i(),p("span",ht,b(e.post.comments_count),1)):$("",!0)]),a("button",{class:"action-btn",onClick:c},[r[4]||(r[4]=a("span",null,"ðŸ”„",-1)),e.post.shares_count?(i(),p("span",yt,b(e.post.shares_count),1)):$("",!0)])]),s.value?(i(),H(lt,{key:1,"post-id":e.post.post_id,"allow-comments":!0},null,8,["post-id"])):$("",!0)])}}}),_t=N(gt,[["__scopeId","data-v-691c55f9"]]),wt={class:"post-list"},Ct={key:0,class:"loading"},bt={key:1,class:"end-message"},kt=U({__name:"PostList",props:{posts:{},loading:{type:Boolean},hasMore:{type:Boolean}},emits:["react","comment","share","edit","delete"],setup(e,{emit:d}){const t=d,l=(m,k)=>t("react",m,k),s=m=>t("comment",m),n=m=>t("share",m),v=m=>t("edit",m),f=m=>t("delete",m);return(m,k)=>(i(),p("div",wt,[(i(!0),p(O,null,X(e.posts,c=>(i(),H(_t,{key:c.id,post:c,onReact:u=>l(c.id,u),onComment:u=>s(c.id),onShare:u=>n(c.id),onEdit:u=>v(c.id),onDelete:u=>f(c.id)},null,8,["post","onReact","onComment","onShare","onEdit","onDelete"]))),128)),e.loading?(i(),p("div",Ct,[...k[0]||(k[0]=[a("div",{class:"spinner"},null,-1),a("p",null,"Loading posts...",-1)])])):$("",!0),!e.loading&&!e.hasMore?(i(),p("div",bt,"No more posts")):$("",!0)]))}}),$t=N(kt,[["__scopeId","data-v-8dd72ada"]]),Pt={class:"form-actions"},It=U({__name:"PostCreator",props:{modelValue:{type:Boolean},wallId:{}},emits:["update:modelValue","submit"],setup(e,{emit:d}){const t=e,l=d,s=C(t.modelValue),n=C(""),v=C([]),f=C(),m=C(!1),k=u=>{const r=u.target;r.files&&(v.value=Array.from(r.files))},c=()=>{n.value.trim()&&(l("submit",{wall_id:t.wallId,content:n.value,media_files:v.value}),n.value="",v.value=[],l("update:modelValue",!1))};return(u,r)=>(i(),H(ye,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=S=>s.value=S),title:"Create Post",size:"md"},{default:A(()=>[a("form",{onSubmit:q(c,["prevent"])},[te(a("textarea",{"onUpdate:modelValue":r[0]||(r[0]=S=>n.value=S),placeholder:"What's on your mind?",rows:"6",class:"post-input"},null,512),[[ae,n.value]]),a("div",Pt,[a("input",{type:"file",ref_key:"fileInput",ref:f,onChange:k,accept:"image/*,video/*",multiple:"",hidden:""},null,544),E(Z,{type:"button",variant:"ghost",onClick:r[1]||(r[1]=S=>{var T;return(T=f.value)==null?void 0:T.click()})},{default:A(()=>[...r[3]||(r[3]=[W("ðŸ“Ž Add Media",-1)])]),_:1}),E(Z,{type:"submit",variant:"primary",loading:m.value},{default:A(()=>[...r[4]||(r[4]=[W("Post",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["modelValue"]))}}),xt=N(It,[["__scopeId","data-v-cc0eb781"]]),Rt=(e,d={threshold:.8})=>{const t=C(),l=C(!1),s=()=>{if(!t.value||l.value)return;const{scrollTop:n,scrollHeight:v,clientHeight:f}=t.value;(n+f)/v>=d.threshold&&(l.value=!0,e(),setTimeout(()=>{l.value=!1},1e3))};return J(()=>{var n;(n=t.value)==null||n.addEventListener("scroll",s),window.addEventListener("scroll",s)}),le(()=>{var n;(n=t.value)==null||n.removeEventListener("scroll",s),window.removeEventListener("scroll",s)}),{targetRef:t,isLoading:l}},Ft={class:"home-view"},Mt={class:"feed-header"},St=U({__name:"HomeView",setup(e){const d=ge(),t=C(!1),l=C(1);J(()=>{d.fetchFeed()}),Rt(()=>{d.hasMore&&!d.loading&&d.loadMore()});const s=async c=>{await d.createPost(c)},n=(c,u)=>{d.reactToPost(c,u)},v=c=>{console.log("Comment on post",c)},f=c=>{console.log("Share post",c)},m=c=>{console.log("Edit post",c)},k=async c=>{confirm("Delete this post?")&&await d.deletePost(c)};return(c,u)=>(i(),p("div",Ft,[a("div",Mt,[u[3]||(u[3]=a("h1",null,"Home Feed",-1)),E(Z,{variant:"primary",onClick:u[0]||(u[0]=r=>t.value=!0)},{default:A(()=>[...u[2]||(u[2]=[W("+ Create Post",-1)])]),_:1})]),E($t,{posts:I(d).feedPosts,loading:I(d).loading,"has-more":I(d).hasMore,onReact:n,onComment:v,onShare:f,onEdit:m,onDelete:k},null,8,["posts","loading","has-more"]),E(xt,{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=r=>t.value=r),"wall-id":l.value,onSubmit:s},null,8,["modelValue","wall-id"])]))}}),Vt=N(St,[["__scopeId","data-v-d8e47323"]]);export{Vt as default};
//# sourceMappingURL=HomeView-Cm6Np_lA.js.map
