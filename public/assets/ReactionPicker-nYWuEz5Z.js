import{c as i,_ as L}from"./index-Dlg_VAyS.js";import{r as m,b as x,f as W,w as A,g as y,k as p,l as V,W as J,n as F,u as g,j as B,t as k,T as H,m as z,F as O,z as j,D as K,s as Z,i as _,Z as q}from"./vendor-Bfvy7Eak.js";const de={async getFeed(e){return i.get("/posts/feed",e)},async getWallPosts(e,o){return i.get(`/walls/${e}/posts`,o)},async getPost(e){return i.get(`/posts/${e}`)},async createPost(e){const o=new FormData;return o.append("wall_id",e.wall_id.toString()),o.append("content",e.content),e.post_type&&o.append("post_type",e.post_type),e.visibility&&o.append("visibility",e.visibility),e.ai_application_id&&o.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((v,u)=>{o.append(`media_files[${u}]`,v)}),i.upload("/posts",o)},async updatePost(e,o){return i.patch(`/posts/${e}`,o)},async deletePost(e){return i.delete(`/posts/${e}`)},async reactToPost(e,o){return i.post(`/posts/${e}/reactions`,{reaction_type:o})},async removeReaction(e){return i.delete(`/posts/${e}/reactions`)},async sharePost(e,o,v){return i.post(`/posts/${e}/share`,{wall_id:o,content:v})},async incrementViewCount(e){return i.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return i.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return i.post(`/posts/${e}/open`)}};function G(e,o){const v=()=>({like:0,love:0,haha:0,wow:0,sad:0,angry:0}),u=m([]),a=m({total:0,by_type:v()}),r=m(null),w=m(!1),b=m(null),C=()=>typeof e=="string"?e:e.value,P=()=>typeof o=="number"?o:o.value,f={like:"ðŸ‘",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},R={like:"#3b82f6",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},h=()=>{const s=localStorage.getItem("user");if(console.log("User string from localStorage:",s),s)try{const n=JSON.parse(s);console.log("Parsed user object:",n);const t=n.user_id||0;return console.log("User ID:",t),t}catch(n){return console.error("Error parsing user from localStorage:",n),0}return console.log("No user found in localStorage"),0},d=async()=>{var s,n;try{w.value=!0,b.value=null;const t=await i.get(`/reactions/${C()}/${P()}`);if(t&&typeof t=="object"&&"reactions"in t){u.value=Array.isArray(t.reactions)?t.reactions:[];const l={like:0,love:0,haha:0,wow:0,sad:0,angry:0},c=((s=t.stats)==null?void 0:s.by_type)||{},D={...l};Object.keys(l).forEach(T=>{T in c&&(D[T]=Number(c[T])||0)}),a.value={total:((n=t.stats)==null?void 0:n.total)||0,by_type:D};const E=h();console.log("Current user ID:",E),console.log("Reactions array:",u.value);const U=u.value.find(T=>T.user_id===E);console.log("User reaction found:",U),r.value=U?U.reaction_type:null,console.log("Current user reaction set to:",r.value)}else Array.isArray(t)?(u.value=t,a.value={total:t.length,by_type:v()}):(u.value=[],a.value={total:0,by_type:v()})}catch(t){b.value=t.message||"Failed to load reactions",console.error("Error loading reactions:",t)}finally{w.value=!1}},$=async s=>{const n=r.value,t=a.value.total,l={...a.value.by_type};try{r.value=s,a.value.total++,a.value.by_type[s]=(a.value.by_type[s]??0)+1,await i.post("/reactions",{reactable_type:C(),reactable_id:P(),reaction_type:s}),await d()}catch(c){throw r.value=n,a.value.total=t,a.value.by_type=l,b.value=c.message||"Failed to add reaction",c}},I=async()=>{const s=r.value,n=a.value.total,t={...a.value.by_type};if(s)try{r.value=null,a.value.total--,a.value.by_type[s]!==void 0&&(a.value.by_type[s]=Math.max(0,a.value.by_type[s]-1)),await i.delete(`/reactions/${C()}/${P()}`),await d()}catch(l){throw r.value=s,a.value.total=n,a.value.by_type=t,b.value=l.message||"Failed to remove reaction",l}},S=async s=>{r.value===s?await I():r.value?(await I(),await $(s)):await $(s)},M=x(()=>r.value?f[r.value]:"ðŸ¤"),N=x(()=>r.value?R[r.value]:"#94a3b8");return{reactions:u,stats:a,currentUserReaction:r,loading:w,error:b,reactionIcons:f,reactionColors:R,displayIcon:M,displayColor:N,loadReactions:d,addReaction:$,removeReaction:I,toggleReaction:S}}const Q={class:"reaction-picker-container"},X={class:"reaction-icon"},Y={key:0,class:"reaction-count"},ee=["onClick","title"],te={class:"modal-header"},oe={class:"modal-body"},ae={class:"reaction-tabs"},se=["onClick"],ne={class:"reaction-users-list"},le=["src","alt"],re={class:"username"},ce={class:"reaction-emoji"},ie={key:0,class:"empty-state"},ue=W({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const o=e;console.log("ReactionPicker created with:",o.reactableType,o.reactableId);const{reactions:v,stats:u,currentUserReaction:a,reactionIcons:r,displayIcon:w,displayColor:b,loadReactions:C,toggleReaction:P}=G(m(o.reactableType),m(o.reactableId));A(()=>[o.reactableType,o.reactableId],()=>{console.log("ReactionPicker props changed, reloading reactions:",o.reactableType,o.reactableId),C()}),A(v,n=>{console.log("Reactions updated:",n),console.log("Current user reaction:",a.value)},{deep:!0}),A(a,n=>{console.log("Current user reaction updated:",n),console.log("Display icon:",w.value),console.log("Display color:",b.value)});const f=m(!1),R=m(!1),h=m("all");let d=null;const $=n=>{n.stopPropagation(),console.log("Toggle picker clicked"),f.value=!f.value},I=()=>{console.log("Show picker on hover"),d=setTimeout(()=>{f.value=!0},300)},S=()=>{console.log("Hide picker on hover"),d&&(clearTimeout(d),d=null),setTimeout(()=>{f.value&&(f.value=!1)},300)},M=()=>{console.log("Keep picker open"),d&&(clearTimeout(d),d=null)},N=async n=>{console.log("Handle reaction click:",n),f.value=!1;try{await P(n),console.log("Reaction toggled successfully")}catch(t){console.error("Failed to toggle reaction:",t)}},s=x(()=>h.value==="all"?v.value:v.value.filter(n=>n.reaction_type===h.value));return console.log("Loading reactions on mount"),C(),(n,t)=>(_(),y("div",Q,[p("button",{onClick:$,onMouseenter:I,onMouseleave:S,class:F(["reaction-button",{active:g(a)}]),style:J({color:g(b)})},[p("span",X,k(g(w)),1),g(u).total>0?(_(),y("span",Y,k(g(u).total),1)):B("",!0)],38),V(H,{name:"picker-fade"},{default:z(()=>[f.value?(_(),y("div",{key:0,class:"reaction-picker",onMouseenter:M,onMouseleave:S},[(_(!0),y(O,null,j(g(r),(l,c)=>(_(),y("button",{key:c,onClick:D=>N(c),class:F(["reaction-option",{selected:g(a)===c}]),title:c},k(l),11,ee))),128))],32)):B("",!0)]),_:1}),V(H,{name:"modal-fade"},{default:z(()=>[R.value?(_(),y("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=l=>R.value=!1)},[p("div",{class:"modal-content",onClick:t[2]||(t[2]=K(()=>{},["stop"]))},[p("div",te,[t[4]||(t[4]=p("h3",null,"Reactions",-1)),p("button",{onClick:t[0]||(t[0]=l=>R.value=!1),class:"btn-close"},"Ã—")]),p("div",oe,[p("div",ae,[p("button",{onClick:t[1]||(t[1]=l=>h.value="all"),class:F(["tab-button",{active:h.value==="all"}])}," All "+k(g(u).total),3),(_(!0),y(O,null,j(g(u).by_type,(l,c)=>Z((_(),y("button",{key:c,onClick:D=>h.value=c,class:F(["tab-button",{active:h.value===c}])},k(g(r)[c])+" "+k(l),11,se)),[[q,l>0]])),128))]),p("div",ne,[(_(!0),y(O,null,j(s.value,l=>(_(),y("div",{key:l.reaction_id,class:"reaction-user-item"},[p("img",{src:l.avatar_url||"/assets/images/default-avatar.svg",alt:l.username,class:"user-avatar"},null,8,le),p("span",re,k(l.username),1),p("span",ce,k(g(r)[l.reaction_type]),1)]))),128)),s.value.length===0?(_(),y("div",ie," No reactions yet ")):B("",!0)])])])])):B("",!0)]),_:1})]))}}),ye=L(ue,[["__scopeId","data-v-be219355"]]);export{ye as R,de as p};
//# sourceMappingURL=ReactionPicker-nYWuEz5Z.js.map
