import{c,_ as H}from"./index-TLTI1gNp.js";import{r as g,b as j,f as W,g as d,k as v,l as E,W as J,n as F,u as y,j as B,t as h,T as V,m as z,F as A,z as O,D as L,s as Z,i as _,Z as q}from"./vendor-Bfvy7Eak.js";const pe={async getFeed(e){return c.get("/posts/feed",e)},async getWallPosts(e,o){return c.get(`/walls/${e}/posts`,o)},async getPost(e){return c.get(`/posts/${e}`)},async createPost(e){const o=new FormData;return o.append("wall_id",e.wall_id.toString()),o.append("content",e.content),e.post_type&&o.append("post_type",e.post_type),e.visibility&&o.append("visibility",e.visibility),e.ai_application_id&&o.append("ai_application_id",e.ai_application_id.toString()),e.media_files&&e.media_files.forEach((f,u)=>{o.append(`media_files[${u}]`,f)}),c.upload("/posts",o)},async updatePost(e,o){return c.patch(`/posts/${e}`,o)},async deletePost(e){return c.delete(`/posts/${e}`)},async reactToPost(e,o){return c.post(`/posts/${e}/reactions`,{reaction_type:o})},async removeReaction(e){return c.delete(`/posts/${e}/reactions`)},async sharePost(e,o,f){return c.post(`/posts/${e}/share`,{wall_id:o,content:f})},async incrementViewCount(e){return c.post(`/posts/${e}/view`)},async batchIncrementViewCounts(e){return c.post("/posts/batch-view",{post_ids:e})},async incrementOpenCount(e){return c.post(`/posts/${e}/open`)}};function G(e,o){const f=()=>({like:0,love:0,haha:0,wow:0,sad:0,angry:0}),u=g([]),s=g({total:0,by_type:f()}),l=g(null),C=g(!1),w=g(null),R=()=>typeof e=="string"?e:e.value,$=()=>typeof o=="number"?o:o.value,m={like:"ðŸ‘",love:"â¤ï¸",haha:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢",angry:"ðŸ˜ "},k={like:"#3b82f6",love:"#ef4444",haha:"#eab308",wow:"#f97316",sad:"#64748b",angry:"#dc2626"},b=()=>{const a=localStorage.getItem("user");if(console.log("User string from localStorage:",a),a)try{const r=JSON.parse(a);console.log("Parsed user object:",r);const t=r.user_id||0;return console.log("User ID:",t),t}catch(r){return console.error("Error parsing user from localStorage:",r),0}return console.log("No user found in localStorage"),0},p=async()=>{var a,r;try{C.value=!0,w.value=null;const t=await c.get(`/reactions/${R()}/${$()}`);if(t&&typeof t=="object"&&"reactions"in t){u.value=Array.isArray(t.reactions)?t.reactions:[];const n={like:0,love:0,haha:0,wow:0,sad:0,angry:0},i=((a=t.stats)==null?void 0:a.by_type)||{},D={...n};Object.keys(n).forEach(S=>{S in i&&(D[S]=Number(i[S])||0)}),s.value={total:((r=t.stats)==null?void 0:r.total)||0,by_type:D};const x=b();console.log("Current user ID:",x),console.log("Reactions array:",u.value);const U=u.value.find(S=>S.user_id===x);console.log("User reaction found:",U),l.value=U?U.reaction_type:null,console.log("Current user reaction set to:",l.value)}else Array.isArray(t)?(u.value=t,s.value={total:t.length,by_type:f()}):(u.value=[],s.value={total:0,by_type:f()})}catch(t){w.value=t.message||"Failed to load reactions",console.error("Error loading reactions:",t)}finally{C.value=!1}},P=async a=>{const r=l.value,t=s.value.total,n={...s.value.by_type};try{l.value=a,s.value.total++,s.value.by_type[a]=(s.value.by_type[a]??0)+1,await c.post("/reactions",{reactable_type:R(),reactable_id:$(),reaction_type:a}),await p()}catch(i){throw l.value=r,s.value.total=t,s.value.by_type=n,w.value=i.message||"Failed to add reaction",i}},I=async()=>{const a=l.value,r=s.value.total,t={...s.value.by_type};if(a)try{l.value=null,s.value.total--,s.value.by_type[a]!==void 0&&(s.value.by_type[a]=Math.max(0,s.value.by_type[a]-1)),await c.delete(`/reactions/${R()}/${$()}`),await p()}catch(n){throw l.value=a,s.value.total=r,s.value.by_type=t,w.value=n.message||"Failed to remove reaction",n}},T=async a=>{l.value===a?await I():l.value?(await I(),await P(a)):await P(a)},M=j(()=>l.value?m[l.value]:"ðŸ¤"),N=j(()=>l.value?k[l.value]:"#94a3b8");return{reactions:u,stats:s,currentUserReaction:l,loading:C,error:w,reactionIcons:m,reactionColors:k,displayIcon:M,displayColor:N,loadReactions:p,addReaction:P,removeReaction:I,toggleReaction:T}}const K={class:"reaction-picker-container"},Q={class:"reaction-icon"},X={key:0,class:"reaction-count"},Y=["onClick","title"],ee={class:"modal-header"},te={class:"modal-body"},ae={class:"reaction-tabs"},oe=["onClick"],se={class:"reaction-users-list"},ne=["src","alt"],le={class:"username"},re={class:"reaction-emoji"},ie={key:0,class:"empty-state"},ce=W({__name:"ReactionPicker",props:{reactableType:{},reactableId:{}},setup(e){const o=e,{reactions:f,stats:u,currentUserReaction:s,reactionIcons:l,displayIcon:C,displayColor:w,loadReactions:R,toggleReaction:$}=G(g(o.reactableType),g(o.reactableId)),m=g(!1),k=g(!1),b=g("all");let p=null;const P=r=>{r.stopPropagation(),m.value=!m.value},I=()=>{p=setTimeout(()=>{m.value=!0},300)},T=()=>{p&&(clearTimeout(p),p=null),setTimeout(()=>{m.value&&(m.value=!1)},300)},M=()=>{p&&(clearTimeout(p),p=null)},N=async r=>{m.value=!1;try{await $(r)}catch(t){console.error("Failed to toggle reaction:",t)}},a=j(()=>b.value==="all"?f.value:f.value.filter(r=>r.reaction_type===b.value));return R(),(r,t)=>(_(),d("div",K,[v("button",{onClick:P,onMouseenter:I,onMouseleave:T,class:F(["reaction-button",{active:y(s)}]),style:J({color:y(w)})},[v("span",Q,h(y(C)),1),y(u).total>0?(_(),d("span",X,h(y(u).total),1)):B("",!0)],38),E(V,{name:"picker-fade"},{default:z(()=>[m.value?(_(),d("div",{key:0,class:"reaction-picker",onMouseenter:M,onMouseleave:T},[(_(!0),d(A,null,O(y(l),(n,i)=>(_(),d("button",{key:i,onClick:D=>N(i),class:F(["reaction-option",{selected:y(s)===i}]),title:i},h(n),11,Y))),128))],32)):B("",!0)]),_:1}),E(V,{name:"modal-fade"},{default:z(()=>[k.value?(_(),d("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=n=>k.value=!1)},[v("div",{class:"modal-content",onClick:t[2]||(t[2]=L(()=>{},["stop"]))},[v("div",ee,[t[4]||(t[4]=v("h3",null,"Reactions",-1)),v("button",{onClick:t[0]||(t[0]=n=>k.value=!1),class:"btn-close"},"Ã—")]),v("div",te,[v("div",ae,[v("button",{onClick:t[1]||(t[1]=n=>b.value="all"),class:F(["tab-button",{active:b.value==="all"}])}," All "+h(y(u).total),3),(_(!0),d(A,null,O(y(u).by_type,(n,i)=>Z((_(),d("button",{key:i,onClick:D=>b.value=i,class:F(["tab-button",{active:b.value===i}])},h(y(l)[i])+" "+h(n),11,oe)),[[q,n>0]])),128))]),v("div",se,[(_(!0),d(A,null,O(a.value,n=>(_(),d("div",{key:n.reaction_id,class:"reaction-user-item"},[v("img",{src:n.avatar_url||"/assets/images/default-avatar.svg",alt:n.username,class:"user-avatar"},null,8,ne),v("span",le,h(n.username),1),v("span",re,h(y(l)[n.reaction_type]),1)]))),128)),a.value.length===0?(_(),d("div",ie," No reactions yet ")):B("",!0)])])])])):B("",!0)]),_:1})]))}}),de=H(ce,[["__scopeId","data-v-7f6eb01c"]]);export{de as R,pe as p};
//# sourceMappingURL=ReactionPicker-CW_-A30y.js.map
