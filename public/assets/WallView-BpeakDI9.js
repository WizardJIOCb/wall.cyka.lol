var Kt=Object.defineProperty;var Yt=(t,e,n)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>Yt(t,typeof e!="symbol"?e+"":e,n);import{f as Te,r as A,b as G,e as Ye,o as Et,g as _,k as s,j as b,n as ve,t as f,W as Me,i as g,s as Lt,v as en,x as tn,D as zt,Y as yt,l as be,F as he,z as je,B as Ce,q as nn,w as We,u as pe,X as sn,y as on,C as $t,A as Oe,p as an}from"./vendor-Bfvy7Eak.js";import{_ as Ie,c as V,u as et}from"./index-D53KQBf3.js";import{R as ln,p as Ve}from"./ReactionPicker-Duy0X_iP.js";import"./utils-Cb2jxgch.js";const rn={class:"ai-generation-progress"},cn={class:"progress-header"},un={class:"status-icon-container"},dn={key:0,class:"spinner"},pn={class:"status-info"},hn={class:"status-subtitle"},mn={key:0,class:"model-name"},gn={class:"model-text"},_n={class:"progress-bar-container"},kn={key:0,class:"progress-text"},fn={key:1,class:"progress-fill-indeterminate"},vn={key:0,class:"stats-grid"},bn={class:"stat-card"},wn={class:"stat-content"},xn={class:"stat-value"},yn={class:"stat-label"},$n={class:"stat-card"},Sn={class:"stat-content"},Cn={class:"stat-value"},Rn={class:"stat-card"},Tn={class:"stat-content"},In={class:"stat-value"},An={key:0,class:"stat-card"},Pn={class:"stat-content"},En={class:"stat-value"},Ln={key:1,class:"completion-stats"},zn={class:"token-breakdown"},Mn={class:"token-item"},jn={class:"token-value"},qn={class:"token-item"},Fn={class:"token-value"},Dn={class:"token-item total"},Bn={class:"token-value"},Gn={key:2,class:"error-message"},Nn=Te({__name:"AIGenerationProgress",props:{jobId:{},autoStart:{type:Boolean},modelName:{}},emits:["complete","error"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=A("queued"),h=A(0),u=A(0),m=A(0),i=A(0),y=A(0),v=A(0),p=A(0),S=A(0),x=A(0),R=A(0),E=A("");let I=null,D=null,Z=0;const H=G(()=>c.value==="processing"),ce=G(()=>{switch(c.value){case"queued":return"â³";case"processing":return"ðŸ¤–";case"completed":return"âœ…";case"failed":return"âŒ";default:return"â“"}}),X=G(()=>`status-${c.value}`),O=G(()=>{switch(c.value){case"queued":return"Generation Queued";case"processing":return"AI is Generating...";case"completed":return"Generation Complete";case"failed":return"Generation Failed";default:return"Unknown Status"}}),ee=G(()=>c.value==="queued"?"Waiting in queue...":c.value==="processing"?x.value===0?"Preparing... Evaluating prompt and loading model":h.value===0&&x.value>0?"Preparing generation...":m.value>0?`Generating at ${m.value.toFixed(1)} tokens/sec (${Math.round(R.value)} chars/sec)`:`Generating content... ${x.value} characters`:"");function te(j){return j.toLocaleString()}function _e(j){const w=Math.floor(j/1e3),F=Math.floor(w/60),P=Math.floor(F/60);return P>0?`${P}h ${F%60}m ${w%60}s`:F>0?`${F}m ${w%60}s`:`${w}s`}function ke(){if(I)return;const w=`/api/v1/ai/generation/${o.jobId}/progress`;console.log("[AIGenerationProgress] Starting SSE connection to:",w),Z=Date.now(),D=window.setInterval(()=>{c.value==="processing"&&(i.value=Date.now()-Z)},100),I=new EventSource(w),I.addEventListener("progress",F=>{console.log("[AIGenerationProgress] Received progress event:",F.data);const P=JSON.parse(F.data);if(c.value=P.status,h.value=P.progress||0,u.value=P.current_tokens||0,m.value=P.tokens_per_second||0,y.value=P.estimated_remaining||0,v.value=P.prompt_tokens||0,p.value=P.completion_tokens||0,S.value=P.total_tokens||0,x.value=P.content_length||0,R.value=P.chars_per_second||0,P.elapsed_time&&c.value==="processing"&&i.value===0){const U=P.elapsed_time;Z=Date.now()-U,i.value=U}}),I.addEventListener("complete",F=>{console.log("[AIGenerationProgress] Generation complete:",F.data);const P=JSON.parse(F.data);c.value="completed",h.value=100,S.value=P.total_tokens||S.value,P.elapsed_time&&(i.value=P.elapsed_time),ne(),a("complete",P)}),I.addEventListener("error",F=>{console.error("[AIGenerationProgress] SSE error event:",F);let P={};try{P=JSON.parse(F.data)}catch{P={error:"Connection error"}}c.value="failed",E.value=P.error||"Unknown error occurred",ne(),a("error",E.value)}),I.onerror=F=>{console.error("[AIGenerationProgress] SSE connection error:",F)}}function ne(){I&&(I.close(),I=null),D&&(clearInterval(D),D=null)}return Ye(()=>{o.autoStart!==!1&&ke()}),Et(()=>{ne()}),e({startTracking:ke,stopTracking:ne}),(j,w)=>(g(),_("div",rn,[s("div",cn,[s("div",un,[c.value==="processing"?(g(),_("div",dn)):(g(),_("span",{key:1,class:ve(["status-icon",X.value])},f(ce.value),3))]),s("div",pn,[s("h3",null,f(O.value),1),s("p",hn,f(ee.value),1),o.modelName?(g(),_("p",mn,[w[0]||(w[0]=s("span",{class:"model-icon"},"ðŸ¤–",-1)),s("span",gn,f(o.modelName),1)])):b("",!0)])]),s("div",_n,[s("div",{class:ve(["progress-bar",{indeterminate:h.value===0&&H.value}])},[h.value>0?(g(),_("div",{key:0,class:ve(["progress-fill",{"progress-pulsing":H.value}]),style:Me({width:h.value+"%"})},[h.value>=8?(g(),_("span",kn,f(h.value)+"%",1)):b("",!0)],6)):H.value?(g(),_("div",fn)):b("",!0)],2)]),H.value||c.value==="completed"?(g(),_("div",vn,[s("div",bn,[w[1]||(w[1]=s("div",{class:"stat-icon"},"ðŸ”¢",-1)),s("div",wn,[s("div",xn,f(te(u.value)),1),s("div",yn,f(u.value===0&&c.value==="processing"?"Evaluating...":"Tokens Generated"),1)])]),s("div",$n,[w[3]||(w[3]=s("div",{class:"stat-icon"},"âš¡",-1)),s("div",Sn,[s("div",Cn,f(m.value>0?m.value.toFixed(1):"â€”"),1),w[2]||(w[2]=s("div",{class:"stat-label"},"Tokens/sec",-1))])]),s("div",Rn,[w[5]||(w[5]=s("div",{class:"stat-icon"},"â±ï¸",-1)),s("div",Tn,[s("div",In,f(_e(i.value)),1),w[4]||(w[4]=s("div",{class:"stat-label"},"Elapsed Time",-1))])]),y.value>0&&H.value?(g(),_("div",An,[w[7]||(w[7]=s("div",{class:"stat-icon"},"â³",-1)),s("div",Pn,[s("div",En,f(_e(y.value)),1),w[6]||(w[6]=s("div",{class:"stat-label"},"Est. Remaining",-1))])])):b("",!0)])):b("",!0),c.value==="completed"&&S.value>0?(g(),_("div",Ln,[w[11]||(w[11]=s("div",{class:"completion-badge"},[s("span",{class:"badge-icon"},"âœ¨"),s("span",{class:"badge-text"},"Generation Complete!")],-1)),s("div",zn,[s("div",Mn,[w[8]||(w[8]=s("span",{class:"token-label"},"Input Tokens:",-1)),s("span",jn,f(te(v.value)),1)]),s("div",qn,[w[9]||(w[9]=s("span",{class:"token-label"},"Output Tokens:",-1)),s("span",Fn,f(te(p.value)),1)]),s("div",Dn,[w[10]||(w[10]=s("span",{class:"token-label"},"Total:",-1)),s("span",Bn,f(te(S.value)),1)])])])):b("",!0),c.value==="failed"&&E.value?(g(),_("div",Gn,[w[12]||(w[12]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",null,f(E.value),1)])):b("",!0)]))}}),Un=Ie(Nn,[["__scopeId","data-v-208e0ab2"]]);function Mt(t){const e=A([]),n=A(!1),o=A(null),a=()=>typeof t=="number"?t:t.value,c=v=>v!=null&&typeof v=="object"&&typeof v.comment_id=="number"&&v.comment_id>0;return{comments:e,loading:n,error:o,loadComments:async(v="newest")=>{try{n.value=!0,o.value=null;let p="created_asc";v==="newest"?p="created_desc":v==="popular"&&(p="reactions");const S=await V.get(`/posts/${a()}/comments`,{params:{sort:p}});console.log("Comments API Response:",S),S&&Array.isArray(S.comments)?(e.value=S.comments.filter(c),console.log("Filtered comments:",e.value)):(console.log("Invalid response format or no comments array found"),e.value=[])}catch(p){o.value=p.message||"Failed to load comments",console.error("Error loading comments:",p),e.value=[]}finally{n.value=!1}},addComment:async v=>{try{const S=(await V.post("/comments",v)).comment;if(c(S)){if(!v.parent_id)e.value.unshift(S);else return S;return S}return null}catch(p){throw o.value=p.message||"Failed to add comment",p}},updateComment:async(v,p)=>{try{const x=(await V.patch(`/comments/${v}`,p)).comment;if(c(x)){const R=e.value.findIndex(E=>E&&E.comment_id===v);return R!==-1&&(e.value[R]={...e.value[R],...x}),x}return null}catch(S){throw o.value=S.message||"Failed to update comment",S}},deleteComment:async v=>{try{await V.delete(`/comments/${v}`),e.value=e.value.filter(p=>p&&p.comment_id!==void 0&&p.comment_id!==v)}catch(p){throw o.value=p.message||"Failed to delete comment",p}},loadReplies:async v=>{try{const p=await V.get(`/posts/${a()}/comments`,{params:{parent_id:v}});return p&&Array.isArray(p.comments)?p.comments.filter(c):[]}catch(p){return o.value=p.message||"Failed to load replies",[]}}}}const Hn={class:"comment-input-container"},On={class:"comment-input-wrapper"},Vn=["src","alt"],Zn={class:"input-area"},Wn=["placeholder","onKeydown"],Qn={class:"input-actions"},Jn=["disabled"],Xn=["disabled"],Kn=Te({__name:"CommentInput",props:{postId:{},parentId:{},placeholder:{},onCancel:{type:Function},initialValue:{}},emits:["submit","cancel"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=et(),h=A(o.initialValue||""),u=A(!1),m=A(null),i=G(()=>{var R;return((R=c.user)==null?void 0:R.avatar_url)||"/assets/images/default-avatar.svg"}),y=G(()=>{var R;return((R=c.user)==null?void 0:R.username)||"User"}),v=()=>{yt(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=`${m.value.scrollHeight}px`)})},p=async()=>{if(!(!h.value.trim()||u.value)){u.value=!0;try{a("submit",h.value.trim()),h.value="",v()}finally{u.value=!1}}},S=()=>{h.value="",v(),o.onCancel&&o.onCancel(),a("cancel")};return e({focus:()=>{yt(()=>{var R;(R=m.value)==null||R.focus()})}}),(R,E)=>(g(),_("div",Hn,[s("div",On,[s("img",{src:i.value,alt:y.value,class:"user-avatar"},null,8,Vn),s("div",Zn,[Lt(s("textarea",{"onUpdate:modelValue":E[0]||(E[0]=I=>h.value=I),ref_key:"textareaRef",ref:m,placeholder:t.placeholder,onKeydown:tn(zt(p,["exact","prevent"]),["enter"]),onInput:v,class:"comment-textarea",rows:"1"},null,40,Wn),[[en,h.value]]),s("div",Qn,[s("button",{onClick:p,disabled:!h.value.trim()||u.value,class:"btn-submit"},f(u.value?"Posting...":"Post"),9,Jn),t.onCancel?(g(),_("button",{key:0,onClick:S,class:"btn-cancel",disabled:u.value}," Cancel ",8,Xn)):b("",!0)])])])]))}}),Qe=Ie(Kn,[["__scopeId","data-v-1796c3c9"]]),Yn={class:"comment-header"},es=["src","alt"],ts={class:"comment-meta"},ns={class:"comment-author"},ss={class:"comment-time"},os={key:0,class:"comment-edited"},as={class:"comment-body"},ls={key:0,class:"comment-edit"},rs={key:1,class:"comment-content"},is=["innerHTML"],cs={key:1},us={key:0,class:"comment-actions"},ds={key:0},ps={key:1,class:"reply-input"},hs={key:2,class:"comment-replies"},ms={key:3,class:"load-replies"},gs={key:4,class:"loading-replies"},_s={key:5,class:"view-full-thread"},ks=Te({__name:"CommentItem",props:{comment:{},postId:{},depth:{},maxDepth:{}},emits:["reply-added","comment-updated","comment-deleted"],setup(t,{emit:e}){const n=t,o=e;n.comment||console.warn("CommentItem: comment prop is required");const a=et(),{addComment:c,updateComment:h,deleteComment:u,loadReplies:m}=Mt(A(n.postId)),i=G(()=>n.depth||0),y=G(()=>n.maxDepth||3),v=A(!1),p=A(!1),S=A(!1),x=A(!1),R=A([]),E=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),I=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),D=G(()=>n.comment&&i.value<y.value),Z=j=>{const w=new Date(j),P=new Date().getTime()-w.getTime(),U=Math.floor(P/6e4),Pe=Math.floor(P/36e5),ue=Math.floor(P/864e5);return U<1?"just now":U<60?`${U}m ago`:Pe<24?`${Pe}h ago`:ue<7?`${ue}d ago`:w.toLocaleDateString()},H=()=>{v.value=!0},ce=()=>{v.value=!1},X=async j=>{try{if(!n.comment)return;const w=await h(n.comment.comment_id,{content_text:j});w&&(v.value=!1,o("comment-updated",w))}catch(w){console.error("Failed to update comment:",w)}},O=async()=>{if(!(!n.comment||!confirm("Delete this comment?")))try{await u(n.comment.comment_id),o("comment-deleted",n.comment.comment_id)}catch(j){console.error("Failed to delete comment:",j)}},ee=()=>{p.value=!p.value},te=async j=>{try{if(!n.comment)return;const w=await c({post_id:n.postId,content_text:j,parent_id:n.comment.comment_id});w&&(p.value=!1,R.value.unshift(w),S.value=!0,o("reply-added",w))}catch(w){console.error("Failed to add reply:",w)}},_e=async()=>{if(n.comment){x.value=!0;try{R.value=await m(n.comment.comment_id),S.value=!0}catch(j){console.error("Failed to load replies:",j)}finally{x.value=!1}}},ke=j=>{o("reply-added",j)},ne=()=>{n.comment&&console.log("View full thread for comment:",n.comment.comment_id)};return(j,w)=>{const F=nn("CommentItem",!0);return t.comment&&t.comment.comment_id?(g(),_("div",{key:0,class:ve(["comment-item",{"is-reply":i.value>0}]),style:Me({marginLeft:`${i.value*40}px`})},[s("div",Yn,[s("img",{src:t.comment.author_avatar||"/assets/images/default-avatar.svg",alt:t.comment.author_username,class:"comment-avatar"},null,8,es),s("div",ts,[s("span",ns,f(t.comment.author_username),1),s("span",ss,f(Z(t.comment.created_at)),1),t.comment.edited_at?(g(),_("span",os,"(edited)")):b("",!0)])]),s("div",as,[v.value?(g(),_("div",ls,[be(Qe,{"post-id":t.comment.post_id,"initial-value":t.comment.content_text,placeholder:"Edit your comment...",onSubmit:X,onCancel:ce},null,8,["post-id","initial-value"])])):(g(),_("div",rs,[t.comment.content_html?(g(),_("div",{key:0,innerHTML:t.comment.content_html},null,8,is)):(g(),_("p",cs,f(t.comment.content_text),1))]))]),v.value?b("",!0):(g(),_("div",us,[be(ln,{"reactable-type":"comment","reactable-id":t.comment.comment_id},null,8,["reactable-id"]),D.value?(g(),_("button",{key:0,onClick:ee,class:"action-btn"},[w[2]||(w[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),w[3]||(w[3]=s("span",null,"Reply",-1)),t.comment.reply_count>0?(g(),_("span",ds,"("+f(t.comment.reply_count)+")",1)):b("",!0)])):b("",!0),E.value?(g(),_("button",{key:1,onClick:H,class:"action-btn"},[...w[4]||(w[4]=[s("span",{class:"icon"},"âœï¸",-1),s("span",null,"Edit",-1)])])):b("",!0),I.value?(g(),_("button",{key:2,onClick:O,class:"action-btn delete"},[...w[5]||(w[5]=[s("span",{class:"icon"},"ðŸ—‘ï¸",-1),s("span",null,"Delete",-1)])])):b("",!0)])),p.value?(g(),_("div",ps,[be(Qe,{"post-id":t.comment.post_id,"parent-id":t.comment.comment_id,placeholder:"Write a reply...",onSubmit:te,onCancel:ee},null,8,["post-id","parent-id"])])):b("",!0),S.value&&R.value.length>0?(g(),_("div",hs,[(g(!0),_(he,null,je(R.value,P=>(g(),Ce(F,{key:P.comment_id,comment:P,"post-id":t.postId,depth:i.value+1,"max-depth":y.value,onReplyAdded:ke,onCommentUpdated:w[0]||(w[0]=U=>j.$emit("comment-updated",U)),onCommentDeleted:w[1]||(w[1]=U=>j.$emit("comment-deleted",U))},null,8,["comment","post-id","depth","max-depth"]))),128))])):b("",!0),t.comment.reply_count>0&&!S.value&&!x.value?(g(),_("div",ms,[s("button",{onClick:_e,class:"btn-load-replies"},[w[6]||(w[6]=s("span",{class:"icon"},"â†³",-1)),s("span",null,"Show "+f(t.comment.reply_count)+" "+f(t.comment.reply_count===1?"reply":"replies"),1)])])):b("",!0),x.value?(g(),_("div",gs,[...w[7]||(w[7]=[s("div",{class:"spinner"},null,-1),s("span",null,"Loading replies...",-1)])])):b("",!0),i.value>=y.value&&t.comment.reply_count>0?(g(),_("div",_s,[s("button",{onClick:ne,class:"btn-view-thread"}," View full thread â†’ ")])):b("",!0)],6)):b("",!0)}}}),fs=Ie(ks,[["__scopeId","data-v-3683cf16"]]),vs={class:"comment-section"},bs={class:"comments-header"},ws={class:"comments-title"},xs={class:"add-comment"},ys={class:"comments-list"},$s={key:0,class:"loading-container"},Ss={key:1,class:"error-container"},Cs={key:2,class:"empty-state"},Rs={key:3,class:"comments"},Ts=Te({__name:"CommentSection",props:{postId:{},maxDepth:{}},emits:["comment-created","comment-deleted","comment-updated"],setup(t,{emit:e}){const n=t,o=e,a=A(n.maxDepth||3),c=A("newest"),{comments:h,loading:u,error:m,loadComments:i,addComment:y}=Mt(A(n.postId)),v=()=>{i(c.value)};We(h,E=>{console.log("Comments updated:",E),console.log("Comments length:",E.length)});const p=async E=>{try{const I=await y({post_id:n.postId,content_text:E});I&&o("comment-created",I)}catch(I){console.error("Failed to add comment:",I)}},S=E=>{o("comment-created",E)},x=E=>{o("comment-updated",E)},R=E=>{o("comment-deleted",E)};return Ye(()=>{i(c.value)}),(E,I)=>(g(),_("div",vs,[s("div",bs,[s("h3",ws,[I[2]||(I[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,"Comments ("+f(pe(h).length)+")",1)]),Lt(s("select",{"onUpdate:modelValue":I[0]||(I[0]=D=>c.value=D),onChange:v,class:"sort-select"},[...I[3]||(I[3]=[s("option",{value:"newest"},"Newest First",-1),s("option",{value:"oldest"},"Oldest First",-1),s("option",{value:"popular"},"Most Popular",-1)])],544),[[sn,c.value]])]),s("div",xs,[be(Qe,{"post-id":t.postId,placeholder:"Add a comment...",onSubmit:p},null,8,["post-id"])]),s("div",ys,[pe(u)?(g(),_("div",$s,[...I[4]||(I[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading comments...",-1)])])):pe(m)?(g(),_("div",Ss,[s("p",null,f(pe(m)),1),s("button",{onClick:I[1]||(I[1]=D=>pe(i)(c.value)),class:"btn-retry"},"Retry")])):pe(h).length===0?(g(),_("div",Cs,[...I[5]||(I[5]=[s("span",{class:"empty-icon"},"ðŸ’¬",-1),s("p",null,"No comments yet",-1),s("p",{class:"empty-hint"},"Be the first to comment!",-1)])])):(g(),_("div",Rs,[(g(!0),_(he,null,je(pe(h),(D,Z)=>(g(),Ce(fs,{key:D.comment_id,comment:D,"post-id":t.postId,depth:0,"max-depth":a.value,onReplyAdded:S,onCommentUpdated:x,onCommentDeleted:R},null,8,["comment","post-id","max-depth"]))),128))]))])]))}}),St=Ie(Ts,[["__scopeId","data-v-76797f32"]]);function tt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ge=tt();function jt(t){ge=t}var Re={exec:()=>null};function z(t,e=""){let n=typeof t=="string"?t:t.source,o={replace:(a,c)=>{let h=typeof c=="string"?c:c.source;return h=h.replace(N.caret,"$1"),n=n.replace(a,h),o},getRegex:()=>new RegExp(n,e)};return o}var N={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Is=/^(?:[ \t]*(?:\n|$))+/,As=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ps=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ae=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Es=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,nt=/(?:[*+-]|\d{1,9}[.)])/,qt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ft=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ls=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),st=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,zs=/^[^\n]+/,ot=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Ms=z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ot).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),js=z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,nt).getRegex(),Be="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",at=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,qs=z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",at).replace("tag",Be).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dt=z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Fs=z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dt).getRegex(),lt={blockquote:Fs,code:As,def:Ms,fences:Ps,heading:Es,hr:Ae,html:qs,lheading:Ft,list:js,newline:Is,paragraph:Dt,table:Re,text:zs},Ct=z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Ds={...lt,lheading:Ls,table:Ct,paragraph:z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ct).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex()},Bs={...lt,html:z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",at).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Re,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:z(st).replace("hr",Ae).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ft).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gs=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ns=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Bt=/^( {2,}|\\)\n(?!\s*$)/,Us=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ge=/[\p{P}\p{S}]/u,rt=/[\s\p{P}\p{S}]/u,Gt=/[^\s\p{P}\p{S}]/u,Hs=z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,rt).getRegex(),Nt=/(?!~)[\p{P}\p{S}]/u,Os=/(?!~)[\s\p{P}\p{S}]/u,Vs=/(?:[^\s\p{P}\p{S}]|~)/u,Zs=z(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ut=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ws=z(Ut,"u").replace(/punct/g,Ge).getRegex(),Qs=z(Ut,"u").replace(/punct/g,Nt).getRegex(),Ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Js=z(Ht,"gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Xs=z(Ht,"gu").replace(/notPunctSpace/g,Vs).replace(/punctSpace/g,Os).replace(/punct/g,Nt).getRegex(),Ks=z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Ys=z(/\\(punct)/,"gu").replace(/punct/g,Ge).getRegex(),eo=z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),to=z(at).replace("(?:-->|$)","-->").getRegex(),no=z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",to).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),qe=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,so=z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",qe).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ot=z(/^!?\[(label)\]\[(ref)\]/).replace("label",qe).replace("ref",ot).getRegex(),Vt=z(/^!?\[(ref)\](?:\[\])?/).replace("ref",ot).getRegex(),oo=z("reflink|nolink(?!\\()","g").replace("reflink",Ot).replace("nolink",Vt).getRegex(),Rt=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,it={_backpedal:Re,anyPunctuation:Ys,autolink:eo,blockSkip:Zs,br:Bt,code:Ns,del:Re,emStrongLDelim:Ws,emStrongRDelimAst:Js,emStrongRDelimUnd:Ks,escape:Gs,link:so,nolink:Vt,punctuation:Hs,reflink:Ot,reflinkSearch:oo,tag:no,text:Us,url:Re},ao={...it,link:z(/^!?\[(label)\]\((.*?)\)/).replace("label",qe).getRegex(),reflink:z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",qe).getRegex()},Je={...it,emStrongRDelimAst:Xs,emStrongLDelim:Qs,url:z(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Rt).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:z(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Rt).getRegex()},lo={...Je,br:z(Bt).replace("{2,}","*").getRegex(),text:z(Je.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Le={normal:lt,gfm:Ds,pedantic:Bs},ye={normal:it,gfm:Je,breaks:lo,pedantic:ao},ro={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tt=t=>ro[t];function K(t,e){if(e){if(N.escapeTest.test(t))return t.replace(N.escapeReplace,Tt)}else if(N.escapeTestNoEncode.test(t))return t.replace(N.escapeReplaceNoEncode,Tt);return t}function It(t){try{t=encodeURI(t).replace(N.percentDecode,"%")}catch{return null}return t}function At(t,e){var c;let n=t.replace(N.findPipe,(h,u,m)=>{let i=!1,y=u;for(;--y>=0&&m[y]==="\\";)i=!i;return i?"|":" |"}),o=n.split(N.splitPipe),a=0;if(o[0].trim()||o.shift(),o.length>0&&!((c=o.at(-1))!=null&&c.trim())&&o.pop(),e)if(o.length>e)o.splice(e);else for(;o.length<e;)o.push("");for(;a<o.length;a++)o[a]=o[a].trim().replace(N.slashPipe,"|");return o}function $e(t,e,n){let o=t.length;if(o===0)return"";let a=0;for(;a<o&&t.charAt(o-a-1)===e;)a++;return t.slice(0,o-a)}function io(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let o=0;o<t.length;o++)if(t[o]==="\\")o++;else if(t[o]===e[0])n++;else if(t[o]===e[1]&&(n--,n<0))return o;return n>0?-2:-1}function Pt(t,e,n,o,a){let c=e.href,h=e.title||null,u=t[1].replace(a.other.outputLinkReplace,"$1");o.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:c,title:h,text:u,tokens:o.inlineTokens(u)};return o.state.inLink=!1,m}function co(t,e,n){let o=t.match(n.other.indentCodeCompensation);if(o===null)return e;let a=o[1];return e.split(`
`).map(c=>{let h=c.match(n.other.beginningSpace);if(h===null)return c;let[u]=h;return u.length>=a.length?c.slice(a.length):c}).join(`
`)}var Fe=class{constructor(t){q(this,"options");q(this,"rules");q(this,"lexer");this.options=t||ge}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:$e(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],o=co(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:o}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let o=$e(n,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(n=o.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:$e(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=$e(e[0],`
`).split(`
`),o="",a="",c=[];for(;n.length>0;){let h=!1,u=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))u.push(n[m]),h=!0;else if(!h)u.push(n[m]);else break;n=n.slice(m);let i=u.join(`
`),y=i.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${i}`:i,a=a?`${a}
${y}`:y;let v=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,c,!0),this.lexer.state.top=v,n.length===0)break;let p=c.at(-1);if((p==null?void 0:p.type)==="code")break;if((p==null?void 0:p.type)==="blockquote"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.blockquote(x);c[c.length-1]=R,o=o.substring(0,o.length-S.raw.length)+R.raw,a=a.substring(0,a.length-S.text.length)+R.text;break}else if((p==null?void 0:p.type)==="list"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.list(x);c[c.length-1]=R,o=o.substring(0,o.length-p.raw.length)+R.raw,a=a.substring(0,a.length-S.raw.length)+R.raw,n=x.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:a}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),o=n.length>1,a={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");let c=this.rules.other.listItemRegex(n),h=!1;for(;t;){let m=!1,i="",y="";if(!(e=c.exec(t))||this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let v=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,I=>" ".repeat(3*I.length)),p=t.split(`
`,1)[0],S=!v.trim(),x=0;if(this.options.pedantic?(x=2,y=v.trimStart()):S?x=e[1].length+1:(x=e[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,y=v.slice(x),x+=e[1].length),S&&this.rules.other.blankLine.test(p)&&(i+=p+`
`,t=t.substring(p.length+1),m=!0),!m){let I=this.rules.other.nextBulletRegex(x),D=this.rules.other.hrRegex(x),Z=this.rules.other.fencesBeginRegex(x),H=this.rules.other.headingBeginRegex(x),ce=this.rules.other.htmlBeginRegex(x);for(;t;){let X=t.split(`
`,1)[0],O;if(p=X,this.options.pedantic?(p=p.replace(this.rules.other.listReplaceNesting,"  "),O=p):O=p.replace(this.rules.other.tabCharGlobal,"    "),Z.test(p)||H.test(p)||ce.test(p)||I.test(p)||D.test(p))break;if(O.search(this.rules.other.nonSpaceChar)>=x||!p.trim())y+=`
`+O.slice(x);else{if(S||v.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Z.test(v)||H.test(v)||D.test(v))break;y+=`
`+p}!S&&!p.trim()&&(S=!0),i+=X+`
`,t=t.substring(X.length+1),v=O.slice(x)}}a.loose||(h?a.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(h=!0));let R=null,E;this.options.gfm&&(R=this.rules.other.listIsTask.exec(y),R&&(E=R[0]!=="[ ] ",y=y.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:i,task:!!R,checked:E,loose:!1,text:y,tokens:[]}),a.raw+=i}let u=a.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let m=0;m<a.items.length;m++)if(this.lexer.state.top=!1,a.items[m].tokens=this.lexer.blockTokens(a.items[m].text,[]),!a.loose){let i=a.items[m].tokens.filter(v=>v.type==="space"),y=i.length>0&&i.some(v=>this.rules.other.anyLine.test(v.raw));a.loose=y}if(a.loose)for(let m=0;m<a.items.length;m++)a.items[m].loose=!0;return a}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:o,title:a}}}table(t){var h;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=At(e[1]),o=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(h=e[3])!=null&&h.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===o.length){for(let u of o)this.rules.other.tableAlignRight.test(u)?c.align.push("right"):this.rules.other.tableAlignCenter.test(u)?c.align.push("center"):this.rules.other.tableAlignLeft.test(u)?c.align.push("left"):c.align.push(null);for(let u=0;u<n.length;u++)c.header.push({text:n[u],tokens:this.lexer.inline(n[u]),header:!0,align:c.align[u]});for(let u of a)c.rows.push(At(u,c.header.length).map((m,i)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:c.align[i]})));return c}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=$e(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=io(e[2],"()");if(c===-2)return;if(c>-1){let h=(e[0].indexOf("!")===0?5:4)+e[1].length+c;e[2]=e[2].substring(0,c),e[0]=e[0].substring(0,h).trim(),e[3]=""}}let o=e[2],a="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],a=c[3])}else a=e[3]?e[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?o=o.slice(1):o=o.slice(1,-1)),Pt(e,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let o=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[o.toLowerCase()];if(!a){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return Pt(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let o=this.rules.inline.emStrongLDelim.exec(t);if(!(!o||o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...o[0]].length-1,c,h,u=a,m=0,i=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(i.lastIndex=0,e=e.slice(-1*t.length+a);(o=i.exec(e))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(h=[...c].length,o[3]||o[4]){u+=h;continue}else if((o[5]||o[6])&&a%3&&!((a+h)%3)){m+=h;continue}if(u-=h,u>0)continue;h=Math.min(h,h+u+m);let y=[...o[0]][0].length,v=t.slice(0,a+o.index+y+h);if(Math.min(a,h)%2){let S=v.slice(1,-1);return{type:"em",raw:v,text:S,tokens:this.lexer.inlineTokens(S)}}let p=v.slice(2,-2);return{type:"strong",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return o&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,o;return e[2]==="@"?(n=e[1],o="mailto:"+n):(n=e[1],o=n),{type:"link",raw:e[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let o,a;if(e[2]==="@")o=e[0],a="mailto:"+o;else{let c;do c=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(c!==e[0]);o=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Q=class Xe{constructor(e){q(this,"tokens");q(this,"options");q(this,"state");q(this,"tokenizer");q(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ge,this.options.tokenizer=this.options.tokenizer||new Fe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:N,block:Le.normal,inline:ye.normal};this.options.pedantic?(n.block=Le.pedantic,n.inline=ye.pedantic):this.options.gfm&&(n.block=Le.gfm,this.options.breaks?n.inline=ye.breaks:n.inline=ye.gfm),this.tokenizer.rules=n}static get rules(){return{block:Le,inline:ye}}static lex(e,n){return new Xe(n).lex(e)}static lexInline(e,n){return new Xe(n).inlineTokens(e)}lex(e){e=e.replace(N.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let o=this.inlineQueue[n];this.inlineTokens(o.src,o.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],o=!1){var a,c,h;for(this.options.pedantic&&(e=e.replace(N.tabCharGlobal,"    ").replace(N.spaceLine,""));e;){let u;if((c=(a=this.options.extensions)==null?void 0:a.block)!=null&&c.some(i=>(u=i.call({lexer:this},e,n))?(e=e.substring(u.raw.length),n.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let i=n.at(-1);u.raw.length===1&&i!==void 0?i.raw+=`
`:n.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},n.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),n.push(u);continue}let m=e;if((h=this.options.extensions)!=null&&h.startBlock){let i=1/0,y=e.slice(1),v;this.options.extensions.startBlock.forEach(p=>{v=p.call({lexer:this},y),typeof v=="number"&&v>=0&&(i=Math.min(i,v))}),i<1/0&&i>=0&&(m=e.substring(0,i+1))}if(this.state.top&&(u=this.tokenizer.paragraph(m))){let i=n.at(-1);o&&(i==null?void 0:i.type)==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u),o=m.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(e){let i="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,m,i,y,v;let o=e,a=null;if(this.tokens.links){let p=Object.keys(this.tokens.links);if(p.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)p.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);o=((m=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:m.call({lexer:this},o))??o;let c=!1,h="";for(;e;){c||(h=""),c=!1;let p;if((y=(i=this.options.extensions)==null?void 0:i.inline)!=null&&y.some(x=>(p=x.call({lexer:this},e,n))?(e=e.substring(p.raw.length),n.push(p),!0):!1))continue;if(p=this.tokenizer.escape(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.tag(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.link(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(p.raw.length);let x=n.at(-1);p.type==="text"&&(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(p=this.tokenizer.emStrong(e,o,h)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.codespan(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.br(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.del(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.autolink(e)){e=e.substring(p.raw.length),n.push(p);continue}if(!this.state.inLink&&(p=this.tokenizer.url(e))){e=e.substring(p.raw.length),n.push(p);continue}let S=e;if((v=this.options.extensions)!=null&&v.startInline){let x=1/0,R=e.slice(1),E;this.options.extensions.startInline.forEach(I=>{E=I.call({lexer:this},R),typeof E=="number"&&E>=0&&(x=Math.min(x,E))}),x<1/0&&x>=0&&(S=e.substring(0,x+1))}if(p=this.tokenizer.inlineText(S)){e=e.substring(p.raw.length),p.raw.slice(-1)!=="_"&&(h=p.raw.slice(-1)),c=!0;let x=n.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(e){let x="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return n}},De=class{constructor(t){q(this,"options");q(this,"parser");this.options=t||ge}space(t){return""}code({text:t,lang:e,escaped:n}){var c;let o=(c=(e||"").match(N.notSpaceStart))==null?void 0:c[0],a=t.replace(N.endingNewline,"")+`
`;return o?'<pre><code class="language-'+K(o)+'">'+(n?a:K(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:K(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,o="";for(let h=0;h<t.items.length;h++){let u=t.items[h];o+=this.listitem(u)}let a=e?"ol":"ul",c=e&&n!==1?' start="'+n+'"':"";return"<"+a+c+`>
`+o+"</"+a+`>
`}listitem(t){var n;let e="";if(t.task){let o=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=o+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=o+" "+K(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):e+=o+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let o="";for(let a=0;a<t.rows.length;a++){let c=t.rows[a];n="";for(let h=0;h<c.length;h++)n+=this.tablecell(c[h]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+o+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${K(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let o=this.parser.parseInline(n),a=It(t);if(a===null)return o;t=a;let c='<a href="'+t+'"';return e&&(c+=' title="'+K(e)+'"'),c+=">"+o+"</a>",c}image({href:t,title:e,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));let a=It(t);if(a===null)return K(n);t=a;let c=`<img src="${t}" alt="${n}"`;return e&&(c+=` title="${K(e)}"`),c+=">",c}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:K(t.text)}},ct=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},J=class Ke{constructor(e){q(this,"options");q(this,"renderer");q(this,"textRenderer");this.options=e||ge,this.options.renderer=this.options.renderer||new De,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ct}static parse(e,n){return new Ke(n).parse(e)}static parseInline(e,n){return new Ke(n).parseInline(e)}parse(e,n=!0){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=u,y=this.options.extensions.renderers[i.type].call({parser:this},i);if(y!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(i.type)){o+=y||"";continue}}let m=u;switch(m.type){case"space":{o+=this.renderer.space(m);continue}case"hr":{o+=this.renderer.hr(m);continue}case"heading":{o+=this.renderer.heading(m);continue}case"code":{o+=this.renderer.code(m);continue}case"table":{o+=this.renderer.table(m);continue}case"blockquote":{o+=this.renderer.blockquote(m);continue}case"list":{o+=this.renderer.list(m);continue}case"html":{o+=this.renderer.html(m);continue}case"def":{o+=this.renderer.def(m);continue}case"paragraph":{o+=this.renderer.paragraph(m);continue}case"text":{let i=m,y=this.renderer.text(i);for(;h+1<e.length&&e[h+1].type==="text";)i=e[++h],y+=`
`+this.renderer.text(i);n?o+=this.renderer.paragraph({type:"paragraph",raw:y,text:y,tokens:[{type:"text",raw:y,text:y,escaped:!0}]}):o+=y;continue}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}parseInline(e,n=this.renderer){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=this.options.extensions.renderers[u.type].call({parser:this},u);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){o+=i||"";continue}}let m=u;switch(m.type){case"escape":{o+=n.text(m);break}case"html":{o+=n.html(m);break}case"link":{o+=n.link(m);break}case"image":{o+=n.image(m);break}case"strong":{o+=n.strong(m);break}case"em":{o+=n.em(m);break}case"codespan":{o+=n.codespan(m);break}case"br":{o+=n.br(m);break}case"del":{o+=n.del(m);break}case"text":{o+=n.text(m);break}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}},ze,Se=(ze=class{constructor(t){q(this,"options");q(this,"block");this.options=t||ge}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Q.lex:Q.lexInline}provideParser(){return this.block?J.parse:J.parseInline}},q(ze,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),q(ze,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),ze),uo=class{constructor(...t){q(this,"defaults",tt());q(this,"options",this.setOptions);q(this,"parse",this.parseMarkdown(!0));q(this,"parseInline",this.parseMarkdown(!1));q(this,"Parser",J);q(this,"Renderer",De);q(this,"TextRenderer",ct);q(this,"Lexer",Q);q(this,"Tokenizer",Fe);q(this,"Hooks",Se);this.use(...t)}walkTokens(t,e){var o,a;let n=[];for(let c of t)switch(n=n.concat(e.call(this,c)),c.type){case"table":{let h=c;for(let u of h.header)n=n.concat(this.walkTokens(u.tokens,e));for(let u of h.rows)for(let m of u)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let h=c;n=n.concat(this.walkTokens(h.items,e));break}default:{let h=c;(a=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&a[h.type]?this.defaults.extensions.childTokens[h.type].forEach(u=>{let m=h[u].flat(1/0);n=n.concat(this.walkTokens(m,e))}):h.tokens&&(n=n.concat(this.walkTokens(h.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let o={...n};if(o.async=this.defaults.async||o.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let c=e.renderers[a.name];c?e.renderers[a.name]=function(...h){let u=a.renderer.apply(this,h);return u===!1&&(u=c.apply(this,h)),u}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let c=e[a.level];c?c.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),o.extensions=e),n.renderer){let a=this.defaults.renderer||new De(this.defaults);for(let c in n.renderer){if(!(c in a))throw new Error(`renderer '${c}' does not exist`);if(["options","parser"].includes(c))continue;let h=c,u=n.renderer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y||""}}o.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Fe(this.defaults);for(let c in n.tokenizer){if(!(c in a))throw new Error(`tokenizer '${c}' does not exist`);if(["options","rules","lexer"].includes(c))continue;let h=c,u=n.tokenizer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Se;for(let c in n.hooks){if(!(c in a))throw new Error(`hook '${c}' does not exist`);if(["options","block"].includes(c))continue;let h=c,u=n.hooks[h],m=a[h];Se.passThroughHooks.has(c)?a[h]=i=>{if(this.defaults.async&&Se.passThroughHooksRespectAsync.has(c))return(async()=>{let v=await u.call(a,i);return m.call(a,v)})();let y=u.call(a,i);return m.call(a,y)}:a[h]=(...i)=>{if(this.defaults.async)return(async()=>{let v=await u.apply(a,i);return v===!1&&(v=await m.apply(a,i)),v})();let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,c=n.walkTokens;o.walkTokens=function(h){let u=[];return u.push(c.call(this,h)),a&&(u=u.concat(a.call(this,h))),u}}this.defaults={...this.defaults,...o}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Q.lex(t,e??this.defaults)}parser(t,e){return J.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let o={...n},a={...this.defaults,...o},c=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&o.async===!1)return c(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let h=a.hooks?await a.hooks.preprocess(e):e,u=await(a.hooks?await a.hooks.provideLexer():t?Q.lex:Q.lexInline)(h,a),m=a.hooks?await a.hooks.processAllTokens(u):u;a.walkTokens&&await Promise.all(this.walkTokens(m,a.walkTokens));let i=await(a.hooks?await a.hooks.provideParser():t?J.parse:J.parseInline)(m,a);return a.hooks?await a.hooks.postprocess(i):i})().catch(c);try{a.hooks&&(e=a.hooks.preprocess(e));let h=(a.hooks?a.hooks.provideLexer():t?Q.lex:Q.lexInline)(e,a);a.hooks&&(h=a.hooks.processAllTokens(h)),a.walkTokens&&this.walkTokens(h,a.walkTokens);let u=(a.hooks?a.hooks.provideParser():t?J.parse:J.parseInline)(h,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(h){return c(h)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let o="<p>An error occurred:</p><pre>"+K(n.message+"",!0)+"</pre>";return e?Promise.resolve(o):o}if(e)return Promise.reject(n);throw n}}},me=new uo;function M(t,e){return me.parse(t,e)}M.options=M.setOptions=function(t){return me.setOptions(t),M.defaults=me.defaults,jt(M.defaults),M};M.getDefaults=tt;M.defaults=ge;M.use=function(...t){return me.use(...t),M.defaults=me.defaults,jt(M.defaults),M};M.walkTokens=function(t,e){return me.walkTokens(t,e)};M.parseInline=me.parseInline;M.Parser=J;M.parser=J.parse;M.Renderer=De;M.TextRenderer=ct;M.Lexer=Q;M.lexer=Q.lex;M.Tokenizer=Fe;M.Hooks=Se;M.parse=M;M.options;M.setOptions;M.use;M.walkTokens;M.parseInline;J.parse;Q.lex;const po={class:"wall-view"},ho={key:0,class:"loading-container"},mo={key:1,class:"error-container"},go={key:2,class:"wall-content"},_o={class:"wall-header"},ko={class:"wall-info"},fo={class:"wall-avatar"},vo=["src","alt"],bo={class:"wall-details"},wo={class:"wall-title"},xo={key:0,class:"wall-owner"},yo={key:1,class:"wall-description"},$o={class:"wall-stats"},So={class:"stat"},Co={class:"stat-value"},Ro={class:"stat"},To={class:"stat-value"},Io={class:"posts-section"},Ao={key:0,class:"loading-posts"},Po={key:1,class:"empty-state"},Eo={key:2,class:"posts-grid"},Lo={key:1,class:"ai-content-info"},zo={key:0,class:"ai-preview-prompt"},Mo={key:1},jo=["innerHTML"],qo=["onClick"],Fo={key:2,class:"post-header"},Do=["src","alt"],Bo={class:"post-meta"},Go={class:"post-author"},No={class:"post-time"},Uo={key:3,class:"post-content"},Ho=["innerHTML"],Oo={key:1},Vo={key:4,class:"ai-content-preview"},Zo={class:"ai-preview-header"},Wo=["src","alt"],Qo={class:"ai-generation-info"},Jo={key:0,class:"info-item bricks-spent"},Xo={class:"bricks-amount"},Ko={key:1,class:"info-item model-used"},Yo={class:"model-name"},ea={key:0,class:"ai-generation-stats"},ta={key:0,class:"stat-item"},na={class:"stat-value"},sa={key:1,class:"stat-item"},oa={class:"stat-value"},aa={key:2,class:"stat-item"},la={class:"stat-value"},ra={key:1,class:"ai-preview-prompt"},ia={key:2,class:"ai-preview-response"},ca=["innerHTML"],ua=["onClick"],da={key:5,class:"ai-content-preview"},pa={class:"ai-preview-header"},ha=["src","alt"],ma={class:"ai-generation-info"},ga={class:"info-item status-processing"},_a={class:"status-badge processing"},ka={key:0,class:"info-item model-used"},fa={class:"model-name"},va={key:0,class:"ai-preview-prompt"},ba={key:1,class:"ai-preview-response"},wa=["innerHTML"],xa=["onClick"],ya={key:6,class:"post-media"},$a=["src","alt"],Sa={class:"post-actions"},Ca={class:"action-btn"},Ra={class:"action-btn"},Ta={class:"action-btn"},Ia={class:"action-btn"},Aa={class:"post-time-footer"},Pa={key:7,class:"post-comments"},Ea={key:3,class:"load-more"},La={class:"modal-content ai-modal"},za={key:0,class:"modal-body"},Ma={class:"ai-modal-section"},ja={class:"ai-prompt-full"},qa={key:0,class:"ai-modal-section"},Fa=["innerHTML"],Da={key:1,class:"ai-response-content ai-generating"},Ba={key:1,class:"ai-modal-section ai-stats"},Ga={key:0,class:"generation-progress-bar"},Na={class:"progress-bar-container"},Ua={class:"progress-text"},Ha={class:"stats-grid"},Oa={class:"stat-item"},Va={class:"stat-value"},Za={key:0,class:"stat-item"},Wa={class:"stat-value"},Qa={key:1,class:"stat-item"},Ja={class:"stat-value"},Xa={key:2,class:"stat-item"},Ka={class:"stat-value"},Ya={key:3,class:"stat-item"},el={class:"stat-value"},tl={key:4,class:"stat-item"},nl={class:"stat-value"},sl={key:5,class:"stat-item"},ol={class:"stat-value"},al={key:0,class:"stat-item"},ll={class:"stat-value"},rl={key:1,class:"stat-item"},il={class:"stat-value bricks-value"},cl={key:2,class:"stat-item"},ul={class:"stat-value"},dl={key:3,class:"stat-item"},pl={class:"stat-value"},hl={key:4,class:"stat-item"},ml={class:"stat-value"},gl={key:5,class:"stat-item"},_l={class:"stat-value"},kl={key:2,class:"ai-modal-section"},fl={class:"post-counters"},vl={class:"counter-item"},bl={class:"counter-icon"},wl={class:"counter-label"},xl={class:"counter-value"},yl={class:"counter-item"},$l={class:"counter-value"},Sl={class:"counter-item"},Cl={class:"counter-value"},Rl={class:"counter-item"},Tl={class:"counter-value"},Il={key:3,class:"ai-modal-section"},Al={class:"modal-footer"},Pl={class:"action-buttons-group"},El={key:0,class:"toast-notification"},Ze=20,Ll=Te({__name:"WallView",props:{wallId:{}},setup(t){M.setOptions({breaks:!0,gfm:!0});const e=t;an();const n=on(),o=et(),a=A(!0),c=A(!1),h=A(!1),u=A(null),m=A(null),i=A([]),y=A(1),v=A(!0);let p=new Map,S=new Map;const x=new Set,R=new Set,E=G(()=>m.value&&o.user&&m.value.user_id===o.user.id),I=G(()=>{var r;return(r=m.value)!=null&&r.theme?{backgroundColor:m.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),D=G(()=>i.value.filter(r=>!(r.post_type==="ai_app"&&r.ai_status==="failed"))),Z=async r=>{if(!x.has(r))try{await Ve.incrementViewCount(r),x.add(r),console.log(`View count incremented for post ${r}`)}catch(l){console.error(`Failed to increment view count for post ${r}:`,l)}},H=async()=>{const r=[];if(i.value.forEach(l=>{!R.has(l.post_id)&&!x.has(l.post_id)&&(r.push(l.post_id),R.add(l.post_id))}),r.length>0)try{await Ve.batchIncrementViewCounts(r),r.forEach(l=>x.add(l)),console.log(`Batch view counts incremented for ${r.length} posts`)}catch(l){console.error("Failed to batch increment view counts:",l),r.forEach($=>{R.delete($),Z($)})}},ce=async r=>{try{await Ve.incrementOpenCount(r),console.log(`Open count incremented for post ${r}`)}catch(l){console.error(`Failed to increment open count for post ${r}:`,l)}},X=r=>{const l=new Date(r),C=new Date().getTime()-l.getTime(),T=Math.floor(C/6e4),d=Math.floor(C/36e5),L=Math.floor(C/864e5);return T<1?"just now":T<60?`${T}m ago`:d<24?`${d}h ago`:L<7?`${L}d ago`:l.toLocaleDateString()},O=async()=>{var r,l,$,C;try{a.value=!0,u.value=null;let T=e.wallId||n.params.wallId;if(!T)throw new Error("No wall identifier provided");let d;if(T==="me"?d=await V.get("/walls/me"):d=await V.get(`/walls/${T}`),d!=null&&d.success&&((r=d==null?void 0:d.data)!=null&&r.wall))m.value=d.data.wall,await ee();else throw new Error((d==null?void 0:d.message)||"Wall not found")}catch(T){console.error("Error loading wall:",T),((l=T.response)==null?void 0:l.status)===404?u.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":u.value=((C=($=T.response)==null?void 0:$.data)==null?void 0:C.message)||T.message||"Failed to load wall"}finally{a.value=!1}},ee=async(r=!1)=>{var l;if(m.value){if(h.value){console.log("[WallView] Skipping loadPosts - request already in progress");return}try{h.value=!0,r||(c.value=!0);const $=(y.value-1)*Ze,C=await V.get(`/walls/${m.value.wall_id}/posts?limit=${Ze}&offset=${$}`);if(C!=null&&C.success&&((l=C==null?void 0:C.data)!=null&&l.posts)){const T=C.data.posts;y.value===1?r?te(T):(i.value=T,H()):(i.value=[...i.value,...T],H()),v.value=T.length===Ze,_e()}}catch($){console.error("Error loading posts:",$)}finally{h.value=!1,r||(c.value=!1)}}},te=r=>{const l=new Map(r.map($=>[$.post_id,$]));i.value.forEach(($,C)=>{const T=l.get($.post_id);T&&(Object.assign(i.value[C],T),l.delete($.post_id))}),l.size>0&&(i.value=[...Array.from(l.values()),...i.value])},_e=()=>{const r=i.value.filter(l=>l.post_type==="ai_app"&&(l.ai_status==="queued"||l.ai_status==="processing"));console.log("[WallView] Checking pending AI posts:",r.length),r.forEach(l=>{var $,C;console.log("[WallView] Pending post:",{post_id:l.post_id,ai_status:l.ai_status,ai_job_id:l.ai_job_id,has_content:!!l.ai_content,html_content_length:((C=($=l.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0})}),r.length>0?r.forEach(l=>{l.ai_status==="processing"&&l.ai_job_id&&F(l)}):U()},ke=()=>{y.value++,ee()},ne=()=>{console.log("Create post functionality coming soon")},j=async r=>{console.log("Generation completed for post:",r.post_id),P(r.ai_job_id)},w=(r,l)=>{console.error("Generation failed for post:",r.post_id,l),P(r.ai_job_id);const $=i.value.findIndex(C=>C.post_id===r.post_id);$!==-1&&(i.value[$].ai_status="failed")},F=r=>{if(!r.ai_job_id)return;if(p.has(r.ai_job_id)){console.log("[ContentStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/content`;console.log("[ContentStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);p.set(r.ai_job_id,C),C.addEventListener("content",T=>{var W,oe,ae,le,re,ie;const d=JSON.parse(T.data);console.log("[ContentStream] Received content chunk:",{jobId:r.ai_job_id,contentLength:((W=d.content)==null?void 0:W.length)||0,model:d.model,modalOpen:fe.value,isSelectedPost:((oe=k.value)==null?void 0:oe.post_id)===r.post_id});const L=i.value.findIndex(de=>de.post_id===r.post_id);L!==-1&&(i.value[L].ai_content||(i.value[L].ai_content={}),i.value[L]={...i.value[L],ai_content:{...i.value[L].ai_content,html_content:d.content||"",generation_model:d.model||((ae=i.value[L].ai_content)==null?void 0:ae.generation_model)}},console.log("[ContentStream] Updated post in list, content length:",((le=d.content)==null?void 0:le.length)||0)),((re=k.value)==null?void 0:re.post_id)===r.post_id&&(console.log("[ContentStream] Updating modal content"),k.value={...k.value,ai_content:{...k.value.ai_content,html_content:d.content||""}},console.log("[ContentStream] Modal updated, new content length:",((ie=k.value.ai_content.html_content)==null?void 0:ie.length)||0))}),C.addEventListener("complete",T=>{console.log("[ContentStream] Generation complete"),P(r.ai_job_id);const d=i.value.findIndex(L=>L.post_id===r.post_id);d!==-1&&(i.value[d].ai_status="completed")}),C.addEventListener("error",T=>{console.error("[ContentStream] SSE error for job:",r.ai_job_id),P(r.ai_job_id)}),C.onerror=T=>{console.error("[ContentStream] Connection error:",T),P(r.ai_job_id)}},P=r=>{if(!r)return;const l=p.get(r);l&&(l.close(),p.delete(r),console.log("[ContentStream] Stopped SSE for job:",r))},U=()=>{p.forEach((r,l)=>{r.close(),console.log("[ContentStream] Closed SSE for job:",l)}),p.clear()},Pe=r=>{if(!r.ai_job_id)return;if(S.has(r.ai_job_id)){console.log("[ProgressStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/progress`;console.log("[ProgressStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);S.set(r.ai_job_id,C),C.addEventListener("progress",T=>{var L;const d=JSON.parse(T.data);console.log("[ProgressStream] Received progress update:",d),((L=k.value)==null?void 0:L.post_id)===r.post_id&&(k.value={...k.value,ai_content:{...k.value.ai_content,current_tokens:d.current_tokens||0,tokens_per_second:d.tokens_per_second||0,elapsed_time:d.elapsed_time||0,estimated_remaining:d.estimated_remaining||0,progress_percentage:d.progress||0,content_length:d.content_length||0,chars_per_second:d.chars_per_second||0,input_tokens:d.prompt_tokens||0,output_tokens:d.completion_tokens||0,total_tokens:d.total_tokens||0}})}),C.addEventListener("complete",T=>{var d;console.log("[ProgressStream] Generation complete, reloading data"),ue(r.ai_job_id),((d=k.value)==null?void 0:d.post_id)===r.post_id&&V.get(`/ai/apps/${r.ai_app_id}`).then(L=>{var W;L!=null&&L.success&&((W=L==null?void 0:L.data)!=null&&W.app)&&(k.value={...k.value,ai_status:"completed",ai_content:{...L.data.app,bricks_cost:L.data.app.bricks_cost||0}})}).catch(L=>{console.error("Failed to reload final data:",L)}),ee()}),C.addEventListener("error",T=>{console.error("[ProgressStream] SSE error for job:",r.ai_job_id),ue(r.ai_job_id)}),C.onerror=T=>{console.error("[ProgressStream] Connection error:",T),ue(r.ai_job_id)}},ue=r=>{if(!r)return;const l=S.get(r);l&&(l.close(),S.delete(r),console.log("[ProgressStream] Stopped SSE for job:",r))},Zt=()=>{S.forEach((r,l)=>{r.close(),console.log("[ProgressStream] Closed SSE for job:",l)}),S.clear()},Ee=(r,l)=>r?r.length<=l?r:r.substring(0,l)+"...":"",Ne=r=>{if(!r)return"";const l=r.replace(/<[^>]*>/g,""),$=Ee(l,200);return M.parse($,{async:!1})},k=A(null),fe=A(!1),ut=A(""),Ue=A(!1),se=r=>{ut.value=r,Ue.value=!0,setTimeout(()=>{Ue.value=!1},2e3)},Wt=G(()=>{var l,$;if(!(($=(l=k.value)==null?void 0:l.ai_content)!=null&&$.html_content))return"";let r=String(M.parse(k.value.ai_content.html_content));return r=r.replace(/<hr\s*\/?>/gi,'<hr class="content-divider">'),r=r.replace(/<hr\s+[^>]*>/gi,'<hr class="content-divider">'),r}),dt=G(()=>{var $;if(!(($=k.value)!=null&&$.ai_content))return 0;const r=k.value.ai_content.output_tokens||0,l=k.value.ai_content.generation_time||0;return r>0&&l>0?r/(l/1e3):0}),pt=r=>{if(!(r!=null&&r.ai_content))return 0;if(r.ai_content.tokens_per_second&&r.ai_content.tokens_per_second>0)return r.ai_content.tokens_per_second;const l=r.ai_content.output_tokens||0,$=r.ai_content.generation_time||0;return l>0&&$>0?l/($/1e3):0},we=async r=>{var l,$,C,T,d,L,W,oe,ae,le,re,ie,de,xe;try{if(await ce(r.post_id),r.ai_status==="queued"||r.ai_status==="processing"){console.log("Opening modal for generating post, using post data:",{post_id:r.post_id,ai_job_id:r.ai_job_id,has_content:!!((l=r.ai_content)!=null&&l.html_content),content_length:((C=($=r.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0}),k.value={...r,ai_content:{user_prompt:((T=r.ai_content)==null?void 0:T.user_prompt)||null,html_content:((d=r.ai_content)==null?void 0:d.html_content)||"",css_content:((L=r.ai_content)==null?void 0:L.css_content)||null,js_content:((W=r.ai_content)==null?void 0:W.js_content)||null,generation_model:((oe=r.ai_content)==null?void 0:oe.generation_model)||r.ai_model||null,generation_time:null,input_tokens:0,output_tokens:0,total_tokens:0,bricks_cost:((ae=r.ai_content)==null?void 0:ae.bricks_cost)||0,current_tokens:0,tokens_per_second:0,elapsed_time:0,estimated_remaining:0,progress_percentage:0,content_length:0,chars_per_second:0}},fe.value=!0,document.body.style.overflow="hidden",r.ai_status==="processing"&&r.ai_job_id&&(F(r),Pe(r));return}const B=await V.get(`/ai/apps/${r.ai_app_id}`);B!=null&&B.success&&((le=B==null?void 0:B.data)!=null&&le.app)&&(console.log("AI App Data:",B.data.app),k.value={...r,ai_content:{...B.data.app,bricks_cost:B.data.app.bricks_cost||((re=r.ai_content)==null?void 0:re.bricks_cost)||0,input_tokens:B.data.app.input_tokens||((ie=r.ai_content)==null?void 0:ie.input_tokens)||0,output_tokens:B.data.app.output_tokens||((de=r.ai_content)==null?void 0:de.output_tokens)||0,total_tokens:B.data.app.total_tokens||((xe=r.ai_content)==null?void 0:xe.total_tokens)||0}},fe.value=!0,document.body.style.overflow="hidden")}catch(B){console.error("Error loading AI content:",B),r.ai_content&&(k.value=r,fe.value=!0,document.body.style.overflow="hidden")}},He=()=>{var r;(r=k.value)!=null&&r.ai_job_id&&(P(k.value.ai_job_id),ue(k.value.ai_job_id)),fe.value=!1,k.value=null,document.body.style.overflow=""},Qt=()=>{var T;if(!k.value)return;const r=((T=m.value)==null?void 0:T.wall_id)||n.params.wallId,l=k.value.ai_app_id,C=`${window.location.origin.replace(":3000",":8080")}/wall/${r}?ai=${l}`;navigator.clipboard.writeText(C).then(()=>{console.log("Share link copied to clipboard:",C),se("âœ“ Link copied!")}).catch(d=>{console.error("Failed to copy share link:",d),se("âœ— Failed to copy link")})},Jt=(r,l)=>{navigator.clipboard.writeText(r).then(()=>{console.log(`${l} copied to clipboard`),se(`âœ“ ${l} copied!`)}).catch($=>{console.error("Failed to copy:",$),se("âœ— Failed to copy")})},Xt=async r=>{try{if(r.user_liked){await V.delete(`/posts/${r.post_id}/reactions`),r.user_liked=!1,r.reaction_count=Math.max(0,(r.reaction_count||0)-1);const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!1,i.value[l].reaction_count=Math.max(0,(i.value[l].reaction_count||0)-1))}else{await V.post(`/posts/${r.post_id}/reactions`,{reaction_type:"like"}),r.user_liked=!0,r.reaction_count=(r.reaction_count||0)+1;const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!0,i.value[l].reaction_count=(i.value[l].reaction_count||0)+1)}}catch(l){console.error("Failed to toggle like:",l),se("âœ— Failed to update like")}},ht=r=>{if(k.value){k.value.comment_count=(k.value.comment_count||0)+1;const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}if(r&&r.post_id){const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}se("âœ“ Comment added")},mt=r=>{if(k.value){k.value.comment_count=Math.max(0,(k.value.comment_count||0)-1);const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=Math.max(0,(i.value[l].comment_count||0)-1))}se("âœ“ Comment deleted")},gt=r=>{se("âœ“ Comment updated")};return Ye(async()=>{await O();const r=n.query.ai;if(r){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),We(()=>n.params.wallId,async(r,l)=>{r!==l&&(console.log("[WallView] Route changed, reloading wall:",r),await O())}),We(()=>n.query.ai,async r=>{if(r&&i.value.length>0){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),Et(()=>{U(),Zt(),document.body.style.overflow=""}),(r,l)=>{var $,C,T;return g(),_(he,null,[s("div",po,[a.value?(g(),_("div",ho,[...l[3]||(l[3]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):u.value?(g(),_("div",mo,[l[4]||(l[4]=s("h2",null,"Error Loading Wall",-1)),s("p",null,f(u.value),1),s("button",{onClick:l[0]||(l[0]=d=>r.$router.push("/")),class:"btn-primary"},"Go Home")])):m.value?(g(),_("div",go,[s("div",_o,[s("div",{class:"wall-banner",style:Me(I.value)},null,4),s("div",ko,[s("div",fo,[s("img",{src:m.value.owner_avatar||m.value.avatar_url||"/assets/images/default-avatar.svg",alt:m.value.owner_username||m.value.display_name},null,8,vo)]),s("div",bo,[s("h1",wo,f(m.value.display_name),1),m.value.owner_username?(g(),_("p",xo,"by @"+f(m.value.owner_username),1)):b("",!0),m.value.owner_bio?(g(),_("p",yo,f(m.value.owner_bio),1)):b("",!0)]),s("div",$o,[s("div",So,[s("span",Co,f(m.value.posts_count||0),1),l[5]||(l[5]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",Ro,[s("span",To,f(m.value.subscribers_count||0),1),l[6]||(l[6]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",Io,[l[30]||(l[30]=s("h2",{class:"section-title"},"Posts",-1)),c.value?(g(),_("div",Ao,[...l[7]||(l[7]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):i.value.length===0?(g(),_("div",Po,[l[8]||(l[8]=s("p",null,"No posts yet on this wall.",-1)),E.value?(g(),_("button",{key:0,onClick:ne,class:"btn-primary"},"Create First Post")):b("",!0)])):(g(),_("div",Eo,[(g(!0),_(he,null,je(D.value,d=>{var L,W,oe,ae,le,re,ie,de,xe,B,_t,kt,ft,vt,bt,wt,xt;return g(),_("div",{key:d.post_id,class:ve(["post-card",{"ai-post":d.post_type==="ai_app"}])},[d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),Ce(Un,{key:0,jobId:d.ai_job_id,modelName:d.ai_model,"auto-start":!0,onComplete:Y=>j(d),onError:Y=>w(d,Y)},null,8,["jobId","modelName","onComplete","onError"])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),_("div",Lo,[(L=d.ai_content)!=null&&L.user_prompt?(g(),_("div",zo,[l[9]||(l[9]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(W=d.ai_content)!=null&&W.html_content?(g(),_("div",Mo,[l[10]||(l[10]=s("div",{class:"ai-preview-response"},[s("strong",null,"Generated Response:")],-1)),s("div",{class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,jo)])):b("",!0),d.ai_status==="processing"?(g(),_("button",{key:2,onClick:Y=>we(d),class:"btn-open-ai"},[l[11]||(l[11]=s("span",{class:"icon"},"ðŸ‘ï¸",-1)),s("span",null,f((oe=d.ai_content)!=null&&oe.html_content?"View Full Response":"Watch Generation"),1)],8,qo)):b("",!0)])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Fo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"post-avatar"},null,8,Do),s("div",Bo,[s("span",Go,"@"+f(d.author_username),1),s("span",No,f(X(d.created_at)),1)])])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Uo,[d.content_html?(g(),_("div",{key:0,innerHTML:d.content_html},null,8,Ho)):(g(),_("p",Oo,f(d.content_text),1))])):b("",!0),d.post_type==="ai_app"&&d.ai_status==="completed"?(g(),_("div",Vo,[s("div",Zo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,Wo),s("h4",null,"@"+f(d.author_username),1)]),s("div",Qo,[l[14]||(l[14]=s("div",{class:"info-item status-completed"},[s("strong",null,"Status:"),s("span",{class:"status-badge"},"âœ“ Completed")],-1)),(ae=d.ai_content)!=null&&ae.bricks_cost?(g(),_("div",Jo,[l[12]||(l[12]=s("strong",null,"Bricks spent:",-1)),s("span",Xo,f(d.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),(le=d.ai_content)!=null&&le.generation_model?(g(),_("div",Ko,[l[13]||(l[13]=s("strong",null,"Model:",-1)),s("span",Yo,f(d.ai_content.generation_model),1)])):b("",!0)]),(re=d.ai_content)!=null&&re.generation_time||(ie=d.ai_content)!=null&&ie.total_tokens?(g(),_("div",ea,[(de=d.ai_content)!=null&&de.generation_time?(g(),_("div",ta,[l[15]||(l[15]=s("strong",null,"Time:",-1)),s("span",na,f((d.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),(xe=d.ai_content)!=null&&xe.total_tokens?(g(),_("div",sa,[l[16]||(l[16]=s("strong",null,"Total Tokens:",-1)),s("span",oa,f(d.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),pt(d)>0?(g(),_("div",aa,[l[17]||(l[17]=s("strong",null,"Avg Speed:",-1)),s("span",la,f(pt(d).toFixed(2))+" tok/s",1)])):b("",!0)])):b("",!0),(B=d.ai_content)!=null&&B.user_prompt?(g(),_("div",ra,[l[18]||(l[18]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(_t=d.ai_content)!=null&&_t.html_content?(g(),_("div",ia,[...l[19]||(l[19]=[s("strong",null,"Response:",-1)])])):b("",!0),(kt=d.ai_content)!=null&&kt.html_content?(g(),_("div",{key:3,class:"ai-preview-text",innerHTML:Ne(d.ai_content.html_content)},null,8,ca)):b("",!0),s("button",{onClick:Y=>we(d),class:"btn-open-ai"},[...l[20]||(l[20]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,ua)])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&!d.ai_job_id?(g(),_("div",da,[s("div",pa,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,ha),s("h4",null,"@"+f(d.author_username),1)]),s("div",ma,[s("div",ga,[l[21]||(l[21]=s("strong",null,"Status:",-1)),s("span",_a,f(d.ai_status==="queued"?"â³ Queued":"â³ Processing"),1)]),(ft=d.ai_content)!=null&&ft.generation_model?(g(),_("div",ka,[l[22]||(l[22]=s("strong",null,"Model:",-1)),s("span",fa,f(d.ai_content.generation_model),1)])):b("",!0)]),(vt=d.ai_content)!=null&&vt.user_prompt?(g(),_("div",va,[l[23]||(l[23]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(bt=d.ai_content)!=null&&bt.html_content?(g(),_("div",ba,[...l[24]||(l[24]=[s("strong",null,"Response:",-1)])])):b("",!0),(wt=d.ai_content)!=null&&wt.html_content?(g(),_("div",{key:2,class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,wa)):b("",!0),(xt=d.ai_content)!=null&&xt.html_content?(g(),_("button",{key:3,onClick:Y=>we(d),class:"btn-open-ai"},[...l[25]||(l[25]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,xa)):b("",!0)])):b("",!0),d.media_attachments&&d.media_attachments.length>0?(g(),_("div",ya,[(g(!0),_(he,null,je(d.media_attachments,Y=>(g(),_("img",{key:Y.attachment_id,src:Y.file_url,alt:Y.file_name},null,8,$a))),128))])):b("",!0),s("div",Sa,[s("button",Ca,[l[26]||(l[26]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.reaction_count||0),1)]),s("button",Ra,[l[27]||(l[27]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,f(d.comment_count||0),1)]),s("button",Ta,[l[28]||(l[28]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.view_count||0),1)]),s("button",Ia,[l[29]||(l[29]=s("span",{class:"icon"},"ðŸ“–",-1)),s("span",null,f(d.open_count||0),1)]),s("span",Aa,f(X(d.post_type==="ai_app"?d.updated_at:d.created_at)),1)]),d.post_type!=="ai_app"?(g(),_("div",Pa,[be(St,{"post-id":d.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)],2)}),128))])),v.value&&!c.value?(g(),_("div",Ea,[s("button",{onClick:ke,class:"btn-secondary"},"Load More")])):b("",!0)])])):b("",!0)]),(g(),Ce($t,{to:"body"},[fe.value?(g(),_("div",{key:0,class:"modal-overlay",onClick:zt(He,["self"])},[s("div",La,[s("div",{class:"modal-header"},[l[31]||(l[31]=s("h2",null,"ðŸ¤– AI Response",-1)),s("button",{onClick:He,class:"btn-close"},"Ã—")]),k.value?(g(),_("div",za,[s("div",Ma,[l[32]||(l[32]=s("h3",null,"ðŸ“ Prompt",-1)),s("div",ja,f((($=k.value.ai_content)==null?void 0:$.user_prompt)||"No prompt available"),1)]),(C=k.value.ai_content)!=null&&C.html_content||k.value.ai_status==="processing"?(g(),_("div",qa,[l[34]||(l[34]=s("h3",null,"ðŸ§  Response",-1)),(T=k.value.ai_content)!=null&&T.html_content?(g(),_("div",{key:0,class:ve(["ai-response-content",{"ai-generating":k.value.ai_status==="processing"}]),innerHTML:Wt.value},null,10,Fa)):k.value.ai_status==="processing"?(g(),_("div",Da,[...l[33]||(l[33]=[s("p",{style:{color:"var(--color-text-secondary)","font-style":"italic"}},"Waiting for generation to begin...",-1)])])):b("",!0)])):b("",!0),k.value.ai_content?(g(),_("div",Ba,[l[48]||(l[48]=s("h3",null,"ðŸ“Š Generation Stats",-1)),k.value.ai_status==="processing"?(g(),_("div",Ga,[s("div",Na,[s("div",{class:"progress-bar-fill",style:Me({width:(k.value.ai_content.progress_percentage||0)+"%"})},null,4)]),s("div",Ua,f(k.value.ai_content.progress_percentage||0)+"%",1)])):b("",!0),s("div",Ha,[s("div",Oa,[l[35]||(l[35]=s("span",{class:"stat-label"},"Model:",-1)),s("span",Va,f(k.value.ai_content.generation_model||k.value.ai_model||"Unknown"),1)]),k.value.ai_status==="processing"?(g(),_(he,{key:0},[k.value.ai_content.elapsed_time?(g(),_("div",Za,[l[36]||(l[36]=s("span",{class:"stat-label"},"Elapsed:",-1)),s("span",Wa,f((k.value.ai_content.elapsed_time/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.estimated_remaining?(g(),_("div",Qa,[l[37]||(l[37]=s("span",{class:"stat-label"},"Remaining:",-1)),s("span",Ja,f((k.value.ai_content.estimated_remaining/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.current_tokens?(g(),_("div",Xa,[l[38]||(l[38]=s("span",{class:"stat-label"},"Current Tokens:",-1)),s("span",Ka,f(k.value.ai_content.current_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.tokens_per_second?(g(),_("div",Ya,[l[39]||(l[39]=s("span",{class:"stat-label"},"Speed:",-1)),s("span",el,f(k.value.ai_content.tokens_per_second.toFixed(2))+" tok/s",1)])):b("",!0),k.value.ai_content.content_length?(g(),_("div",tl,[l[40]||(l[40]=s("span",{class:"stat-label"},"Generated:",-1)),s("span",nl,f(k.value.ai_content.content_length.toLocaleString())+" chars",1)])):b("",!0),k.value.ai_content.chars_per_second?(g(),_("div",sl,[l[41]||(l[41]=s("span",{class:"stat-label"},"Char Speed:",-1)),s("span",ol,f(k.value.ai_content.chars_per_second.toFixed(2))+" char/s",1)])):b("",!0)],64)):(g(),_(he,{key:1},[k.value.ai_content.generation_time?(g(),_("div",al,[l[42]||(l[42]=s("span",{class:"stat-label"},"Time:",-1)),s("span",ll,f((k.value.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),k.value.ai_content.bricks_cost?(g(),_("div",rl,[l[43]||(l[43]=s("span",{class:"stat-label"},"Bricks Cost:",-1)),s("span",il,f(k.value.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),k.value.ai_content.input_tokens?(g(),_("div",cl,[l[44]||(l[44]=s("span",{class:"stat-label"},"Input Tokens:",-1)),s("span",ul,f(k.value.ai_content.input_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.output_tokens?(g(),_("div",dl,[l[45]||(l[45]=s("span",{class:"stat-label"},"Output Tokens:",-1)),s("span",pl,f(k.value.ai_content.output_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.total_tokens?(g(),_("div",hl,[l[46]||(l[46]=s("span",{class:"stat-label"},"Total Tokens:",-1)),s("span",ml,f(k.value.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),dt.value>0?(g(),_("div",gl,[l[47]||(l[47]=s("span",{class:"stat-label"},"Avg Speed:",-1)),s("span",_l,f(dt.value.toFixed(2))+" tok/s",1)])):b("",!0)],64))])])):b("",!0),k.value?(g(),_("div",kl,[l[55]||(l[55]=s("h3",null,"ðŸ“Š Post Metrics",-1)),s("div",fl,[s("div",vl,[s("button",{class:"counter-button",onClick:l[1]||(l[1]=d=>Xt(k.value))},[s("span",bl,f(k.value.user_liked?"â¤ï¸":"ðŸ¤"),1),s("span",wl,f(k.value.user_liked?"Liked":"Like"),1),s("span",xl,f(k.value.reaction_count||0),1)])]),s("div",yl,[l[49]||(l[49]=s("span",{class:"counter-icon"},"ðŸ’¬",-1)),l[50]||(l[50]=s("span",{class:"counter-label"},"Comments",-1)),s("span",$l,f(k.value.comment_count||0),1)]),s("div",Sl,[l[51]||(l[51]=s("span",{class:"counter-icon"},"ðŸ‘",-1)),l[52]||(l[52]=s("span",{class:"counter-label"},"Views",-1)),s("span",Cl,f(k.value.view_count||0),1)]),s("div",Rl,[l[53]||(l[53]=s("span",{class:"counter-icon"},"ðŸ“–",-1)),l[54]||(l[54]=s("span",{class:"counter-label"},"Opens",-1)),s("span",Tl,f(k.value.open_count||0),1)])])])):b("",!0),k.value?(g(),_("div",Il,[l[56]||(l[56]=s("h3",null,"ðŸ’¬ Comments",-1)),be(St,{"post-id":k.value.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)])):b("",!0),s("div",Al,[s("div",Pl,[s("button",{onClick:Qt,class:"btn-share"},[...l[57]||(l[57]=[s("span",{class:"icon"},"ðŸ”—",-1),s("span",null,"Share Link",-1)])]),s("button",{onClick:l[2]||(l[2]=d=>Jt(k.value.ai_content.html_content,"Response")),class:"btn-copy"},[...l[58]||(l[58]=[s("span",{class:"icon"},"ðŸ“‹",-1),s("span",null,"Copy",-1)])])]),s("button",{onClick:He,class:"btn-secondary"},"Close")])])])):b("",!0)])),(g(),Ce($t,{to:"body"},[Ue.value?(g(),_("div",El,f(ut.value),1)):b("",!0)]))],64)}}}),Dl=Ie(Ll,[["__scopeId","data-v-f2259925"]]);export{Dl as default};
//# sourceMappingURL=WallView-BpeakDI9.js.map
var Kt=Object.defineProperty;var Yt=(t,e,n)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>Yt(t,typeof e!="symbol"?e+"":e,n);import{f as Te,r as A,b as G,e as Ye,o as Et,g as _,k as s,j as b,n as ve,t as f,W as Me,i as g,s as Lt,v as en,x as tn,D as zt,Y as yt,l as be,F as he,z as je,B as Ce,q as nn,w as We,u as pe,X as sn,y as on,C as $t,A as Oe,p as an}from"./vendor-Bfvy7Eak.js";import{_ as Ie,c as V,u as et}from"./index-D53KQBf3.js";import{R as ln,p as Ve}from"./ReactionPicker-Duy0X_iP.js";import"./utils-Cb2jxgch.js";const rn={class:"ai-generation-progress"},cn={class:"progress-header"},un={class:"status-icon-container"},dn={key:0,class:"spinner"},pn={class:"status-info"},hn={class:"status-subtitle"},mn={key:0,class:"model-name"},gn={class:"model-text"},_n={class:"progress-bar-container"},kn={key:0,class:"progress-text"},fn={key:1,class:"progress-fill-indeterminate"},vn={key:0,class:"stats-grid"},bn={class:"stat-card"},wn={class:"stat-content"},xn={class:"stat-value"},yn={class:"stat-label"},$n={class:"stat-card"},Sn={class:"stat-content"},Cn={class:"stat-value"},Rn={class:"stat-card"},Tn={class:"stat-content"},In={class:"stat-value"},An={key:0,class:"stat-card"},Pn={class:"stat-content"},En={class:"stat-value"},Ln={key:1,class:"completion-stats"},zn={class:"token-breakdown"},Mn={class:"token-item"},jn={class:"token-value"},qn={class:"token-item"},Fn={class:"token-value"},Dn={class:"token-item total"},Bn={class:"token-value"},Gn={key:2,class:"error-message"},Nn=Te({__name:"AIGenerationProgress",props:{jobId:{},autoStart:{type:Boolean},modelName:{}},emits:["complete","error"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=A("queued"),h=A(0),u=A(0),m=A(0),i=A(0),y=A(0),v=A(0),p=A(0),S=A(0),x=A(0),R=A(0),E=A("");let I=null,D=null,Z=0;const H=G(()=>c.value==="processing"),ce=G(()=>{switch(c.value){case"queued":return"â³";case"processing":return"ðŸ¤–";case"completed":return"âœ…";case"failed":return"âŒ";default:return"â“"}}),X=G(()=>`status-${c.value}`),O=G(()=>{switch(c.value){case"queued":return"Generation Queued";case"processing":return"AI is Generating...";case"completed":return"Generation Complete";case"failed":return"Generation Failed";default:return"Unknown Status"}}),ee=G(()=>c.value==="queued"?"Waiting in queue...":c.value==="processing"?x.value===0?"Preparing... Evaluating prompt and loading model":h.value===0&&x.value>0?"Preparing generation...":m.value>0?`Generating at ${m.value.toFixed(1)} tokens/sec (${Math.round(R.value)} chars/sec)`:`Generating content... ${x.value} characters`:"");function te(j){return j.toLocaleString()}function _e(j){const w=Math.floor(j/1e3),F=Math.floor(w/60),P=Math.floor(F/60);return P>0?`${P}h ${F%60}m ${w%60}s`:F>0?`${F}m ${w%60}s`:`${w}s`}function ke(){if(I)return;const w=`/api/v1/ai/generation/${o.jobId}/progress`;console.log("[AIGenerationProgress] Starting SSE connection to:",w),Z=Date.now(),D=window.setInterval(()=>{c.value==="processing"&&(i.value=Date.now()-Z)},100),I=new EventSource(w),I.addEventListener("progress",F=>{console.log("[AIGenerationProgress] Received progress event:",F.data);const P=JSON.parse(F.data);if(c.value=P.status,h.value=P.progress||0,u.value=P.current_tokens||0,m.value=P.tokens_per_second||0,y.value=P.estimated_remaining||0,v.value=P.prompt_tokens||0,p.value=P.completion_tokens||0,S.value=P.total_tokens||0,x.value=P.content_length||0,R.value=P.chars_per_second||0,P.elapsed_time&&c.value==="processing"&&i.value===0){const U=P.elapsed_time;Z=Date.now()-U,i.value=U}}),I.addEventListener("complete",F=>{console.log("[AIGenerationProgress] Generation complete:",F.data);const P=JSON.parse(F.data);c.value="completed",h.value=100,S.value=P.total_tokens||S.value,P.elapsed_time&&(i.value=P.elapsed_time),ne(),a("complete",P)}),I.addEventListener("error",F=>{console.error("[AIGenerationProgress] SSE error event:",F);let P={};try{P=JSON.parse(F.data)}catch{P={error:"Connection error"}}c.value="failed",E.value=P.error||"Unknown error occurred",ne(),a("error",E.value)}),I.onerror=F=>{console.error("[AIGenerationProgress] SSE connection error:",F)}}function ne(){I&&(I.close(),I=null),D&&(clearInterval(D),D=null)}return Ye(()=>{o.autoStart!==!1&&ke()}),Et(()=>{ne()}),e({startTracking:ke,stopTracking:ne}),(j,w)=>(g(),_("div",rn,[s("div",cn,[s("div",un,[c.value==="processing"?(g(),_("div",dn)):(g(),_("span",{key:1,class:ve(["status-icon",X.value])},f(ce.value),3))]),s("div",pn,[s("h3",null,f(O.value),1),s("p",hn,f(ee.value),1),o.modelName?(g(),_("p",mn,[w[0]||(w[0]=s("span",{class:"model-icon"},"ðŸ¤–",-1)),s("span",gn,f(o.modelName),1)])):b("",!0)])]),s("div",_n,[s("div",{class:ve(["progress-bar",{indeterminate:h.value===0&&H.value}])},[h.value>0?(g(),_("div",{key:0,class:ve(["progress-fill",{"progress-pulsing":H.value}]),style:Me({width:h.value+"%"})},[h.value>=8?(g(),_("span",kn,f(h.value)+"%",1)):b("",!0)],6)):H.value?(g(),_("div",fn)):b("",!0)],2)]),H.value||c.value==="completed"?(g(),_("div",vn,[s("div",bn,[w[1]||(w[1]=s("div",{class:"stat-icon"},"ðŸ”¢",-1)),s("div",wn,[s("div",xn,f(te(u.value)),1),s("div",yn,f(u.value===0&&c.value==="processing"?"Evaluating...":"Tokens Generated"),1)])]),s("div",$n,[w[3]||(w[3]=s("div",{class:"stat-icon"},"âš¡",-1)),s("div",Sn,[s("div",Cn,f(m.value>0?m.value.toFixed(1):"â€”"),1),w[2]||(w[2]=s("div",{class:"stat-label"},"Tokens/sec",-1))])]),s("div",Rn,[w[5]||(w[5]=s("div",{class:"stat-icon"},"â±ï¸",-1)),s("div",Tn,[s("div",In,f(_e(i.value)),1),w[4]||(w[4]=s("div",{class:"stat-label"},"Elapsed Time",-1))])]),y.value>0&&H.value?(g(),_("div",An,[w[7]||(w[7]=s("div",{class:"stat-icon"},"â³",-1)),s("div",Pn,[s("div",En,f(_e(y.value)),1),w[6]||(w[6]=s("div",{class:"stat-label"},"Est. Remaining",-1))])])):b("",!0)])):b("",!0),c.value==="completed"&&S.value>0?(g(),_("div",Ln,[w[11]||(w[11]=s("div",{class:"completion-badge"},[s("span",{class:"badge-icon"},"âœ¨"),s("span",{class:"badge-text"},"Generation Complete!")],-1)),s("div",zn,[s("div",Mn,[w[8]||(w[8]=s("span",{class:"token-label"},"Input Tokens:",-1)),s("span",jn,f(te(v.value)),1)]),s("div",qn,[w[9]||(w[9]=s("span",{class:"token-label"},"Output Tokens:",-1)),s("span",Fn,f(te(p.value)),1)]),s("div",Dn,[w[10]||(w[10]=s("span",{class:"token-label"},"Total:",-1)),s("span",Bn,f(te(S.value)),1)])])])):b("",!0),c.value==="failed"&&E.value?(g(),_("div",Gn,[w[12]||(w[12]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",null,f(E.value),1)])):b("",!0)]))}}),Un=Ie(Nn,[["__scopeId","data-v-208e0ab2"]]);function Mt(t){const e=A([]),n=A(!1),o=A(null),a=()=>typeof t=="number"?t:t.value,c=v=>v!=null&&typeof v=="object"&&typeof v.comment_id=="number"&&v.comment_id>0;return{comments:e,loading:n,error:o,loadComments:async(v="newest")=>{try{n.value=!0,o.value=null;let p="created_asc";v==="newest"?p="created_desc":v==="popular"&&(p="reactions");const S=await V.get(`/posts/${a()}/comments`,{params:{sort:p}});console.log("Comments API Response:",S),S&&Array.isArray(S.comments)?(e.value=S.comments.filter(c),console.log("Filtered comments:",e.value)):(console.log("Invalid response format or no comments array found"),e.value=[])}catch(p){o.value=p.message||"Failed to load comments",console.error("Error loading comments:",p),e.value=[]}finally{n.value=!1}},addComment:async v=>{try{const S=(await V.post("/comments",v)).comment;if(c(S)){if(!v.parent_id)e.value.unshift(S);else return S;return S}return null}catch(p){throw o.value=p.message||"Failed to add comment",p}},updateComment:async(v,p)=>{try{const x=(await V.patch(`/comments/${v}`,p)).comment;if(c(x)){const R=e.value.findIndex(E=>E&&E.comment_id===v);return R!==-1&&(e.value[R]={...e.value[R],...x}),x}return null}catch(S){throw o.value=S.message||"Failed to update comment",S}},deleteComment:async v=>{try{await V.delete(`/comments/${v}`),e.value=e.value.filter(p=>p&&p.comment_id!==void 0&&p.comment_id!==v)}catch(p){throw o.value=p.message||"Failed to delete comment",p}},loadReplies:async v=>{try{const p=await V.get(`/posts/${a()}/comments`,{params:{parent_id:v}});return p&&Array.isArray(p.comments)?p.comments.filter(c):[]}catch(p){return o.value=p.message||"Failed to load replies",[]}}}}const Hn={class:"comment-input-container"},On={class:"comment-input-wrapper"},Vn=["src","alt"],Zn={class:"input-area"},Wn=["placeholder","onKeydown"],Qn={class:"input-actions"},Jn=["disabled"],Xn=["disabled"],Kn=Te({__name:"CommentInput",props:{postId:{},parentId:{},placeholder:{},onCancel:{type:Function},initialValue:{}},emits:["submit","cancel"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=et(),h=A(o.initialValue||""),u=A(!1),m=A(null),i=G(()=>{var R;return((R=c.user)==null?void 0:R.avatar_url)||"/assets/images/default-avatar.svg"}),y=G(()=>{var R;return((R=c.user)==null?void 0:R.username)||"User"}),v=()=>{yt(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=`${m.value.scrollHeight}px`)})},p=async()=>{if(!(!h.value.trim()||u.value)){u.value=!0;try{a("submit",h.value.trim()),h.value="",v()}finally{u.value=!1}}},S=()=>{h.value="",v(),o.onCancel&&o.onCancel(),a("cancel")};return e({focus:()=>{yt(()=>{var R;(R=m.value)==null||R.focus()})}}),(R,E)=>(g(),_("div",Hn,[s("div",On,[s("img",{src:i.value,alt:y.value,class:"user-avatar"},null,8,Vn),s("div",Zn,[Lt(s("textarea",{"onUpdate:modelValue":E[0]||(E[0]=I=>h.value=I),ref_key:"textareaRef",ref:m,placeholder:t.placeholder,onKeydown:tn(zt(p,["exact","prevent"]),["enter"]),onInput:v,class:"comment-textarea",rows:"1"},null,40,Wn),[[en,h.value]]),s("div",Qn,[s("button",{onClick:p,disabled:!h.value.trim()||u.value,class:"btn-submit"},f(u.value?"Posting...":"Post"),9,Jn),t.onCancel?(g(),_("button",{key:0,onClick:S,class:"btn-cancel",disabled:u.value}," Cancel ",8,Xn)):b("",!0)])])])]))}}),Qe=Ie(Kn,[["__scopeId","data-v-1796c3c9"]]),Yn={class:"comment-header"},es=["src","alt"],ts={class:"comment-meta"},ns={class:"comment-author"},ss={class:"comment-time"},os={key:0,class:"comment-edited"},as={class:"comment-body"},ls={key:0,class:"comment-edit"},rs={key:1,class:"comment-content"},is=["innerHTML"],cs={key:1},us={key:0,class:"comment-actions"},ds={key:0},ps={key:1,class:"reply-input"},hs={key:2,class:"comment-replies"},ms={key:3,class:"load-replies"},gs={key:4,class:"loading-replies"},_s={key:5,class:"view-full-thread"},ks=Te({__name:"CommentItem",props:{comment:{},postId:{},depth:{},maxDepth:{}},emits:["reply-added","comment-updated","comment-deleted"],setup(t,{emit:e}){const n=t,o=e;n.comment||console.warn("CommentItem: comment prop is required");const a=et(),{addComment:c,updateComment:h,deleteComment:u,loadReplies:m}=Mt(A(n.postId)),i=G(()=>n.depth||0),y=G(()=>n.maxDepth||3),v=A(!1),p=A(!1),S=A(!1),x=A(!1),R=A([]),E=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),I=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),D=G(()=>n.comment&&i.value<y.value),Z=j=>{const w=new Date(j),P=new Date().getTime()-w.getTime(),U=Math.floor(P/6e4),Pe=Math.floor(P/36e5),ue=Math.floor(P/864e5);return U<1?"just now":U<60?`${U}m ago`:Pe<24?`${Pe}h ago`:ue<7?`${ue}d ago`:w.toLocaleDateString()},H=()=>{v.value=!0},ce=()=>{v.value=!1},X=async j=>{try{if(!n.comment)return;const w=await h(n.comment.comment_id,{content_text:j});w&&(v.value=!1,o("comment-updated",w))}catch(w){console.error("Failed to update comment:",w)}},O=async()=>{if(!(!n.comment||!confirm("Delete this comment?")))try{await u(n.comment.comment_id),o("comment-deleted",n.comment.comment_id)}catch(j){console.error("Failed to delete comment:",j)}},ee=()=>{p.value=!p.value},te=async j=>{try{if(!n.comment)return;const w=await c({post_id:n.postId,content_text:j,parent_id:n.comment.comment_id});w&&(p.value=!1,R.value.unshift(w),S.value=!0,o("reply-added",w))}catch(w){console.error("Failed to add reply:",w)}},_e=async()=>{if(n.comment){x.value=!0;try{R.value=await m(n.comment.comment_id),S.value=!0}catch(j){console.error("Failed to load replies:",j)}finally{x.value=!1}}},ke=j=>{o("reply-added",j)},ne=()=>{n.comment&&console.log("View full thread for comment:",n.comment.comment_id)};return(j,w)=>{const F=nn("CommentItem",!0);return t.comment&&t.comment.comment_id?(g(),_("div",{key:0,class:ve(["comment-item",{"is-reply":i.value>0}]),style:Me({marginLeft:`${i.value*40}px`})},[s("div",Yn,[s("img",{src:t.comment.author_avatar||"/assets/images/default-avatar.svg",alt:t.comment.author_username,class:"comment-avatar"},null,8,es),s("div",ts,[s("span",ns,f(t.comment.author_username),1),s("span",ss,f(Z(t.comment.created_at)),1),t.comment.edited_at?(g(),_("span",os,"(edited)")):b("",!0)])]),s("div",as,[v.value?(g(),_("div",ls,[be(Qe,{"post-id":t.comment.post_id,"initial-value":t.comment.content_text,placeholder:"Edit your comment...",onSubmit:X,onCancel:ce},null,8,["post-id","initial-value"])])):(g(),_("div",rs,[t.comment.content_html?(g(),_("div",{key:0,innerHTML:t.comment.content_html},null,8,is)):(g(),_("p",cs,f(t.comment.content_text),1))]))]),v.value?b("",!0):(g(),_("div",us,[be(ln,{"reactable-type":"comment","reactable-id":t.comment.comment_id},null,8,["reactable-id"]),D.value?(g(),_("button",{key:0,onClick:ee,class:"action-btn"},[w[2]||(w[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),w[3]||(w[3]=s("span",null,"Reply",-1)),t.comment.reply_count>0?(g(),_("span",ds,"("+f(t.comment.reply_count)+")",1)):b("",!0)])):b("",!0),E.value?(g(),_("button",{key:1,onClick:H,class:"action-btn"},[...w[4]||(w[4]=[s("span",{class:"icon"},"âœï¸",-1),s("span",null,"Edit",-1)])])):b("",!0),I.value?(g(),_("button",{key:2,onClick:O,class:"action-btn delete"},[...w[5]||(w[5]=[s("span",{class:"icon"},"ðŸ—‘ï¸",-1),s("span",null,"Delete",-1)])])):b("",!0)])),p.value?(g(),_("div",ps,[be(Qe,{"post-id":t.comment.post_id,"parent-id":t.comment.comment_id,placeholder:"Write a reply...",onSubmit:te,onCancel:ee},null,8,["post-id","parent-id"])])):b("",!0),S.value&&R.value.length>0?(g(),_("div",hs,[(g(!0),_(he,null,je(R.value,P=>(g(),Ce(F,{key:P.comment_id,comment:P,"post-id":t.postId,depth:i.value+1,"max-depth":y.value,onReplyAdded:ke,onCommentUpdated:w[0]||(w[0]=U=>j.$emit("comment-updated",U)),onCommentDeleted:w[1]||(w[1]=U=>j.$emit("comment-deleted",U))},null,8,["comment","post-id","depth","max-depth"]))),128))])):b("",!0),t.comment.reply_count>0&&!S.value&&!x.value?(g(),_("div",ms,[s("button",{onClick:_e,class:"btn-load-replies"},[w[6]||(w[6]=s("span",{class:"icon"},"â†³",-1)),s("span",null,"Show "+f(t.comment.reply_count)+" "+f(t.comment.reply_count===1?"reply":"replies"),1)])])):b("",!0),x.value?(g(),_("div",gs,[...w[7]||(w[7]=[s("div",{class:"spinner"},null,-1),s("span",null,"Loading replies...",-1)])])):b("",!0),i.value>=y.value&&t.comment.reply_count>0?(g(),_("div",_s,[s("button",{onClick:ne,class:"btn-view-thread"}," View full thread â†’ ")])):b("",!0)],6)):b("",!0)}}}),fs=Ie(ks,[["__scopeId","data-v-3683cf16"]]),vs={class:"comment-section"},bs={class:"comments-header"},ws={class:"comments-title"},xs={class:"add-comment"},ys={class:"comments-list"},$s={key:0,class:"loading-container"},Ss={key:1,class:"error-container"},Cs={key:2,class:"empty-state"},Rs={key:3,class:"comments"},Ts=Te({__name:"CommentSection",props:{postId:{},maxDepth:{}},emits:["comment-created","comment-deleted","comment-updated"],setup(t,{emit:e}){const n=t,o=e,a=A(n.maxDepth||3),c=A("newest"),{comments:h,loading:u,error:m,loadComments:i,addComment:y}=Mt(A(n.postId)),v=()=>{i(c.value)};We(h,E=>{console.log("Comments updated:",E),console.log("Comments length:",E.length)});const p=async E=>{try{const I=await y({post_id:n.postId,content_text:E});I&&o("comment-created",I)}catch(I){console.error("Failed to add comment:",I)}},S=E=>{o("comment-created",E)},x=E=>{o("comment-updated",E)},R=E=>{o("comment-deleted",E)};return Ye(()=>{i(c.value)}),(E,I)=>(g(),_("div",vs,[s("div",bs,[s("h3",ws,[I[2]||(I[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,"Comments ("+f(pe(h).length)+")",1)]),Lt(s("select",{"onUpdate:modelValue":I[0]||(I[0]=D=>c.value=D),onChange:v,class:"sort-select"},[...I[3]||(I[3]=[s("option",{value:"newest"},"Newest First",-1),s("option",{value:"oldest"},"Oldest First",-1),s("option",{value:"popular"},"Most Popular",-1)])],544),[[sn,c.value]])]),s("div",xs,[be(Qe,{"post-id":t.postId,placeholder:"Add a comment...",onSubmit:p},null,8,["post-id"])]),s("div",ys,[pe(u)?(g(),_("div",$s,[...I[4]||(I[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading comments...",-1)])])):pe(m)?(g(),_("div",Ss,[s("p",null,f(pe(m)),1),s("button",{onClick:I[1]||(I[1]=D=>pe(i)(c.value)),class:"btn-retry"},"Retry")])):pe(h).length===0?(g(),_("div",Cs,[...I[5]||(I[5]=[s("span",{class:"empty-icon"},"ðŸ’¬",-1),s("p",null,"No comments yet",-1),s("p",{class:"empty-hint"},"Be the first to comment!",-1)])])):(g(),_("div",Rs,[(g(!0),_(he,null,je(pe(h),(D,Z)=>(g(),Ce(fs,{key:D.comment_id,comment:D,"post-id":t.postId,depth:0,"max-depth":a.value,onReplyAdded:S,onCommentUpdated:x,onCommentDeleted:R},null,8,["comment","post-id","max-depth"]))),128))]))])]))}}),St=Ie(Ts,[["__scopeId","data-v-76797f32"]]);function tt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ge=tt();function jt(t){ge=t}var Re={exec:()=>null};function z(t,e=""){let n=typeof t=="string"?t:t.source,o={replace:(a,c)=>{let h=typeof c=="string"?c:c.source;return h=h.replace(N.caret,"$1"),n=n.replace(a,h),o},getRegex:()=>new RegExp(n,e)};return o}var N={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Is=/^(?:[ \t]*(?:\n|$))+/,As=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ps=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ae=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Es=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,nt=/(?:[*+-]|\d{1,9}[.)])/,qt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ft=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ls=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),st=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,zs=/^[^\n]+/,ot=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Ms=z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ot).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),js=z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,nt).getRegex(),Be="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",at=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,qs=z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",at).replace("tag",Be).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dt=z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Fs=z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dt).getRegex(),lt={blockquote:Fs,code:As,def:Ms,fences:Ps,heading:Es,hr:Ae,html:qs,lheading:Ft,list:js,newline:Is,paragraph:Dt,table:Re,text:zs},Ct=z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Ds={...lt,lheading:Ls,table:Ct,paragraph:z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ct).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex()},Bs={...lt,html:z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",at).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Re,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:z(st).replace("hr",Ae).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ft).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gs=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ns=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Bt=/^( {2,}|\\)\n(?!\s*$)/,Us=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ge=/[\p{P}\p{S}]/u,rt=/[\s\p{P}\p{S}]/u,Gt=/[^\s\p{P}\p{S}]/u,Hs=z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,rt).getRegex(),Nt=/(?!~)[\p{P}\p{S}]/u,Os=/(?!~)[\s\p{P}\p{S}]/u,Vs=/(?:[^\s\p{P}\p{S}]|~)/u,Zs=z(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ut=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ws=z(Ut,"u").replace(/punct/g,Ge).getRegex(),Qs=z(Ut,"u").replace(/punct/g,Nt).getRegex(),Ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Js=z(Ht,"gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Xs=z(Ht,"gu").replace(/notPunctSpace/g,Vs).replace(/punctSpace/g,Os).replace(/punct/g,Nt).getRegex(),Ks=z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Ys=z(/\\(punct)/,"gu").replace(/punct/g,Ge).getRegex(),eo=z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),to=z(at).replace("(?:-->|$)","-->").getRegex(),no=z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",to).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),qe=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,so=z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",qe).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ot=z(/^!?\[(label)\]\[(ref)\]/).replace("label",qe).replace("ref",ot).getRegex(),Vt=z(/^!?\[(ref)\](?:\[\])?/).replace("ref",ot).getRegex(),oo=z("reflink|nolink(?!\\()","g").replace("reflink",Ot).replace("nolink",Vt).getRegex(),Rt=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,it={_backpedal:Re,anyPunctuation:Ys,autolink:eo,blockSkip:Zs,br:Bt,code:Ns,del:Re,emStrongLDelim:Ws,emStrongRDelimAst:Js,emStrongRDelimUnd:Ks,escape:Gs,link:so,nolink:Vt,punctuation:Hs,reflink:Ot,reflinkSearch:oo,tag:no,text:Us,url:Re},ao={...it,link:z(/^!?\[(label)\]\((.*?)\)/).replace("label",qe).getRegex(),reflink:z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",qe).getRegex()},Je={...it,emStrongRDelimAst:Xs,emStrongLDelim:Qs,url:z(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Rt).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:z(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Rt).getRegex()},lo={...Je,br:z(Bt).replace("{2,}","*").getRegex(),text:z(Je.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Le={normal:lt,gfm:Ds,pedantic:Bs},ye={normal:it,gfm:Je,breaks:lo,pedantic:ao},ro={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tt=t=>ro[t];function K(t,e){if(e){if(N.escapeTest.test(t))return t.replace(N.escapeReplace,Tt)}else if(N.escapeTestNoEncode.test(t))return t.replace(N.escapeReplaceNoEncode,Tt);return t}function It(t){try{t=encodeURI(t).replace(N.percentDecode,"%")}catch{return null}return t}function At(t,e){var c;let n=t.replace(N.findPipe,(h,u,m)=>{let i=!1,y=u;for(;--y>=0&&m[y]==="\\";)i=!i;return i?"|":" |"}),o=n.split(N.splitPipe),a=0;if(o[0].trim()||o.shift(),o.length>0&&!((c=o.at(-1))!=null&&c.trim())&&o.pop(),e)if(o.length>e)o.splice(e);else for(;o.length<e;)o.push("");for(;a<o.length;a++)o[a]=o[a].trim().replace(N.slashPipe,"|");return o}function $e(t,e,n){let o=t.length;if(o===0)return"";let a=0;for(;a<o&&t.charAt(o-a-1)===e;)a++;return t.slice(0,o-a)}function io(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let o=0;o<t.length;o++)if(t[o]==="\\")o++;else if(t[o]===e[0])n++;else if(t[o]===e[1]&&(n--,n<0))return o;return n>0?-2:-1}function Pt(t,e,n,o,a){let c=e.href,h=e.title||null,u=t[1].replace(a.other.outputLinkReplace,"$1");o.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:c,title:h,text:u,tokens:o.inlineTokens(u)};return o.state.inLink=!1,m}function co(t,e,n){let o=t.match(n.other.indentCodeCompensation);if(o===null)return e;let a=o[1];return e.split(`
`).map(c=>{let h=c.match(n.other.beginningSpace);if(h===null)return c;let[u]=h;return u.length>=a.length?c.slice(a.length):c}).join(`
`)}var Fe=class{constructor(t){q(this,"options");q(this,"rules");q(this,"lexer");this.options=t||ge}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:$e(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],o=co(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:o}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let o=$e(n,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(n=o.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:$e(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=$e(e[0],`
`).split(`
`),o="",a="",c=[];for(;n.length>0;){let h=!1,u=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))u.push(n[m]),h=!0;else if(!h)u.push(n[m]);else break;n=n.slice(m);let i=u.join(`
`),y=i.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${i}`:i,a=a?`${a}
${y}`:y;let v=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,c,!0),this.lexer.state.top=v,n.length===0)break;let p=c.at(-1);if((p==null?void 0:p.type)==="code")break;if((p==null?void 0:p.type)==="blockquote"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.blockquote(x);c[c.length-1]=R,o=o.substring(0,o.length-S.raw.length)+R.raw,a=a.substring(0,a.length-S.text.length)+R.text;break}else if((p==null?void 0:p.type)==="list"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.list(x);c[c.length-1]=R,o=o.substring(0,o.length-p.raw.length)+R.raw,a=a.substring(0,a.length-S.raw.length)+R.raw,n=x.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:a}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),o=n.length>1,a={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");let c=this.rules.other.listItemRegex(n),h=!1;for(;t;){let m=!1,i="",y="";if(!(e=c.exec(t))||this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let v=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,I=>" ".repeat(3*I.length)),p=t.split(`
`,1)[0],S=!v.trim(),x=0;if(this.options.pedantic?(x=2,y=v.trimStart()):S?x=e[1].length+1:(x=e[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,y=v.slice(x),x+=e[1].length),S&&this.rules.other.blankLine.test(p)&&(i+=p+`
`,t=t.substring(p.length+1),m=!0),!m){let I=this.rules.other.nextBulletRegex(x),D=this.rules.other.hrRegex(x),Z=this.rules.other.fencesBeginRegex(x),H=this.rules.other.headingBeginRegex(x),ce=this.rules.other.htmlBeginRegex(x);for(;t;){let X=t.split(`
`,1)[0],O;if(p=X,this.options.pedantic?(p=p.replace(this.rules.other.listReplaceNesting,"  "),O=p):O=p.replace(this.rules.other.tabCharGlobal,"    "),Z.test(p)||H.test(p)||ce.test(p)||I.test(p)||D.test(p))break;if(O.search(this.rules.other.nonSpaceChar)>=x||!p.trim())y+=`
`+O.slice(x);else{if(S||v.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Z.test(v)||H.test(v)||D.test(v))break;y+=`
`+p}!S&&!p.trim()&&(S=!0),i+=X+`
`,t=t.substring(X.length+1),v=O.slice(x)}}a.loose||(h?a.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(h=!0));let R=null,E;this.options.gfm&&(R=this.rules.other.listIsTask.exec(y),R&&(E=R[0]!=="[ ] ",y=y.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:i,task:!!R,checked:E,loose:!1,text:y,tokens:[]}),a.raw+=i}let u=a.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let m=0;m<a.items.length;m++)if(this.lexer.state.top=!1,a.items[m].tokens=this.lexer.blockTokens(a.items[m].text,[]),!a.loose){let i=a.items[m].tokens.filter(v=>v.type==="space"),y=i.length>0&&i.some(v=>this.rules.other.anyLine.test(v.raw));a.loose=y}if(a.loose)for(let m=0;m<a.items.length;m++)a.items[m].loose=!0;return a}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:o,title:a}}}table(t){var h;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=At(e[1]),o=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(h=e[3])!=null&&h.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===o.length){for(let u of o)this.rules.other.tableAlignRight.test(u)?c.align.push("right"):this.rules.other.tableAlignCenter.test(u)?c.align.push("center"):this.rules.other.tableAlignLeft.test(u)?c.align.push("left"):c.align.push(null);for(let u=0;u<n.length;u++)c.header.push({text:n[u],tokens:this.lexer.inline(n[u]),header:!0,align:c.align[u]});for(let u of a)c.rows.push(At(u,c.header.length).map((m,i)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:c.align[i]})));return c}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=$e(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=io(e[2],"()");if(c===-2)return;if(c>-1){let h=(e[0].indexOf("!")===0?5:4)+e[1].length+c;e[2]=e[2].substring(0,c),e[0]=e[0].substring(0,h).trim(),e[3]=""}}let o=e[2],a="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],a=c[3])}else a=e[3]?e[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?o=o.slice(1):o=o.slice(1,-1)),Pt(e,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let o=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[o.toLowerCase()];if(!a){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return Pt(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let o=this.rules.inline.emStrongLDelim.exec(t);if(!(!o||o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...o[0]].length-1,c,h,u=a,m=0,i=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(i.lastIndex=0,e=e.slice(-1*t.length+a);(o=i.exec(e))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(h=[...c].length,o[3]||o[4]){u+=h;continue}else if((o[5]||o[6])&&a%3&&!((a+h)%3)){m+=h;continue}if(u-=h,u>0)continue;h=Math.min(h,h+u+m);let y=[...o[0]][0].length,v=t.slice(0,a+o.index+y+h);if(Math.min(a,h)%2){let S=v.slice(1,-1);return{type:"em",raw:v,text:S,tokens:this.lexer.inlineTokens(S)}}let p=v.slice(2,-2);return{type:"strong",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return o&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,o;return e[2]==="@"?(n=e[1],o="mailto:"+n):(n=e[1],o=n),{type:"link",raw:e[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let o,a;if(e[2]==="@")o=e[0],a="mailto:"+o;else{let c;do c=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(c!==e[0]);o=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Q=class Xe{constructor(e){q(this,"tokens");q(this,"options");q(this,"state");q(this,"tokenizer");q(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ge,this.options.tokenizer=this.options.tokenizer||new Fe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:N,block:Le.normal,inline:ye.normal};this.options.pedantic?(n.block=Le.pedantic,n.inline=ye.pedantic):this.options.gfm&&(n.block=Le.gfm,this.options.breaks?n.inline=ye.breaks:n.inline=ye.gfm),this.tokenizer.rules=n}static get rules(){return{block:Le,inline:ye}}static lex(e,n){return new Xe(n).lex(e)}static lexInline(e,n){return new Xe(n).inlineTokens(e)}lex(e){e=e.replace(N.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let o=this.inlineQueue[n];this.inlineTokens(o.src,o.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],o=!1){var a,c,h;for(this.options.pedantic&&(e=e.replace(N.tabCharGlobal,"    ").replace(N.spaceLine,""));e;){let u;if((c=(a=this.options.extensions)==null?void 0:a.block)!=null&&c.some(i=>(u=i.call({lexer:this},e,n))?(e=e.substring(u.raw.length),n.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let i=n.at(-1);u.raw.length===1&&i!==void 0?i.raw+=`
`:n.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},n.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),n.push(u);continue}let m=e;if((h=this.options.extensions)!=null&&h.startBlock){let i=1/0,y=e.slice(1),v;this.options.extensions.startBlock.forEach(p=>{v=p.call({lexer:this},y),typeof v=="number"&&v>=0&&(i=Math.min(i,v))}),i<1/0&&i>=0&&(m=e.substring(0,i+1))}if(this.state.top&&(u=this.tokenizer.paragraph(m))){let i=n.at(-1);o&&(i==null?void 0:i.type)==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u),o=m.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(e){let i="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,m,i,y,v;let o=e,a=null;if(this.tokens.links){let p=Object.keys(this.tokens.links);if(p.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)p.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);o=((m=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:m.call({lexer:this},o))??o;let c=!1,h="";for(;e;){c||(h=""),c=!1;let p;if((y=(i=this.options.extensions)==null?void 0:i.inline)!=null&&y.some(x=>(p=x.call({lexer:this},e,n))?(e=e.substring(p.raw.length),n.push(p),!0):!1))continue;if(p=this.tokenizer.escape(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.tag(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.link(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(p.raw.length);let x=n.at(-1);p.type==="text"&&(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(p=this.tokenizer.emStrong(e,o,h)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.codespan(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.br(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.del(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.autolink(e)){e=e.substring(p.raw.length),n.push(p);continue}if(!this.state.inLink&&(p=this.tokenizer.url(e))){e=e.substring(p.raw.length),n.push(p);continue}let S=e;if((v=this.options.extensions)!=null&&v.startInline){let x=1/0,R=e.slice(1),E;this.options.extensions.startInline.forEach(I=>{E=I.call({lexer:this},R),typeof E=="number"&&E>=0&&(x=Math.min(x,E))}),x<1/0&&x>=0&&(S=e.substring(0,x+1))}if(p=this.tokenizer.inlineText(S)){e=e.substring(p.raw.length),p.raw.slice(-1)!=="_"&&(h=p.raw.slice(-1)),c=!0;let x=n.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(e){let x="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return n}},De=class{constructor(t){q(this,"options");q(this,"parser");this.options=t||ge}space(t){return""}code({text:t,lang:e,escaped:n}){var c;let o=(c=(e||"").match(N.notSpaceStart))==null?void 0:c[0],a=t.replace(N.endingNewline,"")+`
`;return o?'<pre><code class="language-'+K(o)+'">'+(n?a:K(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:K(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,o="";for(let h=0;h<t.items.length;h++){let u=t.items[h];o+=this.listitem(u)}let a=e?"ol":"ul",c=e&&n!==1?' start="'+n+'"':"";return"<"+a+c+`>
`+o+"</"+a+`>
`}listitem(t){var n;let e="";if(t.task){let o=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=o+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=o+" "+K(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):e+=o+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let o="";for(let a=0;a<t.rows.length;a++){let c=t.rows[a];n="";for(let h=0;h<c.length;h++)n+=this.tablecell(c[h]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+o+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${K(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let o=this.parser.parseInline(n),a=It(t);if(a===null)return o;t=a;let c='<a href="'+t+'"';return e&&(c+=' title="'+K(e)+'"'),c+=">"+o+"</a>",c}image({href:t,title:e,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));let a=It(t);if(a===null)return K(n);t=a;let c=`<img src="${t}" alt="${n}"`;return e&&(c+=` title="${K(e)}"`),c+=">",c}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:K(t.text)}},ct=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},J=class Ke{constructor(e){q(this,"options");q(this,"renderer");q(this,"textRenderer");this.options=e||ge,this.options.renderer=this.options.renderer||new De,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ct}static parse(e,n){return new Ke(n).parse(e)}static parseInline(e,n){return new Ke(n).parseInline(e)}parse(e,n=!0){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=u,y=this.options.extensions.renderers[i.type].call({parser:this},i);if(y!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(i.type)){o+=y||"";continue}}let m=u;switch(m.type){case"space":{o+=this.renderer.space(m);continue}case"hr":{o+=this.renderer.hr(m);continue}case"heading":{o+=this.renderer.heading(m);continue}case"code":{o+=this.renderer.code(m);continue}case"table":{o+=this.renderer.table(m);continue}case"blockquote":{o+=this.renderer.blockquote(m);continue}case"list":{o+=this.renderer.list(m);continue}case"html":{o+=this.renderer.html(m);continue}case"def":{o+=this.renderer.def(m);continue}case"paragraph":{o+=this.renderer.paragraph(m);continue}case"text":{let i=m,y=this.renderer.text(i);for(;h+1<e.length&&e[h+1].type==="text";)i=e[++h],y+=`
`+this.renderer.text(i);n?o+=this.renderer.paragraph({type:"paragraph",raw:y,text:y,tokens:[{type:"text",raw:y,text:y,escaped:!0}]}):o+=y;continue}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}parseInline(e,n=this.renderer){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=this.options.extensions.renderers[u.type].call({parser:this},u);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){o+=i||"";continue}}let m=u;switch(m.type){case"escape":{o+=n.text(m);break}case"html":{o+=n.html(m);break}case"link":{o+=n.link(m);break}case"image":{o+=n.image(m);break}case"strong":{o+=n.strong(m);break}case"em":{o+=n.em(m);break}case"codespan":{o+=n.codespan(m);break}case"br":{o+=n.br(m);break}case"del":{o+=n.del(m);break}case"text":{o+=n.text(m);break}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}},ze,Se=(ze=class{constructor(t){q(this,"options");q(this,"block");this.options=t||ge}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Q.lex:Q.lexInline}provideParser(){return this.block?J.parse:J.parseInline}},q(ze,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),q(ze,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),ze),uo=class{constructor(...t){q(this,"defaults",tt());q(this,"options",this.setOptions);q(this,"parse",this.parseMarkdown(!0));q(this,"parseInline",this.parseMarkdown(!1));q(this,"Parser",J);q(this,"Renderer",De);q(this,"TextRenderer",ct);q(this,"Lexer",Q);q(this,"Tokenizer",Fe);q(this,"Hooks",Se);this.use(...t)}walkTokens(t,e){var o,a;let n=[];for(let c of t)switch(n=n.concat(e.call(this,c)),c.type){case"table":{let h=c;for(let u of h.header)n=n.concat(this.walkTokens(u.tokens,e));for(let u of h.rows)for(let m of u)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let h=c;n=n.concat(this.walkTokens(h.items,e));break}default:{let h=c;(a=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&a[h.type]?this.defaults.extensions.childTokens[h.type].forEach(u=>{let m=h[u].flat(1/0);n=n.concat(this.walkTokens(m,e))}):h.tokens&&(n=n.concat(this.walkTokens(h.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let o={...n};if(o.async=this.defaults.async||o.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let c=e.renderers[a.name];c?e.renderers[a.name]=function(...h){let u=a.renderer.apply(this,h);return u===!1&&(u=c.apply(this,h)),u}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let c=e[a.level];c?c.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),o.extensions=e),n.renderer){let a=this.defaults.renderer||new De(this.defaults);for(let c in n.renderer){if(!(c in a))throw new Error(`renderer '${c}' does not exist`);if(["options","parser"].includes(c))continue;let h=c,u=n.renderer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y||""}}o.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Fe(this.defaults);for(let c in n.tokenizer){if(!(c in a))throw new Error(`tokenizer '${c}' does not exist`);if(["options","rules","lexer"].includes(c))continue;let h=c,u=n.tokenizer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Se;for(let c in n.hooks){if(!(c in a))throw new Error(`hook '${c}' does not exist`);if(["options","block"].includes(c))continue;let h=c,u=n.hooks[h],m=a[h];Se.passThroughHooks.has(c)?a[h]=i=>{if(this.defaults.async&&Se.passThroughHooksRespectAsync.has(c))return(async()=>{let v=await u.call(a,i);return m.call(a,v)})();let y=u.call(a,i);return m.call(a,y)}:a[h]=(...i)=>{if(this.defaults.async)return(async()=>{let v=await u.apply(a,i);return v===!1&&(v=await m.apply(a,i)),v})();let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,c=n.walkTokens;o.walkTokens=function(h){let u=[];return u.push(c.call(this,h)),a&&(u=u.concat(a.call(this,h))),u}}this.defaults={...this.defaults,...o}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Q.lex(t,e??this.defaults)}parser(t,e){return J.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let o={...n},a={...this.defaults,...o},c=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&o.async===!1)return c(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let h=a.hooks?await a.hooks.preprocess(e):e,u=await(a.hooks?await a.hooks.provideLexer():t?Q.lex:Q.lexInline)(h,a),m=a.hooks?await a.hooks.processAllTokens(u):u;a.walkTokens&&await Promise.all(this.walkTokens(m,a.walkTokens));let i=await(a.hooks?await a.hooks.provideParser():t?J.parse:J.parseInline)(m,a);return a.hooks?await a.hooks.postprocess(i):i})().catch(c);try{a.hooks&&(e=a.hooks.preprocess(e));let h=(a.hooks?a.hooks.provideLexer():t?Q.lex:Q.lexInline)(e,a);a.hooks&&(h=a.hooks.processAllTokens(h)),a.walkTokens&&this.walkTokens(h,a.walkTokens);let u=(a.hooks?a.hooks.provideParser():t?J.parse:J.parseInline)(h,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(h){return c(h)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let o="<p>An error occurred:</p><pre>"+K(n.message+"",!0)+"</pre>";return e?Promise.resolve(o):o}if(e)return Promise.reject(n);throw n}}},me=new uo;function M(t,e){return me.parse(t,e)}M.options=M.setOptions=function(t){return me.setOptions(t),M.defaults=me.defaults,jt(M.defaults),M};M.getDefaults=tt;M.defaults=ge;M.use=function(...t){return me.use(...t),M.defaults=me.defaults,jt(M.defaults),M};M.walkTokens=function(t,e){return me.walkTokens(t,e)};M.parseInline=me.parseInline;M.Parser=J;M.parser=J.parse;M.Renderer=De;M.TextRenderer=ct;M.Lexer=Q;M.lexer=Q.lex;M.Tokenizer=Fe;M.Hooks=Se;M.parse=M;M.options;M.setOptions;M.use;M.walkTokens;M.parseInline;J.parse;Q.lex;const po={class:"wall-view"},ho={key:0,class:"loading-container"},mo={key:1,class:"error-container"},go={key:2,class:"wall-content"},_o={class:"wall-header"},ko={class:"wall-info"},fo={class:"wall-avatar"},vo=["src","alt"],bo={class:"wall-details"},wo={class:"wall-title"},xo={key:0,class:"wall-owner"},yo={key:1,class:"wall-description"},$o={class:"wall-stats"},So={class:"stat"},Co={class:"stat-value"},Ro={class:"stat"},To={class:"stat-value"},Io={class:"posts-section"},Ao={key:0,class:"loading-posts"},Po={key:1,class:"empty-state"},Eo={key:2,class:"posts-grid"},Lo={key:1,class:"ai-content-info"},zo={key:0,class:"ai-preview-prompt"},Mo={key:1},jo=["innerHTML"],qo=["onClick"],Fo={key:2,class:"post-header"},Do=["src","alt"],Bo={class:"post-meta"},Go={class:"post-author"},No={class:"post-time"},Uo={key:3,class:"post-content"},Ho=["innerHTML"],Oo={key:1},Vo={key:4,class:"ai-content-preview"},Zo={class:"ai-preview-header"},Wo=["src","alt"],Qo={class:"ai-generation-info"},Jo={key:0,class:"info-item bricks-spent"},Xo={class:"bricks-amount"},Ko={key:1,class:"info-item model-used"},Yo={class:"model-name"},ea={key:0,class:"ai-generation-stats"},ta={key:0,class:"stat-item"},na={class:"stat-value"},sa={key:1,class:"stat-item"},oa={class:"stat-value"},aa={key:2,class:"stat-item"},la={class:"stat-value"},ra={key:1,class:"ai-preview-prompt"},ia={key:2,class:"ai-preview-response"},ca=["innerHTML"],ua=["onClick"],da={key:5,class:"ai-content-preview"},pa={class:"ai-preview-header"},ha=["src","alt"],ma={class:"ai-generation-info"},ga={class:"info-item status-processing"},_a={class:"status-badge processing"},ka={key:0,class:"info-item model-used"},fa={class:"model-name"},va={key:0,class:"ai-preview-prompt"},ba={key:1,class:"ai-preview-response"},wa=["innerHTML"],xa=["onClick"],ya={key:6,class:"post-media"},$a=["src","alt"],Sa={class:"post-actions"},Ca={class:"action-btn"},Ra={class:"action-btn"},Ta={class:"action-btn"},Ia={class:"action-btn"},Aa={class:"post-time-footer"},Pa={key:7,class:"post-comments"},Ea={key:3,class:"load-more"},La={class:"modal-content ai-modal"},za={key:0,class:"modal-body"},Ma={class:"ai-modal-section"},ja={class:"ai-prompt-full"},qa={key:0,class:"ai-modal-section"},Fa=["innerHTML"],Da={key:1,class:"ai-response-content ai-generating"},Ba={key:1,class:"ai-modal-section ai-stats"},Ga={key:0,class:"generation-progress-bar"},Na={class:"progress-bar-container"},Ua={class:"progress-text"},Ha={class:"stats-grid"},Oa={class:"stat-item"},Va={class:"stat-value"},Za={key:0,class:"stat-item"},Wa={class:"stat-value"},Qa={key:1,class:"stat-item"},Ja={class:"stat-value"},Xa={key:2,class:"stat-item"},Ka={class:"stat-value"},Ya={key:3,class:"stat-item"},el={class:"stat-value"},tl={key:4,class:"stat-item"},nl={class:"stat-value"},sl={key:5,class:"stat-item"},ol={class:"stat-value"},al={key:0,class:"stat-item"},ll={class:"stat-value"},rl={key:1,class:"stat-item"},il={class:"stat-value bricks-value"},cl={key:2,class:"stat-item"},ul={class:"stat-value"},dl={key:3,class:"stat-item"},pl={class:"stat-value"},hl={key:4,class:"stat-item"},ml={class:"stat-value"},gl={key:5,class:"stat-item"},_l={class:"stat-value"},kl={key:2,class:"ai-modal-section"},fl={class:"post-counters"},vl={class:"counter-item"},bl={class:"counter-icon"},wl={class:"counter-label"},xl={class:"counter-value"},yl={class:"counter-item"},$l={class:"counter-value"},Sl={class:"counter-item"},Cl={class:"counter-value"},Rl={class:"counter-item"},Tl={class:"counter-value"},Il={key:3,class:"ai-modal-section"},Al={class:"modal-footer"},Pl={class:"action-buttons-group"},El={key:0,class:"toast-notification"},Ze=20,Ll=Te({__name:"WallView",props:{wallId:{}},setup(t){M.setOptions({breaks:!0,gfm:!0});const e=t;an();const n=on(),o=et(),a=A(!0),c=A(!1),h=A(!1),u=A(null),m=A(null),i=A([]),y=A(1),v=A(!0);let p=new Map,S=new Map;const x=new Set,R=new Set,E=G(()=>m.value&&o.user&&m.value.user_id===o.user.id),I=G(()=>{var r;return(r=m.value)!=null&&r.theme?{backgroundColor:m.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),D=G(()=>i.value.filter(r=>!(r.post_type==="ai_app"&&r.ai_status==="failed"))),Z=async r=>{if(!x.has(r))try{await Ve.incrementViewCount(r),x.add(r),console.log(`View count incremented for post ${r}`)}catch(l){console.error(`Failed to increment view count for post ${r}:`,l)}},H=async()=>{const r=[];if(i.value.forEach(l=>{!R.has(l.post_id)&&!x.has(l.post_id)&&(r.push(l.post_id),R.add(l.post_id))}),r.length>0)try{await Ve.batchIncrementViewCounts(r),r.forEach(l=>x.add(l)),console.log(`Batch view counts incremented for ${r.length} posts`)}catch(l){console.error("Failed to batch increment view counts:",l),r.forEach($=>{R.delete($),Z($)})}},ce=async r=>{try{await Ve.incrementOpenCount(r),console.log(`Open count incremented for post ${r}`)}catch(l){console.error(`Failed to increment open count for post ${r}:`,l)}},X=r=>{const l=new Date(r),C=new Date().getTime()-l.getTime(),T=Math.floor(C/6e4),d=Math.floor(C/36e5),L=Math.floor(C/864e5);return T<1?"just now":T<60?`${T}m ago`:d<24?`${d}h ago`:L<7?`${L}d ago`:l.toLocaleDateString()},O=async()=>{var r,l,$,C;try{a.value=!0,u.value=null;let T=e.wallId||n.params.wallId;if(!T)throw new Error("No wall identifier provided");let d;if(T==="me"?d=await V.get("/walls/me"):d=await V.get(`/walls/${T}`),d!=null&&d.success&&((r=d==null?void 0:d.data)!=null&&r.wall))m.value=d.data.wall,await ee();else throw new Error((d==null?void 0:d.message)||"Wall not found")}catch(T){console.error("Error loading wall:",T),((l=T.response)==null?void 0:l.status)===404?u.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":u.value=((C=($=T.response)==null?void 0:$.data)==null?void 0:C.message)||T.message||"Failed to load wall"}finally{a.value=!1}},ee=async(r=!1)=>{var l;if(m.value){if(h.value){console.log("[WallView] Skipping loadPosts - request already in progress");return}try{h.value=!0,r||(c.value=!0);const $=(y.value-1)*Ze,C=await V.get(`/walls/${m.value.wall_id}/posts?limit=${Ze}&offset=${$}`);if(C!=null&&C.success&&((l=C==null?void 0:C.data)!=null&&l.posts)){const T=C.data.posts;y.value===1?r?te(T):(i.value=T,H()):(i.value=[...i.value,...T],H()),v.value=T.length===Ze,_e()}}catch($){console.error("Error loading posts:",$)}finally{h.value=!1,r||(c.value=!1)}}},te=r=>{const l=new Map(r.map($=>[$.post_id,$]));i.value.forEach(($,C)=>{const T=l.get($.post_id);T&&(Object.assign(i.value[C],T),l.delete($.post_id))}),l.size>0&&(i.value=[...Array.from(l.values()),...i.value])},_e=()=>{const r=i.value.filter(l=>l.post_type==="ai_app"&&(l.ai_status==="queued"||l.ai_status==="processing"));console.log("[WallView] Checking pending AI posts:",r.length),r.forEach(l=>{var $,C;console.log("[WallView] Pending post:",{post_id:l.post_id,ai_status:l.ai_status,ai_job_id:l.ai_job_id,has_content:!!l.ai_content,html_content_length:((C=($=l.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0})}),r.length>0?r.forEach(l=>{l.ai_status==="processing"&&l.ai_job_id&&F(l)}):U()},ke=()=>{y.value++,ee()},ne=()=>{console.log("Create post functionality coming soon")},j=async r=>{console.log("Generation completed for post:",r.post_id),P(r.ai_job_id)},w=(r,l)=>{console.error("Generation failed for post:",r.post_id,l),P(r.ai_job_id);const $=i.value.findIndex(C=>C.post_id===r.post_id);$!==-1&&(i.value[$].ai_status="failed")},F=r=>{if(!r.ai_job_id)return;if(p.has(r.ai_job_id)){console.log("[ContentStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/content`;console.log("[ContentStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);p.set(r.ai_job_id,C),C.addEventListener("content",T=>{var W,oe,ae,le,re,ie;const d=JSON.parse(T.data);console.log("[ContentStream] Received content chunk:",{jobId:r.ai_job_id,contentLength:((W=d.content)==null?void 0:W.length)||0,model:d.model,modalOpen:fe.value,isSelectedPost:((oe=k.value)==null?void 0:oe.post_id)===r.post_id});const L=i.value.findIndex(de=>de.post_id===r.post_id);L!==-1&&(i.value[L].ai_content||(i.value[L].ai_content={}),i.value[L]={...i.value[L],ai_content:{...i.value[L].ai_content,html_content:d.content||"",generation_model:d.model||((ae=i.value[L].ai_content)==null?void 0:ae.generation_model)}},console.log("[ContentStream] Updated post in list, content length:",((le=d.content)==null?void 0:le.length)||0)),((re=k.value)==null?void 0:re.post_id)===r.post_id&&(console.log("[ContentStream] Updating modal content"),k.value={...k.value,ai_content:{...k.value.ai_content,html_content:d.content||""}},console.log("[ContentStream] Modal updated, new content length:",((ie=k.value.ai_content.html_content)==null?void 0:ie.length)||0))}),C.addEventListener("complete",T=>{console.log("[ContentStream] Generation complete"),P(r.ai_job_id);const d=i.value.findIndex(L=>L.post_id===r.post_id);d!==-1&&(i.value[d].ai_status="completed")}),C.addEventListener("error",T=>{console.error("[ContentStream] SSE error for job:",r.ai_job_id),P(r.ai_job_id)}),C.onerror=T=>{console.error("[ContentStream] Connection error:",T),P(r.ai_job_id)}},P=r=>{if(!r)return;const l=p.get(r);l&&(l.close(),p.delete(r),console.log("[ContentStream] Stopped SSE for job:",r))},U=()=>{p.forEach((r,l)=>{r.close(),console.log("[ContentStream] Closed SSE for job:",l)}),p.clear()},Pe=r=>{if(!r.ai_job_id)return;if(S.has(r.ai_job_id)){console.log("[ProgressStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/progress`;console.log("[ProgressStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);S.set(r.ai_job_id,C),C.addEventListener("progress",T=>{var L;const d=JSON.parse(T.data);console.log("[ProgressStream] Received progress update:",d),((L=k.value)==null?void 0:L.post_id)===r.post_id&&(k.value={...k.value,ai_content:{...k.value.ai_content,current_tokens:d.current_tokens||0,tokens_per_second:d.tokens_per_second||0,elapsed_time:d.elapsed_time||0,estimated_remaining:d.estimated_remaining||0,progress_percentage:d.progress||0,content_length:d.content_length||0,chars_per_second:d.chars_per_second||0,input_tokens:d.prompt_tokens||0,output_tokens:d.completion_tokens||0,total_tokens:d.total_tokens||0}})}),C.addEventListener("complete",T=>{var d;console.log("[ProgressStream] Generation complete, reloading data"),ue(r.ai_job_id),((d=k.value)==null?void 0:d.post_id)===r.post_id&&V.get(`/ai/apps/${r.ai_app_id}`).then(L=>{var W;L!=null&&L.success&&((W=L==null?void 0:L.data)!=null&&W.app)&&(k.value={...k.value,ai_status:"completed",ai_content:{...L.data.app,bricks_cost:L.data.app.bricks_cost||0}})}).catch(L=>{console.error("Failed to reload final data:",L)}),ee()}),C.addEventListener("error",T=>{console.error("[ProgressStream] SSE error for job:",r.ai_job_id),ue(r.ai_job_id)}),C.onerror=T=>{console.error("[ProgressStream] Connection error:",T),ue(r.ai_job_id)}},ue=r=>{if(!r)return;const l=S.get(r);l&&(l.close(),S.delete(r),console.log("[ProgressStream] Stopped SSE for job:",r))},Zt=()=>{S.forEach((r,l)=>{r.close(),console.log("[ProgressStream] Closed SSE for job:",l)}),S.clear()},Ee=(r,l)=>r?r.length<=l?r:r.substring(0,l)+"...":"",Ne=r=>{if(!r)return"";const l=r.replace(/<[^>]*>/g,""),$=Ee(l,200);return M.parse($,{async:!1})},k=A(null),fe=A(!1),ut=A(""),Ue=A(!1),se=r=>{ut.value=r,Ue.value=!0,setTimeout(()=>{Ue.value=!1},2e3)},Wt=G(()=>{var l,$;if(!(($=(l=k.value)==null?void 0:l.ai_content)!=null&&$.html_content))return"";let r=String(M.parse(k.value.ai_content.html_content));return r=r.replace(/<hr\s*\/?>/gi,'<hr class="content-divider">'),r=r.replace(/<hr\s+[^>]*>/gi,'<hr class="content-divider">'),r}),dt=G(()=>{var $;if(!(($=k.value)!=null&&$.ai_content))return 0;const r=k.value.ai_content.output_tokens||0,l=k.value.ai_content.generation_time||0;return r>0&&l>0?r/(l/1e3):0}),pt=r=>{if(!(r!=null&&r.ai_content))return 0;if(r.ai_content.tokens_per_second&&r.ai_content.tokens_per_second>0)return r.ai_content.tokens_per_second;const l=r.ai_content.output_tokens||0,$=r.ai_content.generation_time||0;return l>0&&$>0?l/($/1e3):0},we=async r=>{var l,$,C,T,d,L,W,oe,ae,le,re,ie,de,xe;try{if(await ce(r.post_id),r.ai_status==="queued"||r.ai_status==="processing"){console.log("Opening modal for generating post, using post data:",{post_id:r.post_id,ai_job_id:r.ai_job_id,has_content:!!((l=r.ai_content)!=null&&l.html_content),content_length:((C=($=r.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0}),k.value={...r,ai_content:{user_prompt:((T=r.ai_content)==null?void 0:T.user_prompt)||null,html_content:((d=r.ai_content)==null?void 0:d.html_content)||"",css_content:((L=r.ai_content)==null?void 0:L.css_content)||null,js_content:((W=r.ai_content)==null?void 0:W.js_content)||null,generation_model:((oe=r.ai_content)==null?void 0:oe.generation_model)||r.ai_model||null,generation_time:null,input_tokens:0,output_tokens:0,total_tokens:0,bricks_cost:((ae=r.ai_content)==null?void 0:ae.bricks_cost)||0,current_tokens:0,tokens_per_second:0,elapsed_time:0,estimated_remaining:0,progress_percentage:0,content_length:0,chars_per_second:0}},fe.value=!0,document.body.style.overflow="hidden",r.ai_status==="processing"&&r.ai_job_id&&(F(r),Pe(r));return}const B=await V.get(`/ai/apps/${r.ai_app_id}`);B!=null&&B.success&&((le=B==null?void 0:B.data)!=null&&le.app)&&(console.log("AI App Data:",B.data.app),k.value={...r,ai_content:{...B.data.app,bricks_cost:B.data.app.bricks_cost||((re=r.ai_content)==null?void 0:re.bricks_cost)||0,input_tokens:B.data.app.input_tokens||((ie=r.ai_content)==null?void 0:ie.input_tokens)||0,output_tokens:B.data.app.output_tokens||((de=r.ai_content)==null?void 0:de.output_tokens)||0,total_tokens:B.data.app.total_tokens||((xe=r.ai_content)==null?void 0:xe.total_tokens)||0}},fe.value=!0,document.body.style.overflow="hidden")}catch(B){console.error("Error loading AI content:",B),r.ai_content&&(k.value=r,fe.value=!0,document.body.style.overflow="hidden")}},He=()=>{var r;(r=k.value)!=null&&r.ai_job_id&&(P(k.value.ai_job_id),ue(k.value.ai_job_id)),fe.value=!1,k.value=null,document.body.style.overflow=""},Qt=()=>{var T;if(!k.value)return;const r=((T=m.value)==null?void 0:T.wall_id)||n.params.wallId,l=k.value.ai_app_id,C=`${window.location.origin.replace(":3000",":8080")}/wall/${r}?ai=${l}`;navigator.clipboard.writeText(C).then(()=>{console.log("Share link copied to clipboard:",C),se("âœ“ Link copied!")}).catch(d=>{console.error("Failed to copy share link:",d),se("âœ— Failed to copy link")})},Jt=(r,l)=>{navigator.clipboard.writeText(r).then(()=>{console.log(`${l} copied to clipboard`),se(`âœ“ ${l} copied!`)}).catch($=>{console.error("Failed to copy:",$),se("âœ— Failed to copy")})},Xt=async r=>{try{if(r.user_liked){await V.delete(`/posts/${r.post_id}/reactions`),r.user_liked=!1,r.reaction_count=Math.max(0,(r.reaction_count||0)-1);const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!1,i.value[l].reaction_count=Math.max(0,(i.value[l].reaction_count||0)-1))}else{await V.post(`/posts/${r.post_id}/reactions`,{reaction_type:"like"}),r.user_liked=!0,r.reaction_count=(r.reaction_count||0)+1;const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!0,i.value[l].reaction_count=(i.value[l].reaction_count||0)+1)}}catch(l){console.error("Failed to toggle like:",l),se("âœ— Failed to update like")}},ht=r=>{if(k.value){k.value.comment_count=(k.value.comment_count||0)+1;const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}if(r&&r.post_id){const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}se("âœ“ Comment added")},mt=r=>{if(k.value){k.value.comment_count=Math.max(0,(k.value.comment_count||0)-1);const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=Math.max(0,(i.value[l].comment_count||0)-1))}se("âœ“ Comment deleted")},gt=r=>{se("âœ“ Comment updated")};return Ye(async()=>{await O();const r=n.query.ai;if(r){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),We(()=>n.params.wallId,async(r,l)=>{r!==l&&(console.log("[WallView] Route changed, reloading wall:",r),await O())}),We(()=>n.query.ai,async r=>{if(r&&i.value.length>0){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),Et(()=>{U(),Zt(),document.body.style.overflow=""}),(r,l)=>{var $,C,T;return g(),_(he,null,[s("div",po,[a.value?(g(),_("div",ho,[...l[3]||(l[3]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):u.value?(g(),_("div",mo,[l[4]||(l[4]=s("h2",null,"Error Loading Wall",-1)),s("p",null,f(u.value),1),s("button",{onClick:l[0]||(l[0]=d=>r.$router.push("/")),class:"btn-primary"},"Go Home")])):m.value?(g(),_("div",go,[s("div",_o,[s("div",{class:"wall-banner",style:Me(I.value)},null,4),s("div",ko,[s("div",fo,[s("img",{src:m.value.owner_avatar||m.value.avatar_url||"/assets/images/default-avatar.svg",alt:m.value.owner_username||m.value.display_name},null,8,vo)]),s("div",bo,[s("h1",wo,f(m.value.display_name),1),m.value.owner_username?(g(),_("p",xo,"by @"+f(m.value.owner_username),1)):b("",!0),m.value.owner_bio?(g(),_("p",yo,f(m.value.owner_bio),1)):b("",!0)]),s("div",$o,[s("div",So,[s("span",Co,f(m.value.posts_count||0),1),l[5]||(l[5]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",Ro,[s("span",To,f(m.value.subscribers_count||0),1),l[6]||(l[6]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",Io,[l[30]||(l[30]=s("h2",{class:"section-title"},"Posts",-1)),c.value?(g(),_("div",Ao,[...l[7]||(l[7]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):i.value.length===0?(g(),_("div",Po,[l[8]||(l[8]=s("p",null,"No posts yet on this wall.",-1)),E.value?(g(),_("button",{key:0,onClick:ne,class:"btn-primary"},"Create First Post")):b("",!0)])):(g(),_("div",Eo,[(g(!0),_(he,null,je(D.value,d=>{var L,W,oe,ae,le,re,ie,de,xe,B,_t,kt,ft,vt,bt,wt,xt;return g(),_("div",{key:d.post_id,class:ve(["post-card",{"ai-post":d.post_type==="ai_app"}])},[d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),Ce(Un,{key:0,jobId:d.ai_job_id,modelName:d.ai_model,"auto-start":!0,onComplete:Y=>j(d),onError:Y=>w(d,Y)},null,8,["jobId","modelName","onComplete","onError"])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),_("div",Lo,[(L=d.ai_content)!=null&&L.user_prompt?(g(),_("div",zo,[l[9]||(l[9]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(W=d.ai_content)!=null&&W.html_content?(g(),_("div",Mo,[l[10]||(l[10]=s("div",{class:"ai-preview-response"},[s("strong",null,"Generated Response:")],-1)),s("div",{class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,jo)])):b("",!0),d.ai_status==="processing"?(g(),_("button",{key:2,onClick:Y=>we(d),class:"btn-open-ai"},[l[11]||(l[11]=s("span",{class:"icon"},"ðŸ‘ï¸",-1)),s("span",null,f((oe=d.ai_content)!=null&&oe.html_content?"View Full Response":"Watch Generation"),1)],8,qo)):b("",!0)])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Fo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"post-avatar"},null,8,Do),s("div",Bo,[s("span",Go,"@"+f(d.author_username),1),s("span",No,f(X(d.created_at)),1)])])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Uo,[d.content_html?(g(),_("div",{key:0,innerHTML:d.content_html},null,8,Ho)):(g(),_("p",Oo,f(d.content_text),1))])):b("",!0),d.post_type==="ai_app"&&d.ai_status==="completed"?(g(),_("div",Vo,[s("div",Zo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,Wo),s("h4",null,"@"+f(d.author_username),1)]),s("div",Qo,[l[14]||(l[14]=s("div",{class:"info-item status-completed"},[s("strong",null,"Status:"),s("span",{class:"status-badge"},"âœ“ Completed")],-1)),(ae=d.ai_content)!=null&&ae.bricks_cost?(g(),_("div",Jo,[l[12]||(l[12]=s("strong",null,"Bricks spent:",-1)),s("span",Xo,f(d.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),(le=d.ai_content)!=null&&le.generation_model?(g(),_("div",Ko,[l[13]||(l[13]=s("strong",null,"Model:",-1)),s("span",Yo,f(d.ai_content.generation_model),1)])):b("",!0)]),(re=d.ai_content)!=null&&re.generation_time||(ie=d.ai_content)!=null&&ie.total_tokens?(g(),_("div",ea,[(de=d.ai_content)!=null&&de.generation_time?(g(),_("div",ta,[l[15]||(l[15]=s("strong",null,"Time:",-1)),s("span",na,f((d.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),(xe=d.ai_content)!=null&&xe.total_tokens?(g(),_("div",sa,[l[16]||(l[16]=s("strong",null,"Total Tokens:",-1)),s("span",oa,f(d.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),pt(d)>0?(g(),_("div",aa,[l[17]||(l[17]=s("strong",null,"Avg Speed:",-1)),s("span",la,f(pt(d).toFixed(2))+" tok/s",1)])):b("",!0)])):b("",!0),(B=d.ai_content)!=null&&B.user_prompt?(g(),_("div",ra,[l[18]||(l[18]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(_t=d.ai_content)!=null&&_t.html_content?(g(),_("div",ia,[...l[19]||(l[19]=[s("strong",null,"Response:",-1)])])):b("",!0),(kt=d.ai_content)!=null&&kt.html_content?(g(),_("div",{key:3,class:"ai-preview-text",innerHTML:Ne(d.ai_content.html_content)},null,8,ca)):b("",!0),s("button",{onClick:Y=>we(d),class:"btn-open-ai"},[...l[20]||(l[20]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,ua)])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&!d.ai_job_id?(g(),_("div",da,[s("div",pa,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,ha),s("h4",null,"@"+f(d.author_username),1)]),s("div",ma,[s("div",ga,[l[21]||(l[21]=s("strong",null,"Status:",-1)),s("span",_a,f(d.ai_status==="queued"?"â³ Queued":"â³ Processing"),1)]),(ft=d.ai_content)!=null&&ft.generation_model?(g(),_("div",ka,[l[22]||(l[22]=s("strong",null,"Model:",-1)),s("span",fa,f(d.ai_content.generation_model),1)])):b("",!0)]),(vt=d.ai_content)!=null&&vt.user_prompt?(g(),_("div",va,[l[23]||(l[23]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(bt=d.ai_content)!=null&&bt.html_content?(g(),_("div",ba,[...l[24]||(l[24]=[s("strong",null,"Response:",-1)])])):b("",!0),(wt=d.ai_content)!=null&&wt.html_content?(g(),_("div",{key:2,class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,wa)):b("",!0),(xt=d.ai_content)!=null&&xt.html_content?(g(),_("button",{key:3,onClick:Y=>we(d),class:"btn-open-ai"},[...l[25]||(l[25]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,xa)):b("",!0)])):b("",!0),d.media_attachments&&d.media_attachments.length>0?(g(),_("div",ya,[(g(!0),_(he,null,je(d.media_attachments,Y=>(g(),_("img",{key:Y.attachment_id,src:Y.file_url,alt:Y.file_name},null,8,$a))),128))])):b("",!0),s("div",Sa,[s("button",Ca,[l[26]||(l[26]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.reaction_count||0),1)]),s("button",Ra,[l[27]||(l[27]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,f(d.comment_count||0),1)]),s("button",Ta,[l[28]||(l[28]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.view_count||0),1)]),s("button",Ia,[l[29]||(l[29]=s("span",{class:"icon"},"ðŸ“–",-1)),s("span",null,f(d.open_count||0),1)]),s("span",Aa,f(X(d.post_type==="ai_app"?d.updated_at:d.created_at)),1)]),d.post_type!=="ai_app"?(g(),_("div",Pa,[be(St,{"post-id":d.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)],2)}),128))])),v.value&&!c.value?(g(),_("div",Ea,[s("button",{onClick:ke,class:"btn-secondary"},"Load More")])):b("",!0)])])):b("",!0)]),(g(),Ce($t,{to:"body"},[fe.value?(g(),_("div",{key:0,class:"modal-overlay",onClick:zt(He,["self"])},[s("div",La,[s("div",{class:"modal-header"},[l[31]||(l[31]=s("h2",null,"ðŸ¤– AI Response",-1)),s("button",{onClick:He,class:"btn-close"},"Ã—")]),k.value?(g(),_("div",za,[s("div",Ma,[l[32]||(l[32]=s("h3",null,"ðŸ“ Prompt",-1)),s("div",ja,f((($=k.value.ai_content)==null?void 0:$.user_prompt)||"No prompt available"),1)]),(C=k.value.ai_content)!=null&&C.html_content||k.value.ai_status==="processing"?(g(),_("div",qa,[l[34]||(l[34]=s("h3",null,"ðŸ§  Response",-1)),(T=k.value.ai_content)!=null&&T.html_content?(g(),_("div",{key:0,class:ve(["ai-response-content",{"ai-generating":k.value.ai_status==="processing"}]),innerHTML:Wt.value},null,10,Fa)):k.value.ai_status==="processing"?(g(),_("div",Da,[...l[33]||(l[33]=[s("p",{style:{color:"var(--color-text-secondary)","font-style":"italic"}},"Waiting for generation to begin...",-1)])])):b("",!0)])):b("",!0),k.value.ai_content?(g(),_("div",Ba,[l[48]||(l[48]=s("h3",null,"ðŸ“Š Generation Stats",-1)),k.value.ai_status==="processing"?(g(),_("div",Ga,[s("div",Na,[s("div",{class:"progress-bar-fill",style:Me({width:(k.value.ai_content.progress_percentage||0)+"%"})},null,4)]),s("div",Ua,f(k.value.ai_content.progress_percentage||0)+"%",1)])):b("",!0),s("div",Ha,[s("div",Oa,[l[35]||(l[35]=s("span",{class:"stat-label"},"Model:",-1)),s("span",Va,f(k.value.ai_content.generation_model||k.value.ai_model||"Unknown"),1)]),k.value.ai_status==="processing"?(g(),_(he,{key:0},[k.value.ai_content.elapsed_time?(g(),_("div",Za,[l[36]||(l[36]=s("span",{class:"stat-label"},"Elapsed:",-1)),s("span",Wa,f((k.value.ai_content.elapsed_time/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.estimated_remaining?(g(),_("div",Qa,[l[37]||(l[37]=s("span",{class:"stat-label"},"Remaining:",-1)),s("span",Ja,f((k.value.ai_content.estimated_remaining/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.current_tokens?(g(),_("div",Xa,[l[38]||(l[38]=s("span",{class:"stat-label"},"Current Tokens:",-1)),s("span",Ka,f(k.value.ai_content.current_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.tokens_per_second?(g(),_("div",Ya,[l[39]||(l[39]=s("span",{class:"stat-label"},"Speed:",-1)),s("span",el,f(k.value.ai_content.tokens_per_second.toFixed(2))+" tok/s",1)])):b("",!0),k.value.ai_content.content_length?(g(),_("div",tl,[l[40]||(l[40]=s("span",{class:"stat-label"},"Generated:",-1)),s("span",nl,f(k.value.ai_content.content_length.toLocaleString())+" chars",1)])):b("",!0),k.value.ai_content.chars_per_second?(g(),_("div",sl,[l[41]||(l[41]=s("span",{class:"stat-label"},"Char Speed:",-1)),s("span",ol,f(k.value.ai_content.chars_per_second.toFixed(2))+" char/s",1)])):b("",!0)],64)):(g(),_(he,{key:1},[k.value.ai_content.generation_time?(g(),_("div",al,[l[42]||(l[42]=s("span",{class:"stat-label"},"Time:",-1)),s("span",ll,f((k.value.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),k.value.ai_content.bricks_cost?(g(),_("div",rl,[l[43]||(l[43]=s("span",{class:"stat-label"},"Bricks Cost:",-1)),s("span",il,f(k.value.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),k.value.ai_content.input_tokens?(g(),_("div",cl,[l[44]||(l[44]=s("span",{class:"stat-label"},"Input Tokens:",-1)),s("span",ul,f(k.value.ai_content.input_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.output_tokens?(g(),_("div",dl,[l[45]||(l[45]=s("span",{class:"stat-label"},"Output Tokens:",-1)),s("span",pl,f(k.value.ai_content.output_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.total_tokens?(g(),_("div",hl,[l[46]||(l[46]=s("span",{class:"stat-label"},"Total Tokens:",-1)),s("span",ml,f(k.value.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),dt.value>0?(g(),_("div",gl,[l[47]||(l[47]=s("span",{class:"stat-label"},"Avg Speed:",-1)),s("span",_l,f(dt.value.toFixed(2))+" tok/s",1)])):b("",!0)],64))])])):b("",!0),k.value?(g(),_("div",kl,[l[55]||(l[55]=s("h3",null,"ðŸ“Š Post Metrics",-1)),s("div",fl,[s("div",vl,[s("button",{class:"counter-button",onClick:l[1]||(l[1]=d=>Xt(k.value))},[s("span",bl,f(k.value.user_liked?"â¤ï¸":"ðŸ¤"),1),s("span",wl,f(k.value.user_liked?"Liked":"Like"),1),s("span",xl,f(k.value.reaction_count||0),1)])]),s("div",yl,[l[49]||(l[49]=s("span",{class:"counter-icon"},"ðŸ’¬",-1)),l[50]||(l[50]=s("span",{class:"counter-label"},"Comments",-1)),s("span",$l,f(k.value.comment_count||0),1)]),s("div",Sl,[l[51]||(l[51]=s("span",{class:"counter-icon"},"ðŸ‘",-1)),l[52]||(l[52]=s("span",{class:"counter-label"},"Views",-1)),s("span",Cl,f(k.value.view_count||0),1)]),s("div",Rl,[l[53]||(l[53]=s("span",{class:"counter-icon"},"ðŸ“–",-1)),l[54]||(l[54]=s("span",{class:"counter-label"},"Opens",-1)),s("span",Tl,f(k.value.open_count||0),1)])])])):b("",!0),k.value?(g(),_("div",Il,[l[56]||(l[56]=s("h3",null,"ðŸ’¬ Comments",-1)),be(St,{"post-id":k.value.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)])):b("",!0),s("div",Al,[s("div",Pl,[s("button",{onClick:Qt,class:"btn-share"},[...l[57]||(l[57]=[s("span",{class:"icon"},"ðŸ”—",-1),s("span",null,"Share Link",-1)])]),s("button",{onClick:l[2]||(l[2]=d=>Jt(k.value.ai_content.html_content,"Response")),class:"btn-copy"},[...l[58]||(l[58]=[s("span",{class:"icon"},"ðŸ“‹",-1),s("span",null,"Copy",-1)])])]),s("button",{onClick:He,class:"btn-secondary"},"Close")])])])):b("",!0)])),(g(),Ce($t,{to:"body"},[Ue.value?(g(),_("div",El,f(ut.value),1)):b("",!0)]))],64)}}}),Dl=Ie(Ll,[["__scopeId","data-v-f2259925"]]);export{Dl as default};
//# sourceMappingURL=WallView-BpeakDI9.js.map
var Kt=Object.defineProperty;var Yt=(t,e,n)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>Yt(t,typeof e!="symbol"?e+"":e,n);import{f as Te,r as A,b as G,e as Ye,o as Et,g as _,k as s,j as b,n as ve,t as f,W as Me,i as g,s as Lt,v as en,x as tn,D as zt,Y as yt,l as be,F as he,z as je,B as Ce,q as nn,w as We,u as pe,X as sn,y as on,C as $t,A as Oe,p as an}from"./vendor-Bfvy7Eak.js";import{_ as Ie,c as V,u as et}from"./index-D53KQBf3.js";import{R as ln,p as Ve}from"./ReactionPicker-Duy0X_iP.js";import"./utils-Cb2jxgch.js";const rn={class:"ai-generation-progress"},cn={class:"progress-header"},un={class:"status-icon-container"},dn={key:0,class:"spinner"},pn={class:"status-info"},hn={class:"status-subtitle"},mn={key:0,class:"model-name"},gn={class:"model-text"},_n={class:"progress-bar-container"},kn={key:0,class:"progress-text"},fn={key:1,class:"progress-fill-indeterminate"},vn={key:0,class:"stats-grid"},bn={class:"stat-card"},wn={class:"stat-content"},xn={class:"stat-value"},yn={class:"stat-label"},$n={class:"stat-card"},Sn={class:"stat-content"},Cn={class:"stat-value"},Rn={class:"stat-card"},Tn={class:"stat-content"},In={class:"stat-value"},An={key:0,class:"stat-card"},Pn={class:"stat-content"},En={class:"stat-value"},Ln={key:1,class:"completion-stats"},zn={class:"token-breakdown"},Mn={class:"token-item"},jn={class:"token-value"},qn={class:"token-item"},Fn={class:"token-value"},Dn={class:"token-item total"},Bn={class:"token-value"},Gn={key:2,class:"error-message"},Nn=Te({__name:"AIGenerationProgress",props:{jobId:{},autoStart:{type:Boolean},modelName:{}},emits:["complete","error"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=A("queued"),h=A(0),u=A(0),m=A(0),i=A(0),y=A(0),v=A(0),p=A(0),S=A(0),x=A(0),R=A(0),E=A("");let I=null,D=null,Z=0;const H=G(()=>c.value==="processing"),ce=G(()=>{switch(c.value){case"queued":return"â³";case"processing":return"ðŸ¤–";case"completed":return"âœ…";case"failed":return"âŒ";default:return"â“"}}),X=G(()=>`status-${c.value}`),O=G(()=>{switch(c.value){case"queued":return"Generation Queued";case"processing":return"AI is Generating...";case"completed":return"Generation Complete";case"failed":return"Generation Failed";default:return"Unknown Status"}}),ee=G(()=>c.value==="queued"?"Waiting in queue...":c.value==="processing"?x.value===0?"Preparing... Evaluating prompt and loading model":h.value===0&&x.value>0?"Preparing generation...":m.value>0?`Generating at ${m.value.toFixed(1)} tokens/sec (${Math.round(R.value)} chars/sec)`:`Generating content... ${x.value} characters`:"");function te(j){return j.toLocaleString()}function _e(j){const w=Math.floor(j/1e3),F=Math.floor(w/60),P=Math.floor(F/60);return P>0?`${P}h ${F%60}m ${w%60}s`:F>0?`${F}m ${w%60}s`:`${w}s`}function ke(){if(I)return;const w=`/api/v1/ai/generation/${o.jobId}/progress`;console.log("[AIGenerationProgress] Starting SSE connection to:",w),Z=Date.now(),D=window.setInterval(()=>{c.value==="processing"&&(i.value=Date.now()-Z)},100),I=new EventSource(w),I.addEventListener("progress",F=>{console.log("[AIGenerationProgress] Received progress event:",F.data);const P=JSON.parse(F.data);if(c.value=P.status,h.value=P.progress||0,u.value=P.current_tokens||0,m.value=P.tokens_per_second||0,y.value=P.estimated_remaining||0,v.value=P.prompt_tokens||0,p.value=P.completion_tokens||0,S.value=P.total_tokens||0,x.value=P.content_length||0,R.value=P.chars_per_second||0,P.elapsed_time&&c.value==="processing"&&i.value===0){const U=P.elapsed_time;Z=Date.now()-U,i.value=U}}),I.addEventListener("complete",F=>{console.log("[AIGenerationProgress] Generation complete:",F.data);const P=JSON.parse(F.data);c.value="completed",h.value=100,S.value=P.total_tokens||S.value,P.elapsed_time&&(i.value=P.elapsed_time),ne(),a("complete",P)}),I.addEventListener("error",F=>{console.error("[AIGenerationProgress] SSE error event:",F);let P={};try{P=JSON.parse(F.data)}catch{P={error:"Connection error"}}c.value="failed",E.value=P.error||"Unknown error occurred",ne(),a("error",E.value)}),I.onerror=F=>{console.error("[AIGenerationProgress] SSE connection error:",F)}}function ne(){I&&(I.close(),I=null),D&&(clearInterval(D),D=null)}return Ye(()=>{o.autoStart!==!1&&ke()}),Et(()=>{ne()}),e({startTracking:ke,stopTracking:ne}),(j,w)=>(g(),_("div",rn,[s("div",cn,[s("div",un,[c.value==="processing"?(g(),_("div",dn)):(g(),_("span",{key:1,class:ve(["status-icon",X.value])},f(ce.value),3))]),s("div",pn,[s("h3",null,f(O.value),1),s("p",hn,f(ee.value),1),o.modelName?(g(),_("p",mn,[w[0]||(w[0]=s("span",{class:"model-icon"},"ðŸ¤–",-1)),s("span",gn,f(o.modelName),1)])):b("",!0)])]),s("div",_n,[s("div",{class:ve(["progress-bar",{indeterminate:h.value===0&&H.value}])},[h.value>0?(g(),_("div",{key:0,class:ve(["progress-fill",{"progress-pulsing":H.value}]),style:Me({width:h.value+"%"})},[h.value>=8?(g(),_("span",kn,f(h.value)+"%",1)):b("",!0)],6)):H.value?(g(),_("div",fn)):b("",!0)],2)]),H.value||c.value==="completed"?(g(),_("div",vn,[s("div",bn,[w[1]||(w[1]=s("div",{class:"stat-icon"},"ðŸ”¢",-1)),s("div",wn,[s("div",xn,f(te(u.value)),1),s("div",yn,f(u.value===0&&c.value==="processing"?"Evaluating...":"Tokens Generated"),1)])]),s("div",$n,[w[3]||(w[3]=s("div",{class:"stat-icon"},"âš¡",-1)),s("div",Sn,[s("div",Cn,f(m.value>0?m.value.toFixed(1):"â€”"),1),w[2]||(w[2]=s("div",{class:"stat-label"},"Tokens/sec",-1))])]),s("div",Rn,[w[5]||(w[5]=s("div",{class:"stat-icon"},"â±ï¸",-1)),s("div",Tn,[s("div",In,f(_e(i.value)),1),w[4]||(w[4]=s("div",{class:"stat-label"},"Elapsed Time",-1))])]),y.value>0&&H.value?(g(),_("div",An,[w[7]||(w[7]=s("div",{class:"stat-icon"},"â³",-1)),s("div",Pn,[s("div",En,f(_e(y.value)),1),w[6]||(w[6]=s("div",{class:"stat-label"},"Est. Remaining",-1))])])):b("",!0)])):b("",!0),c.value==="completed"&&S.value>0?(g(),_("div",Ln,[w[11]||(w[11]=s("div",{class:"completion-badge"},[s("span",{class:"badge-icon"},"âœ¨"),s("span",{class:"badge-text"},"Generation Complete!")],-1)),s("div",zn,[s("div",Mn,[w[8]||(w[8]=s("span",{class:"token-label"},"Input Tokens:",-1)),s("span",jn,f(te(v.value)),1)]),s("div",qn,[w[9]||(w[9]=s("span",{class:"token-label"},"Output Tokens:",-1)),s("span",Fn,f(te(p.value)),1)]),s("div",Dn,[w[10]||(w[10]=s("span",{class:"token-label"},"Total:",-1)),s("span",Bn,f(te(S.value)),1)])])])):b("",!0),c.value==="failed"&&E.value?(g(),_("div",Gn,[w[12]||(w[12]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",null,f(E.value),1)])):b("",!0)]))}}),Un=Ie(Nn,[["__scopeId","data-v-208e0ab2"]]);function Mt(t){const e=A([]),n=A(!1),o=A(null),a=()=>typeof t=="number"?t:t.value,c=v=>v!=null&&typeof v=="object"&&typeof v.comment_id=="number"&&v.comment_id>0;return{comments:e,loading:n,error:o,loadComments:async(v="newest")=>{try{n.value=!0,o.value=null;let p="created_asc";v==="newest"?p="created_desc":v==="popular"&&(p="reactions");const S=await V.get(`/posts/${a()}/comments`,{params:{sort:p}});console.log("Comments API Response:",S),S&&Array.isArray(S.comments)?(e.value=S.comments.filter(c),console.log("Filtered comments:",e.value)):(console.log("Invalid response format or no comments array found"),e.value=[])}catch(p){o.value=p.message||"Failed to load comments",console.error("Error loading comments:",p),e.value=[]}finally{n.value=!1}},addComment:async v=>{try{const S=(await V.post("/comments",v)).comment;if(c(S)){if(!v.parent_id)e.value.unshift(S);else return S;return S}return null}catch(p){throw o.value=p.message||"Failed to add comment",p}},updateComment:async(v,p)=>{try{const x=(await V.patch(`/comments/${v}`,p)).comment;if(c(x)){const R=e.value.findIndex(E=>E&&E.comment_id===v);return R!==-1&&(e.value[R]={...e.value[R],...x}),x}return null}catch(S){throw o.value=S.message||"Failed to update comment",S}},deleteComment:async v=>{try{await V.delete(`/comments/${v}`),e.value=e.value.filter(p=>p&&p.comment_id!==void 0&&p.comment_id!==v)}catch(p){throw o.value=p.message||"Failed to delete comment",p}},loadReplies:async v=>{try{const p=await V.get(`/posts/${a()}/comments`,{params:{parent_id:v}});return p&&Array.isArray(p.comments)?p.comments.filter(c):[]}catch(p){return o.value=p.message||"Failed to load replies",[]}}}}const Hn={class:"comment-input-container"},On={class:"comment-input-wrapper"},Vn=["src","alt"],Zn={class:"input-area"},Wn=["placeholder","onKeydown"],Qn={class:"input-actions"},Jn=["disabled"],Xn=["disabled"],Kn=Te({__name:"CommentInput",props:{postId:{},parentId:{},placeholder:{},onCancel:{type:Function},initialValue:{}},emits:["submit","cancel"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=et(),h=A(o.initialValue||""),u=A(!1),m=A(null),i=G(()=>{var R;return((R=c.user)==null?void 0:R.avatar_url)||"/assets/images/default-avatar.svg"}),y=G(()=>{var R;return((R=c.user)==null?void 0:R.username)||"User"}),v=()=>{yt(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=`${m.value.scrollHeight}px`)})},p=async()=>{if(!(!h.value.trim()||u.value)){u.value=!0;try{a("submit",h.value.trim()),h.value="",v()}finally{u.value=!1}}},S=()=>{h.value="",v(),o.onCancel&&o.onCancel(),a("cancel")};return e({focus:()=>{yt(()=>{var R;(R=m.value)==null||R.focus()})}}),(R,E)=>(g(),_("div",Hn,[s("div",On,[s("img",{src:i.value,alt:y.value,class:"user-avatar"},null,8,Vn),s("div",Zn,[Lt(s("textarea",{"onUpdate:modelValue":E[0]||(E[0]=I=>h.value=I),ref_key:"textareaRef",ref:m,placeholder:t.placeholder,onKeydown:tn(zt(p,["exact","prevent"]),["enter"]),onInput:v,class:"comment-textarea",rows:"1"},null,40,Wn),[[en,h.value]]),s("div",Qn,[s("button",{onClick:p,disabled:!h.value.trim()||u.value,class:"btn-submit"},f(u.value?"Posting...":"Post"),9,Jn),t.onCancel?(g(),_("button",{key:0,onClick:S,class:"btn-cancel",disabled:u.value}," Cancel ",8,Xn)):b("",!0)])])])]))}}),Qe=Ie(Kn,[["__scopeId","data-v-1796c3c9"]]),Yn={class:"comment-header"},es=["src","alt"],ts={class:"comment-meta"},ns={class:"comment-author"},ss={class:"comment-time"},os={key:0,class:"comment-edited"},as={class:"comment-body"},ls={key:0,class:"comment-edit"},rs={key:1,class:"comment-content"},is=["innerHTML"],cs={key:1},us={key:0,class:"comment-actions"},ds={key:0},ps={key:1,class:"reply-input"},hs={key:2,class:"comment-replies"},ms={key:3,class:"load-replies"},gs={key:4,class:"loading-replies"},_s={key:5,class:"view-full-thread"},ks=Te({__name:"CommentItem",props:{comment:{},postId:{},depth:{},maxDepth:{}},emits:["reply-added","comment-updated","comment-deleted"],setup(t,{emit:e}){const n=t,o=e;n.comment||console.warn("CommentItem: comment prop is required");const a=et(),{addComment:c,updateComment:h,deleteComment:u,loadReplies:m}=Mt(A(n.postId)),i=G(()=>n.depth||0),y=G(()=>n.maxDepth||3),v=A(!1),p=A(!1),S=A(!1),x=A(!1),R=A([]),E=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),I=G(()=>{var j;return n.comment&&((j=a.user)==null?void 0:j.user_id)===n.comment.author_id}),D=G(()=>n.comment&&i.value<y.value),Z=j=>{const w=new Date(j),P=new Date().getTime()-w.getTime(),U=Math.floor(P/6e4),Pe=Math.floor(P/36e5),ue=Math.floor(P/864e5);return U<1?"just now":U<60?`${U}m ago`:Pe<24?`${Pe}h ago`:ue<7?`${ue}d ago`:w.toLocaleDateString()},H=()=>{v.value=!0},ce=()=>{v.value=!1},X=async j=>{try{if(!n.comment)return;const w=await h(n.comment.comment_id,{content_text:j});w&&(v.value=!1,o("comment-updated",w))}catch(w){console.error("Failed to update comment:",w)}},O=async()=>{if(!(!n.comment||!confirm("Delete this comment?")))try{await u(n.comment.comment_id),o("comment-deleted",n.comment.comment_id)}catch(j){console.error("Failed to delete comment:",j)}},ee=()=>{p.value=!p.value},te=async j=>{try{if(!n.comment)return;const w=await c({post_id:n.postId,content_text:j,parent_id:n.comment.comment_id});w&&(p.value=!1,R.value.unshift(w),S.value=!0,o("reply-added",w))}catch(w){console.error("Failed to add reply:",w)}},_e=async()=>{if(n.comment){x.value=!0;try{R.value=await m(n.comment.comment_id),S.value=!0}catch(j){console.error("Failed to load replies:",j)}finally{x.value=!1}}},ke=j=>{o("reply-added",j)},ne=()=>{n.comment&&console.log("View full thread for comment:",n.comment.comment_id)};return(j,w)=>{const F=nn("CommentItem",!0);return t.comment&&t.comment.comment_id?(g(),_("div",{key:0,class:ve(["comment-item",{"is-reply":i.value>0}]),style:Me({marginLeft:`${i.value*40}px`})},[s("div",Yn,[s("img",{src:t.comment.author_avatar||"/assets/images/default-avatar.svg",alt:t.comment.author_username,class:"comment-avatar"},null,8,es),s("div",ts,[s("span",ns,f(t.comment.author_username),1),s("span",ss,f(Z(t.comment.created_at)),1),t.comment.edited_at?(g(),_("span",os,"(edited)")):b("",!0)])]),s("div",as,[v.value?(g(),_("div",ls,[be(Qe,{"post-id":t.comment.post_id,"initial-value":t.comment.content_text,placeholder:"Edit your comment...",onSubmit:X,onCancel:ce},null,8,["post-id","initial-value"])])):(g(),_("div",rs,[t.comment.content_html?(g(),_("div",{key:0,innerHTML:t.comment.content_html},null,8,is)):(g(),_("p",cs,f(t.comment.content_text),1))]))]),v.value?b("",!0):(g(),_("div",us,[be(ln,{"reactable-type":"comment","reactable-id":t.comment.comment_id},null,8,["reactable-id"]),D.value?(g(),_("button",{key:0,onClick:ee,class:"action-btn"},[w[2]||(w[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),w[3]||(w[3]=s("span",null,"Reply",-1)),t.comment.reply_count>0?(g(),_("span",ds,"("+f(t.comment.reply_count)+")",1)):b("",!0)])):b("",!0),E.value?(g(),_("button",{key:1,onClick:H,class:"action-btn"},[...w[4]||(w[4]=[s("span",{class:"icon"},"âœï¸",-1),s("span",null,"Edit",-1)])])):b("",!0),I.value?(g(),_("button",{key:2,onClick:O,class:"action-btn delete"},[...w[5]||(w[5]=[s("span",{class:"icon"},"ðŸ—‘ï¸",-1),s("span",null,"Delete",-1)])])):b("",!0)])),p.value?(g(),_("div",ps,[be(Qe,{"post-id":t.comment.post_id,"parent-id":t.comment.comment_id,placeholder:"Write a reply...",onSubmit:te,onCancel:ee},null,8,["post-id","parent-id"])])):b("",!0),S.value&&R.value.length>0?(g(),_("div",hs,[(g(!0),_(he,null,je(R.value,P=>(g(),Ce(F,{key:P.comment_id,comment:P,"post-id":t.postId,depth:i.value+1,"max-depth":y.value,onReplyAdded:ke,onCommentUpdated:w[0]||(w[0]=U=>j.$emit("comment-updated",U)),onCommentDeleted:w[1]||(w[1]=U=>j.$emit("comment-deleted",U))},null,8,["comment","post-id","depth","max-depth"]))),128))])):b("",!0),t.comment.reply_count>0&&!S.value&&!x.value?(g(),_("div",ms,[s("button",{onClick:_e,class:"btn-load-replies"},[w[6]||(w[6]=s("span",{class:"icon"},"â†³",-1)),s("span",null,"Show "+f(t.comment.reply_count)+" "+f(t.comment.reply_count===1?"reply":"replies"),1)])])):b("",!0),x.value?(g(),_("div",gs,[...w[7]||(w[7]=[s("div",{class:"spinner"},null,-1),s("span",null,"Loading replies...",-1)])])):b("",!0),i.value>=y.value&&t.comment.reply_count>0?(g(),_("div",_s,[s("button",{onClick:ne,class:"btn-view-thread"}," View full thread â†’ ")])):b("",!0)],6)):b("",!0)}}}),fs=Ie(ks,[["__scopeId","data-v-3683cf16"]]),vs={class:"comment-section"},bs={class:"comments-header"},ws={class:"comments-title"},xs={class:"add-comment"},ys={class:"comments-list"},$s={key:0,class:"loading-container"},Ss={key:1,class:"error-container"},Cs={key:2,class:"empty-state"},Rs={key:3,class:"comments"},Ts=Te({__name:"CommentSection",props:{postId:{},maxDepth:{}},emits:["comment-created","comment-deleted","comment-updated"],setup(t,{emit:e}){const n=t,o=e,a=A(n.maxDepth||3),c=A("newest"),{comments:h,loading:u,error:m,loadComments:i,addComment:y}=Mt(A(n.postId)),v=()=>{i(c.value)};We(h,E=>{console.log("Comments updated:",E),console.log("Comments length:",E.length)});const p=async E=>{try{const I=await y({post_id:n.postId,content_text:E});I&&o("comment-created",I)}catch(I){console.error("Failed to add comment:",I)}},S=E=>{o("comment-created",E)},x=E=>{o("comment-updated",E)},R=E=>{o("comment-deleted",E)};return Ye(()=>{i(c.value)}),(E,I)=>(g(),_("div",vs,[s("div",bs,[s("h3",ws,[I[2]||(I[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,"Comments ("+f(pe(h).length)+")",1)]),Lt(s("select",{"onUpdate:modelValue":I[0]||(I[0]=D=>c.value=D),onChange:v,class:"sort-select"},[...I[3]||(I[3]=[s("option",{value:"newest"},"Newest First",-1),s("option",{value:"oldest"},"Oldest First",-1),s("option",{value:"popular"},"Most Popular",-1)])],544),[[sn,c.value]])]),s("div",xs,[be(Qe,{"post-id":t.postId,placeholder:"Add a comment...",onSubmit:p},null,8,["post-id"])]),s("div",ys,[pe(u)?(g(),_("div",$s,[...I[4]||(I[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading comments...",-1)])])):pe(m)?(g(),_("div",Ss,[s("p",null,f(pe(m)),1),s("button",{onClick:I[1]||(I[1]=D=>pe(i)(c.value)),class:"btn-retry"},"Retry")])):pe(h).length===0?(g(),_("div",Cs,[...I[5]||(I[5]=[s("span",{class:"empty-icon"},"ðŸ’¬",-1),s("p",null,"No comments yet",-1),s("p",{class:"empty-hint"},"Be the first to comment!",-1)])])):(g(),_("div",Rs,[(g(!0),_(he,null,je(pe(h),(D,Z)=>(g(),Ce(fs,{key:D.comment_id,comment:D,"post-id":t.postId,depth:0,"max-depth":a.value,onReplyAdded:S,onCommentUpdated:x,onCommentDeleted:R},null,8,["comment","post-id","max-depth"]))),128))]))])]))}}),St=Ie(Ts,[["__scopeId","data-v-76797f32"]]);function tt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ge=tt();function jt(t){ge=t}var Re={exec:()=>null};function z(t,e=""){let n=typeof t=="string"?t:t.source,o={replace:(a,c)=>{let h=typeof c=="string"?c:c.source;return h=h.replace(N.caret,"$1"),n=n.replace(a,h),o},getRegex:()=>new RegExp(n,e)};return o}var N={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Is=/^(?:[ \t]*(?:\n|$))+/,As=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ps=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ae=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Es=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,nt=/(?:[*+-]|\d{1,9}[.)])/,qt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ft=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ls=z(qt).replace(/bull/g,nt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),st=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,zs=/^[^\n]+/,ot=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Ms=z(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ot).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),js=z(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,nt).getRegex(),Be="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",at=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,qs=z("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",at).replace("tag",Be).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dt=z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Fs=z(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dt).getRegex(),lt={blockquote:Fs,code:As,def:Ms,fences:Ps,heading:Es,hr:Ae,html:qs,lheading:Ft,list:js,newline:Is,paragraph:Dt,table:Re,text:zs},Ct=z("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Ds={...lt,lheading:Ls,table:Ct,paragraph:z(st).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ct).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex()},Bs={...lt,html:z(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",at).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Re,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:z(st).replace("hr",Ae).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ft).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gs=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ns=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Bt=/^( {2,}|\\)\n(?!\s*$)/,Us=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ge=/[\p{P}\p{S}]/u,rt=/[\s\p{P}\p{S}]/u,Gt=/[^\s\p{P}\p{S}]/u,Hs=z(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,rt).getRegex(),Nt=/(?!~)[\p{P}\p{S}]/u,Os=/(?!~)[\s\p{P}\p{S}]/u,Vs=/(?:[^\s\p{P}\p{S}]|~)/u,Zs=z(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ut=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ws=z(Ut,"u").replace(/punct/g,Ge).getRegex(),Qs=z(Ut,"u").replace(/punct/g,Nt).getRegex(),Ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Js=z(Ht,"gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Xs=z(Ht,"gu").replace(/notPunctSpace/g,Vs).replace(/punctSpace/g,Os).replace(/punct/g,Nt).getRegex(),Ks=z("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,rt).replace(/punct/g,Ge).getRegex(),Ys=z(/\\(punct)/,"gu").replace(/punct/g,Ge).getRegex(),eo=z(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),to=z(at).replace("(?:-->|$)","-->").getRegex(),no=z("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",to).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),qe=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,so=z(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",qe).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ot=z(/^!?\[(label)\]\[(ref)\]/).replace("label",qe).replace("ref",ot).getRegex(),Vt=z(/^!?\[(ref)\](?:\[\])?/).replace("ref",ot).getRegex(),oo=z("reflink|nolink(?!\\()","g").replace("reflink",Ot).replace("nolink",Vt).getRegex(),Rt=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,it={_backpedal:Re,anyPunctuation:Ys,autolink:eo,blockSkip:Zs,br:Bt,code:Ns,del:Re,emStrongLDelim:Ws,emStrongRDelimAst:Js,emStrongRDelimUnd:Ks,escape:Gs,link:so,nolink:Vt,punctuation:Hs,reflink:Ot,reflinkSearch:oo,tag:no,text:Us,url:Re},ao={...it,link:z(/^!?\[(label)\]\((.*?)\)/).replace("label",qe).getRegex(),reflink:z(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",qe).getRegex()},Je={...it,emStrongRDelimAst:Xs,emStrongLDelim:Qs,url:z(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Rt).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:z(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Rt).getRegex()},lo={...Je,br:z(Bt).replace("{2,}","*").getRegex(),text:z(Je.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Le={normal:lt,gfm:Ds,pedantic:Bs},ye={normal:it,gfm:Je,breaks:lo,pedantic:ao},ro={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tt=t=>ro[t];function K(t,e){if(e){if(N.escapeTest.test(t))return t.replace(N.escapeReplace,Tt)}else if(N.escapeTestNoEncode.test(t))return t.replace(N.escapeReplaceNoEncode,Tt);return t}function It(t){try{t=encodeURI(t).replace(N.percentDecode,"%")}catch{return null}return t}function At(t,e){var c;let n=t.replace(N.findPipe,(h,u,m)=>{let i=!1,y=u;for(;--y>=0&&m[y]==="\\";)i=!i;return i?"|":" |"}),o=n.split(N.splitPipe),a=0;if(o[0].trim()||o.shift(),o.length>0&&!((c=o.at(-1))!=null&&c.trim())&&o.pop(),e)if(o.length>e)o.splice(e);else for(;o.length<e;)o.push("");for(;a<o.length;a++)o[a]=o[a].trim().replace(N.slashPipe,"|");return o}function $e(t,e,n){let o=t.length;if(o===0)return"";let a=0;for(;a<o&&t.charAt(o-a-1)===e;)a++;return t.slice(0,o-a)}function io(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let o=0;o<t.length;o++)if(t[o]==="\\")o++;else if(t[o]===e[0])n++;else if(t[o]===e[1]&&(n--,n<0))return o;return n>0?-2:-1}function Pt(t,e,n,o,a){let c=e.href,h=e.title||null,u=t[1].replace(a.other.outputLinkReplace,"$1");o.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:c,title:h,text:u,tokens:o.inlineTokens(u)};return o.state.inLink=!1,m}function co(t,e,n){let o=t.match(n.other.indentCodeCompensation);if(o===null)return e;let a=o[1];return e.split(`
`).map(c=>{let h=c.match(n.other.beginningSpace);if(h===null)return c;let[u]=h;return u.length>=a.length?c.slice(a.length):c}).join(`
`)}var Fe=class{constructor(t){q(this,"options");q(this,"rules");q(this,"lexer");this.options=t||ge}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:$e(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],o=co(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:o}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let o=$e(n,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(n=o.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:$e(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=$e(e[0],`
`).split(`
`),o="",a="",c=[];for(;n.length>0;){let h=!1,u=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))u.push(n[m]),h=!0;else if(!h)u.push(n[m]);else break;n=n.slice(m);let i=u.join(`
`),y=i.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${i}`:i,a=a?`${a}
${y}`:y;let v=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,c,!0),this.lexer.state.top=v,n.length===0)break;let p=c.at(-1);if((p==null?void 0:p.type)==="code")break;if((p==null?void 0:p.type)==="blockquote"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.blockquote(x);c[c.length-1]=R,o=o.substring(0,o.length-S.raw.length)+R.raw,a=a.substring(0,a.length-S.text.length)+R.text;break}else if((p==null?void 0:p.type)==="list"){let S=p,x=S.raw+`
`+n.join(`
`),R=this.list(x);c[c.length-1]=R,o=o.substring(0,o.length-p.raw.length)+R.raw,a=a.substring(0,a.length-S.raw.length)+R.raw,n=x.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:a}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),o=n.length>1,a={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");let c=this.rules.other.listItemRegex(n),h=!1;for(;t;){let m=!1,i="",y="";if(!(e=c.exec(t))||this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let v=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,I=>" ".repeat(3*I.length)),p=t.split(`
`,1)[0],S=!v.trim(),x=0;if(this.options.pedantic?(x=2,y=v.trimStart()):S?x=e[1].length+1:(x=e[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,y=v.slice(x),x+=e[1].length),S&&this.rules.other.blankLine.test(p)&&(i+=p+`
`,t=t.substring(p.length+1),m=!0),!m){let I=this.rules.other.nextBulletRegex(x),D=this.rules.other.hrRegex(x),Z=this.rules.other.fencesBeginRegex(x),H=this.rules.other.headingBeginRegex(x),ce=this.rules.other.htmlBeginRegex(x);for(;t;){let X=t.split(`
`,1)[0],O;if(p=X,this.options.pedantic?(p=p.replace(this.rules.other.listReplaceNesting,"  "),O=p):O=p.replace(this.rules.other.tabCharGlobal,"    "),Z.test(p)||H.test(p)||ce.test(p)||I.test(p)||D.test(p))break;if(O.search(this.rules.other.nonSpaceChar)>=x||!p.trim())y+=`
`+O.slice(x);else{if(S||v.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Z.test(v)||H.test(v)||D.test(v))break;y+=`
`+p}!S&&!p.trim()&&(S=!0),i+=X+`
`,t=t.substring(X.length+1),v=O.slice(x)}}a.loose||(h?a.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(h=!0));let R=null,E;this.options.gfm&&(R=this.rules.other.listIsTask.exec(y),R&&(E=R[0]!=="[ ] ",y=y.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:i,task:!!R,checked:E,loose:!1,text:y,tokens:[]}),a.raw+=i}let u=a.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let m=0;m<a.items.length;m++)if(this.lexer.state.top=!1,a.items[m].tokens=this.lexer.blockTokens(a.items[m].text,[]),!a.loose){let i=a.items[m].tokens.filter(v=>v.type==="space"),y=i.length>0&&i.some(v=>this.rules.other.anyLine.test(v.raw));a.loose=y}if(a.loose)for(let m=0;m<a.items.length;m++)a.items[m].loose=!0;return a}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:o,title:a}}}table(t){var h;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=At(e[1]),o=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(h=e[3])!=null&&h.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===o.length){for(let u of o)this.rules.other.tableAlignRight.test(u)?c.align.push("right"):this.rules.other.tableAlignCenter.test(u)?c.align.push("center"):this.rules.other.tableAlignLeft.test(u)?c.align.push("left"):c.align.push(null);for(let u=0;u<n.length;u++)c.header.push({text:n[u],tokens:this.lexer.inline(n[u]),header:!0,align:c.align[u]});for(let u of a)c.rows.push(At(u,c.header.length).map((m,i)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:c.align[i]})));return c}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=$e(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=io(e[2],"()");if(c===-2)return;if(c>-1){let h=(e[0].indexOf("!")===0?5:4)+e[1].length+c;e[2]=e[2].substring(0,c),e[0]=e[0].substring(0,h).trim(),e[3]=""}}let o=e[2],a="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],a=c[3])}else a=e[3]?e[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?o=o.slice(1):o=o.slice(1,-1)),Pt(e,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let o=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[o.toLowerCase()];if(!a){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return Pt(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let o=this.rules.inline.emStrongLDelim.exec(t);if(!(!o||o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...o[0]].length-1,c,h,u=a,m=0,i=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(i.lastIndex=0,e=e.slice(-1*t.length+a);(o=i.exec(e))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(h=[...c].length,o[3]||o[4]){u+=h;continue}else if((o[5]||o[6])&&a%3&&!((a+h)%3)){m+=h;continue}if(u-=h,u>0)continue;h=Math.min(h,h+u+m);let y=[...o[0]][0].length,v=t.slice(0,a+o.index+y+h);if(Math.min(a,h)%2){let S=v.slice(1,-1);return{type:"em",raw:v,text:S,tokens:this.lexer.inlineTokens(S)}}let p=v.slice(2,-2);return{type:"strong",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return o&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,o;return e[2]==="@"?(n=e[1],o="mailto:"+n):(n=e[1],o=n),{type:"link",raw:e[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let o,a;if(e[2]==="@")o=e[0],a="mailto:"+o;else{let c;do c=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(c!==e[0]);o=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Q=class Xe{constructor(e){q(this,"tokens");q(this,"options");q(this,"state");q(this,"tokenizer");q(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ge,this.options.tokenizer=this.options.tokenizer||new Fe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:N,block:Le.normal,inline:ye.normal};this.options.pedantic?(n.block=Le.pedantic,n.inline=ye.pedantic):this.options.gfm&&(n.block=Le.gfm,this.options.breaks?n.inline=ye.breaks:n.inline=ye.gfm),this.tokenizer.rules=n}static get rules(){return{block:Le,inline:ye}}static lex(e,n){return new Xe(n).lex(e)}static lexInline(e,n){return new Xe(n).inlineTokens(e)}lex(e){e=e.replace(N.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let o=this.inlineQueue[n];this.inlineTokens(o.src,o.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],o=!1){var a,c,h;for(this.options.pedantic&&(e=e.replace(N.tabCharGlobal,"    ").replace(N.spaceLine,""));e;){let u;if((c=(a=this.options.extensions)==null?void 0:a.block)!=null&&c.some(i=>(u=i.call({lexer:this},e,n))?(e=e.substring(u.raw.length),n.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let i=n.at(-1);u.raw.length===1&&i!==void 0?i.raw+=`
`:n.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},n.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),n.push(u);continue}let m=e;if((h=this.options.extensions)!=null&&h.startBlock){let i=1/0,y=e.slice(1),v;this.options.extensions.startBlock.forEach(p=>{v=p.call({lexer:this},y),typeof v=="number"&&v>=0&&(i=Math.min(i,v))}),i<1/0&&i>=0&&(m=e.substring(0,i+1))}if(this.state.top&&(u=this.tokenizer.paragraph(m))){let i=n.at(-1);o&&(i==null?void 0:i.type)==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u),o=m.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(e){let i="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,m,i,y,v;let o=e,a=null;if(this.tokens.links){let p=Object.keys(this.tokens.links);if(p.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)p.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);o=((m=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:m.call({lexer:this},o))??o;let c=!1,h="";for(;e;){c||(h=""),c=!1;let p;if((y=(i=this.options.extensions)==null?void 0:i.inline)!=null&&y.some(x=>(p=x.call({lexer:this},e,n))?(e=e.substring(p.raw.length),n.push(p),!0):!1))continue;if(p=this.tokenizer.escape(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.tag(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.link(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(p.raw.length);let x=n.at(-1);p.type==="text"&&(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(p=this.tokenizer.emStrong(e,o,h)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.codespan(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.br(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.del(e)){e=e.substring(p.raw.length),n.push(p);continue}if(p=this.tokenizer.autolink(e)){e=e.substring(p.raw.length),n.push(p);continue}if(!this.state.inLink&&(p=this.tokenizer.url(e))){e=e.substring(p.raw.length),n.push(p);continue}let S=e;if((v=this.options.extensions)!=null&&v.startInline){let x=1/0,R=e.slice(1),E;this.options.extensions.startInline.forEach(I=>{E=I.call({lexer:this},R),typeof E=="number"&&E>=0&&(x=Math.min(x,E))}),x<1/0&&x>=0&&(S=e.substring(0,x+1))}if(p=this.tokenizer.inlineText(S)){e=e.substring(p.raw.length),p.raw.slice(-1)!=="_"&&(h=p.raw.slice(-1)),c=!0;let x=n.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=p.raw,x.text+=p.text):n.push(p);continue}if(e){let x="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return n}},De=class{constructor(t){q(this,"options");q(this,"parser");this.options=t||ge}space(t){return""}code({text:t,lang:e,escaped:n}){var c;let o=(c=(e||"").match(N.notSpaceStart))==null?void 0:c[0],a=t.replace(N.endingNewline,"")+`
`;return o?'<pre><code class="language-'+K(o)+'">'+(n?a:K(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:K(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,o="";for(let h=0;h<t.items.length;h++){let u=t.items[h];o+=this.listitem(u)}let a=e?"ol":"ul",c=e&&n!==1?' start="'+n+'"':"";return"<"+a+c+`>
`+o+"</"+a+`>
`}listitem(t){var n;let e="";if(t.task){let o=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=o+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=o+" "+K(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):e+=o+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let o="";for(let a=0;a<t.rows.length;a++){let c=t.rows[a];n="";for(let h=0;h<c.length;h++)n+=this.tablecell(c[h]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+o+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${K(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let o=this.parser.parseInline(n),a=It(t);if(a===null)return o;t=a;let c='<a href="'+t+'"';return e&&(c+=' title="'+K(e)+'"'),c+=">"+o+"</a>",c}image({href:t,title:e,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));let a=It(t);if(a===null)return K(n);t=a;let c=`<img src="${t}" alt="${n}"`;return e&&(c+=` title="${K(e)}"`),c+=">",c}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:K(t.text)}},ct=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},J=class Ke{constructor(e){q(this,"options");q(this,"renderer");q(this,"textRenderer");this.options=e||ge,this.options.renderer=this.options.renderer||new De,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ct}static parse(e,n){return new Ke(n).parse(e)}static parseInline(e,n){return new Ke(n).parseInline(e)}parse(e,n=!0){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=u,y=this.options.extensions.renderers[i.type].call({parser:this},i);if(y!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(i.type)){o+=y||"";continue}}let m=u;switch(m.type){case"space":{o+=this.renderer.space(m);continue}case"hr":{o+=this.renderer.hr(m);continue}case"heading":{o+=this.renderer.heading(m);continue}case"code":{o+=this.renderer.code(m);continue}case"table":{o+=this.renderer.table(m);continue}case"blockquote":{o+=this.renderer.blockquote(m);continue}case"list":{o+=this.renderer.list(m);continue}case"html":{o+=this.renderer.html(m);continue}case"def":{o+=this.renderer.def(m);continue}case"paragraph":{o+=this.renderer.paragraph(m);continue}case"text":{let i=m,y=this.renderer.text(i);for(;h+1<e.length&&e[h+1].type==="text";)i=e[++h],y+=`
`+this.renderer.text(i);n?o+=this.renderer.paragraph({type:"paragraph",raw:y,text:y,tokens:[{type:"text",raw:y,text:y,escaped:!0}]}):o+=y;continue}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}parseInline(e,n=this.renderer){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=this.options.extensions.renderers[u.type].call({parser:this},u);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){o+=i||"";continue}}let m=u;switch(m.type){case"escape":{o+=n.text(m);break}case"html":{o+=n.html(m);break}case"link":{o+=n.link(m);break}case"image":{o+=n.image(m);break}case"strong":{o+=n.strong(m);break}case"em":{o+=n.em(m);break}case"codespan":{o+=n.codespan(m);break}case"br":{o+=n.br(m);break}case"del":{o+=n.del(m);break}case"text":{o+=n.text(m);break}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}},ze,Se=(ze=class{constructor(t){q(this,"options");q(this,"block");this.options=t||ge}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Q.lex:Q.lexInline}provideParser(){return this.block?J.parse:J.parseInline}},q(ze,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),q(ze,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),ze),uo=class{constructor(...t){q(this,"defaults",tt());q(this,"options",this.setOptions);q(this,"parse",this.parseMarkdown(!0));q(this,"parseInline",this.parseMarkdown(!1));q(this,"Parser",J);q(this,"Renderer",De);q(this,"TextRenderer",ct);q(this,"Lexer",Q);q(this,"Tokenizer",Fe);q(this,"Hooks",Se);this.use(...t)}walkTokens(t,e){var o,a;let n=[];for(let c of t)switch(n=n.concat(e.call(this,c)),c.type){case"table":{let h=c;for(let u of h.header)n=n.concat(this.walkTokens(u.tokens,e));for(let u of h.rows)for(let m of u)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let h=c;n=n.concat(this.walkTokens(h.items,e));break}default:{let h=c;(a=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&a[h.type]?this.defaults.extensions.childTokens[h.type].forEach(u=>{let m=h[u].flat(1/0);n=n.concat(this.walkTokens(m,e))}):h.tokens&&(n=n.concat(this.walkTokens(h.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let o={...n};if(o.async=this.defaults.async||o.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let c=e.renderers[a.name];c?e.renderers[a.name]=function(...h){let u=a.renderer.apply(this,h);return u===!1&&(u=c.apply(this,h)),u}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let c=e[a.level];c?c.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),o.extensions=e),n.renderer){let a=this.defaults.renderer||new De(this.defaults);for(let c in n.renderer){if(!(c in a))throw new Error(`renderer '${c}' does not exist`);if(["options","parser"].includes(c))continue;let h=c,u=n.renderer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y||""}}o.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Fe(this.defaults);for(let c in n.tokenizer){if(!(c in a))throw new Error(`tokenizer '${c}' does not exist`);if(["options","rules","lexer"].includes(c))continue;let h=c,u=n.tokenizer[h],m=a[h];a[h]=(...i)=>{let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Se;for(let c in n.hooks){if(!(c in a))throw new Error(`hook '${c}' does not exist`);if(["options","block"].includes(c))continue;let h=c,u=n.hooks[h],m=a[h];Se.passThroughHooks.has(c)?a[h]=i=>{if(this.defaults.async&&Se.passThroughHooksRespectAsync.has(c))return(async()=>{let v=await u.call(a,i);return m.call(a,v)})();let y=u.call(a,i);return m.call(a,y)}:a[h]=(...i)=>{if(this.defaults.async)return(async()=>{let v=await u.apply(a,i);return v===!1&&(v=await m.apply(a,i)),v})();let y=u.apply(a,i);return y===!1&&(y=m.apply(a,i)),y}}o.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,c=n.walkTokens;o.walkTokens=function(h){let u=[];return u.push(c.call(this,h)),a&&(u=u.concat(a.call(this,h))),u}}this.defaults={...this.defaults,...o}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Q.lex(t,e??this.defaults)}parser(t,e){return J.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let o={...n},a={...this.defaults,...o},c=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&o.async===!1)return c(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let h=a.hooks?await a.hooks.preprocess(e):e,u=await(a.hooks?await a.hooks.provideLexer():t?Q.lex:Q.lexInline)(h,a),m=a.hooks?await a.hooks.processAllTokens(u):u;a.walkTokens&&await Promise.all(this.walkTokens(m,a.walkTokens));let i=await(a.hooks?await a.hooks.provideParser():t?J.parse:J.parseInline)(m,a);return a.hooks?await a.hooks.postprocess(i):i})().catch(c);try{a.hooks&&(e=a.hooks.preprocess(e));let h=(a.hooks?a.hooks.provideLexer():t?Q.lex:Q.lexInline)(e,a);a.hooks&&(h=a.hooks.processAllTokens(h)),a.walkTokens&&this.walkTokens(h,a.walkTokens);let u=(a.hooks?a.hooks.provideParser():t?J.parse:J.parseInline)(h,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(h){return c(h)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let o="<p>An error occurred:</p><pre>"+K(n.message+"",!0)+"</pre>";return e?Promise.resolve(o):o}if(e)return Promise.reject(n);throw n}}},me=new uo;function M(t,e){return me.parse(t,e)}M.options=M.setOptions=function(t){return me.setOptions(t),M.defaults=me.defaults,jt(M.defaults),M};M.getDefaults=tt;M.defaults=ge;M.use=function(...t){return me.use(...t),M.defaults=me.defaults,jt(M.defaults),M};M.walkTokens=function(t,e){return me.walkTokens(t,e)};M.parseInline=me.parseInline;M.Parser=J;M.parser=J.parse;M.Renderer=De;M.TextRenderer=ct;M.Lexer=Q;M.lexer=Q.lex;M.Tokenizer=Fe;M.Hooks=Se;M.parse=M;M.options;M.setOptions;M.use;M.walkTokens;M.parseInline;J.parse;Q.lex;const po={class:"wall-view"},ho={key:0,class:"loading-container"},mo={key:1,class:"error-container"},go={key:2,class:"wall-content"},_o={class:"wall-header"},ko={class:"wall-info"},fo={class:"wall-avatar"},vo=["src","alt"],bo={class:"wall-details"},wo={class:"wall-title"},xo={key:0,class:"wall-owner"},yo={key:1,class:"wall-description"},$o={class:"wall-stats"},So={class:"stat"},Co={class:"stat-value"},Ro={class:"stat"},To={class:"stat-value"},Io={class:"posts-section"},Ao={key:0,class:"loading-posts"},Po={key:1,class:"empty-state"},Eo={key:2,class:"posts-grid"},Lo={key:1,class:"ai-content-info"},zo={key:0,class:"ai-preview-prompt"},Mo={key:1},jo=["innerHTML"],qo=["onClick"],Fo={key:2,class:"post-header"},Do=["src","alt"],Bo={class:"post-meta"},Go={class:"post-author"},No={class:"post-time"},Uo={key:3,class:"post-content"},Ho=["innerHTML"],Oo={key:1},Vo={key:4,class:"ai-content-preview"},Zo={class:"ai-preview-header"},Wo=["src","alt"],Qo={class:"ai-generation-info"},Jo={key:0,class:"info-item bricks-spent"},Xo={class:"bricks-amount"},Ko={key:1,class:"info-item model-used"},Yo={class:"model-name"},ea={key:0,class:"ai-generation-stats"},ta={key:0,class:"stat-item"},na={class:"stat-value"},sa={key:1,class:"stat-item"},oa={class:"stat-value"},aa={key:2,class:"stat-item"},la={class:"stat-value"},ra={key:1,class:"ai-preview-prompt"},ia={key:2,class:"ai-preview-response"},ca=["innerHTML"],ua=["onClick"],da={key:5,class:"ai-content-preview"},pa={class:"ai-preview-header"},ha=["src","alt"],ma={class:"ai-generation-info"},ga={class:"info-item status-processing"},_a={class:"status-badge processing"},ka={key:0,class:"info-item model-used"},fa={class:"model-name"},va={key:0,class:"ai-preview-prompt"},ba={key:1,class:"ai-preview-response"},wa=["innerHTML"],xa=["onClick"],ya={key:6,class:"post-media"},$a=["src","alt"],Sa={class:"post-actions"},Ca={class:"action-btn"},Ra={class:"action-btn"},Ta={class:"action-btn"},Ia={class:"action-btn"},Aa={class:"post-time-footer"},Pa={key:7,class:"post-comments"},Ea={key:3,class:"load-more"},La={class:"modal-content ai-modal"},za={key:0,class:"modal-body"},Ma={class:"ai-modal-section"},ja={class:"ai-prompt-full"},qa={key:0,class:"ai-modal-section"},Fa=["innerHTML"],Da={key:1,class:"ai-response-content ai-generating"},Ba={key:1,class:"ai-modal-section ai-stats"},Ga={key:0,class:"generation-progress-bar"},Na={class:"progress-bar-container"},Ua={class:"progress-text"},Ha={class:"stats-grid"},Oa={class:"stat-item"},Va={class:"stat-value"},Za={key:0,class:"stat-item"},Wa={class:"stat-value"},Qa={key:1,class:"stat-item"},Ja={class:"stat-value"},Xa={key:2,class:"stat-item"},Ka={class:"stat-value"},Ya={key:3,class:"stat-item"},el={class:"stat-value"},tl={key:4,class:"stat-item"},nl={class:"stat-value"},sl={key:5,class:"stat-item"},ol={class:"stat-value"},al={key:0,class:"stat-item"},ll={class:"stat-value"},rl={key:1,class:"stat-item"},il={class:"stat-value bricks-value"},cl={key:2,class:"stat-item"},ul={class:"stat-value"},dl={key:3,class:"stat-item"},pl={class:"stat-value"},hl={key:4,class:"stat-item"},ml={class:"stat-value"},gl={key:5,class:"stat-item"},_l={class:"stat-value"},kl={key:2,class:"ai-modal-section"},fl={class:"post-counters"},vl={class:"counter-item"},bl={class:"counter-icon"},wl={class:"counter-label"},xl={class:"counter-value"},yl={class:"counter-item"},$l={class:"counter-value"},Sl={class:"counter-item"},Cl={class:"counter-value"},Rl={class:"counter-item"},Tl={class:"counter-value"},Il={key:3,class:"ai-modal-section"},Al={class:"modal-footer"},Pl={class:"action-buttons-group"},El={key:0,class:"toast-notification"},Ze=20,Ll=Te({__name:"WallView",props:{wallId:{}},setup(t){M.setOptions({breaks:!0,gfm:!0});const e=t;an();const n=on(),o=et(),a=A(!0),c=A(!1),h=A(!1),u=A(null),m=A(null),i=A([]),y=A(1),v=A(!0);let p=new Map,S=new Map;const x=new Set,R=new Set,E=G(()=>m.value&&o.user&&m.value.user_id===o.user.id),I=G(()=>{var r;return(r=m.value)!=null&&r.theme?{backgroundColor:m.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),D=G(()=>i.value.filter(r=>!(r.post_type==="ai_app"&&r.ai_status==="failed"))),Z=async r=>{if(!x.has(r))try{await Ve.incrementViewCount(r),x.add(r),console.log(`View count incremented for post ${r}`)}catch(l){console.error(`Failed to increment view count for post ${r}:`,l)}},H=async()=>{const r=[];if(i.value.forEach(l=>{!R.has(l.post_id)&&!x.has(l.post_id)&&(r.push(l.post_id),R.add(l.post_id))}),r.length>0)try{await Ve.batchIncrementViewCounts(r),r.forEach(l=>x.add(l)),console.log(`Batch view counts incremented for ${r.length} posts`)}catch(l){console.error("Failed to batch increment view counts:",l),r.forEach($=>{R.delete($),Z($)})}},ce=async r=>{try{await Ve.incrementOpenCount(r),console.log(`Open count incremented for post ${r}`)}catch(l){console.error(`Failed to increment open count for post ${r}:`,l)}},X=r=>{const l=new Date(r),C=new Date().getTime()-l.getTime(),T=Math.floor(C/6e4),d=Math.floor(C/36e5),L=Math.floor(C/864e5);return T<1?"just now":T<60?`${T}m ago`:d<24?`${d}h ago`:L<7?`${L}d ago`:l.toLocaleDateString()},O=async()=>{var r,l,$,C;try{a.value=!0,u.value=null;let T=e.wallId||n.params.wallId;if(!T)throw new Error("No wall identifier provided");let d;if(T==="me"?d=await V.get("/walls/me"):d=await V.get(`/walls/${T}`),d!=null&&d.success&&((r=d==null?void 0:d.data)!=null&&r.wall))m.value=d.data.wall,await ee();else throw new Error((d==null?void 0:d.message)||"Wall not found")}catch(T){console.error("Error loading wall:",T),((l=T.response)==null?void 0:l.status)===404?u.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":u.value=((C=($=T.response)==null?void 0:$.data)==null?void 0:C.message)||T.message||"Failed to load wall"}finally{a.value=!1}},ee=async(r=!1)=>{var l;if(m.value){if(h.value){console.log("[WallView] Skipping loadPosts - request already in progress");return}try{h.value=!0,r||(c.value=!0);const $=(y.value-1)*Ze,C=await V.get(`/walls/${m.value.wall_id}/posts?limit=${Ze}&offset=${$}`);if(C!=null&&C.success&&((l=C==null?void 0:C.data)!=null&&l.posts)){const T=C.data.posts;y.value===1?r?te(T):(i.value=T,H()):(i.value=[...i.value,...T],H()),v.value=T.length===Ze,_e()}}catch($){console.error("Error loading posts:",$)}finally{h.value=!1,r||(c.value=!1)}}},te=r=>{const l=new Map(r.map($=>[$.post_id,$]));i.value.forEach(($,C)=>{const T=l.get($.post_id);T&&(Object.assign(i.value[C],T),l.delete($.post_id))}),l.size>0&&(i.value=[...Array.from(l.values()),...i.value])},_e=()=>{const r=i.value.filter(l=>l.post_type==="ai_app"&&(l.ai_status==="queued"||l.ai_status==="processing"));console.log("[WallView] Checking pending AI posts:",r.length),r.forEach(l=>{var $,C;console.log("[WallView] Pending post:",{post_id:l.post_id,ai_status:l.ai_status,ai_job_id:l.ai_job_id,has_content:!!l.ai_content,html_content_length:((C=($=l.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0})}),r.length>0?r.forEach(l=>{l.ai_status==="processing"&&l.ai_job_id&&F(l)}):U()},ke=()=>{y.value++,ee()},ne=()=>{console.log("Create post functionality coming soon")},j=async r=>{console.log("Generation completed for post:",r.post_id),P(r.ai_job_id)},w=(r,l)=>{console.error("Generation failed for post:",r.post_id,l),P(r.ai_job_id);const $=i.value.findIndex(C=>C.post_id===r.post_id);$!==-1&&(i.value[$].ai_status="failed")},F=r=>{if(!r.ai_job_id)return;if(p.has(r.ai_job_id)){console.log("[ContentStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/content`;console.log("[ContentStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);p.set(r.ai_job_id,C),C.addEventListener("content",T=>{var W,oe,ae,le,re,ie;const d=JSON.parse(T.data);console.log("[ContentStream] Received content chunk:",{jobId:r.ai_job_id,contentLength:((W=d.content)==null?void 0:W.length)||0,model:d.model,modalOpen:fe.value,isSelectedPost:((oe=k.value)==null?void 0:oe.post_id)===r.post_id});const L=i.value.findIndex(de=>de.post_id===r.post_id);L!==-1&&(i.value[L].ai_content||(i.value[L].ai_content={}),i.value[L]={...i.value[L],ai_content:{...i.value[L].ai_content,html_content:d.content||"",generation_model:d.model||((ae=i.value[L].ai_content)==null?void 0:ae.generation_model)}},console.log("[ContentStream] Updated post in list, content length:",((le=d.content)==null?void 0:le.length)||0)),((re=k.value)==null?void 0:re.post_id)===r.post_id&&(console.log("[ContentStream] Updating modal content"),k.value={...k.value,ai_content:{...k.value.ai_content,html_content:d.content||""}},console.log("[ContentStream] Modal updated, new content length:",((ie=k.value.ai_content.html_content)==null?void 0:ie.length)||0))}),C.addEventListener("complete",T=>{console.log("[ContentStream] Generation complete"),P(r.ai_job_id);const d=i.value.findIndex(L=>L.post_id===r.post_id);d!==-1&&(i.value[d].ai_status="completed")}),C.addEventListener("error",T=>{console.error("[ContentStream] SSE error for job:",r.ai_job_id),P(r.ai_job_id)}),C.onerror=T=>{console.error("[ContentStream] Connection error:",T),P(r.ai_job_id)}},P=r=>{if(!r)return;const l=p.get(r);l&&(l.close(),p.delete(r),console.log("[ContentStream] Stopped SSE for job:",r))},U=()=>{p.forEach((r,l)=>{r.close(),console.log("[ContentStream] Closed SSE for job:",l)}),p.clear()},Pe=r=>{if(!r.ai_job_id)return;if(S.has(r.ai_job_id)){console.log("[ProgressStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/progress`;console.log("[ProgressStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const C=new EventSource($);S.set(r.ai_job_id,C),C.addEventListener("progress",T=>{var L;const d=JSON.parse(T.data);console.log("[ProgressStream] Received progress update:",d),((L=k.value)==null?void 0:L.post_id)===r.post_id&&(k.value={...k.value,ai_content:{...k.value.ai_content,current_tokens:d.current_tokens||0,tokens_per_second:d.tokens_per_second||0,elapsed_time:d.elapsed_time||0,estimated_remaining:d.estimated_remaining||0,progress_percentage:d.progress||0,content_length:d.content_length||0,chars_per_second:d.chars_per_second||0,input_tokens:d.prompt_tokens||0,output_tokens:d.completion_tokens||0,total_tokens:d.total_tokens||0}})}),C.addEventListener("complete",T=>{var d;console.log("[ProgressStream] Generation complete, reloading data"),ue(r.ai_job_id),((d=k.value)==null?void 0:d.post_id)===r.post_id&&V.get(`/ai/apps/${r.ai_app_id}`).then(L=>{var W;L!=null&&L.success&&((W=L==null?void 0:L.data)!=null&&W.app)&&(k.value={...k.value,ai_status:"completed",ai_content:{...L.data.app,bricks_cost:L.data.app.bricks_cost||0}})}).catch(L=>{console.error("Failed to reload final data:",L)}),ee()}),C.addEventListener("error",T=>{console.error("[ProgressStream] SSE error for job:",r.ai_job_id),ue(r.ai_job_id)}),C.onerror=T=>{console.error("[ProgressStream] Connection error:",T),ue(r.ai_job_id)}},ue=r=>{if(!r)return;const l=S.get(r);l&&(l.close(),S.delete(r),console.log("[ProgressStream] Stopped SSE for job:",r))},Zt=()=>{S.forEach((r,l)=>{r.close(),console.log("[ProgressStream] Closed SSE for job:",l)}),S.clear()},Ee=(r,l)=>r?r.length<=l?r:r.substring(0,l)+"...":"",Ne=r=>{if(!r)return"";const l=r.replace(/<[^>]*>/g,""),$=Ee(l,200);return M.parse($,{async:!1})},k=A(null),fe=A(!1),ut=A(""),Ue=A(!1),se=r=>{ut.value=r,Ue.value=!0,setTimeout(()=>{Ue.value=!1},2e3)},Wt=G(()=>{var l,$;if(!(($=(l=k.value)==null?void 0:l.ai_content)!=null&&$.html_content))return"";let r=String(M.parse(k.value.ai_content.html_content));return r=r.replace(/<hr\s*\/?>/gi,'<hr class="content-divider">'),r=r.replace(/<hr\s+[^>]*>/gi,'<hr class="content-divider">'),r}),dt=G(()=>{var $;if(!(($=k.value)!=null&&$.ai_content))return 0;const r=k.value.ai_content.output_tokens||0,l=k.value.ai_content.generation_time||0;return r>0&&l>0?r/(l/1e3):0}),pt=r=>{if(!(r!=null&&r.ai_content))return 0;if(r.ai_content.tokens_per_second&&r.ai_content.tokens_per_second>0)return r.ai_content.tokens_per_second;const l=r.ai_content.output_tokens||0,$=r.ai_content.generation_time||0;return l>0&&$>0?l/($/1e3):0},we=async r=>{var l,$,C,T,d,L,W,oe,ae,le,re,ie,de,xe;try{if(await ce(r.post_id),r.ai_status==="queued"||r.ai_status==="processing"){console.log("Opening modal for generating post, using post data:",{post_id:r.post_id,ai_job_id:r.ai_job_id,has_content:!!((l=r.ai_content)!=null&&l.html_content),content_length:((C=($=r.ai_content)==null?void 0:$.html_content)==null?void 0:C.length)||0}),k.value={...r,ai_content:{user_prompt:((T=r.ai_content)==null?void 0:T.user_prompt)||null,html_content:((d=r.ai_content)==null?void 0:d.html_content)||"",css_content:((L=r.ai_content)==null?void 0:L.css_content)||null,js_content:((W=r.ai_content)==null?void 0:W.js_content)||null,generation_model:((oe=r.ai_content)==null?void 0:oe.generation_model)||r.ai_model||null,generation_time:null,input_tokens:0,output_tokens:0,total_tokens:0,bricks_cost:((ae=r.ai_content)==null?void 0:ae.bricks_cost)||0,current_tokens:0,tokens_per_second:0,elapsed_time:0,estimated_remaining:0,progress_percentage:0,content_length:0,chars_per_second:0}},fe.value=!0,document.body.style.overflow="hidden",r.ai_status==="processing"&&r.ai_job_id&&(F(r),Pe(r));return}const B=await V.get(`/ai/apps/${r.ai_app_id}`);B!=null&&B.success&&((le=B==null?void 0:B.data)!=null&&le.app)&&(console.log("AI App Data:",B.data.app),k.value={...r,ai_content:{...B.data.app,bricks_cost:B.data.app.bricks_cost||((re=r.ai_content)==null?void 0:re.bricks_cost)||0,input_tokens:B.data.app.input_tokens||((ie=r.ai_content)==null?void 0:ie.input_tokens)||0,output_tokens:B.data.app.output_tokens||((de=r.ai_content)==null?void 0:de.output_tokens)||0,total_tokens:B.data.app.total_tokens||((xe=r.ai_content)==null?void 0:xe.total_tokens)||0}},fe.value=!0,document.body.style.overflow="hidden")}catch(B){console.error("Error loading AI content:",B),r.ai_content&&(k.value=r,fe.value=!0,document.body.style.overflow="hidden")}},He=()=>{var r;(r=k.value)!=null&&r.ai_job_id&&(P(k.value.ai_job_id),ue(k.value.ai_job_id)),fe.value=!1,k.value=null,document.body.style.overflow=""},Qt=()=>{var T;if(!k.value)return;const r=((T=m.value)==null?void 0:T.wall_id)||n.params.wallId,l=k.value.ai_app_id,C=`${window.location.origin.replace(":3000",":8080")}/wall/${r}?ai=${l}`;navigator.clipboard.writeText(C).then(()=>{console.log("Share link copied to clipboard:",C),se("âœ“ Link copied!")}).catch(d=>{console.error("Failed to copy share link:",d),se("âœ— Failed to copy link")})},Jt=(r,l)=>{navigator.clipboard.writeText(r).then(()=>{console.log(`${l} copied to clipboard`),se(`âœ“ ${l} copied!`)}).catch($=>{console.error("Failed to copy:",$),se("âœ— Failed to copy")})},Xt=async r=>{try{if(r.user_liked){await V.delete(`/posts/${r.post_id}/reactions`),r.user_liked=!1,r.reaction_count=Math.max(0,(r.reaction_count||0)-1);const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!1,i.value[l].reaction_count=Math.max(0,(i.value[l].reaction_count||0)-1))}else{await V.post(`/posts/${r.post_id}/reactions`,{reaction_type:"like"}),r.user_liked=!0,r.reaction_count=(r.reaction_count||0)+1;const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!0,i.value[l].reaction_count=(i.value[l].reaction_count||0)+1)}}catch(l){console.error("Failed to toggle like:",l),se("âœ— Failed to update like")}},ht=r=>{if(k.value){k.value.comment_count=(k.value.comment_count||0)+1;const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}if(r&&r.post_id){const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}se("âœ“ Comment added")},mt=r=>{if(k.value){k.value.comment_count=Math.max(0,(k.value.comment_count||0)-1);const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=Math.max(0,(i.value[l].comment_count||0)-1))}se("âœ“ Comment deleted")},gt=r=>{se("âœ“ Comment updated")};return Ye(async()=>{await O();const r=n.query.ai;if(r){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),We(()=>n.params.wallId,async(r,l)=>{r!==l&&(console.log("[WallView] Route changed, reloading wall:",r),await O())}),We(()=>n.query.ai,async r=>{if(r&&i.value.length>0){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await we(l)}}),Et(()=>{U(),Zt(),document.body.style.overflow=""}),(r,l)=>{var $,C,T;return g(),_(he,null,[s("div",po,[a.value?(g(),_("div",ho,[...l[3]||(l[3]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):u.value?(g(),_("div",mo,[l[4]||(l[4]=s("h2",null,"Error Loading Wall",-1)),s("p",null,f(u.value),1),s("button",{onClick:l[0]||(l[0]=d=>r.$router.push("/")),class:"btn-primary"},"Go Home")])):m.value?(g(),_("div",go,[s("div",_o,[s("div",{class:"wall-banner",style:Me(I.value)},null,4),s("div",ko,[s("div",fo,[s("img",{src:m.value.owner_avatar||m.value.avatar_url||"/assets/images/default-avatar.svg",alt:m.value.owner_username||m.value.display_name},null,8,vo)]),s("div",bo,[s("h1",wo,f(m.value.display_name),1),m.value.owner_username?(g(),_("p",xo,"by @"+f(m.value.owner_username),1)):b("",!0),m.value.owner_bio?(g(),_("p",yo,f(m.value.owner_bio),1)):b("",!0)]),s("div",$o,[s("div",So,[s("span",Co,f(m.value.posts_count||0),1),l[5]||(l[5]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",Ro,[s("span",To,f(m.value.subscribers_count||0),1),l[6]||(l[6]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",Io,[l[30]||(l[30]=s("h2",{class:"section-title"},"Posts",-1)),c.value?(g(),_("div",Ao,[...l[7]||(l[7]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):i.value.length===0?(g(),_("div",Po,[l[8]||(l[8]=s("p",null,"No posts yet on this wall.",-1)),E.value?(g(),_("button",{key:0,onClick:ne,class:"btn-primary"},"Create First Post")):b("",!0)])):(g(),_("div",Eo,[(g(!0),_(he,null,je(D.value,d=>{var L,W,oe,ae,le,re,ie,de,xe,B,_t,kt,ft,vt,bt,wt,xt;return g(),_("div",{key:d.post_id,class:ve(["post-card",{"ai-post":d.post_type==="ai_app"}])},[d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),Ce(Un,{key:0,jobId:d.ai_job_id,modelName:d.ai_model,"auto-start":!0,onComplete:Y=>j(d),onError:Y=>w(d,Y)},null,8,["jobId","modelName","onComplete","onError"])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&d.ai_job_id?(g(),_("div",Lo,[(L=d.ai_content)!=null&&L.user_prompt?(g(),_("div",zo,[l[9]||(l[9]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(W=d.ai_content)!=null&&W.html_content?(g(),_("div",Mo,[l[10]||(l[10]=s("div",{class:"ai-preview-response"},[s("strong",null,"Generated Response:")],-1)),s("div",{class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,jo)])):b("",!0),d.ai_status==="processing"?(g(),_("button",{key:2,onClick:Y=>we(d),class:"btn-open-ai"},[l[11]||(l[11]=s("span",{class:"icon"},"ðŸ‘ï¸",-1)),s("span",null,f((oe=d.ai_content)!=null&&oe.html_content?"View Full Response":"Watch Generation"),1)],8,qo)):b("",!0)])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Fo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"post-avatar"},null,8,Do),s("div",Bo,[s("span",Go,"@"+f(d.author_username),1),s("span",No,f(X(d.created_at)),1)])])):b("",!0),d.post_type!=="ai_app"?(g(),_("div",Uo,[d.content_html?(g(),_("div",{key:0,innerHTML:d.content_html},null,8,Ho)):(g(),_("p",Oo,f(d.content_text),1))])):b("",!0),d.post_type==="ai_app"&&d.ai_status==="completed"?(g(),_("div",Vo,[s("div",Zo,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,Wo),s("h4",null,"@"+f(d.author_username),1)]),s("div",Qo,[l[14]||(l[14]=s("div",{class:"info-item status-completed"},[s("strong",null,"Status:"),s("span",{class:"status-badge"},"âœ“ Completed")],-1)),(ae=d.ai_content)!=null&&ae.bricks_cost?(g(),_("div",Jo,[l[12]||(l[12]=s("strong",null,"Bricks spent:",-1)),s("span",Xo,f(d.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),(le=d.ai_content)!=null&&le.generation_model?(g(),_("div",Ko,[l[13]||(l[13]=s("strong",null,"Model:",-1)),s("span",Yo,f(d.ai_content.generation_model),1)])):b("",!0)]),(re=d.ai_content)!=null&&re.generation_time||(ie=d.ai_content)!=null&&ie.total_tokens?(g(),_("div",ea,[(de=d.ai_content)!=null&&de.generation_time?(g(),_("div",ta,[l[15]||(l[15]=s("strong",null,"Time:",-1)),s("span",na,f((d.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),(xe=d.ai_content)!=null&&xe.total_tokens?(g(),_("div",sa,[l[16]||(l[16]=s("strong",null,"Total Tokens:",-1)),s("span",oa,f(d.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),pt(d)>0?(g(),_("div",aa,[l[17]||(l[17]=s("strong",null,"Avg Speed:",-1)),s("span",la,f(pt(d).toFixed(2))+" tok/s",1)])):b("",!0)])):b("",!0),(B=d.ai_content)!=null&&B.user_prompt?(g(),_("div",ra,[l[18]||(l[18]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(_t=d.ai_content)!=null&&_t.html_content?(g(),_("div",ia,[...l[19]||(l[19]=[s("strong",null,"Response:",-1)])])):b("",!0),(kt=d.ai_content)!=null&&kt.html_content?(g(),_("div",{key:3,class:"ai-preview-text",innerHTML:Ne(d.ai_content.html_content)},null,8,ca)):b("",!0),s("button",{onClick:Y=>we(d),class:"btn-open-ai"},[...l[20]||(l[20]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,ua)])):b("",!0),d.post_type==="ai_app"&&(d.ai_status==="queued"||d.ai_status==="processing")&&!d.ai_job_id?(g(),_("div",da,[s("div",pa,[s("img",{src:d.author_avatar||"/assets/images/default-avatar.svg",alt:d.author_username,class:"preview-avatar"},null,8,ha),s("h4",null,"@"+f(d.author_username),1)]),s("div",ma,[s("div",ga,[l[21]||(l[21]=s("strong",null,"Status:",-1)),s("span",_a,f(d.ai_status==="queued"?"â³ Queued":"â³ Processing"),1)]),(ft=d.ai_content)!=null&&ft.generation_model?(g(),_("div",ka,[l[22]||(l[22]=s("strong",null,"Model:",-1)),s("span",fa,f(d.ai_content.generation_model),1)])):b("",!0)]),(vt=d.ai_content)!=null&&vt.user_prompt?(g(),_("div",va,[l[23]||(l[23]=s("strong",null,"Prompt:",-1)),Oe(" "+f(Ee(d.ai_content.user_prompt,150)),1)])):b("",!0),(bt=d.ai_content)!=null&&bt.html_content?(g(),_("div",ba,[...l[24]||(l[24]=[s("strong",null,"Response:",-1)])])):b("",!0),(wt=d.ai_content)!=null&&wt.html_content?(g(),_("div",{key:2,class:"ai-preview-text ai-generating",innerHTML:Ne(d.ai_content.html_content)},null,8,wa)):b("",!0),(xt=d.ai_content)!=null&&xt.html_content?(g(),_("button",{key:3,onClick:Y=>we(d),class:"btn-open-ai"},[...l[25]||(l[25]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,xa)):b("",!0)])):b("",!0),d.media_attachments&&d.media_attachments.length>0?(g(),_("div",ya,[(g(!0),_(he,null,je(d.media_attachments,Y=>(g(),_("img",{key:Y.attachment_id,src:Y.file_url,alt:Y.file_name},null,8,$a))),128))])):b("",!0),s("div",Sa,[s("button",Ca,[l[26]||(l[26]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.reaction_count||0),1)]),s("button",Ra,[l[27]||(l[27]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,f(d.comment_count||0),1)]),s("button",Ta,[l[28]||(l[28]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,f(d.view_count||0),1)]),s("button",Ia,[l[29]||(l[29]=s("span",{class:"icon"},"ðŸ“–",-1)),s("span",null,f(d.open_count||0),1)]),s("span",Aa,f(X(d.post_type==="ai_app"?d.updated_at:d.created_at)),1)]),d.post_type!=="ai_app"?(g(),_("div",Pa,[be(St,{"post-id":d.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)],2)}),128))])),v.value&&!c.value?(g(),_("div",Ea,[s("button",{onClick:ke,class:"btn-secondary"},"Load More")])):b("",!0)])])):b("",!0)]),(g(),Ce($t,{to:"body"},[fe.value?(g(),_("div",{key:0,class:"modal-overlay",onClick:zt(He,["self"])},[s("div",La,[s("div",{class:"modal-header"},[l[31]||(l[31]=s("h2",null,"ðŸ¤– AI Response",-1)),s("button",{onClick:He,class:"btn-close"},"Ã—")]),k.value?(g(),_("div",za,[s("div",Ma,[l[32]||(l[32]=s("h3",null,"ðŸ“ Prompt",-1)),s("div",ja,f((($=k.value.ai_content)==null?void 0:$.user_prompt)||"No prompt available"),1)]),(C=k.value.ai_content)!=null&&C.html_content||k.value.ai_status==="processing"?(g(),_("div",qa,[l[34]||(l[34]=s("h3",null,"ðŸ§  Response",-1)),(T=k.value.ai_content)!=null&&T.html_content?(g(),_("div",{key:0,class:ve(["ai-response-content",{"ai-generating":k.value.ai_status==="processing"}]),innerHTML:Wt.value},null,10,Fa)):k.value.ai_status==="processing"?(g(),_("div",Da,[...l[33]||(l[33]=[s("p",{style:{color:"var(--color-text-secondary)","font-style":"italic"}},"Waiting for generation to begin...",-1)])])):b("",!0)])):b("",!0),k.value.ai_content?(g(),_("div",Ba,[l[48]||(l[48]=s("h3",null,"ðŸ“Š Generation Stats",-1)),k.value.ai_status==="processing"?(g(),_("div",Ga,[s("div",Na,[s("div",{class:"progress-bar-fill",style:Me({width:(k.value.ai_content.progress_percentage||0)+"%"})},null,4)]),s("div",Ua,f(k.value.ai_content.progress_percentage||0)+"%",1)])):b("",!0),s("div",Ha,[s("div",Oa,[l[35]||(l[35]=s("span",{class:"stat-label"},"Model:",-1)),s("span",Va,f(k.value.ai_content.generation_model||k.value.ai_model||"Unknown"),1)]),k.value.ai_status==="processing"?(g(),_(he,{key:0},[k.value.ai_content.elapsed_time?(g(),_("div",Za,[l[36]||(l[36]=s("span",{class:"stat-label"},"Elapsed:",-1)),s("span",Wa,f((k.value.ai_content.elapsed_time/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.estimated_remaining?(g(),_("div",Qa,[l[37]||(l[37]=s("span",{class:"stat-label"},"Remaining:",-1)),s("span",Ja,f((k.value.ai_content.estimated_remaining/1e3).toFixed(1))+"s",1)])):b("",!0),k.value.ai_content.current_tokens?(g(),_("div",Xa,[l[38]||(l[38]=s("span",{class:"stat-label"},"Current Tokens:",-1)),s("span",Ka,f(k.value.ai_content.current_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.tokens_per_second?(g(),_("div",Ya,[l[39]||(l[39]=s("span",{class:"stat-label"},"Speed:",-1)),s("span",el,f(k.value.ai_content.tokens_per_second.toFixed(2))+" tok/s",1)])):b("",!0),k.value.ai_content.content_length?(g(),_("div",tl,[l[40]||(l[40]=s("span",{class:"stat-label"},"Generated:",-1)),s("span",nl,f(k.value.ai_content.content_length.toLocaleString())+" chars",1)])):b("",!0),k.value.ai_content.chars_per_second?(g(),_("div",sl,[l[41]||(l[41]=s("span",{class:"stat-label"},"Char Speed:",-1)),s("span",ol,f(k.value.ai_content.chars_per_second.toFixed(2))+" char/s",1)])):b("",!0)],64)):(g(),_(he,{key:1},[k.value.ai_content.generation_time?(g(),_("div",al,[l[42]||(l[42]=s("span",{class:"stat-label"},"Time:",-1)),s("span",ll,f((k.value.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):b("",!0),k.value.ai_content.bricks_cost?(g(),_("div",rl,[l[43]||(l[43]=s("span",{class:"stat-label"},"Bricks Cost:",-1)),s("span",il,f(k.value.ai_content.bricks_cost)+" ðŸ§±",1)])):b("",!0),k.value.ai_content.input_tokens?(g(),_("div",cl,[l[44]||(l[44]=s("span",{class:"stat-label"},"Input Tokens:",-1)),s("span",ul,f(k.value.ai_content.input_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.output_tokens?(g(),_("div",dl,[l[45]||(l[45]=s("span",{class:"stat-label"},"Output Tokens:",-1)),s("span",pl,f(k.value.ai_content.output_tokens.toLocaleString()),1)])):b("",!0),k.value.ai_content.total_tokens?(g(),_("div",hl,[l[46]||(l[46]=s("span",{class:"stat-label"},"Total Tokens:",-1)),s("span",ml,f(k.value.ai_content.total_tokens.toLocaleString()),1)])):b("",!0),dt.value>0?(g(),_("div",gl,[l[47]||(l[47]=s("span",{class:"stat-label"},"Avg Speed:",-1)),s("span",_l,f(dt.value.toFixed(2))+" tok/s",1)])):b("",!0)],64))])])):b("",!0),k.value?(g(),_("div",kl,[l[55]||(l[55]=s("h3",null,"ðŸ“Š Post Metrics",-1)),s("div",fl,[s("div",vl,[s("button",{class:"counter-button",onClick:l[1]||(l[1]=d=>Xt(k.value))},[s("span",bl,f(k.value.user_liked?"â¤ï¸":"ðŸ¤"),1),s("span",wl,f(k.value.user_liked?"Liked":"Like"),1),s("span",xl,f(k.value.reaction_count||0),1)])]),s("div",yl,[l[49]||(l[49]=s("span",{class:"counter-icon"},"ðŸ’¬",-1)),l[50]||(l[50]=s("span",{class:"counter-label"},"Comments",-1)),s("span",$l,f(k.value.comment_count||0),1)]),s("div",Sl,[l[51]||(l[51]=s("span",{class:"counter-icon"},"ðŸ‘",-1)),l[52]||(l[52]=s("span",{class:"counter-label"},"Views",-1)),s("span",Cl,f(k.value.view_count||0),1)]),s("div",Rl,[l[53]||(l[53]=s("span",{class:"counter-icon"},"ðŸ“–",-1)),l[54]||(l[54]=s("span",{class:"counter-label"},"Opens",-1)),s("span",Tl,f(k.value.open_count||0),1)])])])):b("",!0),k.value?(g(),_("div",Il,[l[56]||(l[56]=s("h3",null,"ðŸ’¬ Comments",-1)),be(St,{"post-id":k.value.post_id,"max-depth":3,onCommentCreated:ht,onCommentDeleted:mt,onCommentUpdated:gt},null,8,["post-id"])])):b("",!0)])):b("",!0),s("div",Al,[s("div",Pl,[s("button",{onClick:Qt,class:"btn-share"},[...l[57]||(l[57]=[s("span",{class:"icon"},"ðŸ”—",-1),s("span",null,"Share Link",-1)])]),s("button",{onClick:l[2]||(l[2]=d=>Jt(k.value.ai_content.html_content,"Response")),class:"btn-copy"},[...l[58]||(l[58]=[s("span",{class:"icon"},"ðŸ“‹",-1),s("span",null,"Copy",-1)])])]),s("button",{onClick:He,class:"btn-secondary"},"Close")])])])):b("",!0)])),(g(),Ce($t,{to:"body"},[Ue.value?(g(),_("div",El,f(ut.value),1)):b("",!0)]))],64)}}}),Dl=Ie(Ll,[["__scopeId","data-v-f2259925"]]);export{Dl as default};
//# sourceMappingURL=WallView-BpeakDI9.js.map
