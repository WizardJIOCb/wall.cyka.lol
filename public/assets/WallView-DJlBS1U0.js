var Kt=Object.defineProperty;var Yt=(t,e,n)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>Yt(t,typeof e!="symbol"?e+"":e,n);import{f as Pe,r as I,b as G,e as tt,o as Et,g as f,k as s,j as v,n as ve,t as y,W as Fe,i as g,s as Lt,v as en,x as tn,D as zt,Y as wt,l as be,F as me,z as De,B as Ae,q as nn,u as he,X as sn,y as on,w as xt,C as $t,A as We,p as an}from"./vendor-Bfvy7Eak.js";import{_ as Ee,c as Z,u as nt}from"./index-ClHu1LSx.js";import{R as ln,p as Qe}from"./ReactionPicker-whVcBkkY.js";import"./utils-Cb2jxgch.js";const rn={class:"ai-generation-progress"},cn={class:"progress-header"},un={class:"status-icon-container"},dn={key:0,class:"spinner"},pn={class:"status-info"},hn={class:"status-subtitle"},mn={key:0,class:"model-name"},_n={class:"model-text"},gn={class:"progress-bar-container"},fn={key:0,class:"progress-text"},kn={key:1,class:"progress-fill-indeterminate"},vn={key:0,class:"stats-grid"},bn={class:"stat-card"},yn={class:"stat-content"},wn={class:"stat-value"},xn={class:"stat-label"},$n={class:"stat-card"},Sn={class:"stat-content"},Cn={class:"stat-value"},Rn={class:"stat-card"},Tn={class:"stat-content"},An={class:"stat-value"},In={key:0,class:"stat-card"},Pn={class:"stat-content"},En={class:"stat-value"},Ln={key:1,class:"completion-stats"},zn={class:"token-breakdown"},jn={class:"token-item"},Mn={class:"token-value"},qn={class:"token-item"},Fn={class:"token-value"},Dn={class:"token-item total"},Bn={class:"token-value"},Gn={key:2,class:"error-message"},Nn=Pe({__name:"AIGenerationProgress",props:{jobId:{},autoStart:{type:Boolean},modelName:{}},emits:["complete","error"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=I("queued"),h=I(0),u=I(0),m=I(0),i=I(0),x=I(0),_=I(0),d=I(0),S=I(0),b=I(0),C=I(0),z=I("");let A=null,D=null,O=0;const H=G(()=>c.value==="processing"),ce=G(()=>{switch(c.value){case"queued":return"â³";case"processing":return"ðŸ¤–";case"completed":return"âœ…";case"failed":return"âŒ";default:return"â“"}}),X=G(()=>`status-${c.value}`),V=G(()=>{switch(c.value){case"queued":return"Generation Queued";case"processing":return"AI is Generating...";case"completed":return"Generation Complete";case"failed":return"Generation Failed";default:return"Unknown Status"}}),ee=G(()=>c.value==="queued"?"Waiting in queue...":c.value==="processing"?b.value===0?"Preparing... Evaluating prompt and loading model":h.value===0&&b.value>0?"Preparing generation...":m.value>0?`Generating at ${m.value.toFixed(1)} tokens/sec (${Math.round(C.value)} chars/sec)`:`Generating content... ${b.value} characters`:"");function te(M){return M.toLocaleString()}function fe(M){const w=Math.floor(M/1e3),B=Math.floor(w/60),P=Math.floor(B/60);return P>0?`${P}h ${B%60}m ${w%60}s`:B>0?`${B}m ${w%60}s`:`${w}s`}function ke(){if(A)return;const w=`/api/v1/ai/generation/${o.jobId}/progress`;console.log("[AIGenerationProgress] Starting SSE connection to:",w),O=Date.now(),D=window.setInterval(()=>{c.value==="processing"&&(i.value=Date.now()-O)},100),A=new EventSource(w),A.addEventListener("progress",B=>{console.log("[AIGenerationProgress] Received progress event:",B.data);const P=JSON.parse(B.data);if(c.value=P.status,h.value=P.progress||0,u.value=P.current_tokens||0,m.value=P.tokens_per_second||0,x.value=P.estimated_remaining||0,_.value=P.prompt_tokens||0,d.value=P.completion_tokens||0,S.value=P.total_tokens||0,b.value=P.content_length||0,C.value=P.chars_per_second||0,P.elapsed_time&&c.value==="processing"&&i.value===0){const U=P.elapsed_time;O=Date.now()-U,i.value=U}}),A.addEventListener("complete",B=>{console.log("[AIGenerationProgress] Generation complete:",B.data);const P=JSON.parse(B.data);c.value="completed",h.value=100,S.value=P.total_tokens||S.value,P.elapsed_time&&(i.value=P.elapsed_time),ne(),a("complete",P)}),A.addEventListener("error",B=>{console.error("[AIGenerationProgress] SSE error event:",B);let P={};try{P=JSON.parse(B.data)}catch{P={error:"Connection error"}}c.value="failed",z.value=P.error||"Unknown error occurred",ne(),a("error",z.value)}),A.onerror=B=>{console.error("[AIGenerationProgress] SSE connection error:",B)}}function ne(){A&&(A.close(),A=null),D&&(clearInterval(D),D=null)}return tt(()=>{o.autoStart!==!1&&ke()}),Et(()=>{ne()}),e({startTracking:ke,stopTracking:ne}),(M,w)=>(g(),f("div",rn,[s("div",cn,[s("div",un,[c.value==="processing"?(g(),f("div",dn)):(g(),f("span",{key:1,class:ve(["status-icon",X.value])},y(ce.value),3))]),s("div",pn,[s("h3",null,y(V.value),1),s("p",hn,y(ee.value),1),o.modelName?(g(),f("p",mn,[w[0]||(w[0]=s("span",{class:"model-icon"},"ðŸ¤–",-1)),s("span",_n,y(o.modelName),1)])):v("",!0)])]),s("div",gn,[s("div",{class:ve(["progress-bar",{indeterminate:h.value===0&&H.value}])},[h.value>0?(g(),f("div",{key:0,class:ve(["progress-fill",{"progress-pulsing":H.value}]),style:Fe({width:h.value+"%"})},[h.value>=8?(g(),f("span",fn,y(h.value)+"%",1)):v("",!0)],6)):H.value?(g(),f("div",kn)):v("",!0)],2)]),H.value||c.value==="completed"?(g(),f("div",vn,[s("div",bn,[w[1]||(w[1]=s("div",{class:"stat-icon"},"ðŸ”¢",-1)),s("div",yn,[s("div",wn,y(te(u.value)),1),s("div",xn,y(u.value===0&&c.value==="processing"?"Evaluating...":"Tokens Generated"),1)])]),s("div",$n,[w[3]||(w[3]=s("div",{class:"stat-icon"},"âš¡",-1)),s("div",Sn,[s("div",Cn,y(m.value>0?m.value.toFixed(1):"â€”"),1),w[2]||(w[2]=s("div",{class:"stat-label"},"Tokens/sec",-1))])]),s("div",Rn,[w[5]||(w[5]=s("div",{class:"stat-icon"},"â±ï¸",-1)),s("div",Tn,[s("div",An,y(fe(i.value)),1),w[4]||(w[4]=s("div",{class:"stat-label"},"Elapsed Time",-1))])]),x.value>0&&H.value?(g(),f("div",In,[w[7]||(w[7]=s("div",{class:"stat-icon"},"â³",-1)),s("div",Pn,[s("div",En,y(fe(x.value)),1),w[6]||(w[6]=s("div",{class:"stat-label"},"Est. Remaining",-1))])])):v("",!0)])):v("",!0),c.value==="completed"&&S.value>0?(g(),f("div",Ln,[w[11]||(w[11]=s("div",{class:"completion-badge"},[s("span",{class:"badge-icon"},"âœ¨"),s("span",{class:"badge-text"},"Generation Complete!")],-1)),s("div",zn,[s("div",jn,[w[8]||(w[8]=s("span",{class:"token-label"},"Input Tokens:",-1)),s("span",Mn,y(te(_.value)),1)]),s("div",qn,[w[9]||(w[9]=s("span",{class:"token-label"},"Output Tokens:",-1)),s("span",Fn,y(te(d.value)),1)]),s("div",Dn,[w[10]||(w[10]=s("span",{class:"token-label"},"Total:",-1)),s("span",Bn,y(te(S.value)),1)])])])):v("",!0),c.value==="failed"&&z.value?(g(),f("div",Gn,[w[12]||(w[12]=s("span",{class:"error-icon"},"âš ï¸",-1)),s("span",null,y(z.value),1)])):v("",!0)]))}}),Un=Ee(Nn,[["__scopeId","data-v-208e0ab2"]]);function jt(t){const e=I([]),n=I(!1),o=I(null),a=()=>typeof t=="number"?t:t.value,c=_=>{if(_==null||typeof _!="object")return!1;const d=_.comment_id||_.id||_._id;if(d===void 0)return _.content_text&&_.author_username;if(typeof d!="number"){const C=Number(d);if(isNaN(C)||C<=0)return!1}return!(["comment_id","post_id","author_id","author_username","author_name","content_text","content_html","depth_level","reply_count","reaction_count","like_count","dislike_count","is_edited","is_hidden","created_at","updated_at"].filter(C=>!(C in _)).length>0||typeof _.comment_id!="number"||_.comment_id<=0||typeof _.post_id!="number"||_.post_id<=0||typeof _.author_id!="number"||_.author_id<=0||typeof _.author_username!="string"||!_.author_username||typeof _.author_name!="string"||!_.author_name||typeof _.content_text!="string"||typeof _.content_html!="string"||typeof _.depth_level!="number"||typeof _.reply_count!="number"||typeof _.reaction_count!="number"||typeof _.like_count!="number"||typeof _.dislike_count!="number"||typeof _.is_edited!="boolean"||typeof _.is_hidden!="boolean"||typeof _.created_at!="string"||!_.created_at||typeof _.updated_at!="string"||!_.updated_at||_.parent_comment_id!==void 0&&_.parent_comment_id!==null&&typeof _.parent_comment_id!="number"||_.author_avatar!==void 0&&_.author_avatar!==null&&typeof _.author_avatar!="string"||_.user_reaction!==void 0&&_.user_reaction!==null&&typeof _.user_reaction!="string")};return{comments:e,loading:n,error:o,loadComments:async(_="newest")=>{try{n.value=!0,o.value=null;let d="created_asc";_==="newest"?d="created_desc":_==="popular"&&(d="reactions"),console.log("Making API request for comments with postId:",a());const S=await Z.get(`/posts/${a()}/comments`,{params:{sort:d}});let b=[];if(S&&typeof S=="object"&&("comments"in S&&Array.isArray(S.comments)?b=S.comments:Array.isArray(S)&&(b=S)),Array.isArray(b)){const C=b.filter(c);e.value=C}else e.value=[]}catch(d){o.value=d.message||"Failed to load comments",console.error("Error loading comments:",d),e.value=[]}finally{n.value=!1}},addComment:async _=>{try{const S=(await Z.post("/comments",_)).comment;if(c(S)){if(!_.parent_id)e.value.unshift(S);else return S;return S}return null}catch(d){throw o.value=d.message||"Failed to add comment",d}},updateComment:async(_,d)=>{try{const b=(await Z.patch(`/comments/${_}`,d)).comment;if(c(b)){const C=e.value.findIndex(z=>z&&z.comment_id===_);return C!==-1&&(e.value[C]={...e.value[C],...b}),b}return null}catch(S){throw o.value=S.message||"Failed to update comment",S}},deleteComment:async _=>{try{await Z.delete(`/comments/${_}`),e.value=e.value.filter(d=>d&&d.comment_id!==_)}catch(d){throw o.value=d.message||"Failed to delete comment",d}},loadReplies:async _=>{try{const d=await Z.get(`/posts/${a()}/comments`,{params:{parent_id:_}});return d&&Array.isArray(d.comments)?d.comments.filter(c):[]}catch(d){return o.value=d.message||"Failed to load replies",[]}}}}const Hn={class:"comment-input-container"},On={class:"comment-input-wrapper"},Vn=["src","alt"],Zn={class:"input-area"},Wn=["placeholder","onKeydown"],Qn={class:"input-actions"},Jn=["disabled"],Xn=["disabled"],Kn=Pe({__name:"CommentInput",props:{postId:{},parentId:{},placeholder:{},onCancel:{type:Function},initialValue:{}},emits:["submit","cancel"],setup(t,{expose:e,emit:n}){const o=t,a=n,c=nt(),h=I(o.initialValue||""),u=I(!1),m=I(null),i=G(()=>{var C;return((C=c.user)==null?void 0:C.avatar_url)||"/assets/images/default-avatar.svg"}),x=G(()=>{var C;return((C=c.user)==null?void 0:C.username)||"User"}),_=()=>{wt(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=`${m.value.scrollHeight}px`)})},d=async()=>{if(!(!h.value.trim()||u.value)){u.value=!0;try{a("submit",h.value.trim()),h.value="",_()}finally{u.value=!1}}},S=()=>{h.value="",_(),o.onCancel&&o.onCancel(),a("cancel")};return e({focus:()=>{wt(()=>{var C;(C=m.value)==null||C.focus()})}}),(C,z)=>(g(),f("div",Hn,[s("div",On,[s("img",{src:i.value,alt:x.value,class:"user-avatar"},null,8,Vn),s("div",Zn,[Lt(s("textarea",{"onUpdate:modelValue":z[0]||(z[0]=A=>h.value=A),ref_key:"textareaRef",ref:m,placeholder:t.placeholder,onKeydown:tn(zt(d,["exact","prevent"]),["enter"]),onInput:_,class:"comment-textarea",rows:"1"},null,40,Wn),[[en,h.value]]),s("div",Qn,[s("button",{onClick:d,disabled:!h.value.trim()||u.value,class:"btn-submit"},y(u.value?"Posting...":"Post"),9,Jn),t.onCancel?(g(),f("button",{key:0,onClick:S,class:"btn-cancel",disabled:u.value}," Cancel ",8,Xn)):v("",!0)])])])]))}}),Xe=Ee(Kn,[["__scopeId","data-v-1796c3c9"]]),Yn={class:"comment-header"},es=["src","alt"],ts={class:"comment-meta"},ns={class:"comment-author"},ss={class:"comment-time"},os={key:0,class:"comment-edited"},as={class:"comment-body"},ls={key:0,class:"comment-edit"},rs={key:1,class:"comment-content"},is=["innerHTML"],cs={key:1},us={key:0,class:"comment-actions"},ds={key:0},ps={key:1,class:"reply-input"},hs={key:2,class:"comment-replies"},ms={key:3,class:"load-replies"},_s={key:4,class:"loading-replies"},gs={key:5,class:"view-full-thread"},fs=Pe({__name:"CommentItem",props:{comment:{},postId:{},depth:{},maxDepth:{}},emits:["reply-added","comment-updated","comment-deleted"],setup(t,{emit:e}){const n=t,o=e;n.comment?(console.log("Rendering CommentItem with comment:",n.comment),console.log("Comment ID:",n.comment.comment_id,"Type:",typeof n.comment.comment_id),console.log("Comment validation:",n.comment&&n.comment.comment_id)):console.warn("CommentItem: comment prop is required");const a=nt(),{addComment:c,updateComment:h,deleteComment:u,loadReplies:m}=jt(I(n.postId)),i=G(()=>n.depth||0),x=G(()=>n.maxDepth||3),_=I(!1),d=I(!1),S=I(!1),b=I(!1),C=I([]),z=G(()=>{var M;return n.comment&&((M=a.user)==null?void 0:M.id)===n.comment.author_id}),A=G(()=>{var M;return n.comment&&((M=a.user)==null?void 0:M.id)===n.comment.author_id}),D=G(()=>n.comment&&i.value<x.value),O=M=>{const w=new Date(M),P=new Date().getTime()-w.getTime(),U=Math.floor(P/6e4),ze=Math.floor(P/36e5),ue=Math.floor(P/864e5);return U<1?"just now":U<60?`${U}m ago`:ze<24?`${ze}h ago`:ue<7?`${ue}d ago`:w.toLocaleDateString()},H=()=>{_.value=!0},ce=()=>{_.value=!1},X=async M=>{try{if(!n.comment)return;const w=await h(n.comment.comment_id,{content_text:M});w&&(_.value=!1,o("comment-updated",w))}catch(w){console.error("Failed to update comment:",w)}},V=async()=>{if(!(!n.comment||!confirm("Delete this comment?")))try{await u(n.comment.comment_id),o("comment-deleted",n.comment.comment_id)}catch(M){console.error("Failed to delete comment:",M)}},ee=()=>{d.value=!d.value},te=async M=>{try{if(!n.comment)return;const w=await c({post_id:n.postId,content_text:M,parent_id:n.comment.comment_id});w&&(d.value=!1,C.value.unshift(w),S.value=!0,o("reply-added",w))}catch(w){console.error("Failed to add reply:",w)}},fe=async()=>{if(n.comment){b.value=!0;try{C.value=await m(n.comment.comment_id),S.value=!0}catch(M){console.error("Failed to load replies:",M)}finally{b.value=!1}}},ke=M=>{o("reply-added",M)},ne=()=>{n.comment&&console.log("View full thread for comment:",n.comment.comment_id)};return(M,w)=>{const B=nn("CommentItem",!0);return t.comment&&t.comment.comment_id?(g(),f("div",{key:0,class:ve(["comment-item",{"is-reply":i.value>0}]),style:Fe({marginLeft:`${i.value*40}px`})},[s("div",Yn,[s("img",{src:t.comment.author_avatar||"/assets/images/default-avatar.svg",alt:t.comment.author_username,class:"comment-avatar"},null,8,es),s("div",ts,[s("span",ns,y(t.comment.author_username),1),s("span",ss,y(O(t.comment.created_at)),1),t.comment.edited_at?(g(),f("span",os,"(edited)")):v("",!0)])]),s("div",as,[_.value?(g(),f("div",ls,[be(Xe,{"post-id":t.comment.post_id,"initial-value":t.comment.content_text,placeholder:"Edit your comment...",onSubmit:X,onCancel:ce},null,8,["post-id","initial-value"])])):(g(),f("div",rs,[t.comment.content_html?(g(),f("div",{key:0,innerHTML:t.comment.content_html},null,8,is)):(g(),f("p",cs,y(t.comment.content_text),1))]))]),_.value?v("",!0):(g(),f("div",us,[be(ln,{"reactable-type":"comment","reactable-id":t.comment.comment_id},null,8,["reactable-id"]),D.value?(g(),f("button",{key:0,onClick:ee,class:"action-btn"},[w[2]||(w[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),w[3]||(w[3]=s("span",null,"Reply",-1)),t.comment.reply_count>0?(g(),f("span",ds,"("+y(t.comment.reply_count)+")",1)):v("",!0)])):v("",!0),z.value?(g(),f("button",{key:1,onClick:H,class:"action-btn"},[...w[4]||(w[4]=[s("span",{class:"icon"},"âœï¸",-1),s("span",null,"Edit",-1)])])):v("",!0),A.value?(g(),f("button",{key:2,onClick:V,class:"action-btn delete"},[...w[5]||(w[5]=[s("span",{class:"icon"},"ðŸ—‘ï¸",-1),s("span",null,"Delete",-1)])])):v("",!0)])),d.value?(g(),f("div",ps,[be(Xe,{"post-id":t.comment.post_id,"parent-id":t.comment.comment_id,placeholder:"Write a reply...",onSubmit:te,onCancel:ee},null,8,["post-id","parent-id"])])):v("",!0),S.value&&C.value.length>0?(g(),f("div",hs,[(g(!0),f(me,null,De(C.value,P=>(g(),Ae(B,{key:P.comment_id,comment:P,"post-id":t.postId,depth:i.value+1,"max-depth":x.value,onReplyAdded:ke,onCommentUpdated:w[0]||(w[0]=U=>M.$emit("comment-updated",U)),onCommentDeleted:w[1]||(w[1]=U=>M.$emit("comment-deleted",U))},null,8,["comment","post-id","depth","max-depth"]))),128))])):v("",!0),t.comment.reply_count>0&&!S.value&&!b.value?(g(),f("div",ms,[s("button",{onClick:fe,class:"btn-load-replies"},[w[6]||(w[6]=s("span",{class:"icon"},"â†³",-1)),s("span",null,"Show "+y(t.comment.reply_count)+" "+y(t.comment.reply_count===1?"reply":"replies"),1)])])):v("",!0),b.value?(g(),f("div",_s,[...w[7]||(w[7]=[s("div",{class:"spinner"},null,-1),s("span",null,"Loading replies...",-1)])])):v("",!0),i.value>=x.value&&t.comment.reply_count>0?(g(),f("div",gs,[s("button",{onClick:ne,class:"btn-view-thread"}," View full thread â†’ ")])):v("",!0)],6)):v("",!0)}}}),ks=Ee(fs,[["__scopeId","data-v-6b5c39e9"]]),vs={class:"comment-section"},bs={class:"comments-header"},ys={class:"comments-title"},ws={class:"add-comment"},xs={class:"comments-list"},$s={key:0,class:"loading-container"},Ss={key:1,class:"error-container"},Cs={key:2,class:"comments"},Rs={key:0,class:"empty-state"},Ts=Pe({__name:"CommentSection",props:{postId:{},maxDepth:{}},emits:["comment-created","comment-deleted","comment-updated"],setup(t,{emit:e}){const n=t,o=e,a=I(n.maxDepth||3),c=I("newest"),{comments:h,loading:u,error:m,loadComments:i,addComment:x}=jt(I(n.postId)),_=()=>{i(c.value)},d=async z=>{try{const A=await x({post_id:n.postId,content_text:z});A&&o("comment-created",A)}catch(A){console.error("Failed to add comment:",A)}},S=z=>{o("comment-created",z)},b=z=>{o("comment-updated",z)},C=z=>{o("comment-deleted",z)};return tt(()=>{i(c.value)}),(z,A)=>(g(),f("div",vs,[s("div",bs,[s("h3",ys,[A[2]||(A[2]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,"Comments ("+y(he(h).length)+")",1)]),Lt(s("select",{"onUpdate:modelValue":A[0]||(A[0]=D=>c.value=D),onChange:_,class:"sort-select"},[...A[3]||(A[3]=[s("option",{value:"newest"},"Newest First",-1),s("option",{value:"oldest"},"Oldest First",-1),s("option",{value:"popular"},"Most Popular",-1)])],544),[[sn,c.value]])]),s("div",ws,[be(Xe,{"post-id":t.postId,placeholder:"Add a comment...",onSubmit:d},null,8,["post-id"])]),s("div",xs,[he(u)?(g(),f("div",$s,[...A[4]||(A[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading comments...",-1)])])):he(m)?(g(),f("div",Ss,[s("p",null,y(he(m)),1),s("button",{onClick:A[1]||(A[1]=D=>he(i)(c.value)),class:"btn-retry"},"Retry")])):(g(),f("div",Cs,[(g(!0),f(me,null,De(he(h),(D,O)=>(g(),f("div",{key:D.comment_id||D.id||O},[D&&(D.comment_id||D.id)?(g(),Ae(ks,{key:0,comment:D,"post-id":t.postId,depth:0,"max-depth":a.value,onReplyAdded:S,onCommentUpdated:b,onCommentDeleted:C},null,8,["comment","post-id","max-depth"])):v("",!0)]))),128)),he(h).length===0?(g(),f("div",Rs,[...A[5]||(A[5]=[s("span",{class:"empty-icon"},"ðŸ’¬",-1),s("p",null,"No valid comments to display",-1),s("p",{class:"empty-hint"},"Be the first to comment on this post!",-1)])])):v("",!0)]))])]))}}),St=Ee(Ts,[["__scopeId","data-v-00e45262"]]);function st(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ge=st();function Mt(t){ge=t}var Ie={exec:()=>null};function L(t,e=""){let n=typeof t=="string"?t:t.source,o={replace:(a,c)=>{let h=typeof c=="string"?c:c.source;return h=h.replace(N.caret,"$1"),n=n.replace(a,h),o},getRegex:()=>new RegExp(n,e)};return o}var N={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},As=/^(?:[ \t]*(?:\n|$))+/,Is=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ps=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Le=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Es=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ot=/(?:[*+-]|\d{1,9}[.)])/,qt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ft=L(qt).replace(/bull/g,ot).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Ls=L(qt).replace(/bull/g,ot).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),at=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,zs=/^[^\n]+/,lt=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,js=L(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",lt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ms=L(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ot).getRegex(),Ue="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",rt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,qs=L("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",rt).replace("tag",Ue).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dt=L(at).replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ue).getRegex(),Fs=L(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dt).getRegex(),it={blockquote:Fs,code:Is,def:js,fences:Ps,heading:Es,hr:Le,html:qs,lheading:Ft,list:Ms,newline:As,paragraph:Dt,table:Ie,text:zs},Ct=L("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ue).getRegex(),Ds={...it,lheading:Ls,table:Ct,paragraph:L(at).replace("hr",Le).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ct).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ue).getRegex()},Bs={...it,html:L(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",rt).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ie,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:L(at).replace("hr",Le).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ft).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Gs=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ns=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Bt=/^( {2,}|\\)\n(?!\s*$)/,Us=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,He=/[\p{P}\p{S}]/u,ct=/[\s\p{P}\p{S}]/u,Gt=/[^\s\p{P}\p{S}]/u,Hs=L(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ct).getRegex(),Nt=/(?!~)[\p{P}\p{S}]/u,Os=/(?!~)[\s\p{P}\p{S}]/u,Vs=/(?:[^\s\p{P}\p{S}]|~)/u,Zs=L(/link|code|html/,"g").replace("link",new RegExp("\\[(?:[^\\[\\]`]|(?<!`)(?<a>`+)[^`]+\\k<a>(?!`))*?\\]\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)]|\\((?:\\\\[\\s\\S]|[^\\\\\\(\\)])*\\))*\\)")).replace("code",new RegExp("(?<!`)(?<b>`+)[^`]+\\k<b>(?!`)")).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ut=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ws=L(Ut,"u").replace(/punct/g,He).getRegex(),Qs=L(Ut,"u").replace(/punct/g,Nt).getRegex(),Ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Js=L(Ht,"gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,ct).replace(/punct/g,He).getRegex(),Xs=L(Ht,"gu").replace(/notPunctSpace/g,Vs).replace(/punctSpace/g,Os).replace(/punct/g,Nt).getRegex(),Ks=L("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Gt).replace(/punctSpace/g,ct).replace(/punct/g,He).getRegex(),Ys=L(/\\(punct)/,"gu").replace(/punct/g,He).getRegex(),eo=L(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),to=L(rt).replace("(?:-->|$)","-->").getRegex(),no=L("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",to).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Be=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,so=L(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Be).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ot=L(/^!?\[(label)\]\[(ref)\]/).replace("label",Be).replace("ref",lt).getRegex(),Vt=L(/^!?\[(ref)\](?:\[\])?/).replace("ref",lt).getRegex(),oo=L("reflink|nolink(?!\\()","g").replace("reflink",Ot).replace("nolink",Vt).getRegex(),Rt=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,ut={_backpedal:Ie,anyPunctuation:Ys,autolink:eo,blockSkip:Zs,br:Bt,code:Ns,del:Ie,emStrongLDelim:Ws,emStrongRDelimAst:Js,emStrongRDelimUnd:Ks,escape:Gs,link:so,nolink:Vt,punctuation:Hs,reflink:Ot,reflinkSearch:oo,tag:no,text:Us,url:Ie},ao={...ut,link:L(/^!?\[(label)\]\((.*?)\)/).replace("label",Be).getRegex(),reflink:L(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Be).getRegex()},Ke={...ut,emStrongRDelimAst:Xs,emStrongLDelim:Qs,url:L(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Rt).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:L(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Rt).getRegex()},lo={...Ke,br:L(Bt).replace("{2,}","*").getRegex(),text:L(Ke.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Me={normal:it,gfm:Ds,pedantic:Bs},Ce={normal:ut,gfm:Ke,breaks:lo,pedantic:ao},ro={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tt=t=>ro[t];function K(t,e){if(e){if(N.escapeTest.test(t))return t.replace(N.escapeReplace,Tt)}else if(N.escapeTestNoEncode.test(t))return t.replace(N.escapeReplaceNoEncode,Tt);return t}function At(t){try{t=encodeURI(t).replace(N.percentDecode,"%")}catch{return null}return t}function It(t,e){var c;let n=t.replace(N.findPipe,(h,u,m)=>{let i=!1,x=u;for(;--x>=0&&m[x]==="\\";)i=!i;return i?"|":" |"}),o=n.split(N.splitPipe),a=0;if(o[0].trim()||o.shift(),o.length>0&&!((c=o.at(-1))!=null&&c.trim())&&o.pop(),e)if(o.length>e)o.splice(e);else for(;o.length<e;)o.push("");for(;a<o.length;a++)o[a]=o[a].trim().replace(N.slashPipe,"|");return o}function Re(t,e,n){let o=t.length;if(o===0)return"";let a=0;for(;a<o&&t.charAt(o-a-1)===e;)a++;return t.slice(0,o-a)}function io(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let o=0;o<t.length;o++)if(t[o]==="\\")o++;else if(t[o]===e[0])n++;else if(t[o]===e[1]&&(n--,n<0))return o;return n>0?-2:-1}function Pt(t,e,n,o,a){let c=e.href,h=e.title||null,u=t[1].replace(a.other.outputLinkReplace,"$1");o.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:c,title:h,text:u,tokens:o.inlineTokens(u)};return o.state.inLink=!1,m}function co(t,e,n){let o=t.match(n.other.indentCodeCompensation);if(o===null)return e;let a=o[1];return e.split(`
`).map(c=>{let h=c.match(n.other.beginningSpace);if(h===null)return c;let[u]=h;return u.length>=a.length?c.slice(a.length):c}).join(`
`)}var Ge=class{constructor(t){q(this,"options");q(this,"rules");q(this,"lexer");this.options=t||ge}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Re(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],o=co(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:o}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let o=Re(n,"#");(this.options.pedantic||!o||this.rules.other.endingSpaceChar.test(o))&&(n=o.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Re(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=Re(e[0],`
`).split(`
`),o="",a="",c=[];for(;n.length>0;){let h=!1,u=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))u.push(n[m]),h=!0;else if(!h)u.push(n[m]);else break;n=n.slice(m);let i=u.join(`
`),x=i.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");o=o?`${o}
${i}`:i,a=a?`${a}
${x}`:x;let _=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(x,c,!0),this.lexer.state.top=_,n.length===0)break;let d=c.at(-1);if((d==null?void 0:d.type)==="code")break;if((d==null?void 0:d.type)==="blockquote"){let S=d,b=S.raw+`
`+n.join(`
`),C=this.blockquote(b);c[c.length-1]=C,o=o.substring(0,o.length-S.raw.length)+C.raw,a=a.substring(0,a.length-S.text.length)+C.text;break}else if((d==null?void 0:d.type)==="list"){let S=d,b=S.raw+`
`+n.join(`
`),C=this.list(b);c[c.length-1]=C,o=o.substring(0,o.length-d.raw.length)+C.raw,a=a.substring(0,a.length-S.raw.length)+C.raw,n=b.substring(c.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:o,tokens:c,text:a}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),o=n.length>1,a={type:"list",raw:"",ordered:o,start:o?+n.slice(0,-1):"",loose:!1,items:[]};n=o?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=o?n:"[*+-]");let c=this.rules.other.listItemRegex(n),h=!1;for(;t;){let m=!1,i="",x="";if(!(e=c.exec(t))||this.rules.block.hr.test(t))break;i=e[0],t=t.substring(i.length);let _=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,A=>" ".repeat(3*A.length)),d=t.split(`
`,1)[0],S=!_.trim(),b=0;if(this.options.pedantic?(b=2,x=_.trimStart()):S?b=e[1].length+1:(b=e[2].search(this.rules.other.nonSpaceChar),b=b>4?1:b,x=_.slice(b),b+=e[1].length),S&&this.rules.other.blankLine.test(d)&&(i+=d+`
`,t=t.substring(d.length+1),m=!0),!m){let A=this.rules.other.nextBulletRegex(b),D=this.rules.other.hrRegex(b),O=this.rules.other.fencesBeginRegex(b),H=this.rules.other.headingBeginRegex(b),ce=this.rules.other.htmlBeginRegex(b);for(;t;){let X=t.split(`
`,1)[0],V;if(d=X,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),V=d):V=d.replace(this.rules.other.tabCharGlobal,"    "),O.test(d)||H.test(d)||ce.test(d)||A.test(d)||D.test(d))break;if(V.search(this.rules.other.nonSpaceChar)>=b||!d.trim())x+=`
`+V.slice(b);else{if(S||_.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||O.test(_)||H.test(_)||D.test(_))break;x+=`
`+d}!S&&!d.trim()&&(S=!0),i+=X+`
`,t=t.substring(X.length+1),_=V.slice(b)}}a.loose||(h?a.loose=!0:this.rules.other.doubleBlankLine.test(i)&&(h=!0));let C=null,z;this.options.gfm&&(C=this.rules.other.listIsTask.exec(x),C&&(z=C[0]!=="[ ] ",x=x.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:i,task:!!C,checked:z,loose:!1,text:x,tokens:[]}),a.raw+=i}let u=a.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let m=0;m<a.items.length;m++)if(this.lexer.state.top=!1,a.items[m].tokens=this.lexer.blockTokens(a.items[m].text,[]),!a.loose){let i=a.items[m].tokens.filter(_=>_.type==="space"),x=i.length>0&&i.some(_=>this.rules.other.anyLine.test(_.raw));a.loose=x}if(a.loose)for(let m=0;m<a.items.length;m++)a.items[m].loose=!0;return a}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),o=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:o,title:a}}}table(t){var h;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=It(e[1]),o=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(h=e[3])!=null&&h.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],c={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===o.length){for(let u of o)this.rules.other.tableAlignRight.test(u)?c.align.push("right"):this.rules.other.tableAlignCenter.test(u)?c.align.push("center"):this.rules.other.tableAlignLeft.test(u)?c.align.push("left"):c.align.push(null);for(let u=0;u<n.length;u++)c.header.push({text:n[u],tokens:this.lexer.inline(n[u]),header:!0,align:c.align[u]});for(let u of a)c.rows.push(It(u,c.header.length).map((m,i)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:c.align[i]})));return c}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let c=Re(n.slice(0,-1),"\\");if((n.length-c.length)%2===0)return}else{let c=io(e[2],"()");if(c===-2)return;if(c>-1){let h=(e[0].indexOf("!")===0?5:4)+e[1].length+c;e[2]=e[2].substring(0,c),e[0]=e[0].substring(0,h).trim(),e[3]=""}}let o=e[2],a="";if(this.options.pedantic){let c=this.rules.other.pedanticHrefTitle.exec(o);c&&(o=c[1],a=c[3])}else a=e[3]?e[3].slice(1,-1):"";return o=o.trim(),this.rules.other.startAngleBracket.test(o)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?o=o.slice(1):o=o.slice(1,-1)),Pt(e,{href:o&&o.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let o=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[o.toLowerCase()];if(!a){let c=n[0].charAt(0);return{type:"text",raw:c,text:c}}return Pt(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let o=this.rules.inline.emStrongLDelim.exec(t);if(!(!o||o[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(o[1]||o[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...o[0]].length-1,c,h,u=a,m=0,i=o[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(i.lastIndex=0,e=e.slice(-1*t.length+a);(o=i.exec(e))!=null;){if(c=o[1]||o[2]||o[3]||o[4]||o[5]||o[6],!c)continue;if(h=[...c].length,o[3]||o[4]){u+=h;continue}else if((o[5]||o[6])&&a%3&&!((a+h)%3)){m+=h;continue}if(u-=h,u>0)continue;h=Math.min(h,h+u+m);let x=[...o[0]][0].length,_=t.slice(0,a+o.index+x+h);if(Math.min(a,h)%2){let S=_.slice(1,-1);return{type:"em",raw:_,text:S,tokens:this.lexer.inlineTokens(S)}}let d=_.slice(2,-2);return{type:"strong",raw:_,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),o=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return o&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,o;return e[2]==="@"?(n=e[1],o="mailto:"+n):(n=e[1],o=n),{type:"link",raw:e[0],text:n,href:o,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let o,a;if(e[2]==="@")o=e[0],a="mailto:"+o;else{let c;do c=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(c!==e[0]);o=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:o,href:a,tokens:[{type:"text",raw:o,text:o}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Q=class Ye{constructor(e){q(this,"tokens");q(this,"options");q(this,"state");q(this,"tokenizer");q(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ge,this.options.tokenizer=this.options.tokenizer||new Ge,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:N,block:Me.normal,inline:Ce.normal};this.options.pedantic?(n.block=Me.pedantic,n.inline=Ce.pedantic):this.options.gfm&&(n.block=Me.gfm,this.options.breaks?n.inline=Ce.breaks:n.inline=Ce.gfm),this.tokenizer.rules=n}static get rules(){return{block:Me,inline:Ce}}static lex(e,n){return new Ye(n).lex(e)}static lexInline(e,n){return new Ye(n).inlineTokens(e)}lex(e){e=e.replace(N.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let o=this.inlineQueue[n];this.inlineTokens(o.src,o.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],o=!1){var a,c,h;for(this.options.pedantic&&(e=e.replace(N.tabCharGlobal,"    ").replace(N.spaceLine,""));e;){let u;if((c=(a=this.options.extensions)==null?void 0:a.block)!=null&&c.some(i=>(u=i.call({lexer:this},e,n))?(e=e.substring(u.raw.length),n.push(u),!0):!1))continue;if(u=this.tokenizer.space(e)){e=e.substring(u.raw.length);let i=n.at(-1);u.raw.length===1&&i!==void 0?i.raw+=`
`:n.push(u);continue}if(u=this.tokenizer.code(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(u=this.tokenizer.fences(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.heading(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.hr(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.blockquote(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.list(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.html(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.def(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="paragraph"||(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.raw,this.inlineQueue.at(-1).src=i.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title},n.push(u));continue}if(u=this.tokenizer.table(e)){e=e.substring(u.raw.length),n.push(u);continue}if(u=this.tokenizer.lheading(e)){e=e.substring(u.raw.length),n.push(u);continue}let m=e;if((h=this.options.extensions)!=null&&h.startBlock){let i=1/0,x=e.slice(1),_;this.options.extensions.startBlock.forEach(d=>{_=d.call({lexer:this},x),typeof _=="number"&&_>=0&&(i=Math.min(i,_))}),i<1/0&&i>=0&&(m=e.substring(0,i+1))}if(this.state.top&&(u=this.tokenizer.paragraph(m))){let i=n.at(-1);o&&(i==null?void 0:i.type)==="paragraph"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u),o=m.length!==e.length,e=e.substring(u.raw.length);continue}if(u=this.tokenizer.text(e)){e=e.substring(u.raw.length);let i=n.at(-1);(i==null?void 0:i.type)==="text"?(i.raw+=(i.raw.endsWith(`
`)?"":`
`)+u.raw,i.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):n.push(u);continue}if(e){let i="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(i);break}else throw new Error(i)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,m,i,x,_;let o=e,a=null;if(this.tokens.links){let d=Object.keys(this.tokens.links);if(d.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)d.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,a.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);o=((m=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:m.call({lexer:this},o))??o;let c=!1,h="";for(;e;){c||(h=""),c=!1;let d;if((x=(i=this.options.extensions)==null?void 0:i.inline)!=null&&x.some(b=>(d=b.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.escape(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.tag(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.link(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(d.raw.length);let b=n.at(-1);d.type==="text"&&(b==null?void 0:b.type)==="text"?(b.raw+=d.raw,b.text+=d.text):n.push(d);continue}if(d=this.tokenizer.emStrong(e,o,h)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.codespan(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.br(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.del(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.autolink(e)){e=e.substring(d.raw.length),n.push(d);continue}if(!this.state.inLink&&(d=this.tokenizer.url(e))){e=e.substring(d.raw.length),n.push(d);continue}let S=e;if((_=this.options.extensions)!=null&&_.startInline){let b=1/0,C=e.slice(1),z;this.options.extensions.startInline.forEach(A=>{z=A.call({lexer:this},C),typeof z=="number"&&z>=0&&(b=Math.min(b,z))}),b<1/0&&b>=0&&(S=e.substring(0,b+1))}if(d=this.tokenizer.inlineText(S)){e=e.substring(d.raw.length),d.raw.slice(-1)!=="_"&&(h=d.raw.slice(-1)),c=!0;let b=n.at(-1);(b==null?void 0:b.type)==="text"?(b.raw+=d.raw,b.text+=d.text):n.push(d);continue}if(e){let b="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(b);break}else throw new Error(b)}}return n}},Ne=class{constructor(t){q(this,"options");q(this,"parser");this.options=t||ge}space(t){return""}code({text:t,lang:e,escaped:n}){var c;let o=(c=(e||"").match(N.notSpaceStart))==null?void 0:c[0],a=t.replace(N.endingNewline,"")+`
`;return o?'<pre><code class="language-'+K(o)+'">'+(n?a:K(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:K(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,o="";for(let h=0;h<t.items.length;h++){let u=t.items[h];o+=this.listitem(u)}let a=e?"ol":"ul",c=e&&n!==1?' start="'+n+'"':"";return"<"+a+c+`>
`+o+"</"+a+`>
`}listitem(t){var n;let e="";if(t.task){let o=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=o+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=o+" "+K(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:o+" ",text:o+" ",escaped:!0}):e+=o+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let o="";for(let a=0;a<t.rows.length;a++){let c=t.rows[a];n="";for(let h=0;h<c.length;h++)n+=this.tablecell(c[h]);o+=this.tablerow({text:n})}return o&&(o=`<tbody>${o}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+o+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${K(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let o=this.parser.parseInline(n),a=At(t);if(a===null)return o;t=a;let c='<a href="'+t+'"';return e&&(c+=' title="'+K(e)+'"'),c+=">"+o+"</a>",c}image({href:t,title:e,text:n,tokens:o}){o&&(n=this.parser.parseInline(o,this.parser.textRenderer));let a=At(t);if(a===null)return K(n);t=a;let c=`<img src="${t}" alt="${n}"`;return e&&(c+=` title="${K(e)}"`),c+=">",c}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:K(t.text)}},dt=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},J=class et{constructor(e){q(this,"options");q(this,"renderer");q(this,"textRenderer");this.options=e||ge,this.options.renderer=this.options.renderer||new Ne,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new dt}static parse(e,n){return new et(n).parse(e)}static parseInline(e,n){return new et(n).parseInline(e)}parse(e,n=!0){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=u,x=this.options.extensions.renderers[i.type].call({parser:this},i);if(x!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(i.type)){o+=x||"";continue}}let m=u;switch(m.type){case"space":{o+=this.renderer.space(m);continue}case"hr":{o+=this.renderer.hr(m);continue}case"heading":{o+=this.renderer.heading(m);continue}case"code":{o+=this.renderer.code(m);continue}case"table":{o+=this.renderer.table(m);continue}case"blockquote":{o+=this.renderer.blockquote(m);continue}case"list":{o+=this.renderer.list(m);continue}case"html":{o+=this.renderer.html(m);continue}case"def":{o+=this.renderer.def(m);continue}case"paragraph":{o+=this.renderer.paragraph(m);continue}case"text":{let i=m,x=this.renderer.text(i);for(;h+1<e.length&&e[h+1].type==="text";)i=e[++h],x+=`
`+this.renderer.text(i);n?o+=this.renderer.paragraph({type:"paragraph",raw:x,text:x,tokens:[{type:"text",raw:x,text:x,escaped:!0}]}):o+=x;continue}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}parseInline(e,n=this.renderer){var a,c;let o="";for(let h=0;h<e.length;h++){let u=e[h];if((c=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&c[u.type]){let i=this.options.extensions.renderers[u.type].call({parser:this},u);if(i!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){o+=i||"";continue}}let m=u;switch(m.type){case"escape":{o+=n.text(m);break}case"html":{o+=n.html(m);break}case"link":{o+=n.link(m);break}case"image":{o+=n.image(m);break}case"strong":{o+=n.strong(m);break}case"em":{o+=n.em(m);break}case"codespan":{o+=n.codespan(m);break}case"br":{o+=n.br(m);break}case"del":{o+=n.del(m);break}case"text":{o+=n.text(m);break}default:{let i='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(i),"";throw new Error(i)}}}return o}},qe,Te=(qe=class{constructor(t){q(this,"options");q(this,"block");this.options=t||ge}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Q.lex:Q.lexInline}provideParser(){return this.block?J.parse:J.parseInline}},q(qe,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),q(qe,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),qe),uo=class{constructor(...t){q(this,"defaults",st());q(this,"options",this.setOptions);q(this,"parse",this.parseMarkdown(!0));q(this,"parseInline",this.parseMarkdown(!1));q(this,"Parser",J);q(this,"Renderer",Ne);q(this,"TextRenderer",dt);q(this,"Lexer",Q);q(this,"Tokenizer",Ge);q(this,"Hooks",Te);this.use(...t)}walkTokens(t,e){var o,a;let n=[];for(let c of t)switch(n=n.concat(e.call(this,c)),c.type){case"table":{let h=c;for(let u of h.header)n=n.concat(this.walkTokens(u.tokens,e));for(let u of h.rows)for(let m of u)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let h=c;n=n.concat(this.walkTokens(h.items,e));break}default:{let h=c;(a=(o=this.defaults.extensions)==null?void 0:o.childTokens)!=null&&a[h.type]?this.defaults.extensions.childTokens[h.type].forEach(u=>{let m=h[u].flat(1/0);n=n.concat(this.walkTokens(m,e))}):h.tokens&&(n=n.concat(this.walkTokens(h.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let o={...n};if(o.async=this.defaults.async||o.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let c=e.renderers[a.name];c?e.renderers[a.name]=function(...h){let u=a.renderer.apply(this,h);return u===!1&&(u=c.apply(this,h)),u}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let c=e[a.level];c?c.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),o.extensions=e),n.renderer){let a=this.defaults.renderer||new Ne(this.defaults);for(let c in n.renderer){if(!(c in a))throw new Error(`renderer '${c}' does not exist`);if(["options","parser"].includes(c))continue;let h=c,u=n.renderer[h],m=a[h];a[h]=(...i)=>{let x=u.apply(a,i);return x===!1&&(x=m.apply(a,i)),x||""}}o.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Ge(this.defaults);for(let c in n.tokenizer){if(!(c in a))throw new Error(`tokenizer '${c}' does not exist`);if(["options","rules","lexer"].includes(c))continue;let h=c,u=n.tokenizer[h],m=a[h];a[h]=(...i)=>{let x=u.apply(a,i);return x===!1&&(x=m.apply(a,i)),x}}o.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Te;for(let c in n.hooks){if(!(c in a))throw new Error(`hook '${c}' does not exist`);if(["options","block"].includes(c))continue;let h=c,u=n.hooks[h],m=a[h];Te.passThroughHooks.has(c)?a[h]=i=>{if(this.defaults.async&&Te.passThroughHooksRespectAsync.has(c))return(async()=>{let _=await u.call(a,i);return m.call(a,_)})();let x=u.call(a,i);return m.call(a,x)}:a[h]=(...i)=>{if(this.defaults.async)return(async()=>{let _=await u.apply(a,i);return _===!1&&(_=await m.apply(a,i)),_})();let x=u.apply(a,i);return x===!1&&(x=m.apply(a,i)),x}}o.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,c=n.walkTokens;o.walkTokens=function(h){let u=[];return u.push(c.call(this,h)),a&&(u=u.concat(a.call(this,h))),u}}this.defaults={...this.defaults,...o}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Q.lex(t,e??this.defaults)}parser(t,e){return J.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let o={...n},a={...this.defaults,...o},c=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&o.async===!1)return c(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return c(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return c(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let h=a.hooks?await a.hooks.preprocess(e):e,u=await(a.hooks?await a.hooks.provideLexer():t?Q.lex:Q.lexInline)(h,a),m=a.hooks?await a.hooks.processAllTokens(u):u;a.walkTokens&&await Promise.all(this.walkTokens(m,a.walkTokens));let i=await(a.hooks?await a.hooks.provideParser():t?J.parse:J.parseInline)(m,a);return a.hooks?await a.hooks.postprocess(i):i})().catch(c);try{a.hooks&&(e=a.hooks.preprocess(e));let h=(a.hooks?a.hooks.provideLexer():t?Q.lex:Q.lexInline)(e,a);a.hooks&&(h=a.hooks.processAllTokens(h)),a.walkTokens&&this.walkTokens(h,a.walkTokens);let u=(a.hooks?a.hooks.provideParser():t?J.parse:J.parseInline)(h,a);return a.hooks&&(u=a.hooks.postprocess(u)),u}catch(h){return c(h)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let o="<p>An error occurred:</p><pre>"+K(n.message+"",!0)+"</pre>";return e?Promise.resolve(o):o}if(e)return Promise.reject(n);throw n}}},_e=new uo;function j(t,e){return _e.parse(t,e)}j.options=j.setOptions=function(t){return _e.setOptions(t),j.defaults=_e.defaults,Mt(j.defaults),j};j.getDefaults=st;j.defaults=ge;j.use=function(...t){return _e.use(...t),j.defaults=_e.defaults,Mt(j.defaults),j};j.walkTokens=function(t,e){return _e.walkTokens(t,e)};j.parseInline=_e.parseInline;j.Parser=J;j.parser=J.parse;j.Renderer=Ne;j.TextRenderer=dt;j.Lexer=Q;j.lexer=Q.lex;j.Tokenizer=Ge;j.Hooks=Te;j.parse=j;j.options;j.setOptions;j.use;j.walkTokens;j.parseInline;J.parse;Q.lex;const po={class:"wall-view"},ho={key:0,class:"loading-container"},mo={key:1,class:"error-container"},_o={key:2,class:"wall-content"},go={class:"wall-header"},fo={class:"wall-info"},ko={class:"wall-avatar"},vo=["src","alt"],bo={class:"wall-details"},yo={class:"wall-title"},wo={key:0,class:"wall-owner"},xo={key:1,class:"wall-description"},$o={class:"wall-stats"},So={class:"stat"},Co={class:"stat-value"},Ro={class:"stat"},To={class:"stat-value"},Ao={class:"posts-section"},Io={key:0,class:"loading-posts"},Po={key:1,class:"empty-state"},Eo={key:2,class:"posts-grid"},Lo={key:1,class:"ai-content-info"},zo={key:0,class:"ai-preview-prompt"},jo={key:1},Mo=["innerHTML"],qo=["onClick"],Fo={key:2,class:"post-header"},Do=["src","alt"],Bo={class:"post-meta"},Go={class:"post-author"},No={class:"post-time"},Uo={key:3,class:"post-content"},Ho=["innerHTML"],Oo={key:1},Vo={key:4,class:"ai-content-preview"},Zo={class:"ai-preview-header"},Wo=["src","alt"],Qo={class:"ai-generation-info"},Jo={key:0,class:"info-item bricks-spent"},Xo={class:"bricks-amount"},Ko={key:1,class:"info-item model-used"},Yo={class:"model-name"},ea={key:0,class:"ai-generation-stats"},ta={key:0,class:"stat-item"},na={class:"stat-value"},sa={key:1,class:"stat-item"},oa={class:"stat-value"},aa={key:2,class:"stat-item"},la={class:"stat-value"},ra={key:1,class:"ai-preview-prompt"},ia={key:2,class:"ai-preview-response"},ca=["innerHTML"],ua=["onClick"],da={key:5,class:"ai-content-preview"},pa={class:"ai-preview-header"},ha=["src","alt"],ma={class:"ai-generation-info"},_a={class:"info-item status-processing"},ga={class:"status-badge processing"},fa={key:0,class:"info-item model-used"},ka={class:"model-name"},va={key:0,class:"ai-preview-prompt"},ba={key:1,class:"ai-preview-response"},ya=["innerHTML"],wa=["onClick"],xa={key:6,class:"post-media"},$a=["src","alt"],Sa={class:"post-actions"},Ca={class:"action-btn"},Ra={class:"action-btn"},Ta={class:"action-btn"},Aa={class:"action-btn"},Ia={class:"post-time-footer"},Pa={key:7,class:"post-comments"},Ea={key:3,class:"load-more"},La={class:"modal-content ai-modal"},za={key:0,class:"modal-body"},ja={class:"ai-modal-section"},Ma={class:"ai-prompt-full"},qa={key:0,class:"ai-modal-section"},Fa=["innerHTML"],Da={key:1,class:"ai-response-content ai-generating"},Ba={key:1,class:"ai-modal-section ai-stats"},Ga={key:0,class:"generation-progress-bar"},Na={class:"progress-bar-container"},Ua={class:"progress-text"},Ha={class:"stats-grid"},Oa={class:"stat-item"},Va={class:"stat-value"},Za={key:0,class:"stat-item"},Wa={class:"stat-value"},Qa={key:1,class:"stat-item"},Ja={class:"stat-value"},Xa={key:2,class:"stat-item"},Ka={class:"stat-value"},Ya={key:3,class:"stat-item"},el={class:"stat-value"},tl={key:4,class:"stat-item"},nl={class:"stat-value"},sl={key:5,class:"stat-item"},ol={class:"stat-value"},al={key:0,class:"stat-item"},ll={class:"stat-value"},rl={key:1,class:"stat-item"},il={class:"stat-value bricks-value"},cl={key:2,class:"stat-item"},ul={class:"stat-value"},dl={key:3,class:"stat-item"},pl={class:"stat-value"},hl={key:4,class:"stat-item"},ml={class:"stat-value"},_l={key:5,class:"stat-item"},gl={class:"stat-value"},fl={key:2,class:"ai-modal-section"},kl={class:"post-counters"},vl={class:"counter-item"},bl={class:"counter-icon"},yl={class:"counter-label"},wl={class:"counter-value"},xl={class:"counter-item"},$l={class:"counter-value"},Sl={class:"counter-item"},Cl={class:"counter-value"},Rl={class:"counter-item"},Tl={class:"counter-value"},Al={key:3,class:"ai-modal-section"},Il={class:"modal-footer"},Pl={class:"action-buttons-group"},El={key:0,class:"toast-notification"},Je=20,Ll=Pe({__name:"WallView",props:{wallId:{}},setup(t){j.setOptions({breaks:!0,gfm:!0});const e=t;an();const n=on(),o=nt(),a=I(!0),c=I(!1),h=I(!1),u=I(null),m=I(null),i=I([]),x=I(1),_=I(!0);let d=new Map,S=new Map;const b=new Set,C=new Set,z=G(()=>m.value&&o.user&&m.value.user_id===o.user.id),A=G(()=>{var r;return(r=m.value)!=null&&r.theme?{backgroundColor:m.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),D=G(()=>i.value.filter(r=>!(r.post_type==="ai_app"&&r.ai_status==="failed"))),O=async r=>{if(!b.has(r))try{await Qe.incrementViewCount(r),b.add(r),console.log(`View count incremented for post ${r}`)}catch(l){console.error(`Failed to increment view count for post ${r}:`,l)}},H=async()=>{const r=[];if(i.value.forEach(l=>{!C.has(l.post_id)&&!b.has(l.post_id)&&(r.push(l.post_id),C.add(l.post_id))}),r.length>0)try{await Qe.batchIncrementViewCounts(r),r.forEach(l=>b.add(l)),console.log(`Batch view counts incremented for ${r.length} posts`)}catch(l){console.error("Failed to batch increment view counts:",l),r.forEach($=>{C.delete($),O($)})}},ce=async r=>{try{await Qe.incrementOpenCount(r),console.log(`Open count incremented for post ${r}`)}catch(l){console.error(`Failed to increment open count for post ${r}:`,l)}},X=r=>{const l=new Date(r),T=new Date().getTime()-l.getTime(),R=Math.floor(T/6e4),p=Math.floor(T/36e5),E=Math.floor(T/864e5);return R<1?"just now":R<60?`${R}m ago`:p<24?`${p}h ago`:E<7?`${E}d ago`:l.toLocaleDateString()},V=async()=>{var r,l,$;try{a.value=!0,u.value=null;let T=e.wallId||n.params.wallId;if(!T)throw new Error("No wall identifier provided");let R;T==="me"?R=await Z.get("/walls/me"):R=await Z.get(`/walls/${T}`);let p=null;if(R&&typeof R=="object"&&("wall"in R&&R.wall&&typeof R.wall=="object"&&"wall_id"in R.wall?p=R.wall:"wall_id"in R?p=R:console.log("Unexpected wall response format:",R)),p)m.value=p,await ee();else throw new Error("Wall not found")}catch(T){console.error("Error loading wall:",T),((r=T.response)==null?void 0:r.status)===404?u.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":u.value=(($=(l=T.response)==null?void 0:l.data)==null?void 0:$.message)||T.message||"Failed to load wall"}finally{a.value=!1}},ee=async(r=!1)=>{var l,$;if(m.value){if(h.value){console.log("[WallView] Skipping loadPosts - request already in progress");return}try{h.value=!0,r||(c.value=!0);const T=(x.value-1)*Je,R=await Z.get(`/walls/${m.value.wall_id}/posts?limit=${Je}&offset=${T}`);let p=[];if(R&&typeof R=="object"&&("posts"in R&&Array.isArray(R.posts)?p=R.posts:Array.isArray(R)?p=R:console.log("Unexpected posts response format:",R)),p.length>0){const E=p;x.value===1?r?fe(E):(i.value=E,H()):(i.value=[...i.value,...E],H()),_.value=E.length===Je,te()}}catch(T){console.error("Error loading posts:",T),u.value=(($=(l=T.response)==null?void 0:l.data)==null?void 0:$.message)||T.message||"Failed to load posts"}finally{h.value=!1,c.value=!1}}},te=()=>{const r=i.value.filter(l=>l.post_type==="ai_app"&&(l.ai_status==="queued"||l.ai_status==="processing"));console.log("[WallView] Checking pending AI posts:",r.length),r.forEach(l=>{var $,T;console.log("[WallView] Pending post:",{post_id:l.post_id,ai_status:l.ai_status,ai_job_id:l.ai_job_id,has_content:!!l.ai_content,html_content_length:((T=($=l.ai_content)==null?void 0:$.html_content)==null?void 0:T.length)||0})}),r.length>0?r.forEach(l=>{l.ai_status==="processing"&&l.ai_job_id&&B(l)}):U()},fe=r=>{const l=new Map(r.map($=>[$.post_id,$]));i.value.forEach(($,T)=>{const R=l.get($.post_id);R&&(Object.assign(i.value[T],R),l.delete($.post_id))}),l.size>0&&(i.value=[...Array.from(l.values()),...i.value])},ke=()=>{x.value++,ee()},ne=()=>{console.log("Create post functionality coming soon")},M=async r=>{console.log("Generation completed for post:",r.post_id),P(r.ai_job_id)},w=(r,l)=>{console.error("Generation failed for post:",r.post_id,l),P(r.ai_job_id);const $=i.value.findIndex(T=>T.post_id===r.post_id);$!==-1&&(i.value[$].ai_status="failed")},B=r=>{if(!r.ai_job_id)return;if(d.has(r.ai_job_id)){console.log("[ContentStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/content`;console.log("[ContentStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const T=new EventSource($);d.set(r.ai_job_id,T),T.addEventListener("content",R=>{var W,oe,ae,le,re,ie;const p=JSON.parse(R.data);console.log("[ContentStream] Received content chunk:",{jobId:r.ai_job_id,contentLength:((W=p.content)==null?void 0:W.length)||0,model:p.model,modalOpen:de.value,isSelectedPost:((oe=k.value)==null?void 0:oe.post_id)===r.post_id});const E=i.value.findIndex(pe=>pe.post_id===r.post_id);E!==-1&&(i.value[E].ai_content||(i.value[E].ai_content={}),i.value[E]={...i.value[E],ai_content:{...i.value[E].ai_content,html_content:p.content||"",generation_model:p.model||((ae=i.value[E].ai_content)==null?void 0:ae.generation_model)}},console.log("[ContentStream] Updated post in list, content length:",((le=p.content)==null?void 0:le.length)||0)),((re=k.value)==null?void 0:re.post_id)===r.post_id&&(console.log("[ContentStream] Updating modal content"),k.value={...k.value,ai_content:{...k.value.ai_content,html_content:p.content||""}},console.log("[ContentStream] Modal updated, new content length:",((ie=k.value.ai_content.html_content)==null?void 0:ie.length)||0))}),T.addEventListener("complete",R=>{console.log("[ContentStream] Generation complete"),P(r.ai_job_id);const p=i.value.findIndex(E=>E.post_id===r.post_id);p!==-1&&(i.value[p].ai_status="completed")}),T.addEventListener("error",R=>{console.error("[ContentStream] SSE error for job:",r.ai_job_id),P(r.ai_job_id)}),T.onerror=R=>{console.error("[ContentStream] Connection error:",R),P(r.ai_job_id)}},P=r=>{if(!r)return;const l=d.get(r);l&&(l.close(),d.delete(r),console.log("[ContentStream] Stopped SSE for job:",r))},U=()=>{d.forEach((r,l)=>{r.close(),console.log("[ContentStream] Closed SSE for job:",l)}),d.clear()},ze=r=>{if(!r.ai_job_id)return;if(S.has(r.ai_job_id)){console.log("[ProgressStream] Already streaming for job:",r.ai_job_id);return}const $=`/api/v1/ai/generation/${r.ai_job_id}/progress`;console.log("[ProgressStream] Starting NEW SSE for job:",r.ai_job_id,"URL:",$);const T=new EventSource($);S.set(r.ai_job_id,T),T.addEventListener("progress",R=>{var E;const p=JSON.parse(R.data);console.log("[ProgressStream] Received progress update:",p),((E=k.value)==null?void 0:E.post_id)===r.post_id&&(k.value={...k.value,ai_content:{...k.value.ai_content,current_tokens:p.current_tokens||0,tokens_per_second:p.tokens_per_second||0,elapsed_time:p.elapsed_time||0,estimated_remaining:p.estimated_remaining||0,progress_percentage:p.progress||0,content_length:p.content_length||0,chars_per_second:p.chars_per_second||0,input_tokens:p.prompt_tokens||0,output_tokens:p.completion_tokens||0,total_tokens:p.total_tokens||0}})}),T.addEventListener("complete",R=>{var p;console.log("[ProgressStream] Generation complete, reloading data"),ue(r.ai_job_id),((p=k.value)==null?void 0:p.post_id)===r.post_id&&Z.get(`/ai/apps/${r.ai_app_id}`).then(E=>{var W;E!=null&&E.success&&((W=E==null?void 0:E.data)!=null&&W.app)&&(k.value={...k.value,ai_status:"completed",ai_content:{...E.data.app,bricks_cost:E.data.app.bricks_cost||0}})}).catch(E=>{console.error("Failed to reload final data:",E)}),ee()}),T.addEventListener("error",R=>{console.error("[ProgressStream] SSE error for job:",r.ai_job_id),ue(r.ai_job_id)}),T.onerror=R=>{console.error("[ProgressStream] Connection error:",R),ue(r.ai_job_id)}},ue=r=>{if(!r)return;const l=S.get(r);l&&(l.close(),S.delete(r),console.log("[ProgressStream] Stopped SSE for job:",r))},Zt=()=>{S.forEach((r,l)=>{r.close(),console.log("[ProgressStream] Closed SSE for job:",l)}),S.clear()},je=(r,l)=>r?r.length<=l?r:r.substring(0,l)+"...":"",Oe=r=>{if(!r)return"";const l=r.replace(/<[^>]*>/g,""),$=je(l,200);return j.parse($,{async:!1})},k=I(null),de=I(!1),pt=I(""),Ve=I(!1),se=r=>{pt.value=r,Ve.value=!0,setTimeout(()=>{Ve.value=!1},2e3)},Wt=G(()=>{var l,$;if(!(($=(l=k.value)==null?void 0:l.ai_content)!=null&&$.html_content))return"";let r=String(j.parse(k.value.ai_content.html_content));return r=r.replace(/<hr\s*\/?>/gi,'<hr class="content-divider">'),r=r.replace(/<hr\s+[^>]*>/gi,'<hr class="content-divider">'),r}),ht=G(()=>{var $;if(!(($=k.value)!=null&&$.ai_content))return 0;const r=k.value.ai_content.output_tokens||0,l=k.value.ai_content.generation_time||0;return r>0&&l>0?r/(l/1e3):0}),mt=r=>{if(!(r!=null&&r.ai_content))return 0;if(r.ai_content.tokens_per_second&&r.ai_content.tokens_per_second>0)return r.ai_content.tokens_per_second;const l=r.ai_content.output_tokens||0,$=r.ai_content.generation_time||0;return l>0&&$>0?l/($/1e3):0},ye=async r=>{var l,$,T,R,p,E,W,oe,ae,le,re,ie,pe,we,xe,$e,Se;try{if(await ce(r.post_id),r.ai_status==="queued"||r.ai_status==="processing"){console.log("Opening modal for generating post, using post data:",{post_id:r.post_id,ai_job_id:r.ai_job_id,has_content:!!((l=r.ai_content)!=null&&l.html_content),content_length:((T=($=r.ai_content)==null?void 0:$.html_content)==null?void 0:T.length)||0}),k.value={...r,ai_content:{user_prompt:((R=r.ai_content)==null?void 0:R.user_prompt)||null,html_content:((p=r.ai_content)==null?void 0:p.html_content)||"",css_content:((E=r.ai_content)==null?void 0:E.css_content)||null,js_content:((W=r.ai_content)==null?void 0:W.js_content)||null,generation_model:((oe=r.ai_content)==null?void 0:oe.generation_model)||r.ai_model||null,generation_time:null,input_tokens:0,output_tokens:0,total_tokens:0,bricks_cost:((ae=r.ai_content)==null?void 0:ae.bricks_cost)||0,current_tokens:0,tokens_per_second:0,elapsed_time:0,estimated_remaining:0,progress_percentage:0,content_length:0,chars_per_second:0}},de.value=!0,document.body.style.overflow="hidden",r.ai_status==="processing"&&r.ai_job_id&&(B(r),ze(r));return}const F=await Z.get(`/ai/apps/${r.ai_app_id}`);F&&typeof F=="object"&&"app"in F?(console.log("AI App Data:",F.app),k.value={...r,ai_content:{...F.app,bricks_cost:F.app.bricks_cost||((le=r.ai_content)==null?void 0:le.bricks_cost)||0,input_tokens:F.app.input_tokens||((re=r.ai_content)==null?void 0:re.input_tokens)||0,output_tokens:F.app.output_tokens||((ie=r.ai_content)==null?void 0:ie.output_tokens)||0,total_tokens:F.app.total_tokens||((pe=r.ai_content)==null?void 0:pe.total_tokens)||0}},de.value=!0,document.body.style.overflow="hidden"):F&&typeof F=="object"&&"app_id"in F&&(console.log("AI App Data (direct):",F),k.value={...r,ai_content:{...F,bricks_cost:F.bricks_cost||((we=r.ai_content)==null?void 0:we.bricks_cost)||0,input_tokens:F.input_tokens||((xe=r.ai_content)==null?void 0:xe.input_tokens)||0,output_tokens:F.output_tokens||(($e=r.ai_content)==null?void 0:$e.output_tokens)||0,total_tokens:F.total_tokens||((Se=r.ai_content)==null?void 0:Se.total_tokens)||0}},de.value=!0,document.body.style.overflow="hidden")}catch(F){console.error("Error loading AI content:",F),r.ai_content&&(k.value=r,de.value=!0,document.body.style.overflow="hidden")}},Ze=()=>{var r;(r=k.value)!=null&&r.ai_job_id&&(P(k.value.ai_job_id),ue(k.value.ai_job_id)),de.value=!1,k.value=null,document.body.style.overflow=""},Qt=()=>{var R;if(!k.value)return;const r=((R=m.value)==null?void 0:R.wall_id)||n.params.wallId,l=k.value.ai_app_id,T=`${window.location.origin.replace(":3000",":8080")}/wall/${r}?ai=${l}`;navigator.clipboard.writeText(T).then(()=>{console.log("Share link copied to clipboard:",T),se("âœ“ Link copied!")}).catch(p=>{console.error("Failed to copy share link:",p),se("âœ— Failed to copy link")})},Jt=(r,l)=>{navigator.clipboard.writeText(r).then(()=>{console.log(`${l} copied to clipboard`),se(`âœ“ ${l} copied!`)}).catch($=>{console.error("Failed to copy:",$),se("âœ— Failed to copy")})},Xt=async r=>{try{if(r.user_liked){await Z.delete(`/posts/${r.post_id}/reactions`),r.user_liked=!1,r.reaction_count=Math.max(0,(r.reaction_count||0)-1);const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!1,i.value[l].reaction_count=Math.max(0,(i.value[l].reaction_count||0)-1))}else{await Z.post(`/posts/${r.post_id}/reactions`,{reaction_type:"like"}),r.user_liked=!0,r.reaction_count=(r.reaction_count||0)+1;const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].user_liked=!0,i.value[l].reaction_count=(i.value[l].reaction_count||0)+1)}}catch(l){console.error("Failed to toggle like:",l),se("âœ— Failed to update like")}},_t=r=>{if(k.value){k.value.comment_count=(k.value.comment_count||0)+1;const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}if(r&&r.post_id){const l=i.value.findIndex($=>$.post_id===r.post_id);l!==-1&&(i.value[l].comment_count=(i.value[l].comment_count||0)+1)}se("âœ“ Comment added")},gt=r=>{if(k.value){k.value.comment_count=Math.max(0,(k.value.comment_count||0)-1);const l=i.value.findIndex($=>$.post_id===k.value.post_id);l!==-1&&(i.value[l].comment_count=Math.max(0,(i.value[l].comment_count||0)-1))}se("âœ“ Comment deleted")},ft=r=>{se("âœ“ Comment updated")};return tt(async()=>{await V();const r=n.query.ai;if(r){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await ye(l)}}),xt(()=>n.params.wallId,async(r,l)=>{r!==l&&(console.log("[WallView] Route changed, reloading wall:",r),await V())}),xt(()=>n.query.ai,async r=>{if(r&&i.value.length>0){const l=i.value.find($=>$.ai_app_id===parseInt(String(r)));l&&await ye(l)}}),Et(()=>{U(),Zt(),document.body.style.overflow=""}),(r,l)=>{var $,T,R;return g(),f(me,null,[s("div",po,[a.value?(g(),f("div",ho,[...l[3]||(l[3]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):u.value?(g(),f("div",mo,[l[4]||(l[4]=s("h2",null,"Error Loading Wall",-1)),s("p",null,y(u.value),1),s("button",{onClick:l[0]||(l[0]=p=>r.$router.push("/")),class:"btn-primary"},"Go Home")])):m.value?(g(),f("div",_o,[s("div",go,[s("div",{class:"wall-banner",style:Fe(A.value)},null,4),s("div",fo,[s("div",ko,[s("img",{src:m.value.owner_avatar||m.value.avatar_url||"/assets/images/default-avatar.svg",alt:m.value.owner_username||m.value.display_name},null,8,vo)]),s("div",bo,[s("h1",yo,y(m.value.display_name),1),m.value.owner_username?(g(),f("p",wo,"by @"+y(m.value.owner_username),1)):v("",!0),m.value.owner_bio?(g(),f("p",xo,y(m.value.owner_bio),1)):v("",!0)]),s("div",$o,[s("div",So,[s("span",Co,y(m.value.posts_count||0),1),l[5]||(l[5]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",Ro,[s("span",To,y(m.value.subscribers_count||0),1),l[6]||(l[6]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",Ao,[l[30]||(l[30]=s("h2",{class:"section-title"},"Posts",-1)),c.value?(g(),f("div",Io,[...l[7]||(l[7]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):i.value.length===0?(g(),f("div",Po,[l[8]||(l[8]=s("p",null,"No posts yet on this wall.",-1)),z.value?(g(),f("button",{key:0,onClick:ne,class:"btn-primary"},"Create First Post")):v("",!0)])):(g(),f("div",Eo,[(g(!0),f(me,null,De(D.value,p=>{var E,W,oe,ae,le,re,ie,pe,we,xe,$e,Se,F,kt,vt,bt,yt;return g(),f("div",{key:p.post_id,class:ve(["post-card",{"ai-post":p.post_type==="ai_app"}])},[p.post_type==="ai_app"&&(p.ai_status==="queued"||p.ai_status==="processing")&&p.ai_job_id?(g(),Ae(Un,{key:0,jobId:p.ai_job_id,modelName:p.ai_model,"auto-start":!0,onComplete:Y=>M(p),onError:Y=>w(p,Y)},null,8,["jobId","modelName","onComplete","onError"])):v("",!0),p.post_type==="ai_app"&&(p.ai_status==="queued"||p.ai_status==="processing")&&p.ai_job_id?(g(),f("div",Lo,[(E=p.ai_content)!=null&&E.user_prompt?(g(),f("div",zo,[l[9]||(l[9]=s("strong",null,"Prompt:",-1)),We(" "+y(je(p.ai_content.user_prompt,150)),1)])):v("",!0),(W=p.ai_content)!=null&&W.html_content?(g(),f("div",jo,[l[10]||(l[10]=s("div",{class:"ai-preview-response"},[s("strong",null,"Generated Response:")],-1)),s("div",{class:"ai-preview-text ai-generating",innerHTML:Oe(p.ai_content.html_content)},null,8,Mo)])):v("",!0),p.ai_status==="processing"?(g(),f("button",{key:2,onClick:Y=>ye(p),class:"btn-open-ai"},[l[11]||(l[11]=s("span",{class:"icon"},"ðŸ‘ï¸",-1)),s("span",null,y((oe=p.ai_content)!=null&&oe.html_content?"View Full Response":"Watch Generation"),1)],8,qo)):v("",!0)])):v("",!0),p.post_type!=="ai_app"?(g(),f("div",Fo,[s("img",{src:p.author_avatar||"/assets/images/default-avatar.svg",alt:p.author_username,class:"post-avatar"},null,8,Do),s("div",Bo,[s("span",Go,"@"+y(p.author_username),1),s("span",No,y(X(p.created_at)),1)])])):v("",!0),p.post_type!=="ai_app"?(g(),f("div",Uo,[p.content_html?(g(),f("div",{key:0,innerHTML:p.content_html},null,8,Ho)):(g(),f("p",Oo,y(p.content_text),1))])):v("",!0),p.post_type==="ai_app"&&p.ai_status==="completed"?(g(),f("div",Vo,[s("div",Zo,[s("img",{src:p.author_avatar||"/assets/images/default-avatar.svg",alt:p.author_username,class:"preview-avatar"},null,8,Wo),s("h4",null,"@"+y(p.author_username),1)]),s("div",Qo,[l[14]||(l[14]=s("div",{class:"info-item status-completed"},[s("strong",null,"Status:"),s("span",{class:"status-badge"},"âœ“ Completed")],-1)),(ae=p.ai_content)!=null&&ae.bricks_cost?(g(),f("div",Jo,[l[12]||(l[12]=s("strong",null,"Bricks spent:",-1)),s("span",Xo,y(p.ai_content.bricks_cost)+" ðŸ§±",1)])):v("",!0),(le=p.ai_content)!=null&&le.generation_model?(g(),f("div",Ko,[l[13]||(l[13]=s("strong",null,"Model:",-1)),s("span",Yo,y(p.ai_content.generation_model),1)])):v("",!0)]),(re=p.ai_content)!=null&&re.generation_time||(ie=p.ai_content)!=null&&ie.total_tokens?(g(),f("div",ea,[(pe=p.ai_content)!=null&&pe.generation_time?(g(),f("div",ta,[l[15]||(l[15]=s("strong",null,"Time:",-1)),s("span",na,y((p.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):v("",!0),(we=p.ai_content)!=null&&we.total_tokens?(g(),f("div",sa,[l[16]||(l[16]=s("strong",null,"Total Tokens:",-1)),s("span",oa,y(p.ai_content.total_tokens.toLocaleString()),1)])):v("",!0),mt(p)>0?(g(),f("div",aa,[l[17]||(l[17]=s("strong",null,"Avg Speed:",-1)),s("span",la,y(mt(p).toFixed(2))+" tok/s",1)])):v("",!0)])):v("",!0),(xe=p.ai_content)!=null&&xe.user_prompt?(g(),f("div",ra,[l[18]||(l[18]=s("strong",null,"Prompt:",-1)),We(" "+y(je(p.ai_content.user_prompt,150)),1)])):v("",!0),($e=p.ai_content)!=null&&$e.html_content?(g(),f("div",ia,[...l[19]||(l[19]=[s("strong",null,"Response:",-1)])])):v("",!0),(Se=p.ai_content)!=null&&Se.html_content?(g(),f("div",{key:3,class:"ai-preview-text",innerHTML:Oe(p.ai_content.html_content)},null,8,ca)):v("",!0),s("button",{onClick:Y=>ye(p),class:"btn-open-ai"},[...l[20]||(l[20]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,ua)])):v("",!0),p.post_type==="ai_app"&&(p.ai_status==="queued"||p.ai_status==="processing")&&!p.ai_job_id?(g(),f("div",da,[s("div",pa,[s("img",{src:p.author_avatar||"/assets/images/default-avatar.svg",alt:p.author_username,class:"preview-avatar"},null,8,ha),s("h4",null,"@"+y(p.author_username),1)]),s("div",ma,[s("div",_a,[l[21]||(l[21]=s("strong",null,"Status:",-1)),s("span",ga,y(p.ai_status==="queued"?"â³ Queued":"â³ Processing"),1)]),(F=p.ai_content)!=null&&F.generation_model?(g(),f("div",fa,[l[22]||(l[22]=s("strong",null,"Model:",-1)),s("span",ka,y(p.ai_content.generation_model),1)])):v("",!0)]),(kt=p.ai_content)!=null&&kt.user_prompt?(g(),f("div",va,[l[23]||(l[23]=s("strong",null,"Prompt:",-1)),We(" "+y(je(p.ai_content.user_prompt,150)),1)])):v("",!0),(vt=p.ai_content)!=null&&vt.html_content?(g(),f("div",ba,[...l[24]||(l[24]=[s("strong",null,"Response:",-1)])])):v("",!0),(bt=p.ai_content)!=null&&bt.html_content?(g(),f("div",{key:2,class:"ai-preview-text ai-generating",innerHTML:Oe(p.ai_content.html_content)},null,8,ya)):v("",!0),(yt=p.ai_content)!=null&&yt.html_content?(g(),f("button",{key:3,onClick:Y=>ye(p),class:"btn-open-ai"},[...l[25]||(l[25]=[s("span",{class:"icon"},"ðŸ‘ï¸",-1),s("span",null,"View Full Response",-1)])],8,wa)):v("",!0)])):v("",!0),p.media_attachments&&p.media_attachments.length>0?(g(),f("div",xa,[(g(!0),f(me,null,De(p.media_attachments,Y=>(g(),f("img",{key:Y.attachment_id,src:Y.file_url,alt:Y.file_name},null,8,$a))),128))])):v("",!0),s("div",Sa,[s("button",Ca,[l[26]||(l[26]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,y(p.reaction_count||0),1)]),s("button",Ra,[l[27]||(l[27]=s("span",{class:"icon"},"ðŸ’¬",-1)),s("span",null,y(p.comment_count||0),1)]),s("button",Ta,[l[28]||(l[28]=s("span",{class:"icon"},"ðŸ‘",-1)),s("span",null,y(p.view_count||0),1)]),s("button",Aa,[l[29]||(l[29]=s("span",{class:"icon"},"ðŸ“–",-1)),s("span",null,y(p.open_count||0),1)]),s("span",Ia,y(X(p.post_type==="ai_app"?p.updated_at:p.created_at)),1)]),p.post_type!=="ai_app"?(g(),f("div",Pa,[be(St,{"post-id":p.post_id,"max-depth":3,onCommentCreated:_t,onCommentDeleted:gt,onCommentUpdated:ft},null,8,["post-id"])])):v("",!0)],2)}),128))])),_.value&&!c.value?(g(),f("div",Ea,[s("button",{onClick:ke,class:"btn-secondary"},"Load More")])):v("",!0)])])):v("",!0)]),(g(),Ae($t,{to:"body"},[de.value?(g(),f("div",{key:0,class:"modal-overlay",onClick:zt(Ze,["self"])},[s("div",La,[s("div",{class:"modal-header"},[l[31]||(l[31]=s("h2",null,"ðŸ¤– AI Response",-1)),s("button",{onClick:Ze,class:"btn-close"},"Ã—")]),k.value?(g(),f("div",za,[s("div",ja,[l[32]||(l[32]=s("h3",null,"ðŸ“ Prompt",-1)),s("div",Ma,y((($=k.value.ai_content)==null?void 0:$.user_prompt)||"No prompt available"),1)]),(T=k.value.ai_content)!=null&&T.html_content||k.value.ai_status==="processing"?(g(),f("div",qa,[l[34]||(l[34]=s("h3",null,"ðŸ§  Response",-1)),(R=k.value.ai_content)!=null&&R.html_content?(g(),f("div",{key:0,class:ve(["ai-response-content",{"ai-generating":k.value.ai_status==="processing"}]),innerHTML:Wt.value},null,10,Fa)):k.value.ai_status==="processing"?(g(),f("div",Da,[...l[33]||(l[33]=[s("p",{style:{color:"var(--color-text-secondary)","font-style":"italic"}},"Waiting for generation to begin...",-1)])])):v("",!0)])):v("",!0),k.value.ai_content?(g(),f("div",Ba,[l[48]||(l[48]=s("h3",null,"ðŸ“Š Generation Stats",-1)),k.value.ai_status==="processing"?(g(),f("div",Ga,[s("div",Na,[s("div",{class:"progress-bar-fill",style:Fe({width:(k.value.ai_content.progress_percentage||0)+"%"})},null,4)]),s("div",Ua,y(k.value.ai_content.progress_percentage||0)+"%",1)])):v("",!0),s("div",Ha,[s("div",Oa,[l[35]||(l[35]=s("span",{class:"stat-label"},"Model:",-1)),s("span",Va,y(k.value.ai_content.generation_model||k.value.ai_model||"Unknown"),1)]),k.value.ai_status==="processing"?(g(),f(me,{key:0},[k.value.ai_content.elapsed_time?(g(),f("div",Za,[l[36]||(l[36]=s("span",{class:"stat-label"},"Elapsed:",-1)),s("span",Wa,y((k.value.ai_content.elapsed_time/1e3).toFixed(1))+"s",1)])):v("",!0),k.value.ai_content.estimated_remaining?(g(),f("div",Qa,[l[37]||(l[37]=s("span",{class:"stat-label"},"Remaining:",-1)),s("span",Ja,y((k.value.ai_content.estimated_remaining/1e3).toFixed(1))+"s",1)])):v("",!0),k.value.ai_content.current_tokens?(g(),f("div",Xa,[l[38]||(l[38]=s("span",{class:"stat-label"},"Current Tokens:",-1)),s("span",Ka,y(k.value.ai_content.current_tokens.toLocaleString()),1)])):v("",!0),k.value.ai_content.tokens_per_second?(g(),f("div",Ya,[l[39]||(l[39]=s("span",{class:"stat-label"},"Speed:",-1)),s("span",el,y(k.value.ai_content.tokens_per_second.toFixed(2))+" tok/s",1)])):v("",!0),k.value.ai_content.content_length?(g(),f("div",tl,[l[40]||(l[40]=s("span",{class:"stat-label"},"Generated:",-1)),s("span",nl,y(k.value.ai_content.content_length.toLocaleString())+" chars",1)])):v("",!0),k.value.ai_content.chars_per_second?(g(),f("div",sl,[l[41]||(l[41]=s("span",{class:"stat-label"},"Char Speed:",-1)),s("span",ol,y(k.value.ai_content.chars_per_second.toFixed(2))+" char/s",1)])):v("",!0)],64)):(g(),f(me,{key:1},[k.value.ai_content.generation_time?(g(),f("div",al,[l[42]||(l[42]=s("span",{class:"stat-label"},"Time:",-1)),s("span",ll,y((k.value.ai_content.generation_time/1e3).toFixed(2))+"s",1)])):v("",!0),k.value.ai_content.bricks_cost?(g(),f("div",rl,[l[43]||(l[43]=s("span",{class:"stat-label"},"Bricks Cost:",-1)),s("span",il,y(k.value.ai_content.bricks_cost)+" ðŸ§±",1)])):v("",!0),k.value.ai_content.input_tokens?(g(),f("div",cl,[l[44]||(l[44]=s("span",{class:"stat-label"},"Input Tokens:",-1)),s("span",ul,y(k.value.ai_content.input_tokens.toLocaleString()),1)])):v("",!0),k.value.ai_content.output_tokens?(g(),f("div",dl,[l[45]||(l[45]=s("span",{class:"stat-label"},"Output Tokens:",-1)),s("span",pl,y(k.value.ai_content.output_tokens.toLocaleString()),1)])):v("",!0),k.value.ai_content.total_tokens?(g(),f("div",hl,[l[46]||(l[46]=s("span",{class:"stat-label"},"Total Tokens:",-1)),s("span",ml,y(k.value.ai_content.total_tokens.toLocaleString()),1)])):v("",!0),ht.value>0?(g(),f("div",_l,[l[47]||(l[47]=s("span",{class:"stat-label"},"Avg Speed:",-1)),s("span",gl,y(ht.value.toFixed(2))+" tok/s",1)])):v("",!0)],64))])])):v("",!0),k.value?(g(),f("div",fl,[l[55]||(l[55]=s("h3",null,"ðŸ“Š Post Metrics",-1)),s("div",kl,[s("div",vl,[s("button",{class:"counter-button",onClick:l[1]||(l[1]=p=>Xt(k.value))},[s("span",bl,y(k.value.user_liked?"â¤ï¸":"ðŸ¤"),1),s("span",yl,y(k.value.user_liked?"Liked":"Like"),1),s("span",wl,y(k.value.reaction_count||0),1)])]),s("div",xl,[l[49]||(l[49]=s("span",{class:"counter-icon"},"ðŸ’¬",-1)),l[50]||(l[50]=s("span",{class:"counter-label"},"Comments",-1)),s("span",$l,y(k.value.comment_count||0),1)]),s("div",Sl,[l[51]||(l[51]=s("span",{class:"counter-icon"},"ðŸ‘",-1)),l[52]||(l[52]=s("span",{class:"counter-label"},"Views",-1)),s("span",Cl,y(k.value.view_count||0),1)]),s("div",Rl,[l[53]||(l[53]=s("span",{class:"counter-icon"},"ðŸ“–",-1)),l[54]||(l[54]=s("span",{class:"counter-label"},"Opens",-1)),s("span",Tl,y(k.value.open_count||0),1)])])])):v("",!0),k.value?(g(),f("div",Al,[l[56]||(l[56]=s("h3",null,"ðŸ’¬ Comments",-1)),be(St,{"post-id":k.value.post_id,"max-depth":3,onCommentCreated:_t,onCommentDeleted:gt,onCommentUpdated:ft},null,8,["post-id"])])):v("",!0)])):v("",!0),s("div",Il,[s("div",Pl,[s("button",{onClick:Qt,class:"btn-share"},[...l[57]||(l[57]=[s("span",{class:"icon"},"ðŸ”—",-1),s("span",null,"Share Link",-1)])]),s("button",{onClick:l[2]||(l[2]=p=>Jt(k.value.ai_content.html_content,"Response")),class:"btn-copy"},[...l[58]||(l[58]=[s("span",{class:"icon"},"ðŸ“‹",-1),s("span",null,"Copy",-1)])])]),s("button",{onClick:Ze,class:"btn-secondary"},"Close")])])])):v("",!0)])),(g(),Ae($t,{to:"body"},[Ve.value?(g(),f("div",El,y(pt.value),1)):v("",!0)]))],64)}}}),Dl=Ee(Ll,[["__scopeId","data-v-8ea4c7e8"]]);export{Dl as default};
//# sourceMappingURL=WallView-DJlBS1U0.js.map
