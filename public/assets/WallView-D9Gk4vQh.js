import{f as tt,r as m,b as O,e as st,o as et,g as i,k as t,z as at,j as v,t as u,U as x,F as $,x as R,O as ot,Y as lt,R as nt,B as it,v as rt,n as ct,y as dt,u as ut,i as l}from"./vendor-yNGdJvjg.js";import{u as pt,b,_ as vt}from"./index-BHEoJuSR.js";import"./utils-i9HKr1_Q.js";const _t={class:"wall-view"},mt={key:0,class:"loading-container"},ht={key:1,class:"error-container"},ft={key:2,class:"wall-content"},wt={class:"wall-header"},yt={class:"wall-info"},gt={class:"wall-avatar"},bt=["src","alt"],kt={class:"wall-details"},Ct={class:"wall-title"},It={key:0,class:"wall-owner"},At={key:1,class:"wall-description"},Mt={class:"wall-stats"},Pt={class:"stat"},$t={class:"stat-value"},Tt={class:"stat"},St={class:"stat-value"},Lt={class:"posts-section"},Ft={key:0,class:"loading-posts"},Dt={key:1,class:"empty-state"},Et={key:2,class:"posts-grid"},Ot={key:0,class:"ai-generation-status"},xt={class:"progress-bar"},Rt={class:"status-text"},jt={class:"post-header"},Gt=["src","alt"],Ut={class:"post-meta"},Bt={class:"post-author"},Ht={class:"post-time"},Nt={class:"post-content"},Wt=["innerHTML"],qt={key:1},Vt={key:1,class:"ai-content-preview"},zt={class:"ai-preview-prompt"},Jt={key:0,class:"ai-preview-code"},Yt=["onClick"],Kt={key:2,class:"post-media"},Qt=["src","alt"],Xt={class:"post-actions"},Zt={class:"action-btn"},ts={class:"action-btn"},ss={class:"action-btn"},es={key:3,class:"load-more"},as={class:"modal-content ai-modal"},os={key:0,class:"modal-body"},ls={class:"ai-modal-section"},ns={class:"ai-prompt-full"},is={key:0,class:"ai-modal-section"},rs={class:"section-header"},cs={class:"code-block"},ds={key:1,class:"ai-modal-section"},us={class:"section-header"},ps={class:"code-block"},vs={key:2,class:"ai-modal-section"},_s={class:"section-header"},ms={class:"code-block"},T=20,hs=tt({__name:"WallView",props:{wallId:{}},setup(j){const G=j;ut();const U=rt(),S=pt(),k=m(!0),y=m(!1),f=m(null),d=m(null),_=m([]),C=m(1),L=m(!0);let w=null;const B=O(()=>d.value&&S.user&&d.value.user_id===S.user.id),H=O(()=>{var e;return(e=d.value)!=null&&e.theme?{backgroundColor:d.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),N=e=>{const s=new Date(e),r=new Date().getTime()-s.getTime(),n=Math.floor(r/6e4),c=Math.floor(r/36e5),a=Math.floor(r/864e5);return n<1?"just now":n<60?`${n}m ago`:c<24?`${c}h ago`:a<7?`${a}d ago`:s.toLocaleDateString()},W=async()=>{var e,s,o,r;try{k.value=!0,f.value=null;let n=G.wallId||U.params.wallId;if(!n)throw new Error("No wall identifier provided");let c;if(n==="me"?c=await b.get("/walls/me"):c=await b.get(`/walls/${n}`),c!=null&&c.success&&((e=c==null?void 0:c.data)!=null&&e.wall))d.value=c.data.wall,await I();else throw new Error((c==null?void 0:c.message)||"Wall not found")}catch(n){console.error("Error loading wall:",n),((s=n.response)==null?void 0:s.status)===404?f.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":f.value=((r=(o=n.response)==null?void 0:o.data)==null?void 0:r.message)||n.message||"Failed to load wall"}finally{k.value=!1}},I=async(e=!1)=>{var s;if(d.value)try{e||(y.value=!0);const o=(C.value-1)*T,r=await b.get(`/walls/${d.value.wall_id}/posts?limit=${T}&offset=${o}`);if(r!=null&&r.success&&((s=r==null?void 0:r.data)!=null&&s.posts)){const n=r.data.posts;C.value===1?e?q(n):_.value=n:_.value=[..._.value,...n],L.value=n.length===T,V()}}catch(o){console.error("Error loading posts:",o)}finally{e||(y.value=!1)}},q=e=>{const s=new Map(e.map(o=>[o.post_id,o]));_.value.forEach((o,r)=>{const n=s.get(o.post_id);n&&(o.ai_status!==n.ai_status&&(_.value[r]={...o,...n}),s.delete(o.post_id))}),s.size>0&&(_.value=[...Array.from(s.values()),..._.value])},V=()=>{_.value.some(s=>s.post_type==="ai_app"&&(s.ai_status==="queued"||s.ai_status==="processing"))?z():F()},z=()=>{w||(w=setInterval(async()=>{await I(!0)},3e3))},F=()=>{w&&(clearInterval(w),w=null)},J=()=>{C.value++,I()},Y=()=>{console.log("Create post functionality coming soon")},K=e=>({queued:10,processing:60,completed:100,failed:0})[e]||0,Q=e=>({queued:"Waiting in queue...",processing:"Generating your application...",completed:"Generation complete!",failed:"Generation failed"})[e]||"Processing...",D=(e,s)=>e?e.length<=s?e:e.substring(0,s)+"...":"",p=m(null),g=m(!1),X=async e=>{var s;alert("Button clicked! Opening modal...");try{console.log("Opening AI modal for post:",e),console.log("AI app ID:",e.ai_app_id);const o=await b.get(`/ai/apps/${e.ai_app_id}`);console.log("Full API Response:",JSON.stringify(o,null,2)),o!=null&&o.success&&((s=o==null?void 0:o.data)!=null&&s.app)?(p.value={...e,ai_content:o.data.app},console.log("Selected AI Post:",p.value),g.value=!0,console.log("Modal visibility:",g.value),alert("Modal should now be visible!")):(console.error("Invalid response structure. Expected: {success: true, data: {app: {...}}}"),console.error("Received:",o),alert("Failed to load AI content: Invalid response structure"))}catch(o){console.error("Error loading AI content:",o),alert("Failed to load AI content: "+(o.message||"Unknown error"))}},A=()=>{g.value=!1,p.value=null},M=(e,s)=>{navigator.clipboard.writeText(e).then(()=>{alert(`${s} copied to clipboard!`)})},Z=()=>{var E;if(!((E=p.value)!=null&&E.ai_content))return;const e=p.value.ai_content,c=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Generated App</title>
  <style>
${e.css_content||""}
  </style>
</head>
<body>
${e.html_content||""}
  <script>
${e.js_content||""}
  <\/script>
</body>
</html>`,a=new Blob([c],{type:"text/html"}),h=URL.createObjectURL(a),P=document.createElement("a");P.href=h,P.download=`ai-app-${p.value.post_id}.html`,P.click(),URL.revokeObjectURL(h)};return st(()=>{W()}),et(()=>{F()}),(e,s)=>{var o,r,n,c;return l(),i($,null,[t("div",_t,[k.value?(l(),i("div",mt,[...s[4]||(s[4]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading wall...",-1)])])):f.value?(l(),i("div",ht,[s[5]||(s[5]=t("h2",null,"Error Loading Wall",-1)),t("p",null,u(f.value),1),t("button",{onClick:s[0]||(s[0]=a=>e.$router.push("/")),class:"btn-primary"},"Go Home")])):d.value?(l(),i("div",ft,[t("div",wt,[t("div",{class:"wall-banner",style:x(H.value)},null,4),t("div",yt,[t("div",gt,[t("img",{src:d.value.owner_avatar||d.value.avatar_url||"/assets/images/default-avatar.svg",alt:d.value.owner_username||d.value.display_name},null,8,bt)]),t("div",kt,[t("h1",Ct,u(d.value.display_name),1),d.value.owner_username?(l(),i("p",It,"by @"+u(d.value.owner_username),1)):v("",!0),d.value.description?(l(),i("p",At,u(d.value.description),1)):v("",!0)]),t("div",Mt,[t("div",Pt,[t("span",$t,u(d.value.posts_count||0),1),s[6]||(s[6]=t("span",{class:"stat-label"},"Posts",-1))]),t("div",Tt,[t("span",St,u(d.value.subscribers_count||0),1),s[7]||(s[7]=t("span",{class:"stat-label"},"Followers",-1))])])])]),t("div",Lt,[s[17]||(s[17]=t("h2",{class:"section-title"},"Posts",-1)),y.value?(l(),i("div",Ft,[...s[8]||(s[8]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading posts...",-1)])])):_.value.length===0?(l(),i("div",Dt,[s[9]||(s[9]=t("p",null,"No posts yet on this wall.",-1)),B.value?(l(),i("button",{key:0,onClick:Y,class:"btn-primary"},"Create First Post")):v("",!0)])):(l(),i("div",Et,[(l(!0),i($,null,R(_.value,a=>(l(),i("div",{key:a.post_id,class:ct(["post-card",{"ai-post":a.post_type==="ai_app"}])},[a.post_type==="ai_app"&&a.ai_status!=="completed"?(l(),i("div",Ot,[s[10]||(s[10]=t("div",{class:"status-header"},[t("span",{class:"status-icon"},"ðŸ¤–"),t("h3",null,"AI Application Generating...")],-1)),t("div",xt,[t("div",{class:"progress-fill",style:x({width:K(a.ai_status)+"%"})},null,4)]),t("p",Rt,u(Q(a.ai_status)),1)])):v("",!0),t("div",jt,[t("img",{src:a.author_avatar||"/assets/images/default-avatar.svg",alt:a.author_username,class:"post-avatar"},null,8,Gt),t("div",Ut,[t("span",Bt,"@"+u(a.author_username),1),t("span",Ht,u(N(a.created_at)),1)])]),t("div",Nt,[a.content_html?(l(),i("div",{key:0,innerHTML:a.content_html},null,8,Wt)):(l(),i("p",qt,u(a.content_text),1))]),a.post_type==="ai_app"&&a.ai_status==="completed"&&a.ai_content?(l(),i("div",Vt,[s[13]||(s[13]=t("div",{class:"ai-preview-header"},[t("span",{class:"preview-icon"},"âœ¨"),t("h4",null,"Generated Application")],-1)),t("div",zt,[s[11]||(s[11]=t("strong",null,"Prompt:",-1)),dt(" "+u(D(a.ai_content.user_prompt,150)),1)]),a.ai_content.html_content?(l(),i("div",Jt,[t("pre",null,u(D(a.ai_content.html_content,200)),1)])):v("",!0),t("button",{onClick:h=>X(a),class:"btn-open-ai"},[...s[12]||(s[12]=[t("span",{class:"icon"},"ðŸ‘ï¸",-1),t("span",null,"Open Full Content",-1)])],8,Yt)])):v("",!0),a.media_attachments&&a.media_attachments.length>0?(l(),i("div",Kt,[(l(!0),i($,null,R(a.media_attachments,h=>(l(),i("img",{key:h.attachment_id,src:h.file_url,alt:h.file_name},null,8,Qt))),128))])):v("",!0),t("div",Xt,[t("button",Zt,[s[14]||(s[14]=t("span",{class:"icon"},"ðŸ‘",-1)),t("span",null,u(a.reaction_count||0),1)]),t("button",ts,[s[15]||(s[15]=t("span",{class:"icon"},"ðŸ’¬",-1)),t("span",null,u(a.comment_count||0),1)]),t("button",ss,[s[16]||(s[16]=t("span",{class:"icon"},"ðŸ‘",-1)),t("span",null,u(a.view_count||0),1)])])],2))),128))])),L.value&&!y.value?(l(),i("div",es,[t("button",{onClick:J,class:"btn-secondary"},"Load More")])):v("",!0)])])):v("",!0)]),(l(),at(it,{to:"body"},[ot(t("div",{class:"modal-overlay",onClick:nt(A,["self"])},[t("div",as,[t("div",{class:"modal-header"},[s[18]||(s[18]=t("h2",null,"âœ¨ AI Generated Application",-1)),t("button",{onClick:A,class:"btn-close"},"Ã—")]),p.value?(l(),i("div",os,[t("div",ls,[s[19]||(s[19]=t("h3",null,"ðŸ“ Prompt",-1)),t("div",ns,u(((o=p.value.ai_content)==null?void 0:o.user_prompt)||"No prompt available"),1)]),(r=p.value.ai_content)!=null&&r.html_content?(l(),i("div",is,[t("div",rs,[s[20]||(s[20]=t("h3",null,"ðŸŒ HTML",-1)),t("button",{onClick:s[1]||(s[1]=a=>M(p.value.ai_content.html_content,"HTML")),class:"btn-copy-small"},"ðŸ“‹ Copy")]),t("pre",cs,u(p.value.ai_content.html_content),1)])):v("",!0),(n=p.value.ai_content)!=null&&n.css_content?(l(),i("div",ds,[t("div",us,[s[21]||(s[21]=t("h3",null,"ðŸŽ¨ CSS",-1)),t("button",{onClick:s[2]||(s[2]=a=>M(p.value.ai_content.css_content,"CSS")),class:"btn-copy-small"},"ðŸ“‹ Copy")]),t("pre",ps,u(p.value.ai_content.css_content),1)])):v("",!0),(c=p.value.ai_content)!=null&&c.js_content?(l(),i("div",vs,[t("div",_s,[s[22]||(s[22]=t("h3",null,"âš¡ JavaScript",-1)),t("button",{onClick:s[3]||(s[3]=a=>M(p.value.ai_content.js_content,"JavaScript")),class:"btn-copy-small"},"ðŸ“‹ Copy")]),t("pre",ms,u(p.value.ai_content.js_content),1)])):v("",!0)])):v("",!0),t("div",{class:"modal-footer"},[t("button",{onClick:Z,class:"btn-primary"},[...s[23]||(s[23]=[t("span",null,"ðŸ“¥",-1),t("span",null,"Download Full App",-1)])]),t("button",{onClick:A,class:"btn-secondary"},"Close")])])],512),[[lt,g.value]])]))],64)}}}),gs=vt(hs,[["__scopeId","data-v-f75122d9"]]);export{gs as default};
//# sourceMappingURL=WallView-D9Gk4vQh.js.map
