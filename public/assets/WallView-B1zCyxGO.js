import{f as st,r as m,w as N,b as R,e as et,o as at,g as n,k as s,z as lt,j as p,t as d,U as W,F as E,x as H,R as ot,B as nt,v as it,n as ct,y as rt,u as ut,i as o}from"./vendor-B5QdKGWw.js";import{u as dt,b as M,_ as vt}from"./index-DOP6el6m.js";import"./utils-i9HKr1_Q.js";const pt={class:"wall-view"},_t={key:0,class:"loading-container"},mt={key:1,class:"error-container"},ft={key:2,class:"wall-content"},yt={class:"wall-header"},wt={class:"wall-info"},gt={class:"wall-avatar"},ht=["src","alt"],bt={class:"wall-details"},kt={class:"wall-title"},Ct={key:0,class:"wall-owner"},Mt={key:1,class:"wall-description"},It={class:"wall-stats"},$t={class:"stat"},At={class:"stat-value"},Tt={class:"stat"},Lt={class:"stat-value"},St={class:"posts-section"},Ft={key:0,class:"loading-posts"},Et={key:1,class:"empty-state"},xt={key:2,class:"posts-grid"},Dt={key:0,class:"ai-generation-status"},Vt={class:"progress-bar"},jt={class:"status-text"},Gt={class:"post-header"},Nt=["src","alt"],Rt={class:"post-meta"},Wt={class:"post-author"},Ht={class:"post-time"},Ot={class:"post-content"},Ut=["innerHTML"],Bt={key:1},Pt={key:1,class:"ai-content-preview"},qt={class:"ai-preview-prompt"},zt={key:0,class:"ai-preview-code"},Jt=["onClick"],Yt={key:2,class:"post-media"},Kt=["src","alt"],Qt={class:"post-actions"},Xt={class:"action-btn"},Zt={class:"action-btn"},ts={class:"action-btn"},ss={key:3,class:"load-more"},es={class:"modal-content ai-modal"},as={key:0,class:"modal-body"},ls={class:"ai-modal-section"},os={class:"ai-prompt-full"},ns={key:0,class:"ai-modal-section"},is={class:"section-header"},cs={class:"code-block"},rs={key:1,class:"ai-modal-section"},us={class:"section-header"},ds={class:"code-block"},vs={key:2,class:"ai-modal-section"},ps={class:"section-header"},_s={class:"code-block"},x=20,ms=st({__name:"WallView",props:{wallId:{}},setup(O){const D=O;ut();const I=it(),V=dt(),w=m(!0),k=m(!1),f=m(null),c=m(null),_=m([]),g=m(1),C=m(!0);let h=null;N(()=>D.wallId||I.params.wallId,(e,t)=>{e!==t&&t!==void 0&&(console.log("WallView: wallId changed from",t,"to",e),w.value=!0,f.value=null,c.value=null,_.value=[],g.value=1,C.value=!0,b(),$())}),N(()=>I.fullPath,(e,t)=>{console.log("WallView: Route changed from",t,"to",e),t!=null&&t.includes("/wall/")&&!(e!=null&&e.includes("/wall/"))&&(console.log("WallView: Navigating away from wall, cleaning up"),b(),document.body.style.overflow=""),e!=null&&e.includes("/wall/")&&e!==t&&(console.log("WallView: Navigating to wall, reloading"),w.value=!0,f.value=null,c.value=null,_.value=[],g.value=1,C.value=!0,b(),$())});const U=R(()=>c.value&&V.user&&c.value.user_id===V.user.id),B=R(()=>{var e;return(e=c.value)!=null&&e.theme?{backgroundColor:c.value.theme}:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}),P=e=>{const t=new Date(e),r=new Date().getTime()-t.getTime(),i=Math.floor(r/6e4),u=Math.floor(r/36e5),a=Math.floor(r/864e5);return i<1?"just now":i<60?`${i}m ago`:u<24?`${u}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()},$=async()=>{var e,t,l,r;try{w.value=!0,f.value=null;let i=D.wallId||I.params.wallId;if(!i)throw new Error("No wall identifier provided");let u;if(i==="me"?u=await M.get("/walls/me"):u=await M.get(`/walls/${i}`),u!=null&&u.success&&((e=u==null?void 0:u.data)!=null&&e.wall))c.value=u.data.wall,await A();else throw new Error((u==null?void 0:u.message)||"Wall not found")}catch(i){console.error("Error loading wall:",i),((t=i.response)==null?void 0:t.status)===404?f.value="The requested wall could not be found. It may not exist or you may not have permission to view it.":f.value=((r=(l=i.response)==null?void 0:l.data)==null?void 0:r.message)||i.message||"Failed to load wall"}finally{w.value=!1}},A=async(e=!1)=>{var t;if(c.value)try{e||(k.value=!0);const l=(g.value-1)*x,r=await M.get(`/walls/${c.value.wall_id}/posts?limit=${x}&offset=${l}`);if(r!=null&&r.success&&((t=r==null?void 0:r.data)!=null&&t.posts)){const i=r.data.posts;g.value===1?e?q(i):_.value=i:_.value=[..._.value,...i],C.value=i.length===x,z()}}catch(l){console.error("Error loading posts:",l)}finally{e||(k.value=!1)}},q=e=>{const t=new Map(e.map(l=>[l.post_id,l]));_.value.forEach((l,r)=>{const i=t.get(l.post_id);i&&(l.ai_status!==i.ai_status&&(_.value[r]={...l,...i}),t.delete(l.post_id))}),t.size>0&&(_.value=[...Array.from(t.values()),..._.value])},z=()=>{_.value.some(t=>t.post_type==="ai_app"&&(t.ai_status==="queued"||t.ai_status==="processing"))?J():b()},J=()=>{h||(h=setInterval(async()=>{await A(!0)},3e3))},b=()=>{h&&(clearInterval(h),h=null)},Y=()=>{g.value++,A()},K=()=>{console.log("Create post functionality coming soon")},Q=e=>({queued:10,processing:60,completed:100,failed:0})[e]||0,X=e=>({queued:"Waiting in queue...",processing:"Generating your application...",completed:"Generation complete!",failed:"Generation failed"})[e]||"Processing...",j=(e,t)=>e?e.length<=t?e:e.substring(0,t)+"...":"",v=m(null),T=m(!1),Z=async e=>{var t;try{const l=await M.get(`/ai/apps/${e.ai_app_id}`);l!=null&&l.success&&((t=l==null?void 0:l.data)!=null&&t.app)&&(v.value={...e,ai_content:l.data.app},T.value=!0,document.body.style.overflow="hidden")}catch(l){console.error("Error loading AI content:",l)}},L=()=>{T.value=!1,v.value=null,document.body.style.overflow=""},S=(e,t)=>{navigator.clipboard.writeText(e).then(()=>{console.log(`${t} copied to clipboard`)}).catch(l=>{console.error("Failed to copy:",l)})},tt=()=>{var G;if(!((G=v.value)!=null&&G.ai_content))return;const e=v.value.ai_content,u=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Generated App</title>
  <style>
${e.css_content||""}
  </style>
</head>
<body>
${e.html_content||""}
  <script>
${e.js_content||""}
  <\/script>
</body>
</html>`,a=new Blob([u],{type:"text/html"}),y=URL.createObjectURL(a),F=document.createElement("a");F.href=y,F.download=`ai-app-${v.value.post_id}.html`,F.click(),URL.revokeObjectURL(y)};return et(()=>{$()}),at(()=>{b(),document.body.style.overflow=""}),(e,t)=>{var l,r,i,u;return o(),n(E,null,[s("div",pt,[w.value?(o(),n("div",_t,[...t[4]||(t[4]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading wall...",-1)])])):f.value?(o(),n("div",mt,[t[5]||(t[5]=s("h2",null,"Error Loading Wall",-1)),s("p",null,d(f.value),1),s("button",{onClick:t[0]||(t[0]=a=>e.$router.push("/")),class:"btn-primary"},"Go Home")])):c.value?(o(),n("div",ft,[s("div",yt,[s("div",{class:"wall-banner",style:W(B.value)},null,4),s("div",wt,[s("div",gt,[s("img",{src:c.value.owner_avatar||c.value.avatar_url||"/assets/images/default-avatar.svg",alt:c.value.owner_username||c.value.display_name},null,8,ht)]),s("div",bt,[s("h1",kt,d(c.value.display_name),1),c.value.owner_username?(o(),n("p",Ct,"by @"+d(c.value.owner_username),1)):p("",!0),c.value.description?(o(),n("p",Mt,d(c.value.description),1)):p("",!0)]),s("div",It,[s("div",$t,[s("span",At,d(c.value.posts_count||0),1),t[6]||(t[6]=s("span",{class:"stat-label"},"Posts",-1))]),s("div",Tt,[s("span",Lt,d(c.value.subscribers_count||0),1),t[7]||(t[7]=s("span",{class:"stat-label"},"Followers",-1))])])])]),s("div",St,[t[17]||(t[17]=s("h2",{class:"section-title"},"Posts",-1)),k.value?(o(),n("div",Ft,[...t[8]||(t[8]=[s("div",{class:"spinner"},null,-1),s("p",null,"Loading posts...",-1)])])):_.value.length===0?(o(),n("div",Et,[t[9]||(t[9]=s("p",null,"No posts yet on this wall.",-1)),U.value?(o(),n("button",{key:0,onClick:K,class:"btn-primary"},"Create First Post")):p("",!0)])):(o(),n("div",xt,[(o(!0),n(E,null,H(_.value,a=>(o(),n("div",{key:a.post_id,class:ct(["post-card",{"ai-post":a.post_type==="ai_app"}])},[a.post_type==="ai_app"&&a.ai_status!=="completed"?(o(),n("div",Dt,[t[10]||(t[10]=s("div",{class:"status-header"},[s("span",{class:"status-icon"},"🤖"),s("h3",null,"AI Application Generating...")],-1)),s("div",Vt,[s("div",{class:"progress-fill",style:W({width:Q(a.ai_status)+"%"})},null,4)]),s("p",jt,d(X(a.ai_status)),1)])):p("",!0),s("div",Gt,[s("img",{src:a.author_avatar||"/assets/images/default-avatar.svg",alt:a.author_username,class:"post-avatar"},null,8,Nt),s("div",Rt,[s("span",Wt,"@"+d(a.author_username),1),s("span",Ht,d(P(a.created_at)),1)])]),s("div",Ot,[a.content_html?(o(),n("div",{key:0,innerHTML:a.content_html},null,8,Ut)):(o(),n("p",Bt,d(a.content_text),1))]),a.post_type==="ai_app"&&a.ai_status==="completed"&&a.ai_content?(o(),n("div",Pt,[t[13]||(t[13]=s("div",{class:"ai-preview-header"},[s("span",{class:"preview-icon"},"✨"),s("h4",null,"Generated Application")],-1)),s("div",qt,[t[11]||(t[11]=s("strong",null,"Prompt:",-1)),rt(" "+d(j(a.ai_content.user_prompt,150)),1)]),a.ai_content.html_content?(o(),n("div",zt,[s("pre",null,d(j(a.ai_content.html_content,200)),1)])):p("",!0),s("button",{onClick:y=>Z(a),class:"btn-open-ai"},[...t[12]||(t[12]=[s("span",{class:"icon"},"👁️",-1),s("span",null,"Open Full Content",-1)])],8,Jt)])):p("",!0),a.media_attachments&&a.media_attachments.length>0?(o(),n("div",Yt,[(o(!0),n(E,null,H(a.media_attachments,y=>(o(),n("img",{key:y.attachment_id,src:y.file_url,alt:y.file_name},null,8,Kt))),128))])):p("",!0),s("div",Qt,[s("button",Xt,[t[14]||(t[14]=s("span",{class:"icon"},"👍",-1)),s("span",null,d(a.reaction_count||0),1)]),s("button",Zt,[t[15]||(t[15]=s("span",{class:"icon"},"💬",-1)),s("span",null,d(a.comment_count||0),1)]),s("button",ts,[t[16]||(t[16]=s("span",{class:"icon"},"👁",-1)),s("span",null,d(a.view_count||0),1)])])],2))),128))])),C.value&&!k.value?(o(),n("div",ss,[s("button",{onClick:Y,class:"btn-secondary"},"Load More")])):p("",!0)])])):p("",!0)]),(o(),lt(nt,{to:"body"},[T.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:ot(L,["self"])},[s("div",es,[s("div",{class:"modal-header"},[t[18]||(t[18]=s("h2",null,"✨ AI Generated Application",-1)),s("button",{onClick:L,class:"btn-close"},"×")]),v.value?(o(),n("div",as,[s("div",ls,[t[19]||(t[19]=s("h3",null,"📝 Prompt",-1)),s("div",os,d(((l=v.value.ai_content)==null?void 0:l.user_prompt)||"No prompt available"),1)]),(r=v.value.ai_content)!=null&&r.html_content?(o(),n("div",ns,[s("div",is,[t[20]||(t[20]=s("h3",null,"🌐 HTML",-1)),s("button",{onClick:t[1]||(t[1]=a=>S(v.value.ai_content.html_content,"HTML")),class:"btn-copy-small"},"📋 Copy")]),s("pre",cs,d(v.value.ai_content.html_content),1)])):p("",!0),(i=v.value.ai_content)!=null&&i.css_content?(o(),n("div",rs,[s("div",us,[t[21]||(t[21]=s("h3",null,"🎨 CSS",-1)),s("button",{onClick:t[2]||(t[2]=a=>S(v.value.ai_content.css_content,"CSS")),class:"btn-copy-small"},"📋 Copy")]),s("pre",ds,d(v.value.ai_content.css_content),1)])):p("",!0),(u=v.value.ai_content)!=null&&u.js_content?(o(),n("div",vs,[s("div",ps,[t[22]||(t[22]=s("h3",null,"⚡ JavaScript",-1)),s("button",{onClick:t[3]||(t[3]=a=>S(v.value.ai_content.js_content,"JavaScript")),class:"btn-copy-small"},"📋 Copy")]),s("pre",_s,d(v.value.ai_content.js_content),1)])):p("",!0)])):p("",!0),s("div",{class:"modal-footer"},[s("button",{onClick:tt,class:"btn-primary"},[...t[23]||(t[23]=[s("span",null,"📥",-1),s("span",null,"Download Full App",-1)])]),s("button",{onClick:L,class:"btn-secondary"},"Close")])])])):p("",!0)]))],64)}}}),gs=vt(ms,[["__scopeId","data-v-7b3b71f4"]]);export{gs as default};
//# sourceMappingURL=WallView-B1zCyxGO.js.map
