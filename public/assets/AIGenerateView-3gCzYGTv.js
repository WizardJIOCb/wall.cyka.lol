import{f as Y,r as d,b as x,e as K,o as X,g as n,k as e,j as z,W as Q,t as l,A as I,s as G,v as Z,X as M,F as ee,z as se,p as te,n as oe,y as ae,i}from"./vendor-Bfvy7Eak.js";import{u as le,c as b,_ as ne}from"./index-Cj66dHzA.js";import"./utils-Cb2jxgch.js";const ie={class:"ai-generate-view"},re={key:0,class:"job-status-section"},ue={class:"status-card"},de={class:"progress-info"},ce={class:"progress-bar"},pe={class:"progress-text"},ve={key:0,class:"queue-info"},ge={class:"job-details"},be={key:1,class:"result-section"},me={class:"app-preview"},ye=["src"],fe={key:1,class:"preview-placeholder"},he={class:"code-viewer"},_e={class:"code-content"},ke={key:2,class:"generation-form"},we={class:"form-header"},Ce={class:"prompt-section"},je={class:"form-label"},xe={class:"char-count"},Ie={class:"options-section"},Ge={class:"option-group"},Ae={class:"option-group"},Pe={class:"cost-section"},Se={class:"cost-display"},qe={class:"cost-value"},ze={class:"balance-display"},Me={class:"balance-value"},Re={key:0,class:"warning-text"},Te=["disabled"],Ue={class:"history-section"},Ve={key:0,class:"loading-container"},Be={key:1,class:"empty-state"},De={key:2,class:"history-grid"},Ee=["onClick"],Fe={class:"history-content"},Le={class:"history-prompt"},$e={class:"history-meta"},Ne={class:"history-status-text"},He={class:"history-date"},Je=Y({__name:"AIGenerateView",props:{jobId:{}},setup(R){var q;const _=R;ae();const T=te(),A=le(),u=d(""),m=d("gpt-oss:20b"),y=d("normal"),p=d(100),v=d(((q=A.user)==null?void 0:q.bricks_balance)||0),f=d(!1),o=d(null),k=d([]),w=d(!1);let g=null;const U=x(()=>u.value.length>0&&p.value<=v.value),V=x(()=>o.value&&{queued:10,analyzing:30,generating:60,finalizing:90,completed:100,failed:0}[o.value.status]||0),B=x(()=>o.value?{queued:"Waiting in queue...",analyzing:"Analyzing your prompt...",generating:"Generating code...",finalizing:"Finalizing application...",completed:"Generation complete!",failed:"Generation failed"}[o.value.status]||"Processing...":""),h=()=>{const t=Math.ceil(u.value.length/4);let s=100;u.value.length<50?s=50:u.value.length<200?s=Math.ceil(t*2):s=Math.ceil(t*3);const a=t+s;let r=Math.ceil(a/100);const c={normal:0,high:50,urgent:150};p.value=Math.max(1,r+c[y.value])},P=t=>new Date(t).toLocaleString(),D=(t,s)=>t.length>s?t.substring(0,s)+"...":t,E=t=>({queued:"â³",analyzing:"ðŸ”",generating:"âš™ï¸",finalizing:"ðŸ”§",completed:"âœ…",failed:"âŒ"})[t]||"ðŸ“",S=async()=>{try{const t=await b.get("/auth/me");t.success&&t.data.user&&(A.updateUser(t.data.user),v.value=t.data.user.bricks_balance||0)}catch(t){console.error("Error loading bricks balance:",t)}},F=async()=>{try{w.value=!0;const t=await b.get("/ai/history?limit=10");t.data.success&&t.data.data.jobs&&(k.value=t.data.data.jobs)}catch(t){console.error("Error loading history:",t)}finally{w.value=!1}},L=async()=>{var t,s,a;try{f.value=!0,console.log("[AIGenerateView] Submitting generation with model:",m.value);const r={prompt:u.value,model:m.value,priority:y.value};console.log("[AIGenerateView] Full request data:",r);const c=await b.post("/ai/generate",r);console.log("AI Generate Response:",c),c.success&&((t=c.data)!=null&&t.job)&&(o.value=c.data.job,await S(),T.push("/wall/me"))}catch(r){console.error("Generation error:",r),alert(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to start generation")}finally{f.value=!1}},C=async t=>{try{const s=t||_.jobId;if(!s)return;const a=await b.get(`/ai/jobs/${s}`);a.data.success&&a.data.data.job&&(o.value=a.data.data.job,o.value.status!=="completed"&&o.value.status!=="failed"&&$())}catch(s){console.error("Error loading job:",s)}},$=()=>{g||(g=setInterval(async()=>{if(o.value&&(o.value.status==="completed"||o.value.status==="failed")){j();return}await C()},3e3))},j=()=>{g&&(clearInterval(g),g=null)},N=async()=>{var t,s;if(o.value)try{await b.post(`/queue/jobs/${o.value.job_id}/cancel`),o.value.status="cancelled",j()}catch(a){alert(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to cancel job")}},H=()=>{var r;if(!((r=o.value)!=null&&r.generated_code))return;const t=new Blob([o.value.generated_code],{type:"text/html"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`ai-app-${o.value.job_id}.html`,a.click(),URL.revokeObjectURL(s)},J=()=>{console.log("Publish app functionality coming soon")},O=()=>{o.value&&(u.value=o.value.prompt,o.value=null)},W=()=>{var t;(t=o.value)!=null&&t.generated_code&&(navigator.clipboard.writeText(o.value.generated_code),alert("Code copied to clipboard!"))};return K(()=>{h(),S(),F(),_.jobId&&C(_.jobId)}),X(()=>{j()}),(t,s)=>(i(),n("div",ie,[o.value&&o.value.status!=="completed"?(i(),n("div",re,[e("div",ue,[e("div",{class:"status-header"},[s[3]||(s[3]=e("h2",null,"ðŸ¤– AI Generation in Progress",-1)),e("button",{onClick:N,class:"btn-danger-sm"},"Cancel")]),e("div",de,[e("div",ce,[e("div",{class:"progress-fill",style:Q({width:`${V.value}%`})},null,4)]),e("p",pe,l(B.value),1)]),o.value.queue_position>0?(i(),n("div",ve,[s[4]||(s[4]=e("span",{class:"icon"},"â³",-1)),e("span",null,"Position "+l(o.value.queue_position)+" in queue",1)])):z("",!0),e("div",ge,[e("p",null,[s[5]||(s[5]=e("strong",null,"Prompt:",-1)),I(" "+l(o.value.prompt),1)]),e("p",null,[s[6]||(s[6]=e("strong",null,"Status:",-1)),I(" "+l(o.value.status),1)]),e("p",null,[s[7]||(s[7]=e("strong",null,"Started:",-1)),I(" "+l(P(o.value.created_at)),1)])])])])):o.value&&o.value.status==="completed"?(i(),n("div",be,[e("div",{class:"result-header"},[s[11]||(s[11]=e("h2",null,"âœ… Generation Complete!",-1)),e("div",{class:"result-actions"},[e("button",{onClick:H,class:"btn-secondary"},[...s[8]||(s[8]=[e("span",{class:"icon"},"ðŸ“¥",-1),e("span",null,"Download",-1)])]),e("button",{onClick:J,class:"btn-primary"},[...s[9]||(s[9]=[e("span",{class:"icon"},"ðŸ“¤",-1),e("span",null,"Publish",-1)])]),e("button",{onClick:O,class:"btn-secondary"},[...s[10]||(s[10]=[e("span",{class:"icon"},"ðŸ”„",-1),e("span",null,"Remix",-1)])])])]),e("div",me,[o.value.result_url?(i(),n("iframe",{key:0,src:o.value.result_url,class:"preview-frame",sandbox:"allow-scripts allow-forms"},null,8,ye)):(i(),n("div",fe,[...s[12]||(s[12]=[e("p",null,"Preview not available",-1)])]))]),e("div",he,[e("div",{class:"code-header"},[s[13]||(s[13]=e("h3",null,"Generated Code",-1)),e("button",{onClick:W,class:"btn-copy"},"Copy")]),e("pre",_e,l(o.value.generated_code||"Code not available"),1)])])):(i(),n("div",ke,[e("div",we,[e("h1",null,l(t.$t("navigation.aiGenerate")),1),s[14]||(s[14]=e("p",{class:"subtitle"},"Describe your web application and let AI build it for you",-1))]),e("div",Ce,[e("label",je,[s[15]||(s[15]=e("span",null,"Prompt",-1)),e("span",xe,l(u.value.length)+"/2000",1)]),G(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=a=>u.value=a),class:"prompt-input",placeholder:"Example: Create a simple todo list app with add, delete, and mark as complete functionality. Use a clean, modern design with blue colors.",rows:"6",maxlength:"2000",onInput:h},null,544),[[Z,u.value]]),s[16]||(s[16]=e("div",{class:"prompt-tips"},[e("p",null,[e("strong",null,"Tips for better results:")]),e("ul",null,[e("li",null,"Be specific about functionality and features"),e("li",null,"Describe the design style and colors"),e("li",null,"Mention any specific technologies if needed"),e("li",null,"Keep it under 2000 characters")])],-1))]),e("div",Ie,[e("div",Ge,[s[18]||(s[18]=e("label",{class:"form-label"},"Model",-1)),G(e("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>m.value=a),class:"form-select",onChange:h},[...s[17]||(s[17]=[e("option",{selected:"",value:"gpt-oss:20b"},"gpt-oss:20b",-1),e("option",{value:"deepseek-coder:6.7b"},"DeepSeek Coder (Recommended)",-1)])],544),[[M,m.value]])]),e("div",Ae,[s[20]||(s[20]=e("label",{class:"form-label"},"Priority",-1)),G(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>y.value=a),class:"form-select",onChange:h},[...s[19]||(s[19]=[e("option",{value:"normal"},"Normal (Free)",-1),e("option",{value:"high"},"High (+50 ðŸ§±)",-1),e("option",{value:"urgent"},"Urgent (+150 ðŸ§±)",-1)])],544),[[M,y.value]])])]),e("div",Pe,[e("div",Se,[s[21]||(s[21]=e("span",{class:"cost-label"},"Estimated Cost:",-1)),e("span",qe,l(p.value)+" ðŸ§±",1)]),e("div",ze,[s[22]||(s[22]=e("span",null,"Your Balance:",-1)),e("span",Me,l(v.value)+" ðŸ§±",1)]),p.value>v.value?(i(),n("p",Re," âš ï¸ Insufficient bricks. You need "+l(p.value-v.value)+" more bricks. ",1)):z("",!0)]),e("button",{onClick:L,disabled:!U.value||f.value,class:"btn-generate"},l(f.value?"Submitting...":"Generate Application"),9,Te)])),e("div",Ue,[s[25]||(s[25]=e("h2",null,"Recent Generations",-1)),w.value?(i(),n("div",Ve,[...s[23]||(s[23]=[e("div",{class:"spinner"},null,-1)])])):k.value.length===0?(i(),n("div",Be,[...s[24]||(s[24]=[e("p",null,"No generation history yet",-1)])])):(i(),n("div",De,[(i(!0),n(ee,null,se(k.value,a=>(i(),n("div",{key:a.job_id,class:"history-card",onClick:r=>C(a.job_id)},[e("div",{class:oe(["history-status",a.status])},l(E(a.status)),3),e("div",Fe,[e("p",Le,l(D(a.prompt,100)),1),e("div",$e,[e("span",Ne,l(a.status),1),e("span",He,l(P(a.created_at)),1)])])],8,Ee))),128))]))])]))}}),Ke=ne(Je,[["__scopeId","data-v-6b210fc3"]]);export{Ke as default};
//# sourceMappingURL=AIGenerateView-3gCzYGTv.js.map
