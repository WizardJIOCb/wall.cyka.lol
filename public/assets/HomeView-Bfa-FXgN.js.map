{"version":3,"file":"HomeView-Bfa-FXgN.js","sources":["../../frontend/src/stores/posts.ts","../../frontend/src/components/comments/CommentForm.vue","../../frontend/src/components/comments/CommentItem.vue","../../frontend/src/components/comments/CommentSection.vue","../../frontend/src/composables/useRepost.ts","../../frontend/src/components/posts/PostCard.vue","../../frontend/src/components/posts/PostList.vue","../../frontend/src/components/posts/PostCreator.vue","../../frontend/src/composables/useInfiniteScroll.ts","../../frontend/src/views/HomeView.vue"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport type { Post, PaginatedResponse, PostFilters } from '@/types/models'\r\nimport postsAPI from '@/services/api/posts'\r\n\r\nexport const usePostsStore = defineStore('posts', () => {\r\n  // State\r\n  const posts = ref<Post[]>([])\r\n  const feedPosts = ref<Post[]>([])\r\n  const currentPage = ref(1)\r\n  const totalPages = ref(1)\r\n  const hasMore = ref(true)\r\n  const loading = ref(false)\r\n  const filters = ref<PostFilters>({\r\n    content_type: 'all',\r\n    time_range: 'all',\r\n    sort_by: 'recent'\r\n  })\r\n\r\n  // Getters\r\n  const getPostById = computed(() => {\r\n    return (postId: number) => posts.value.find(p => p.id === postId)\r\n  })\r\n\r\n  // Actions\r\n  const fetchFeed = async (page = 1, reset = false) => {\r\n    loading.value = true\r\n    try {\r\n      const response: PaginatedResponse<Post> = await postsAPI.getFeed({\r\n        page,\r\n        per_page: 20,\r\n        content_type: filters.value.content_type !== 'all' ? filters.value.content_type : undefined,\r\n        time_range: filters.value.time_range !== 'all' ? filters.value.time_range : undefined,\r\n        sort_by: filters.value.sort_by\r\n      })\r\n\r\n      // Handle different response structures and ensure we have an array\r\n      const postsData = Array.isArray(response.data) ? response.data : []\r\n      \r\n      if (reset) {\r\n        feedPosts.value = postsData\r\n      } else {\r\n        feedPosts.value.push(...postsData)\r\n      }\r\n\r\n      currentPage.value = response.pagination?.current_page || page\r\n      totalPages.value = response.pagination?.total_pages || 1\r\n      hasMore.value = response.pagination?.has_more || false\r\n\r\n      // Also add to posts cache\r\n      postsData.forEach(post => {\r\n        const existingIndex = posts.value.findIndex(p => p.id === post.id)\r\n        if (existingIndex >= 0) {\r\n          posts.value[existingIndex] = post\r\n        } else {\r\n          posts.value.push(post)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      console.error('Failed to fetch feed:', error)\r\n      // Set empty array on error to prevent issues\r\n      if (reset) {\r\n        feedPosts.value = []\r\n      }\r\n      throw error\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  const loadMore = async () => {\r\n    if (hasMore.value && !loading.value) {\r\n      await fetchFeed(currentPage.value + 1, false)\r\n    }\r\n  }\r\n\r\n  const refreshFeed = async () => {\r\n    currentPage.value = 1\r\n    await fetchFeed(1, true)\r\n  }\r\n\r\n  const createPost = async (postData: any) => {\r\n    try {\r\n      const newPost = await postsAPI.createPost(postData)\r\n      \r\n      // Add to beginning of feed\r\n      feedPosts.value.unshift(newPost)\r\n      posts.value.unshift(newPost)\r\n      \r\n      return newPost\r\n    } catch (error) {\r\n      console.error('Failed to create post:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const updatePost = async (postId: number, updates: any) => {\r\n    try {\r\n      const updatedPost = await postsAPI.updatePost(postId, updates)\r\n      \r\n      // Update in cache\r\n      const feedIndex = feedPosts.value.findIndex(p => p.id === postId)\r\n      if (feedIndex >= 0) {\r\n        feedPosts.value[feedIndex] = updatedPost\r\n      }\r\n      \r\n      const cacheIndex = posts.value.findIndex(p => p.id === postId)\r\n      if (cacheIndex >= 0) {\r\n        posts.value[cacheIndex] = updatedPost\r\n      }\r\n      \r\n      return updatedPost\r\n    } catch (error) {\r\n      console.error('Failed to update post:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const deletePost = async (postId: number) => {\r\n    try {\r\n      await postsAPI.deletePost(postId)\r\n      \r\n      // Remove from feed\r\n      feedPosts.value = feedPosts.value.filter(p => p.id !== postId)\r\n      posts.value = posts.value.filter(p => p.id !== postId)\r\n    } catch (error) {\r\n      console.error('Failed to delete post:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const reactToPost = async (postId: number, reactionType: string) => {\r\n    try {\r\n      await postsAPI.reactToPost(postId, reactionType)\r\n      \r\n      // Update reaction count optimistically\r\n      const post = posts.value.find(p => p.id === postId)\r\n      if (post) {\r\n        post.reactions_count = (post.reactions_count || 0) + 1\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to react to post:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const removeReaction = async (postId: number) => {\r\n    try {\r\n      await postsAPI.removeReaction(postId)\r\n      \r\n      // Update reaction count optimistically\r\n      const post = posts.value.find(p => p.id === postId)\r\n      if (post && post.reactions_count > 0) {\r\n        post.reactions_count--\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to remove reaction:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const setFilters = (newFilters: Partial<PostFilters>) => {\r\n    filters.value = { ...filters.value, ...newFilters }\r\n    refreshFeed()\r\n  }\r\n\r\n  const clearFilters = () => {\r\n    filters.value = {\r\n      content_type: 'all',\r\n      time_range: 'all',\r\n      sort_by: 'recent'\r\n    }\r\n    refreshFeed()\r\n  }\r\n\r\n  return {\r\n    // State\r\n    posts,\r\n    feedPosts,\r\n    currentPage,\r\n    totalPages,\r\n    hasMore,\r\n    loading,\r\n    filters,\r\n    \r\n    // Getters\r\n    getPostById,\r\n    \r\n    // Actions\r\n    fetchFeed,\r\n    loadMore,\r\n    refreshFeed,\r\n    createPost,\r\n    updatePost,\r\n    deletePost,\r\n    reactToPost,\r\n    removeReaction,\r\n    setFilters,\r\n    clearFilters\r\n  }\r\n})\r\n","<template>\r\n  <form @submit.prevent=\"submitComment\" class=\"comment-form\">\r\n    <div class=\"form-group\">\r\n      <textarea\r\n        ref=\"textareaRef\"\r\n        v-model=\"content\"\r\n        :placeholder=\"placeholder || t('comments.write')\"\r\n        :maxlength=\"2000\"\r\n        :rows=\"rows\"\r\n        @input=\"autoResize\"\r\n        @keydown.meta.enter=\"submitComment\"\r\n        @keydown.ctrl.enter=\"submitComment\"\r\n        class=\"comment-textarea\"\r\n      ></textarea>\r\n      \r\n      <div class=\"form-footer\">\r\n        <span \r\n          class=\"char-count\" \r\n          :class=\"{ warning: charCount > 1800, error: charCount > 2000 }\"\r\n        >\r\n          {{ charCount }} / 2000\r\n        </span>\r\n        \r\n        <div class=\"form-actions\">\r\n          <button \r\n            v-if=\"showCancel\"\r\n            type=\"button\"\r\n            @click=\"cancel\"\r\n            class=\"btn btn-secondary\"\r\n            :disabled=\"isSubmitting\"\r\n          >\r\n            {{ t('comments.cancel') }}\r\n          </button>\r\n          <button \r\n            type=\"submit\"\r\n            :disabled=\"!canSubmit || isSubmitting\"\r\n            class=\"btn btn-primary\"\r\n          >\r\n            {{ isSubmitting ? t('comments.posting') : submitButtonText }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div v-if=\"error\" class=\"error-message\">\r\n      {{ error }}\r\n    </div>\r\n  </form>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, watch, onMounted } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport apiClient from '@/services/api/client'\r\n\r\ninterface Props {\r\n  postId?: number\r\n  parentCommentId?: number\r\n  commentId?: number\r\n  initialContent?: string\r\n  placeholder?: string\r\n  rows?: number\r\n  showCancel?: boolean\r\n}\r\n\r\ninterface Emits {\r\n  (e: 'comment-created', comment: any): void\r\n  (e: 'comment-updated', comment: any): void\r\n  (e: 'cancel'): void\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  rows: 3,\r\n  showCancel: true\r\n})\r\n\r\nconst emit = defineEmits<Emits>()\r\nconst { t } = useI18n()\r\n\r\n// State\r\nconst content = ref(props.initialContent || '')\r\nconst isSubmitting = ref(false)\r\nconst error = ref<string | null>(null)\r\nconst textareaRef = ref<HTMLTextAreaElement | null>(null)\r\n\r\n// Computed\r\nconst charCount = computed(() => content.value.length)\r\n\r\nconst canSubmit = computed(() => {\r\n  const trimmed = content.value.trim()\r\n  return trimmed.length > 0 && trimmed.length <= 2000 && !isSubmitting.value\r\n})\r\n\r\nconst submitButtonText = computed(() => {\r\n  if (props.commentId) return t('comments.updateComment')\r\n  if (props.parentCommentId) return t('comments.reply')\r\n  return t('comments.comment')\r\n})\r\n\r\n// Methods\r\nconst autoResize = (event?: Event) => {\r\n  const textarea = textareaRef.value\r\n  if (!textarea) return\r\n  \r\n  textarea.style.height = 'auto'\r\n  textarea.style.height = textarea.scrollHeight + 'px'\r\n}\r\n\r\nconst submitComment = async () => {\r\n  if (!canSubmit.value) return\r\n  \r\n  isSubmitting.value = true\r\n  error.value = null\r\n  \r\n  try {\r\n    let response\r\n    \r\n    if (props.commentId) {\r\n      // Edit existing comment\r\n      response = await apiClient.patch(`/comments/${props.commentId}`, {\r\n        content: content.value.trim()\r\n      })\r\n      emit('comment-updated', response.data.data)\r\n    } else if (props.parentCommentId) {\r\n      // Create reply\r\n      response = await apiClient.post(\r\n        `/comments/${props.parentCommentId}/replies`,\r\n        { content: content.value.trim() }\r\n      )\r\n      emit('comment-created', response.data.data)\r\n    } else if (props.postId) {\r\n      // Create top-level comment\r\n      response = await apiClient.post(`/posts/${props.postId}/comments`, {\r\n        content: content.value.trim()\r\n      })\r\n      emit('comment-created', response.data.data)\r\n    }\r\n    \r\n    // Clear form\r\n    content.value = ''\r\n    if (textareaRef.value) {\r\n      textareaRef.value.style.height = 'auto'\r\n    }\r\n    \r\n  } catch (err: any) {\r\n    error.value = err.response?.data?.message || t('comments.errorPosting')\r\n  } finally {\r\n    isSubmitting.value = false\r\n  }\r\n}\r\n\r\nconst cancel = () => {\r\n  content.value = props.initialContent || ''\r\n  error.value = null\r\n  emit('cancel')\r\n}\r\n\r\n// Watch for initial content changes\r\nwatch(() => props.initialContent, (newVal) => {\r\n  content.value = newVal || ''\r\n})\r\n\r\n// Auto-resize on mount\r\nonMounted(() => {\r\n  autoResize()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.comment-form {\r\n  width: 100%;\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: var(--spacing-xs);\r\n}\r\n\r\n.comment-textarea {\r\n  width: 100%;\r\n  min-height: 60px;\r\n  max-height: 300px;\r\n  padding: var(--spacing-sm);\r\n  border: 1px solid var(--border-color);\r\n  border-radius: var(--radius-sm);\r\n  font-family: inherit;\r\n  font-size: 0.95rem;\r\n  line-height: 1.5;\r\n  background: var(--bg-primary);\r\n  color: var(--text-primary);\r\n  resize: vertical;\r\n  transition: border-color 0.2s;\r\n}\r\n\r\n.comment-textarea:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n}\r\n\r\n.comment-textarea::placeholder {\r\n  color: var(--text-tertiary);\r\n}\r\n\r\n.form-footer {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.char-count {\r\n  font-size: 0.85rem;\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.char-count.warning {\r\n  color: var(--warning);\r\n}\r\n\r\n.char-count.error {\r\n  color: var(--error);\r\n  font-weight: 600;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  gap: var(--spacing-xs);\r\n}\r\n\r\n.btn {\r\n  padding: var(--spacing-xs) var(--spacing-md);\r\n  border: none;\r\n  border-radius: var(--radius-sm);\r\n  font-size: 0.9rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.btn:disabled {\r\n  opacity: 0.5;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.btn-primary {\r\n  background: var(--primary);\r\n  color: white;\r\n}\r\n\r\n.btn-primary:hover:not(:disabled) {\r\n  background: var(--primary-dark);\r\n}\r\n\r\n.btn-secondary {\r\n  background: var(--bg-secondary);\r\n  color: var(--text-primary);\r\n  border: 1px solid var(--border-color);\r\n}\r\n\r\n.btn-secondary:hover:not(:disabled) {\r\n  background: var(--bg-tertiary);\r\n}\r\n\r\n.error-message {\r\n  margin-top: var(--spacing-xs);\r\n  padding: var(--spacing-xs) var(--spacing-sm);\r\n  background: var(--error-bg);\r\n  color: var(--error);\r\n  border-radius: var(--radius-sm);\r\n  font-size: 0.9rem;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .comment-textarea {\r\n    font-size: 16px; /* Prevent zoom on iOS */\r\n  }\r\n}\r\n</style>\r\n","<template>\r\n  <div \r\n    v-if=\"comment && comment.comment_id\"\r\n    class=\"comment-item\" \r\n    :class=\"`depth-${depth}`\"\r\n    :style=\"{ marginLeft: indentPixels }\"\r\n  >\r\n    <div class=\"comment-header\">\r\n      <img \r\n        :src=\"comment.author_avatar || '/default-avatar.png'\" \r\n        :alt=\"comment.author_name\"\r\n        class=\"avatar\" \r\n      />\r\n      <div class=\"comment-meta\">\r\n        <router-link \r\n          :to=\"`/users/${comment.author_id}`\"\r\n          class=\"author-name\"\r\n        >\r\n          {{ comment.author_name }}\r\n        </router-link>\r\n        <span class=\"timestamp\">{{ formatTime(comment.created_at) }}</span>\r\n        <span v-if=\"comment.is_edited\" class=\"edited-badge\">\r\n          {{ t('comments.edited') }}\r\n        </span>\r\n      </div>\r\n      \r\n      <div class=\"comment-actions\" v-if=\"isOwner\">\r\n        <button \r\n          @click=\"startEdit\"\r\n          :disabled=\"!canEdit\"\r\n          :title=\"canEdit ? t('comments.edit') : t('comments.editExpired')\"\r\n          class=\"action-btn\"\r\n        >\r\n          <span>‚úèÔ∏è</span>\r\n        </button>\r\n        <button \r\n          @click=\"deleteComment\"\r\n          :title=\"t('comments.delete')\"\r\n          class=\"action-btn\"\r\n        >\r\n          <span>üóëÔ∏è</span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"comment-content\">\r\n      <p v-if=\"!isEditing\" v-html=\"comment.content_html\"></p>\r\n      <CommentForm\r\n        v-else\r\n        :comment-id=\"comment.comment_id\"\r\n        :initial-content=\"comment.content_text\"\r\n        :show-cancel=\"true\"\r\n        :rows=\"2\"\r\n        @comment-updated=\"onUpdated\"\r\n        @cancel=\"isEditing = false\"\r\n      />\r\n    </div>\r\n    \r\n    <div class=\"comment-footer\">\r\n      <button \r\n        class=\"reaction-btn\"\r\n        @click=\"toggleReactionPicker\"\r\n        :class=\"{ active: comment.user_reaction }\"\r\n      >\r\n        <span v-if=\"comment.user_reaction\" class=\"user-reaction\">\r\n          {{ getReactionEmoji(comment.user_reaction) }}\r\n        </span>\r\n        <span v-else>üëç</span>\r\n        <span v-if=\"comment.reaction_count > 0\" class=\"count\">\r\n          {{ formatCount(comment.reaction_count) }}\r\n        </span>\r\n      </button>\r\n      \r\n      <button \r\n        v-if=\"depth < maxDepth\"\r\n        @click=\"toggleReply\"\r\n        class=\"reply-btn\"\r\n      >\r\n        {{ t('comments.reply') }}\r\n        <span v-if=\"comment.reply_count > 0\" class=\"count\">\r\n          ({{ comment.reply_count }})\r\n        </span>\r\n      </button>\r\n      \r\n      <button \r\n        v-if=\"comment.reply_count > 0 && comment.replies\"\r\n        @click=\"toggleReplies\"\r\n        class=\"collapse-btn\"\r\n      >\r\n        {{ repliesExpanded ? t('comments.hideReplies') : t('comments.showReplies') }}\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- Reaction Picker -->\r\n    <div \r\n      v-if=\"showReactionPicker\"\r\n      class=\"reaction-picker\"\r\n      @click.stop\r\n    >\r\n      <button\r\n        v-for=\"reaction in reactionTypes\"\r\n        :key=\"reaction.type\"\r\n        @click=\"reactToComment(reaction.type)\"\r\n        class=\"reaction-option\"\r\n        :class=\"{ selected: comment.user_reaction === reaction.type }\"\r\n        :title=\"reaction.label\"\r\n      >\r\n        {{ reaction.emoji }}\r\n      </button>\r\n      <button @click=\"showReactionPicker = false\" class=\"close-picker\">\r\n        ‚úï\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- Reply Form -->\r\n    <div v-if=\"showReplyForm\" class=\"reply-form\">\r\n      <CommentForm\r\n        :post-id=\"postId\"\r\n        :parent-comment-id=\"comment.comment_id\"\r\n        :placeholder=\"t('comments.writeReply')\"\r\n        :rows=\"2\"\r\n        @comment-created=\"onReplyCreated\"\r\n        @cancel=\"showReplyForm = false\"\r\n      />\r\n    </div>\r\n    \r\n    <!-- Nested Replies -->\r\n    <div v-if=\"repliesExpanded && comment.replies && comment.replies.length > 0\" class=\"replies\">\r\n      <CommentItem\r\n        v-for=\"reply in comment.replies\"\r\n        :key=\"reply.comment_id\"\r\n        :comment=\"reply\"\r\n        :post-id=\"postId\"\r\n        :depth=\"depth + 1\"\r\n        :max-depth=\"maxDepth\"\r\n        @reply-created=\"$emit('reply-created', $event)\"\r\n        @comment-updated=\"$emit('comment-updated', $event)\"\r\n        @comment-deleted=\"$emit('comment-deleted', $event)\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport apiClient from '@/services/api/client'\r\nimport CommentForm from './CommentForm.vue'\r\n\r\ninterface Comment {\r\n  comment_id: number\r\n  post_id: number\r\n  author_id: number\r\n  author_username: string\r\n  author_name: string\r\n  author_avatar: string | null\r\n  parent_comment_id: number | null\r\n  content_text: string\r\n  content_html: string\r\n  depth_level: number\r\n  reply_count: number\r\n  reaction_count: number\r\n  like_count: number\r\n  dislike_count: number\r\n  is_edited: boolean\r\n  is_hidden: boolean\r\n  replies?: Comment[]\r\n  created_at: string\r\n  updated_at: string\r\n  user_reaction?: string | null\r\n}\r\n\r\ninterface Props {\r\n  comment: Comment\r\n  postId: number\r\n  depth?: number\r\n  maxDepth?: number\r\n}\r\n\r\ninterface Emits {\r\n  (e: 'reply-created', comment: Comment): void\r\n  (e: 'comment-updated', comment: Comment): void\r\n  (e: 'comment-deleted', commentId: number): void\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  depth: 0,\r\n  maxDepth: 4\r\n})\r\n\r\nconst emit = defineEmits<Emits>()\r\nconst { t } = useI18n()\r\nconst authStore = useAuthStore()\r\n\r\n// Add safety check for comment prop\r\nif (!props.comment) {\r\n  console.warn('CommentItem: comment prop is required')\r\n}\r\n\r\n// Helper function to validate comment objects\r\nconst isValidComment = (comment: any): comment is Comment => {\r\n  return (\r\n    comment !== null &&\r\n    comment !== undefined &&\r\n    typeof comment === 'object' &&\r\n    typeof comment.comment_id === 'number' &&\r\n    comment.comment_id > 0\r\n  )\r\n}\r\n\r\n// State\r\nconst isEditing = ref(false)\r\nconst showReplyForm = ref(false)\r\nconst showReactionPicker = ref(false)\r\nconst repliesExpanded = ref(true)\r\n\r\n// Reaction types\r\nconst reactionTypes = [\r\n  { type: 'like', emoji: 'üëç', label: 'Like' },\r\n  { type: 'dislike', emoji: 'üëé', label: 'Dislike' },\r\n  { type: 'heart', emoji: '‚ù§Ô∏è', label: 'Love' },\r\n  { type: 'laugh', emoji: 'üòÇ', label: 'Laugh' },\r\n  { type: 'wow', emoji: 'üòÆ', label: 'Wow' },\r\n  { type: 'sad', emoji: 'üò¢', label: 'Sad' },\r\n  { type: 'angry', emoji: 'üò†', label: 'Angry' }\r\n]\r\n\r\n// Computed\r\nconst isOwner = computed(() => {\r\n  return props.comment && authStore.user?.user_id === props.comment.author_id\r\n})\r\n\r\nconst canEdit = computed(() => {\r\n  if (!props.comment) return false\r\n  const createdTime = new Date(props.comment.created_at).getTime()\r\n  const now = Date.now()\r\n  const minutesPassed = (now - createdTime) / 1000 / 60\r\n  return minutesPassed < 15\r\n})\r\n\r\nconst indentPixels = computed(() => {\r\n  if (!props.comment || props.depth === 0) return '0'\r\n  const baseIndent = window.innerWidth > 768 ? 24 : 12\r\n  return `${props.depth * baseIndent}px`\r\n})\r\n\r\n// Methods\r\nconst formatTime = (timestamp: string) => {\r\n  const date = new Date(timestamp)\r\n  const now = new Date()\r\n  const diffMs = now.getTime() - date.getTime()\r\n  const diffMins = Math.floor(diffMs / 60000)\r\n  \r\n  if (diffMins < 1) return t('comments.justNow')\r\n  if (diffMins < 60) return t('comments.minutesAgo', { count: diffMins })\r\n  \r\n  const diffHours = Math.floor(diffMins / 60)\r\n  if (diffHours < 24) return t('comments.hoursAgo', { count: diffHours })\r\n  \r\n  const diffDays = Math.floor(diffHours / 24)\r\n  if (diffDays < 7) return t('comments.daysAgo', { count: diffDays })\r\n  \r\n  return date.toLocaleDateString()\r\n}\r\n\r\nconst formatCount = (count: number) => {\r\n  if (count >= 1000000) return (count / 1000000).toFixed(1) + 'M'\r\n  if (count >= 1000) return (count / 1000).toFixed(1) + 'K'\r\n  return count.toString()\r\n}\r\n\r\nconst getReactionEmoji = (type: string) => {\r\n  const reaction = reactionTypes.find(r => r.type === type)\r\n  return reaction?.emoji || 'üëç'\r\n}\r\n\r\nconst startEdit = () => {\r\n  if (!canEdit.value) return\r\n  isEditing.value = true\r\n}\r\n\r\nconst deleteComment = async () => {\r\n  if (!props.comment || !confirm(t('comments.deleteConfirm'))) return\r\n  \r\n  try {\r\n    await apiClient.delete(`/comments/${props.comment.comment_id}`)\r\n    emit('comment-deleted', props.comment.comment_id)\r\n  } catch (error) {\r\n    console.error('Failed to delete comment:', error)\r\n  }\r\n}\r\n\r\nconst toggleReply = () => {\r\n  showReplyForm.value = !showReplyForm.value\r\n  if (showReplyForm.value) {\r\n    showReactionPicker.value = false\r\n  }\r\n}\r\n\r\nconst toggleReplies = () => {\r\n  repliesExpanded.value = !repliesExpanded.value\r\n}\r\n\r\nconst toggleReactionPicker = () => {\r\n  showReactionPicker.value = !showReactionPicker.value\r\n  if (showReactionPicker.value) {\r\n    showReplyForm.value = false\r\n  }\r\n}\r\n\r\nconst reactToComment = async (reactionType: string) => {\r\n  if (!props.comment) return\r\n  \r\n  try {\r\n    const response = await apiClient.post(\r\n      `/comments/${props.comment.comment_id}/reactions`,\r\n      { reaction_type: reactionType }\r\n    )\r\n    \r\n    // Update local state\r\n    props.comment.reaction_count = response.data.data.reaction_count\r\n    props.comment.like_count = response.data.data.like_count\r\n    props.comment.dislike_count = response.data.data.dislike_count\r\n    \r\n    // Update user's reaction\r\n    if (response.data.data.action === 'removed') {\r\n      props.comment.user_reaction = null\r\n    } else {\r\n      props.comment.user_reaction = reactionType\r\n    }\r\n    \r\n    showReactionPicker.value = false\r\n  } catch (error) {\r\n    console.error('Failed to react:', error)\r\n  }\r\n}\r\n\r\nconst onUpdated = (updatedComment: Comment) => {\r\n  isEditing.value = false\r\n  emit('comment-updated', updatedComment)\r\n}\r\n\r\nconst onReplyCreated = (reply: Comment) => {\r\n  showReplyForm.value = false\r\n  \r\n  // Add reply to local state\r\n  if (!props.comment) return\r\n  if (!props.comment.replies) {\r\n    props.comment.replies = []\r\n  }\r\n  props.comment.replies.push(reply)\r\n  props.comment.reply_count++\r\n  \r\n  emit('reply-created', reply)\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.comment-item {\r\n  padding: var(--spacing-sm);\r\n  border-left: 2px solid transparent;\r\n  margin-bottom: var(--spacing-sm);\r\n  transition: background-color 0.2s;\r\n}\r\n\r\n.comment-item:hover {\r\n  background: var(--bg-secondary);\r\n  border-left-color: var(--border-color);\r\n}\r\n\r\n.comment-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: var(--spacing-xs);\r\n  margin-bottom: var(--spacing-xs);\r\n}\r\n\r\n.avatar {\r\n  width: 32px;\r\n  height: 32px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n}\r\n\r\n.comment-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: var(--spacing-xs);\r\n  flex: 1;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.author-name {\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n  text-decoration: none;\r\n}\r\n\r\n.author-name:hover {\r\n  color: var(--primary);\r\n}\r\n\r\n.timestamp {\r\n  font-size: 0.85rem;\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.edited-badge {\r\n  font-size: 0.8rem;\r\n  color: var(--text-tertiary);\r\n  font-style: italic;\r\n}\r\n\r\n.comment-actions {\r\n  display: flex;\r\n  gap: var(--spacing-xs);\r\n}\r\n\r\n.action-btn {\r\n  background: transparent;\r\n  border: none;\r\n  padding: var(--spacing-xs);\r\n  cursor: pointer;\r\n  opacity: 0.6;\r\n  transition: opacity 0.2s;\r\n}\r\n\r\n.action-btn:hover:not(:disabled) {\r\n  opacity: 1;\r\n}\r\n\r\n.action-btn:disabled {\r\n  opacity: 0.3;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.comment-content {\r\n  color: var(--text-primary);\r\n  line-height: 1.6;\r\n  margin-bottom: var(--spacing-sm);\r\n  word-wrap: break-word;\r\n}\r\n\r\n.comment-content p {\r\n  margin: 0;\r\n}\r\n\r\n.comment-footer {\r\n  display: flex;\r\n  gap: var(--spacing-sm);\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.reaction-btn,\r\n.reply-btn,\r\n.collapse-btn {\r\n  background: transparent;\r\n  border: 1px solid var(--border-color);\r\n  padding: var(--spacing-xs) var(--spacing-sm);\r\n  border-radius: var(--radius-sm);\r\n  font-size: 0.9rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n}\r\n\r\n.reaction-btn:hover,\r\n.reply-btn:hover,\r\n.collapse-btn:hover {\r\n  background: var(--bg-tertiary);\r\n  border-color: var(--primary);\r\n}\r\n\r\n.reaction-btn.active {\r\n  border-color: var(--primary);\r\n  background: var(--primary-light);\r\n}\r\n\r\n.count {\r\n  font-size: 0.85rem;\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.reaction-picker {\r\n  position: absolute;\r\n  margin-top: var(--spacing-xs);\r\n  background: var(--bg-primary);\r\n  border: 1px solid var(--border-color);\r\n  border-radius: var(--radius-md);\r\n  padding: var(--spacing-xs);\r\n  display: flex;\r\n  gap: var(--spacing-xs);\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n  z-index: 10;\r\n}\r\n\r\n.reaction-option {\r\n  background: transparent;\r\n  border: 2px solid transparent;\r\n  padding: var(--spacing-xs);\r\n  border-radius: var(--radius-sm);\r\n  font-size: 1.3rem;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.reaction-option:hover {\r\n  background: var(--bg-secondary);\r\n  transform: scale(1.2);\r\n}\r\n\r\n.reaction-option.selected {\r\n  border-color: var(--primary);\r\n  background: var(--primary-light);\r\n}\r\n\r\n.close-picker {\r\n  background: var(--bg-secondary);\r\n  border: none;\r\n  padding: var(--spacing-xs);\r\n  border-radius: var(--radius-sm);\r\n  cursor: pointer;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.reply-form {\r\n  margin-top: var(--spacing-sm);\r\n  margin-bottom: var(--spacing-sm);\r\n}\r\n\r\n.replies {\r\n  margin-top: var(--spacing-sm);\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .avatar {\r\n    width: 28px;\r\n    height: 28px;\r\n  }\r\n  \r\n  .comment-meta {\r\n    font-size: 0.9rem;\r\n  }\r\n  \r\n  .reaction-picker {\r\n    flex-wrap: wrap;\r\n    max-width: 280px;\r\n  }\r\n}\r\n</style>","<template>\r\n  <div class=\"comment-section\">\r\n    <div class=\"comment-section-header\">\r\n      <h3 class=\"section-title\">\r\n        {{ t('comments.title') }} ({{ totalCount }})\r\n      </h3>\r\n      \r\n      <div class=\"comment-controls\">\r\n        <select v-model=\"sortBy\" class=\"sort-select\" @change=\"fetchComments\">\r\n          <option value=\"created_asc\">{{ t('comments.sortOldest') }}</option>\r\n          <option value=\"created_desc\">{{ t('comments.sortNewest') }}</option>\r\n          <option value=\"reactions\">{{ t('comments.sortReactions') }}</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <div v-if=\"allowComments\" class=\"comment-form-container\">\r\n      <CommentForm\r\n        :post-id=\"postId\"\r\n        :show-cancel=\"false\"\r\n        @comment-created=\"onCommentCreated\"\r\n      />\r\n    </div>\r\n    \r\n    <div v-if=\"loading && comments.length === 0\" class=\"loading-state\">\r\n      <div class=\"spinner\"></div>\r\n      <p>{{ t('comments.loading') }}</p>\r\n    </div>\r\n    \r\n    <div v-else-if=\"comments.length === 0\" class=\"empty-state\">\r\n      <p>{{ t('comments.noComments') }}</p>\r\n    </div>\r\n    \r\n    <div v-else class=\"comments-list\">\r\n      <CommentItem\r\n        v-for=\"comment in topLevelComments\"\r\n        :key=\"comment.comment_id\"\r\n        :comment=\"comment\"\r\n        :post-id=\"postId\"\r\n        :depth=\"0\"\r\n        :max-depth=\"4\"\r\n        @reply-created=\"onReplyCreated\"\r\n        @comment-updated=\"onCommentUpdated\"\r\n        @comment-deleted=\"onCommentDeleted\"\r\n      />\r\n    </div>\r\n    \r\n    <button \r\n      v-if=\"hasMore && !loading\"\r\n      @click=\"loadMore\"\r\n      class=\"load-more-btn\"\r\n    >\r\n      {{ t('comments.loadMore') }}\r\n    </button>\r\n    \r\n    <div v-if=\"loading && comments.length > 0\" class=\"loading-more\">\r\n      <div class=\"spinner-small\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport apiClient from '@/services/api/client'\r\nimport CommentForm from './CommentForm.vue'\r\nimport CommentItem from './CommentItem.vue'\r\n\r\ninterface Comment {\r\n  comment_id: number\r\n  post_id: number\r\n  author_id: number\r\n  author_username: string\r\n  author_name: string\r\n  author_avatar: string | null\r\n  parent_comment_id: number | null\r\n  content_text: string\r\n  content_html: string\r\n  depth_level: number\r\n  reply_count: number\r\n  reaction_count: number\r\n  like_count: number\r\n  dislike_count: number\r\n  is_edited: boolean\r\n  is_hidden: boolean\r\n  replies?: Comment[]\r\n  created_at: string\r\n  updated_at: string\r\n  user_reaction?: string | null\r\n}\r\n\r\ninterface Props {\r\n  postId: number\r\n  initialComments?: Comment[]\r\n  allowComments?: boolean\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  allowComments: true,\r\n  initialComments: () => []\r\n})\r\n\r\nconst { t } = useI18n()\r\n\r\n// State\r\nconst comments = ref<Comment[]>(props.initialComments)\r\nconst loading = ref(false)\r\nconst hasMore = ref(false)\r\nconst sortBy = ref('created_asc')\r\nconst totalCount = ref(0)\r\nconst pollInterval = ref<number | null>(null)\r\n\r\n// Computed\r\nconst topLevelComments = computed(() => {\r\n  return comments.value.filter((c: any) => c && c.comment_id && !c.parent_comment_id)\r\n})\r\n\r\n// Helper function to validate comment objects\r\nconst isValidComment = (comment: any): comment is Comment => {\r\n  // More comprehensive validation to handle potential API response issues\r\n  if (comment === null || comment === undefined || typeof comment !== 'object') {\r\n    return false\r\n  }\r\n  \r\n  if (typeof comment.comment_id !== 'number' || comment.comment_id <= 0) {\r\n    return false\r\n  }\r\n  \r\n  // Additional validation for required fields\r\n  const requiredFields = ['post_id', 'author_id', 'content_text', 'content_html', 'created_at']\r\n  for (const field of requiredFields) {\r\n    if (!(field in comment)) {\r\n      return false\r\n    }\r\n  }\r\n  \r\n  return true\r\n}\r\n\r\n// Methods\r\nconst fetchComments = async () => {\r\n  loading.value = true\r\n  \r\n  try {\r\n    const response = await apiClient.get(`/posts/${props.postId}/comments`, {\r\n      params: {\r\n        sort: sortBy.value,\r\n        limit: 50\r\n      }\r\n    })\r\n    \r\n    // The API client interceptor already unwraps the response\r\n    // response is already the data part: { comments: [...], count: 6, has_more: false }\r\n    // Make sure we have valid data before accessing properties\r\n    if (response && response.comments && Array.isArray(response.comments)) {\r\n      comments.value = response.comments.filter(isValidComment)\r\n      hasMore.value = response.has_more || false\r\n      totalCount.value = response.count || 0\r\n    } else {\r\n      comments.value = []\r\n      hasMore.value = false\r\n      totalCount.value = 0\r\n    }\r\n    \r\n    // Build comment tree\r\n    buildCommentTree()\r\n    \r\n  } catch (error) {\r\n    console.error('Failed to fetch comments:', error)\r\n    comments.value = []\r\n    hasMore.value = false\r\n    totalCount.value = 0\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst buildCommentTree = () => {\r\n  // Create a map for quick lookup\r\n  const commentMap = new Map<number, Comment>()\r\n  comments.value.forEach((comment: any) => {\r\n    if (isValidComment(comment)) {\r\n      comment.replies = []\r\n      commentMap.set(comment.comment_id, comment)\r\n    }\r\n  })\r\n  \r\n  // Build tree structure\r\n  comments.value.forEach((comment: any) => {\r\n    if (isValidComment(comment) && comment.parent_comment_id) {\r\n      const parent = commentMap.get(comment.parent_comment_id)\r\n      if (parent && parent.replies) {\r\n        parent.replies.push(comment)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst loadMore = async () => {\r\n  // In a real implementation, this would use offset/cursor pagination\r\n  // For now, just a placeholder\r\n  console.log('Load more comments')\r\n}\r\n\r\nconst onCommentCreated = (comment: Comment) => {\r\n  // Add new comment to the beginning\r\n  if (isValidComment(comment)) {\r\n    comments.value.unshift(comment)\r\n    totalCount.value++\r\n    buildCommentTree()\r\n  }\r\n}\r\n\r\nconst onReplyCreated = (reply: Comment) => {\r\n  // Reply is already added to parent in CommentItem\r\n  if (isValidComment(reply)) {\r\n    totalCount.value++\r\n  }\r\n}\r\n\r\nconst onCommentUpdated = (updatedComment: Comment) => {\r\n  if (isValidComment(updatedComment)) {\r\n    const index = comments.value.findIndex((c: any) => isValidComment(c) && c.comment_id === updatedComment.comment_id)\r\n    if (index !== -1) {\r\n      comments.value[index] = { ...comments.value[index], ...updatedComment }\r\n      buildCommentTree()\r\n    }\r\n  }\r\n}\r\n\r\nconst onCommentDeleted = (commentId: number) => {\r\n  comments.value = comments.value.filter((c: any) => isValidComment(c) && c.comment_id !== commentId)\r\n  totalCount.value--\r\n  buildCommentTree()\r\n}\r\n\r\nconst startPolling = () => {\r\n  // Poll for new comments every 10 seconds\r\n  pollInterval.value = window.setInterval(() => {\r\n    if (!loading.value) {\r\n      fetchComments()\r\n    }\r\n  }, 10000)\r\n}\r\n\r\nconst stopPolling = () => {\r\n  if (pollInterval.value) {\r\n    clearInterval(pollInterval.value)\r\n    pollInterval.value = null\r\n  }\r\n}\r\n\r\n// Lifecycle\r\nonMounted(() => {\r\n  if (comments.value.length === 0) {\r\n    fetchComments()\r\n  } else {\r\n    buildCommentTree()\r\n    totalCount.value = comments.value.length\r\n  }\r\n  startPolling()\r\n})\r\n\r\nonUnmounted(() => {\r\n  stopPolling()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.comment-section {\r\n  width: 100%;\r\n  background: var(--bg-primary);\r\n  border-radius: var(--radius-md);\r\n  padding: var(--spacing-md);\r\n  margin-top: var(--spacing-md);\r\n}\r\n\r\n.comment-section-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: var(--spacing-md);\r\n  flex-wrap: wrap;\r\n  gap: var(--spacing-sm);\r\n}\r\n\r\n.section-title {\r\n  font-size: 1.25rem;\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n  margin: 0;\r\n}\r\n\r\n.comment-controls {\r\n  display: flex;\r\n  gap: var(--spacing-sm);\r\n  align-items: center;\r\n}\r\n\r\n.sort-select {\r\n  padding: var(--spacing-xs) var(--spacing-sm);\r\n  border: 1px solid var(--border-color);\r\n  border-radius: var(--radius-sm);\r\n  background: var(--bg-primary);\r\n  color: var(--text-primary);\r\n  font-size: 0.9rem;\r\n  cursor: pointer;\r\n}\r\n\r\n.sort-select:focus {\r\n  outline: none;\r\n  border-color: var(--primary);\r\n}\r\n\r\n.comment-form-container {\r\n  margin-bottom: var(--spacing-md);\r\n  padding-bottom: var(--spacing-md);\r\n  border-bottom: 1px solid var(--border-color);\r\n}\r\n\r\n.comments-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.loading-state,\r\n.empty-state {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: var(--spacing-xl);\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.spinner {\r\n  width: 40px;\r\n  height: 40px;\r\n  border: 3px solid var(--border-color);\r\n  border-top-color: var(--primary);\r\n  border-radius: 50%;\r\n  animation: spin 0.8s linear infinite;\r\n}\r\n\r\n.spinner-small {\r\n  width: 24px;\r\n  height: 24px;\r\n  border: 2px solid var(--border-color);\r\n  border-top-color: var(--primary);\r\n  border-radius: 50%;\r\n  animation: spin 0.8s linear infinite;\r\n  margin: var(--spacing-md) auto;\r\n}\r\n\r\n@keyframes spin {\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n.empty-state p {\r\n  margin-top: var(--spacing-sm);\r\n  font-size: 1rem;\r\n}\r\n\r\n.load-more-btn {\r\n  width: 100%;\r\n  padding: var(--spacing-sm) var(--spacing-md);\r\n  margin-top: var(--spacing-md);\r\n  background: var(--bg-secondary);\r\n  border: 1px solid var(--border-color);\r\n  border-radius: var(--radius-sm);\r\n  color: var(--text-primary);\r\n  font-size: 0.95rem;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n\r\n.load-more-btn:hover {\r\n  background: var(--bg-tertiary);\r\n  border-color: var(--primary);\r\n}\r\n\r\n.loading-more {\r\n  display: flex;\r\n  justify-content: center;\r\n  padding: var(--spacing-md);\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .comment-section {\r\n    padding: var(--spacing-sm);\r\n  }\r\n  \r\n  .section-title {\r\n    font-size: 1.1rem;\r\n  }\r\n  \r\n  .comment-section-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n  }\r\n  \r\n  .comment-controls {\r\n    width: 100%;\r\n  }\r\n  \r\n  .sort-select {\r\n    width: 100%;\r\n  }\r\n}\r\n</style>","import { ref, Ref } from 'vue'\r\nimport apiClient from '@/services/api/client'\r\n\r\nexport interface RepostData {\r\n  wall_id?: number\r\n  commentary?: string\r\n}\r\n\r\nexport function useRepost() {\r\n  const loading = ref(false)\r\n  const error = ref<string | null>(null)\r\n\r\n  const repostPost = async (postId: number, data?: RepostData): Promise<any> => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      \r\n      const response = await apiClient.post(`/posts/${postId}/repost`, data || {})\r\n      \r\n      if (response.data.success) {\r\n        return response.data.data.post\r\n      } else {\r\n        throw new Error(response.data.message || 'Failed to repost post')\r\n      }\r\n    } catch (err: any) {\r\n      error.value = err.message || 'Failed to repost post'\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  return {\r\n    loading,\r\n    error,\r\n    repostPost\r\n  }\r\n}","<template>\r\n  <article class=\"post-card\">\r\n    <div class=\"post-header\">\r\n      <AppAvatar :src=\"post.user?.avatar_url\" :name=\"post.user?.display_name || post.user?.username\" size=\"md\" />\r\n      <div class=\"post-author\">\r\n        <router-link :to=\"`/profile/${post.user?.username}`\" class=\"author-name\">\r\n          {{ post.user?.display_name || post.user?.username }}\r\n        </router-link>\r\n        <span class=\"post-time\">{{ formatTime(post.created_at) }}</span>\r\n      </div>\r\n      <AppDropdown v-if=\"canEdit\" position=\"bottom-right\">\r\n        <template #trigger>\r\n          <button class=\"btn-icon\">‚ãÆ</button>\r\n        </template>\r\n        <button class=\"dropdown-item\" @click=\"$emit('edit')\">Edit</button>\r\n        <button class=\"dropdown-item danger\" @click=\"$emit('delete')\">Delete</button>\r\n      </AppDropdown>\r\n    </div>\r\n\r\n    <div class=\"post-content\" v-html=\"post.content_html || post.content\"></div>\r\n\r\n    <div v-if=\"post.media && post.media.length\" class=\"post-media\">\r\n      <img v-for=\"media in post.media\" :key=\"media.id\" :src=\"media.file_path\" :alt=\"'Media'\" />\r\n    </div>\r\n\r\n    <div class=\"post-actions\">\r\n      <ReactionPicker \r\n        reactable-type=\"post\" \r\n        :reactable-id=\"post.post_id\" \r\n      />\r\n      <button class=\"action-btn\" @click=\"toggleComments\">\r\n        <span>üí¨</span>\r\n        <span v-if=\"post.comments_count\">{{ post.comments_count }}</span>\r\n      </button>\r\n      <button class=\"action-btn\" @click=\"handleRepost\">\r\n        <span>üîÑ</span>\r\n        <span v-if=\"post.shares_count\">{{ post.shares_count }}</span>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Comments Section -->\r\n    <CommentSection \r\n      v-if=\"showComments\"\r\n      :post-id=\"post.post_id\"\r\n      :allow-comments=\"true\"\r\n    />\r\n  </article>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed } from 'vue'\r\nimport type { Post } from '@/types/models'\r\nimport AppAvatar from '@/components/common/AppAvatar.vue'\r\nimport AppDropdown from '@/components/common/AppDropdown.vue'\r\nimport CommentSection from '@/components/comments/CommentSection.vue'\r\nimport ReactionPicker from '@/components/social/ReactionPicker.vue'\r\nimport { formatRelativeTime } from '@/utils/formatting'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport { useRepost } from '@/composables/useRepost'\r\nimport { useToast } from '@/composables/useToast'\r\n\r\nconst props = defineProps<{ post: Post }>()\r\nconst emit = defineEmits<{\r\n  edit: []\r\n  delete: []\r\n  comment: []\r\n  share: []\r\n  react: [type: string]\r\n}>()\r\n\r\nconst authStore = useAuthStore()\r\nconst showComments = ref(false)\r\nconst canEdit = computed(() => authStore.user?.id === props.post.user_id)\r\n\r\nconst { repostPost } = useRepost()\r\nconst { showToast } = useToast()\r\n\r\nconst formatTime = (date: string) => formatRelativeTime(date)\r\nconst toggleComments = () => {\r\n  showComments.value = !showComments.value\r\n}\r\n\r\nconst handleRepost = async () => {\r\n  try {\r\n    await repostPost(props.post.post_id)\r\n    showToast('Post reposted successfully', 'success')\r\n  } catch (error) {\r\n    showToast('Failed to repost post', 'error')\r\n    console.error('Repost failed:', error)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.post-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: var(--spacing-4); margin-bottom: var(--spacing-4); }\r\n.post-header { display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-3); }\r\n.post-author { flex: 1; }\r\n.author-name { font-weight: 600; color: var(--text-primary); text-decoration: none; }\r\n.author-name:hover { text-decoration: underline; }\r\n.post-time { display: block; font-size: 0.85rem; color: var(--text-secondary); }\r\n.post-content { margin-bottom: var(--spacing-3); line-height: 1.6; }\r\n.post-media { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2); margin-bottom: var(--spacing-3); }\r\n.post-media img { width: 100%; border-radius: var(--radius-md); }\r\n.post-actions { display: flex; gap: var(--spacing-4); padding-top: var(--spacing-3); border-top: 1px solid var(--border); }\r\n.action-btn { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: var(--spacing-2); color: var(--text-secondary); font-size: 0.9rem; padding: var(--spacing-2); border-radius: var(--radius-md); transition: all 0.2s; }\r\n.action-btn:hover { background: var(--surface-hover); color: var(--text-primary); }\r\n.dropdown-item.danger { color: var(--danger); }\r\n</style>","<template>\r\n  <div class=\"post-list\">\r\n    <PostCard v-for=\"post in posts\" :key=\"post.id\" :post=\"post\" @react=\"handleReact(post.id, $event)\" @comment=\"handleComment(post.id)\" @share=\"handleShare(post.id)\" @edit=\"handleEdit(post.id)\" @delete=\"handleDelete(post.id)\" />\r\n    <div v-if=\"loading\" class=\"loading\"><div class=\"spinner\"></div><p>Loading posts...</p></div>\r\n    <div v-if=\"!loading && !hasMore\" class=\"end-message\">No more posts</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport type { Post } from '@/types/models'\r\nimport PostCard from './PostCard.vue'\r\n\r\ndefineProps<{ posts: Post[]; loading: boolean; hasMore: boolean }>()\r\nconst emit = defineEmits<{\r\n  react: [postId: number, type: string]\r\n  comment: [postId: number]\r\n  share: [postId: number]\r\n  edit: [postId: number]\r\n  delete: [postId: number]\r\n}>()\r\n\r\nconst handleReact = (id: number, type: string) => emit('react', id, type)\r\nconst handleComment = (id: number) => emit('comment', id)\r\nconst handleShare = (id: number) => emit('share', id)\r\nconst handleEdit = (id: number) => emit('edit', id)\r\nconst handleDelete = (id: number) => emit('delete', id)\r\n</script>\r\n\r\n<style scoped>\r\n.post-list { max-width: 800px; margin: 0 auto; }\r\n.loading, .end-message { text-align: center; padding: var(--spacing-6); color: var(--text-secondary); }\r\n.spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto var(--spacing-3); }\r\n@keyframes spin { to { transform: rotate(360deg); } }\r\n</style>\r\n","<template>\r\n  <AppModal v-model=\"isOpen\" title=\"Create Post\" size=\"md\">\r\n    <form @submit.prevent=\"handleSubmit\">\r\n      <textarea v-model=\"content\" placeholder=\"What's on your mind?\" rows=\"6\" class=\"post-input\"></textarea>\r\n      <div class=\"form-actions\">\r\n        <input type=\"file\" ref=\"fileInput\" @change=\"handleFileSelect\" accept=\"image/*,video/*\" multiple hidden />\r\n        <AppButton type=\"button\" variant=\"ghost\" @click=\"fileInput?.click()\">üìé Add Media</AppButton>\r\n        <AppButton type=\"submit\" variant=\"primary\" :loading=\"loading\">Post</AppButton>\r\n      </div>\r\n    </form>\r\n  </AppModal>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue'\r\nimport AppModal from '@/components/common/AppModal.vue'\r\nimport AppButton from '@/components/common/AppButton.vue'\r\n\r\nconst props = defineProps<{ modelValue: boolean; wallId: number }>()\r\nconst emit = defineEmits<{ 'update:modelValue': [value: boolean]; submit: [data: any] }>()\r\n\r\nconst isOpen = ref(props.modelValue)\r\nconst content = ref('')\r\nconst files = ref<File[]>([])\r\nconst fileInput = ref<HTMLInputElement>()\r\nconst loading = ref(false)\r\n\r\nconst handleFileSelect = (e: Event) => {\r\n  const target = e.target as HTMLInputElement\r\n  if (target.files) files.value = Array.from(target.files)\r\n}\r\n\r\nconst handleSubmit = () => {\r\n  if (!content.value.trim()) return\r\n  emit('submit', { wall_id: props.wallId, content: content.value, media_files: files.value })\r\n  content.value = ''\r\n  files.value = []\r\n  emit('update:modelValue', false)\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.post-input { width: 100%; padding: var(--spacing-3); border: 1px solid var(--border); border-radius: var(--radius-md); font-family: inherit; font-size: 1rem; resize: vertical; }\r\n.form-actions { display: flex; justify-content: space-between; margin-top: var(--spacing-4); }\r\n</style>\r\n","import { ref, onMounted, onUnmounted } from 'vue'\r\n\r\nexport const useInfiniteScroll = (callback: () => void, options = { threshold: 0.8 }) => {\r\n  const targetRef = ref<HTMLElement>()\r\n  const isLoading = ref(false)\r\n\r\n  const handleScroll = () => {\r\n    if (!targetRef.value || isLoading.value) return\r\n    \r\n    const { scrollTop, scrollHeight, clientHeight } = targetRef.value\r\n    const scrollPercentage = (scrollTop + clientHeight) / scrollHeight\r\n    \r\n    if (scrollPercentage >= options.threshold) {\r\n      isLoading.value = true\r\n      callback()\r\n      setTimeout(() => { isLoading.value = false }, 1000)\r\n    }\r\n  }\r\n\r\n  onMounted(() => {\r\n    targetRef.value?.addEventListener('scroll', handleScroll)\r\n    window.addEventListener('scroll', handleScroll)\r\n  })\r\n\r\n  onUnmounted(() => {\r\n    targetRef.value?.removeEventListener('scroll', handleScroll)\r\n    window.removeEventListener('scroll', handleScroll)\r\n  })\r\n\r\n  return { targetRef, isLoading }\r\n}\r\n","<template>\r\n  <div class=\"home-view\">\r\n    <div class=\"feed-header\">\r\n      <h1>Home Feed</h1>\r\n      <AppButton variant=\"primary\" @click=\"showCreatePost = true\">+ Create Post</AppButton>\r\n    </div>\r\n    <PostList :posts=\"postsStore.feedPosts\" :loading=\"postsStore.loading\" :has-more=\"postsStore.hasMore\" @react=\"handleReact\" @comment=\"handleComment\" @share=\"handleShare\" @edit=\"handleEdit\" @delete=\"handleDelete\" />\r\n    <PostCreator v-model=\"showCreatePost\" :wall-id=\"currentWallId\" @submit=\"handleCreatePost\" />\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { usePostsStore } from '@/stores/posts'\r\nimport PostList from '@/components/posts/PostList.vue'\r\nimport PostCreator from '@/components/posts/PostCreator.vue'\r\nimport AppButton from '@/components/common/AppButton.vue'\r\nimport { useInfiniteScroll } from '@/composables/useInfiniteScroll'\r\n\r\nconst postsStore = usePostsStore()\r\nconst showCreatePost = ref(false)\r\nconst currentWallId = ref(1) // Default wall ID\r\n\r\nonMounted(() => {\r\n  postsStore.fetchFeed()\r\n})\r\n\r\nuseInfiniteScroll(() => {\r\n  if (postsStore.hasMore && !postsStore.loading) {\r\n    postsStore.loadMore()\r\n  }\r\n})\r\n\r\nconst handleCreatePost = async (data: any) => {\r\n  await postsStore.createPost(data)\r\n}\r\n\r\nconst handleReact = (postId: number, type: string) => {\r\n  postsStore.reactToPost(postId, type)\r\n}\r\n\r\nconst handleComment = (postId: number) => {\r\n  console.log('Comment on post', postId)\r\n}\r\n\r\nconst handleShare = (postId: number) => {\r\n  console.log('Share post', postId)\r\n}\r\n\r\nconst handleEdit = (postId: number) => {\r\n  console.log('Edit post', postId)\r\n}\r\n\r\nconst handleDelete = async (postId: number) => {\r\n  if (confirm('Delete this post?')) {\r\n    await postsStore.deletePost(postId)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.home-view { max-width: 800px; margin: 0 auto; padding: var(--spacing-4); }\r\n.feed-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-6); }\r\n.feed-header h1 { margin: 0; }\r\n</style>\r\n"],"names":["usePostsStore","defineStore","posts","ref","feedPosts","currentPage","totalPages","hasMore","loading","filters","getPostById","computed","postId","p","fetchFeed","page","reset","response","postsAPI","postsData","_a","_b","_c","post","existingIndex","error","loadMore","refreshFeed","postData","newPost","updates","updatedPost","feedIndex","cacheIndex","reactionType","newFilters","props","__props","emit","__emit","t","useI18n","content","isSubmitting","textareaRef","charCount","canSubmit","trimmed","submitButtonText","autoResize","event","textarea","submitComment","apiClient","err","cancel","watch","newVal","onMounted","_createElementBlock","_createElementVNode","_hoisted_1","$event","_unref","_hoisted_3","_normalizeClass","_toDisplayString","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","authStore","useAuthStore","isEditing","showReplyForm","showReactionPicker","repliesExpanded","reactionTypes","isOwner","canEdit","createdTime","indentPixels","baseIndent","formatTime","timestamp","date","diffMs","diffMins","diffHours","diffDays","formatCount","count","getReactionEmoji","type","reaction","r","startEdit","deleteComment","toggleReply","toggleReplies","toggleReactionPicker","reactToComment","onUpdated","updatedComment","onReplyCreated","reply","_createVNode","_component_router_link","_createTextVNode","_openBlock","_hoisted_9","_createBlock","CommentForm","_hoisted_11","_hoisted_12","_hoisted_14","_hoisted_15","_Fragment","_renderList","_hoisted_16","_hoisted_17","_hoisted_18","_component_CommentItem","_cache","$emit","comments","sortBy","totalCount","pollInterval","topLevelComments","c","isValidComment","comment","requiredFields","field","fetchComments","buildCommentTree","commentMap","parent","onCommentCreated","onCommentUpdated","index","onCommentDeleted","commentId","startPolling","stopPolling","onUnmounted","_hoisted_2","_hoisted_8","_hoisted_10","CommentItem","useRepost","data","showComments","repostPost","showToast","useToast","formatRelativeTime","toggleComments","handleRepost","AppAvatar","_d","AppDropdown","media","ReactionPicker","CommentSection","handleReact","id","handleComment","handleShare","handleEdit","handleDelete","PostCard","isOpen","files","fileInput","handleFileSelect","e","target","handleSubmit","AppModal","AppButton","useInfiniteScroll","callback","options","targetRef","isLoading","handleScroll","scrollTop","scrollHeight","clientHeight","postsStore","showCreatePost","currentWallId","handleCreatePost","PostList","PostCreator"],"mappings":"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"}