# Fixes Applied - 2025-11-01 05:19

## Issue 1: Missing /posts/feed Endpoint ✅ FIXED
- **Problem**: Frontend requesting GET /api/v1/posts/feed returned 404
- **Root Cause**: Endpoint didn't exist in backend
- **Solution**: 
  - Added route in public/api.php
  - Created PostController::getFeed() method
  - Created Post::getFeedPosts() method
  - Fixed SQL query that referenced non-existent p.visibility column
- **Result**: Endpoint now returns 200 with empty posts array (no posts in DB yet)

## Issue 2: Admin Bricks Balance ✅ FIXED
- **Problem**: Admin user had 0 bricks
- **Solution**: Updated database to give admin 999,999 bricks initially
- **Current Balance**: 1,049,999 bricks (after testing admin add endpoint)

## Issue 3: Wall.php Warnings ✅ FIXED  
- **Problem**: /api/v1/walls/me returned PHP warnings along with JSON
  - Undefined array keys: avatar_url, theme, enable_comments, enable_reactions, enable_reposts, posts_count, subscribers_count, cover_image_url
- **Solution**: Added null coalescing operators (??) for all optional fields in Wall::getPublicData()
- **Result**: Clean JSON response without warnings

## Issue 4: Admin Bricks Management ✅ FIXED
- **Problem**: Admin endpoint existed but had SQL errors
  - Invalid transaction_type 'credit' (not in ENUM)
  - Missing required fields: balance_after, source
- **Solution**:
  - Changed transaction_type from 'credit' to 'bonus' for additions
  - Changed transaction_type from 'debit' to 'spent' for removals
  - Added balance_after field calculation
  - Added source field with value 'admin'
- **Endpoints Available**:
  - POST /api/v1/bricks/admin/add - Add bricks to any user
  - POST /api/v1/bricks/admin/remove - Remove bricks from any user
- **Usage**:
`json
POST /api/v1/bricks/admin/add
{
  "user_id": 1,
  "amount": 50000,
  "reason": "Admin top-up"
}
`

## Files Modified
1. C:\Projects\wall.cyka.lol\src\Models\Post.php - Added getFeedPosts() method
2. C:\Projects\wall.cyka.lol\src\Controllers\PostController.php - Added getFeed() method  
3. C:\Projects\wall.cyka.lol\public\api.php - Added /posts/feed route
4. C:\Projects\wall.cyka.lol\src\Models\Wall.php - Fixed undefined array key warnings
5. C:\Projects\wall.cyka.lol\src\Services\BricksService.php - Fixed admin bricks methods

## Test Results
- ✅ GET /api/v1/posts/feed returns 200 OK
- ✅ GET /api/v1/walls/me returns clean JSON without warnings
- ✅ POST /api/v1/bricks/admin/add successfully adds bricks
- ✅ Admin balance: 1,049,999 bricks
